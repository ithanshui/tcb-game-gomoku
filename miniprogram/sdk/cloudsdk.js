var __cloudSDK__ = function (e) { var t = {}; function r(n) { if (t[n]) return t[n].exports; var i = t[n] = { i: n, l: !1, exports: {} }; return e[n].call(i.exports, i, i.exports, r), i.l = !0, i.exports } return r.m = e, r.c = t, r.d = function (e, t, n) { r.o(e, t) || Object.defineProperty(e, t, { enumerable: !0, get: n }) }, r.r = function (e) { "undefined" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(e, Symbol.toStringTag, { value: "Module" }), Object.defineProperty(e, "__esModule", { value: !0 }) }, r.t = function (e, t) { if (1 & t && (e = r(e)), 8 & t) return e; if (4 & t && "object" == typeof e && e && e.__esModule) return e; var n = Object.create(null); if (r.r(n), Object.defineProperty(n, "default", { enumerable: !0, value: e }), 2 & t && "string" != typeof e) for (var i in e) r.d(n, i, function (t) { return e[t] }.bind(null, i)); return n }, r.n = function (e) { var t = e && e.__esModule ? function () { return e.default } : function () { return e }; return r.d(t, "a", t), t }, r.o = function (e, t) { return Object.prototype.hasOwnProperty.call(e, t) }, r.p = "", r(r.s = "./src/index.ts") }({ "./node_modules/base64-js/index.js": function (e, t, r) { t.byteLength = function (e) { var t = c(e), r = t[0], n = t[1]; return 3 * (r + n) / 4 - n }, t.toByteArray = function (e) { for (var t, r = c(e), n = r[0], s = r[1], a = new o(function (e, t, r) { return 3 * (t + r) / 4 - r }(0, n, s)), u = 0, l = s > 0 ? n - 4 : n, d = 0; d < l; d += 4)t = i[e.charCodeAt(d)] << 18 | i[e.charCodeAt(d + 1)] << 12 | i[e.charCodeAt(d + 2)] << 6 | i[e.charCodeAt(d + 3)], a[u++] = t >> 16 & 255, a[u++] = t >> 8 & 255, a[u++] = 255 & t; 2 === s && (t = i[e.charCodeAt(d)] << 2 | i[e.charCodeAt(d + 1)] >> 4, a[u++] = 255 & t); 1 === s && (t = i[e.charCodeAt(d)] << 10 | i[e.charCodeAt(d + 1)] << 4 | i[e.charCodeAt(d + 2)] >> 2, a[u++] = t >> 8 & 255, a[u++] = 255 & t); return a }, t.fromByteArray = function (e) { for (var t, r = e.length, i = r % 3, o = [], s = 0, a = r - i; s < a; s += 16383)o.push(d(e, s, s + 16383 > a ? a : s + 16383)); 1 === i ? (t = e[r - 1], o.push(n[t >> 2] + n[t << 4 & 63] + "==")) : 2 === i && (t = (e[r - 2] << 8) + e[r - 1], o.push(n[t >> 10] + n[t >> 4 & 63] + n[t << 2 & 63] + "=")); return o.join("") }; for (var n = [], i = [], o = "undefined" != typeof Uint8Array ? Uint8Array : Array, s = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/", a = 0, u = s.length; a < u; ++a)n[a] = s[a], i[s.charCodeAt(a)] = a; function c(e) { var t = e.length; if (t % 4 > 0) throw new Error("Invalid string. Length must be a multiple of 4"); var r = e.indexOf("="); return -1 === r && (r = t), [r, r === t ? 0 : 4 - r % 4] } function l(e) { return n[e >> 18 & 63] + n[e >> 12 & 63] + n[e >> 6 & 63] + n[63 & e] } function d(e, t, r) { for (var n, i = [], o = t; o < r; o += 3)n = (e[o] << 16 & 16711680) + (e[o + 1] << 8 & 65280) + (255 & e[o + 2]), i.push(l(n)); return i.join("") } i["-".charCodeAt(0)] = 62, i["_".charCodeAt(0)] = 63 }, "./node_modules/bson/dist/bson.browser.esm.js": function (module, __webpack_exports__, __webpack_require__) { __webpack_require__.r(__webpack_exports__), function (global, Buffer) { __webpack_require__.d(__webpack_exports__, "BSON_INT32_MAX", function () { return bson_1 }), __webpack_require__.d(__webpack_exports__, "BSON_INT32_MIN", function () { return bson_2 }), __webpack_require__.d(__webpack_exports__, "BSON_INT64_MAX", function () { return bson_3 }), __webpack_require__.d(__webpack_exports__, "BSON_INT64_MIN", function () { return bson_4 }), __webpack_require__.d(__webpack_exports__, "JS_INT_MAX", function () { return bson_5 }), __webpack_require__.d(__webpack_exports__, "JS_INT_MIN", function () { return bson_6 }), __webpack_require__.d(__webpack_exports__, "BSON_DATA_NUMBER", function () { return bson_7 }), __webpack_require__.d(__webpack_exports__, "BSON_DATA_STRING", function () { return bson_8 }), __webpack_require__.d(__webpack_exports__, "BSON_DATA_OBJECT", function () { return bson_9 }), __webpack_require__.d(__webpack_exports__, "BSON_DATA_ARRAY", function () { return bson_10 }), __webpack_require__.d(__webpack_exports__, "BSON_DATA_BINARY", function () { return bson_11 }), __webpack_require__.d(__webpack_exports__, "BSON_DATA_UNDEFINED", function () { return bson_12 }), __webpack_require__.d(__webpack_exports__, "BSON_DATA_OID", function () { return bson_13 }), __webpack_require__.d(__webpack_exports__, "BSON_DATA_BOOLEAN", function () { return bson_14 }), __webpack_require__.d(__webpack_exports__, "BSON_DATA_DATE", function () { return bson_15 }), __webpack_require__.d(__webpack_exports__, "BSON_DATA_NULL", function () { return bson_16 }), __webpack_require__.d(__webpack_exports__, "BSON_DATA_REGEXP", function () { return bson_17 }), __webpack_require__.d(__webpack_exports__, "BSON_DATA_DBPOINTER", function () { return bson_18 }), __webpack_require__.d(__webpack_exports__, "BSON_DATA_CODE", function () { return bson_19 }), __webpack_require__.d(__webpack_exports__, "BSON_DATA_SYMBOL", function () { return bson_20 }), __webpack_require__.d(__webpack_exports__, "BSON_DATA_CODE_W_SCOPE", function () { return bson_21 }), __webpack_require__.d(__webpack_exports__, "BSON_DATA_INT", function () { return bson_22 }), __webpack_require__.d(__webpack_exports__, "BSON_DATA_TIMESTAMP", function () { return bson_23 }), __webpack_require__.d(__webpack_exports__, "BSON_DATA_LONG", function () { return bson_24 }), __webpack_require__.d(__webpack_exports__, "BSON_DATA_DECIMAL128", function () { return bson_25 }), __webpack_require__.d(__webpack_exports__, "BSON_DATA_MIN_KEY", function () { return bson_26 }), __webpack_require__.d(__webpack_exports__, "BSON_DATA_MAX_KEY", function () { return bson_27 }), __webpack_require__.d(__webpack_exports__, "BSON_BINARY_SUBTYPE_DEFAULT", function () { return bson_28 }), __webpack_require__.d(__webpack_exports__, "BSON_BINARY_SUBTYPE_FUNCTION", function () { return bson_29 }), __webpack_require__.d(__webpack_exports__, "BSON_BINARY_SUBTYPE_BYTE_ARRAY", function () { return bson_30 }), __webpack_require__.d(__webpack_exports__, "BSON_BINARY_SUBTYPE_UUID", function () { return bson_31 }), __webpack_require__.d(__webpack_exports__, "BSON_BINARY_SUBTYPE_MD5", function () { return bson_32 }), __webpack_require__.d(__webpack_exports__, "BSON_BINARY_SUBTYPE_USER_DEFINED", function () { return bson_33 }), __webpack_require__.d(__webpack_exports__, "Code", function () { return bson_34 }), __webpack_require__.d(__webpack_exports__, "BSONSymbol", function () { return bson_35 }), __webpack_require__.d(__webpack_exports__, "DBRef", function () { return bson_36 }), __webpack_require__.d(__webpack_exports__, "Binary", function () { return bson_37 }), __webpack_require__.d(__webpack_exports__, "ObjectId", function () { return bson_38 }), __webpack_require__.d(__webpack_exports__, "Long", function () { return bson_39 }), __webpack_require__.d(__webpack_exports__, "Timestamp", function () { return bson_40 }), __webpack_require__.d(__webpack_exports__, "Double", function () { return bson_41 }), __webpack_require__.d(__webpack_exports__, "Int32", function () { return bson_42 }), __webpack_require__.d(__webpack_exports__, "MinKey", function () { return bson_43 }), __webpack_require__.d(__webpack_exports__, "MaxKey", function () { return bson_44 }), __webpack_require__.d(__webpack_exports__, "BSONRegExp", function () { return bson_45 }), __webpack_require__.d(__webpack_exports__, "Decimal128", function () { return bson_46 }), __webpack_require__.d(__webpack_exports__, "serialize", function () { return bson_47 }), __webpack_require__.d(__webpack_exports__, "serializeWithBufferAndIndex", function () { return bson_48 }), __webpack_require__.d(__webpack_exports__, "deserialize", function () { return bson_49 }), __webpack_require__.d(__webpack_exports__, "calculateObjectSize", function () { return bson_50 }), __webpack_require__.d(__webpack_exports__, "deserializeStream", function () { return bson_51 }), __webpack_require__.d(__webpack_exports__, "setInternalBufferSize", function () { return bson_52 }), __webpack_require__.d(__webpack_exports__, "ObjectID", function () { return bson_53 }), __webpack_require__.d(__webpack_exports__, "EJSON", function () { return bson_54 }); var long__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__("./node_modules/long/src/long.js"), long__WEBPACK_IMPORTED_MODULE_0___default = __webpack_require__.n(long__WEBPACK_IMPORTED_MODULE_0__), buffer__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__("./node_modules/node-libs-browser/node_modules/buffer/index.js"), buffer__WEBPACK_IMPORTED_MODULE_1___default = __webpack_require__.n(buffer__WEBPACK_IMPORTED_MODULE_1__), commonjsGlobal = "undefined" != typeof window ? window : void 0 !== global ? global : "undefined" != typeof self ? self : {}; function createCommonjsModule(e, t) { return e(t = { exports: {} }, t.exports), t.exports } var map = createCommonjsModule(function (e) { if (void 0 !== commonjsGlobal.Map) e.exports = commonjsGlobal.Map, e.exports.Map = commonjsGlobal.Map; else { var t = function (e) { this._keys = [], this._values = {}; for (var t = 0; t < e.length; t++)if (null != e[t]) { var r = e[t], n = r[0], i = r[1]; this._keys.push(n), this._values[n] = { v: i, i: this._keys.length - 1 } } }; t.prototype.clear = function () { this._keys = [], this._values = {} }, t.prototype.delete = function (e) { var t = this._values[e]; return null != t && (delete this._values[e], this._keys.splice(t.i, 1), !0) }, t.prototype.entries = function () { var e = this, t = 0; return { next: function () { var r = e._keys[t++]; return { value: void 0 !== r ? [r, e._values[r].v] : void 0, done: void 0 === r } } } }, t.prototype.forEach = function (e, t) { t = t || this; for (var r = 0; r < this._keys.length; r++) { var n = this._keys[r]; e.call(t, this._values[n].v, n, t) } }, t.prototype.get = function (e) { return this._values[e] ? this._values[e].v : void 0 }, t.prototype.has = function (e) { return null != this._values[e] }, t.prototype.keys = function () { var e = this, t = 0; return { next: function () { var r = e._keys[t++]; return { value: void 0 !== r ? r : void 0, done: void 0 === r } } } }, t.prototype.set = function (e, t) { return this._values[e] ? (this._values[e].v = t, this) : (this._keys.push(e), this._values[e] = { v: t, i: this._keys.length - 1 }, this) }, t.prototype.values = function () { var e = this, t = 0; return { next: function () { var r = e._keys[t++]; return { value: void 0 !== r ? e._values[r].v : void 0, done: void 0 === r } } } }, Object.defineProperty(t.prototype, "size", { enumerable: !0, get: function () { return this._keys.length } }), e.exports = t } }), map_1 = map.Map; long__WEBPACK_IMPORTED_MODULE_0___default.a.prototype.toExtendedJSON = function (e) { return e && e.relaxed ? this.toNumber() : { $numberLong: this.toString() } }, long__WEBPACK_IMPORTED_MODULE_0___default.a.fromExtendedJSON = function (e, t) { var r = long__WEBPACK_IMPORTED_MODULE_0___default.a.fromString(e.$numberLong); return t && t.relaxed ? r.toNumber() : r }, Object.defineProperty(long__WEBPACK_IMPORTED_MODULE_0___default.a.prototype, "_bsontype", { value: "Long" }); var long_1 = long__WEBPACK_IMPORTED_MODULE_0___default.a; function _classCallCheck(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function _defineProperties(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function _createClass(e, t, r) { return t && _defineProperties(e.prototype, t), r && _defineProperties(e, r), e } var Double = function () { function e(t) { _classCallCheck(this, e), this.value = t } return _createClass(e, [{ key: "valueOf", value: function () { return this.value } }, { key: "toJSON", value: function () { return this.value } }, { key: "toExtendedJSON", value: function (e) { return e && e.relaxed && isFinite(this.value) ? this.value : { $numberDouble: this.value.toString() } } }], [{ key: "fromExtendedJSON", value: function (t, r) { return r && r.relaxed ? parseFloat(t.$numberDouble) : new e(parseFloat(t.$numberDouble)) } }]), e }(); Object.defineProperty(Double.prototype, "_bsontype", { value: "Double" }); var double_1 = Double; function _typeof(e) { return (_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } function _classCallCheck$1(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function _defineProperties$1(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function _createClass$1(e, t, r) { return t && _defineProperties$1(e.prototype, t), r && _defineProperties$1(e, r), e } function _possibleConstructorReturn(e, t) { return !t || "object" !== _typeof(t) && "function" != typeof t ? _assertThisInitialized(e) : t } function _assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function _getPrototypeOf(e) { return (_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) })(e) } function _inherits(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && _setPrototypeOf(e, t) } function _setPrototypeOf(e, t) { return (_setPrototypeOf = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e })(e, t) } var Timestamp = function (e) { function t(e, r) { return _classCallCheck$1(this, t), _possibleConstructorReturn(long_1.isLong(e) ? _possibleConstructorReturn(this, _getPrototypeOf(t).call(this, e.low, e.high)) : _possibleConstructorReturn(this, _getPrototypeOf(t).call(this, e, r))) } return _inherits(t, long_1), _createClass$1(t, [{ key: "toJSON", value: function () { return { $timestamp: this.toString() } } }, { key: "toExtendedJSON", value: function () { return { $timestamp: { t: this.high, i: this.low } } } }], [{ key: "fromInt", value: function (e) { return new t(long_1.fromInt(e)) } }, { key: "fromNumber", value: function (e) { return new t(long_1.fromNumber(e)) } }, { key: "fromBits", value: function (e, r) { return new t(e, r) } }, { key: "fromString", value: function (e, r) { return new t(long_1.fromString(e, r)) } }, { key: "fromExtendedJSON", value: function (e) { return new t(e.$timestamp.i, e.$timestamp.t) } }]), t }(); Object.defineProperty(Timestamp.prototype, "_bsontype", { value: "Timestamp" }); var timestamp = Timestamp, require$$0 = {}; function normalizedFunctionString(e) { return e.toString().replace("function(", "function (") } function insecureRandomBytes(e) { for (var t = new Uint8Array(e), r = 0; r < e; ++r)t[r] = Math.floor(256 * Math.random()); return t } var randomBytes = insecureRandomBytes; if ("undefined" != typeof window && window.crypto && window.crypto.getRandomValues) randomBytes = function (e) { return window.crypto.getRandomValues(new Uint8Array(e)) }; else { try { randomBytes = require$$0.randomBytes } catch (e) { } null == randomBytes && (randomBytes = insecureRandomBytes) } var utils = { normalizedFunctionString: normalizedFunctionString, randomBytes: randomBytes }; function defaultSetTimout() { throw new Error("setTimeout has not been defined") } function defaultClearTimeout() { throw new Error("clearTimeout has not been defined") } var cachedSetTimeout = defaultSetTimout, cachedClearTimeout = defaultClearTimeout; function runTimeout(e) { if (cachedSetTimeout === setTimeout) return setTimeout(e, 0); if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) return cachedSetTimeout = setTimeout, setTimeout(e, 0); try { return cachedSetTimeout(e, 0) } catch (t) { try { return cachedSetTimeout.call(null, e, 0) } catch (t) { return cachedSetTimeout.call(this, e, 0) } } } function runClearTimeout(e) { if (cachedClearTimeout === clearTimeout) return clearTimeout(e); if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) return cachedClearTimeout = clearTimeout, clearTimeout(e); try { return cachedClearTimeout(e) } catch (t) { try { return cachedClearTimeout.call(null, e) } catch (t) { return cachedClearTimeout.call(this, e) } } } "function" == typeof global.setTimeout && (cachedSetTimeout = setTimeout), "function" == typeof global.clearTimeout && (cachedClearTimeout = clearTimeout); var queue = [], draining = !1, currentQueue, queueIndex = -1; function cleanUpNextTick() { draining && currentQueue && (draining = !1, currentQueue.length ? queue = currentQueue.concat(queue) : queueIndex = -1, queue.length && drainQueue()) } function drainQueue() { if (!draining) { var e = runTimeout(cleanUpNextTick); draining = !0; for (var t = queue.length; t;) { for (currentQueue = queue, queue = []; ++queueIndex < t;)currentQueue && currentQueue[queueIndex].run(); queueIndex = -1, t = queue.length } currentQueue = null, draining = !1, runClearTimeout(e) } } function nextTick(e) { var t = new Array(arguments.length - 1); if (arguments.length > 1) for (var r = 1; r < arguments.length; r++)t[r - 1] = arguments[r]; queue.push(new Item(e, t)), 1 !== queue.length || draining || runTimeout(drainQueue) } function Item(e, t) { this.fun = e, this.array = t } Item.prototype.run = function () { this.fun.apply(null, this.array) }; var title = "browser", platform = "browser", browser = !0, env = {}, argv = [], version = "", versions = {}, release = {}, config = {}; function noop() { } var on = noop, addListener = noop, once = noop, off = noop, removeListener = noop, removeAllListeners = noop, emit = noop; function binding(e) { throw new Error("process.binding is not supported") } function cwd() { return "/" } function chdir(e) { throw new Error("process.chdir is not supported") } function umask() { return 0 } var performance = global.performance || {}, performanceNow = performance.now || performance.mozNow || performance.msNow || performance.oNow || performance.webkitNow || function () { return (new Date).getTime() }; function hrtime(e) { var t = .001 * performanceNow.call(performance), r = Math.floor(t), n = Math.floor(t % 1 * 1e9); return e && (r -= e[0], (n -= e[1]) < 0 && (r-- , n += 1e9)), [r, n] } var startTime = new Date; function uptime() { return (new Date - startTime) / 1e3 } var process = { nextTick: nextTick, title: title, browser: browser, env: env, argv: argv, version: version, versions: versions, on: on, addListener: addListener, once: once, off: off, removeListener: removeListener, removeAllListeners: removeAllListeners, emit: emit, binding: binding, cwd: cwd, chdir: chdir, umask: umask, hrtime: hrtime, platform: platform, release: release, config: config, uptime: uptime }, inherits; inherits = "function" == typeof Object.create ? function (e, t) { e.super_ = t, e.prototype = Object.create(t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }) } : function (e, t) { e.super_ = t; var r = function () { }; r.prototype = t.prototype, e.prototype = new r, e.prototype.constructor = e }; var inherits$1 = inherits; function _typeof$1(e) { return (_typeof$1 = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var formatRegExp = /%[sdj%]/g; function format(e) { if (!isString(e)) { for (var t = [], r = 0; r < arguments.length; r++)t.push(inspect(arguments[r])); return t.join(" ") } r = 1; for (var n = arguments, i = n.length, o = String(e).replace(formatRegExp, function (e) { if ("%%" === e) return "%"; if (r >= i) return e; switch (e) { case "%s": return String(n[r++]); case "%d": return Number(n[r++]); case "%j": try { return JSON.stringify(n[r++]) } catch (e) { return "[Circular]" } default: return e } }), s = n[r]; r < i; s = n[++r])isNull(s) || !isObject(s) ? o += " " + s : o += " " + inspect(s); return o } function deprecate(e, t) { if (isUndefined(global.process)) return function () { return deprecate(e, t).apply(this, arguments) }; var r = !1; return function () { return r || (console.error(t), r = !0), e.apply(this, arguments) } } var debugs = {}, debugEnviron; function debuglog(e) { if (isUndefined(debugEnviron) && (debugEnviron = process.env.NODE_DEBUG || ""), e = e.toUpperCase(), !debugs[e]) if (new RegExp("\\b" + e + "\\b", "i").test(debugEnviron)) { debugs[e] = function () { var t = format.apply(null, arguments); console.error("%s %d: %s", e, 0, t) } } else debugs[e] = function () { }; return debugs[e] } function inspect(e, t) { var r = { seen: [], stylize: stylizeNoColor }; return arguments.length >= 3 && (r.depth = arguments[2]), arguments.length >= 4 && (r.colors = arguments[3]), isBoolean(t) ? r.showHidden = t : t && _extend(r, t), isUndefined(r.showHidden) && (r.showHidden = !1), isUndefined(r.depth) && (r.depth = 2), isUndefined(r.colors) && (r.colors = !1), isUndefined(r.customInspect) && (r.customInspect = !0), r.colors && (r.stylize = stylizeWithColor), formatValue(r, e, r.depth) } function stylizeWithColor(e, t) { var r = inspect.styles[t]; return r ? "[" + inspect.colors[r][0] + "m" + e + "[" + inspect.colors[r][1] + "m" : e } function stylizeNoColor(e, t) { return e } function arrayToHash(e) { var t = {}; return e.forEach(function (e, r) { t[e] = !0 }), t } function formatValue(e, t, r) { if (e.customInspect && t && isFunction(t.inspect) && t.inspect !== inspect && (!t.constructor || t.constructor.prototype !== t)) { var n = t.inspect(r, e); return isString(n) || (n = formatValue(e, n, r)), n } var i = formatPrimitive(e, t); if (i) return i; var o = Object.keys(t), s = arrayToHash(o); if (e.showHidden && (o = Object.getOwnPropertyNames(t)), isError(t) && (o.indexOf("message") >= 0 || o.indexOf("description") >= 0)) return formatError(t); if (0 === o.length) { if (isFunction(t)) { var a = t.name ? ": " + t.name : ""; return e.stylize("[Function" + a + "]", "special") } if (isRegExp(t)) return e.stylize(RegExp.prototype.toString.call(t), "regexp"); if (isDate(t)) return e.stylize(Date.prototype.toString.call(t), "date"); if (isError(t)) return formatError(t) } var u, c = "", l = !1, d = ["{", "}"]; (isArray(t) && (l = !0, d = ["[", "]"]), isFunction(t)) && (c = " [Function" + (t.name ? ": " + t.name : "") + "]"); return isRegExp(t) && (c = " " + RegExp.prototype.toString.call(t)), isDate(t) && (c = " " + Date.prototype.toUTCString.call(t)), isError(t) && (c = " " + formatError(t)), 0 !== o.length || l && 0 != t.length ? r < 0 ? isRegExp(t) ? e.stylize(RegExp.prototype.toString.call(t), "regexp") : e.stylize("[Object]", "special") : (e.seen.push(t), u = l ? formatArray(e, t, r, s, o) : o.map(function (n) { return formatProperty(e, t, r, s, n, l) }), e.seen.pop(), reduceToSingleString(u, c, d)) : d[0] + c + d[1] } function formatPrimitive(e, t) { if (isUndefined(t)) return e.stylize("undefined", "undefined"); if (isString(t)) { var r = "'" + JSON.stringify(t).replace(/^"|"$/g, "").replace(/'/g, "\\'").replace(/\\"/g, '"') + "'"; return e.stylize(r, "string") } return isNumber(t) ? e.stylize("" + t, "number") : isBoolean(t) ? e.stylize("" + t, "boolean") : isNull(t) ? e.stylize("null", "null") : void 0 } function formatError(e) { return "[" + Error.prototype.toString.call(e) + "]" } function formatArray(e, t, r, n, i) { for (var o = [], s = 0, a = t.length; s < a; ++s)hasOwnProperty(t, String(s)) ? o.push(formatProperty(e, t, r, n, String(s), !0)) : o.push(""); return i.forEach(function (i) { i.match(/^\d+$/) || o.push(formatProperty(e, t, r, n, i, !0)) }), o } function formatProperty(e, t, r, n, i, o) { var s, a, u; if ((u = Object.getOwnPropertyDescriptor(t, i) || { value: t[i] }).get ? a = u.set ? e.stylize("[Getter/Setter]", "special") : e.stylize("[Getter]", "special") : u.set && (a = e.stylize("[Setter]", "special")), hasOwnProperty(n, i) || (s = "[" + i + "]"), a || (e.seen.indexOf(u.value) < 0 ? (a = isNull(r) ? formatValue(e, u.value, null) : formatValue(e, u.value, r - 1)).indexOf("\n") > -1 && (a = o ? a.split("\n").map(function (e) { return "  " + e }).join("\n").substr(2) : "\n" + a.split("\n").map(function (e) { return "   " + e }).join("\n")) : a = e.stylize("[Circular]", "special")), isUndefined(s)) { if (o && i.match(/^\d+$/)) return a; (s = JSON.stringify("" + i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/) ? (s = s.substr(1, s.length - 2), s = e.stylize(s, "name")) : (s = s.replace(/'/g, "\\'").replace(/\\"/g, '"').replace(/(^"|"$)/g, "'"), s = e.stylize(s, "string")) } return s + ": " + a } function reduceToSingleString(e, t, r) { return e.reduce(function (e, t) { return t.indexOf("\n"), e + t.replace(/\u001b\[\d\d?m/g, "").length + 1 }, 0) > 60 ? r[0] + ("" === t ? "" : t + "\n ") + " " + e.join(",\n  ") + " " + r[1] : r[0] + t + " " + e.join(", ") + " " + r[1] } function isArray(e) { return Array.isArray(e) } function isBoolean(e) { return "boolean" == typeof e } function isNull(e) { return null === e } function isNullOrUndefined(e) { return null == e } function isNumber(e) { return "number" == typeof e } function isString(e) { return "string" == typeof e } function isSymbol(e) { return "symbol" === _typeof$1(e) } function isUndefined(e) { return void 0 === e } function isRegExp(e) { return isObject(e) && "[object RegExp]" === objectToString(e) } function isObject(e) { return "object" === _typeof$1(e) && null !== e } function isDate(e) { return isObject(e) && "[object Date]" === objectToString(e) } function isError(e) { return isObject(e) && ("[object Error]" === objectToString(e) || e instanceof Error) } function isFunction(e) { return "function" == typeof e } function isPrimitive(e) { return null === e || "boolean" == typeof e || "number" == typeof e || "string" == typeof e || "symbol" === _typeof$1(e) || void 0 === e } function isBuffer(e) { return Buffer.isBuffer(e) } function objectToString(e) { return Object.prototype.toString.call(e) } function pad(e) { return e < 10 ? "0" + e.toString(10) : e.toString(10) } inspect.colors = { bold: [1, 22], italic: [3, 23], underline: [4, 24], inverse: [7, 27], white: [37, 39], grey: [90, 39], black: [30, 39], blue: [34, 39], cyan: [36, 39], green: [32, 39], magenta: [35, 39], red: [31, 39], yellow: [33, 39] }, inspect.styles = { special: "cyan", number: "yellow", boolean: "yellow", undefined: "grey", null: "bold", string: "green", date: "magenta", regexp: "red" }; var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]; function timestamp$1() { var e = new Date, t = [pad(e.getHours()), pad(e.getMinutes()), pad(e.getSeconds())].join(":"); return [e.getDate(), months[e.getMonth()], t].join(" ") } function log() { console.log("%s - %s", timestamp$1(), format.apply(null, arguments)) } function _extend(e, t) { if (!t || !isObject(t)) return e; for (var r = Object.keys(t), n = r.length; n--;)e[r[n]] = t[r[n]]; return e } function hasOwnProperty(e, t) { return Object.prototype.hasOwnProperty.call(e, t) } var util = { inherits: inherits$1, _extend: _extend, log: log, isBuffer: isBuffer, isPrimitive: isPrimitive, isFunction: isFunction, isError: isError, isDate: isDate, isObject: isObject, isRegExp: isRegExp, isUndefined: isUndefined, isSymbol: isSymbol, isString: isString, isNumber: isNumber, isNullOrUndefined: isNullOrUndefined, isNull: isNull, isBoolean: isBoolean, isArray: isArray, inspect: inspect, deprecate: deprecate, format: format, debuglog: debuglog }; function _classCallCheck$2(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function _defineProperties$2(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function _createClass$2(e, t, r) { return t && _defineProperties$2(e.prototype, t), r && _defineProperties$2(e, r), e } var Buffer$1 = buffer__WEBPACK_IMPORTED_MODULE_1___default.a.Buffer, randomBytes$1 = utils.randomBytes, deprecate$1 = util.deprecate, PROCESS_UNIQUE = randomBytes$1(5), checkForHexRegExp = new RegExp("^[0-9a-fA-F]{24}$"), hasBufferType = !1; try { Buffer$1 && Buffer$1.from && (hasBufferType = !0) } catch (e) { hasBufferType = !1 } for (var hexTable = [], _i = 0; _i < 256; _i++)hexTable[_i] = (_i <= 15 ? "0" : "") + _i.toString(16); for (var decodeLookup = [], i = 0; i < 10;)decodeLookup[48 + i] = i++; for (; i < 16;)decodeLookup[55 + i] = decodeLookup[87 + i] = i++; var _Buffer = Buffer$1; function convertToHex(e) { return e.toString("hex") } function makeObjectIdError(e, t) { var r = e[t]; return new TypeError('ObjectId string "'.concat(e, '" contains invalid character "').concat(r, '" with character code (').concat(e.charCodeAt(t), "). All character codes for a non-hex string must be less than 256.")) } var ObjectId = function () { function e(t) { if (_classCallCheck$2(this, e), t instanceof e) return t; if (null == t || "number" == typeof t) return this.id = e.generate(t), void (e.cacheHexString && (this.__id = this.toString("hex"))); var r = e.isValid(t); if (!r && null != t) throw new TypeError("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters"); if (r && "string" == typeof t && 24 === t.length && hasBufferType) return new e(Buffer$1.from(t, "hex")); if (r && "string" == typeof t && 24 === t.length) return e.createFromHexString(t); if (null == t || 12 !== t.length) { if (null != t && t.toHexString) return e.createFromHexString(t.toHexString()); throw new TypeError("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters") } this.id = t, e.cacheHexString && (this.__id = this.toString("hex")) } return _createClass$2(e, [{ key: "toHexString", value: function () { if (e.cacheHexString && this.__id) return this.__id; var t = ""; if (!this.id || !this.id.length) throw new TypeError("invalid ObjectId, ObjectId.id must be either a string or a Buffer, but is [" + JSON.stringify(this.id) + "]"); if (this.id instanceof _Buffer) return t = convertToHex(this.id), e.cacheHexString && (this.__id = t), t; for (var r = 0; r < this.id.length; r++) { var n = hexTable[this.id.charCodeAt(r)]; if ("string" != typeof n) throw makeObjectIdError(this.id, r); t += n } return e.cacheHexString && (this.__id = t), t } }, { key: "toString", value: function (e) { return this.id && this.id.copy ? this.id.toString("string" == typeof e ? e : "hex") : this.toHexString() } }, { key: "toJSON", value: function () { return this.toHexString() } }, { key: "equals", value: function (t) { return t instanceof e ? this.toString() === t.toString() : "string" == typeof t && e.isValid(t) && 12 === t.length && this.id instanceof _Buffer ? t === this.id.toString("binary") : "string" == typeof t && e.isValid(t) && 24 === t.length ? t.toLowerCase() === this.toHexString() : "string" == typeof t && e.isValid(t) && 12 === t.length ? t === this.id : !(null == t || !(t instanceof e || t.toHexString)) && t.toHexString() === this.toHexString() } }, { key: "getTimestamp", value: function () { var e = new Date, t = this.id.readUInt32BE(0); return e.setTime(1e3 * Math.floor(t)), e } }, { key: "toExtendedJSON", value: function () { return this.toHexString ? { $oid: this.toHexString() } : { $oid: this.toString("hex") } } }], [{ key: "getInc", value: function () { return e.index = (e.index + 1) % 16777215 } }, { key: "generate", value: function (t) { "number" != typeof t && (t = ~~(Date.now() / 1e3)); var r = e.getInc(), n = Buffer$1.alloc(12); return n[3] = 255 & t, n[2] = t >> 8 & 255, n[1] = t >> 16 & 255, n[0] = t >> 24 & 255, n[4] = PROCESS_UNIQUE[0], n[5] = PROCESS_UNIQUE[1], n[6] = PROCESS_UNIQUE[2], n[7] = PROCESS_UNIQUE[3], n[8] = PROCESS_UNIQUE[4], n[11] = 255 & r, n[10] = r >> 8 & 255, n[9] = r >> 16 & 255, n } }, { key: "createPk", value: function () { return new e } }, { key: "createFromTime", value: function (t) { var r = Buffer$1.from([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]); return r[3] = 255 & t, r[2] = t >> 8 & 255, r[1] = t >> 16 & 255, r[0] = t >> 24 & 255, new e(r) } }, { key: "createFromHexString", value: function (t) { if (void 0 === t || null != t && 24 !== t.length) throw new TypeError("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters"); if (hasBufferType) return new e(Buffer$1.from(t, "hex")); for (var r = new _Buffer(12), n = 0, i = 0; i < 24;)r[n++] = decodeLookup[t.charCodeAt(i++)] << 4 | decodeLookup[t.charCodeAt(i++)]; return new e(r) } }, { key: "isValid", value: function (t) { return null != t && ("number" == typeof t || ("string" == typeof t ? 12 === t.length || 24 === t.length && checkForHexRegExp.test(t) : t instanceof e || (t instanceof _Buffer && 12 === t.length || !!t.toHexString && (12 === t.id.length || 24 === t.id.length && checkForHexRegExp.test(t.id))))) } }, { key: "fromExtendedJSON", value: function (t) { return new e(t.$oid) } }]), e }(); ObjectId.get_inc = deprecate$1(function () { return ObjectId.getInc() }, "Please use the static `ObjectId.getInc()` instead"), ObjectId.prototype.get_inc = deprecate$1(function () { return ObjectId.getInc() }, "Please use the static `ObjectId.getInc()` instead"), ObjectId.prototype.getInc = deprecate$1(function () { return ObjectId.getInc() }, "Please use the static `ObjectId.getInc()` instead"), ObjectId.prototype.generate = deprecate$1(function (e) { return ObjectId.generate(e) }, "Please use the static `ObjectId.generate(time)` instead"), Object.defineProperty(ObjectId.prototype, "generationTime", { enumerable: !0, get: function () { return this.id[3] | this.id[2] << 8 | this.id[1] << 16 | this.id[0] << 24 }, set: function (e) { this.id[3] = 255 & e, this.id[2] = e >> 8 & 255, this.id[1] = e >> 16 & 255, this.id[0] = e >> 24 & 255 } }), ObjectId.prototype[util.inspect.custom || "inspect"] = ObjectId.prototype.toString, ObjectId.index = ~~(16777215 * Math.random()), Object.defineProperty(ObjectId.prototype, "_bsontype", { value: "ObjectID" }); var objectid = ObjectId; function _classCallCheck$3(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function _defineProperties$3(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function _createClass$3(e, t, r) { return t && _defineProperties$3(e.prototype, t), r && _defineProperties$3(e, r), e } function alphabetize(e) { return e.split("").sort().join("") } var BSONRegExp = function () { function e(t, r) { _classCallCheck$3(this, e), this.pattern = t || "", this.options = r ? alphabetize(r) : ""; for (var n = 0; n < this.options.length; n++)if ("i" !== this.options[n] && "m" !== this.options[n] && "x" !== this.options[n] && "l" !== this.options[n] && "s" !== this.options[n] && "u" !== this.options[n]) throw new Error("The regular expression option [".concat(this.options[n], "] is not supported")) } return _createClass$3(e, [{ key: "toExtendedJSON", value: function () { return { $regularExpression: { pattern: this.pattern, options: this.options } } } }], [{ key: "fromExtendedJSON", value: function (t) { return new e(t.$regularExpression.pattern, t.$regularExpression.options.split("").sort().join("")) } }]), e }(); Object.defineProperty(BSONRegExp.prototype, "_bsontype", { value: "BSONRegExp" }); var regexp = BSONRegExp; function _classCallCheck$4(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function _defineProperties$4(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function _createClass$4(e, t, r) { return t && _defineProperties$4(e.prototype, t), r && _defineProperties$4(e, r), e } var BSONSymbol = function () { function e(t) { _classCallCheck$4(this, e), this.value = t } return _createClass$4(e, [{ key: "valueOf", value: function () { return this.value } }, { key: "toString", value: function () { return this.value } }, { key: "inspect", value: function () { return this.value } }, { key: "toJSON", value: function () { return this.value } }, { key: "toExtendedJSON", value: function () { return { $symbol: this.value } } }], [{ key: "fromExtendedJSON", value: function (t) { return new e(t.$symbol) } }]), e }(); Object.defineProperty(BSONSymbol.prototype, "_bsontype", { value: "Symbol" }); var symbol = BSONSymbol; function _classCallCheck$5(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function _defineProperties$5(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function _createClass$5(e, t, r) { return t && _defineProperties$5(e.prototype, t), r && _defineProperties$5(e, r), e } var Int32 = function () { function e(t) { _classCallCheck$5(this, e), this.value = t } return _createClass$5(e, [{ key: "valueOf", value: function () { return this.value } }, { key: "toJSON", value: function () { return this.value } }, { key: "toExtendedJSON", value: function (e) { return e && e.relaxed ? this.value : { $numberInt: this.value.toString() } } }], [{ key: "fromExtendedJSON", value: function (t, r) { return r && r.relaxed ? parseInt(t.$numberInt, 10) : new e(t.$numberInt) } }]), e }(); Object.defineProperty(Int32.prototype, "_bsontype", { value: "Int32" }); var int_32 = Int32; function _classCallCheck$6(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function _defineProperties$6(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function _createClass$6(e, t, r) { return t && _defineProperties$6(e.prototype, t), r && _defineProperties$6(e, r), e } var Code = function () { function e(t, r) { _classCallCheck$6(this, e), this.code = t, this.scope = r } return _createClass$6(e, [{ key: "toJSON", value: function () { return { scope: this.scope, code: this.code } } }, { key: "toExtendedJSON", value: function () { return this.scope ? { $code: this.code, $scope: this.scope } : { $code: this.code } } }], [{ key: "fromExtendedJSON", value: function (t) { return new e(t.$code, t.$scope) } }]), e }(); Object.defineProperty(Code.prototype, "_bsontype", { value: "Code" }); var code = Code, Buffer$2 = buffer__WEBPACK_IMPORTED_MODULE_1___default.a.Buffer, PARSE_STRING_REGEXP = /^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/, PARSE_INF_REGEXP = /^(\+|-)?(Infinity|inf)$/i, PARSE_NAN_REGEXP = /^(\+|-)?NaN$/i, EXPONENT_MAX = 6111, EXPONENT_MIN = -6176, EXPONENT_BIAS = 6176, MAX_DIGITS = 34, NAN_BUFFER = [124, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0].reverse(), INF_NEGATIVE_BUFFER = [248, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0].reverse(), INF_POSITIVE_BUFFER = [120, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0].reverse(), EXPONENT_REGEX = /^([-+])?(\d+)?$/; function isDigit(e) { return !isNaN(parseInt(e, 10)) } function divideu128(e) { var t = long_1.fromNumber(1e9), r = long_1.fromNumber(0); if (!(e.parts[0] || e.parts[1] || e.parts[2] || e.parts[3])) return { quotient: e, rem: r }; for (var n = 0; n <= 3; n++)r = (r = r.shiftLeft(32)).add(new long_1(e.parts[n], 0)), e.parts[n] = r.div(t).low, r = r.modulo(t); return { quotient: e, rem: r } } function multiply64x2(e, t) { if (!e && !t) return { high: long_1.fromNumber(0), low: long_1.fromNumber(0) }; var r = e.shiftRightUnsigned(32), n = new long_1(e.getLowBits(), 0), i = t.shiftRightUnsigned(32), o = new long_1(t.getLowBits(), 0), s = r.multiply(i), a = r.multiply(o), u = n.multiply(i), c = n.multiply(o); return s = s.add(a.shiftRightUnsigned(32)), a = new long_1(a.getLowBits(), 0).add(u).add(c.shiftRightUnsigned(32)), { high: s = s.add(a.shiftRightUnsigned(32)), low: c = a.shiftLeft(32).add(new long_1(c.getLowBits(), 0)) } } function lessThan(e, t) { var r = e.high >>> 0, n = t.high >>> 0; return r < n || r === n && e.low >>> 0 < t.low >>> 0 } function invalidErr(e, t) { throw new TypeError('"'.concat(e, '" is not a valid Decimal128 string - ').concat(t)) } function Decimal128(e) { this.bytes = e } Decimal128.fromString = function (e) { var t, r = !1, n = !1, i = !1, o = 0, s = 0, a = 0, u = 0, c = 0, l = [0], d = 0, f = 0, _ = 0, p = 0, h = 0, g = 0, E = [0, 0], m = [0, 0], b = 0; if (e.length >= 7e3) throw new TypeError(e + " not a valid Decimal128 string"); var y = e.match(PARSE_STRING_REGEXP), S = e.match(PARSE_INF_REGEXP), v = e.match(PARSE_NAN_REGEXP); if (!y && !S && !v || 0 === e.length) throw new TypeError(e + " not a valid Decimal128 string"); if (y) { var T = y[2], A = y[4], O = y[5], N = y[6]; A && void 0 === N && invalidErr(e, "missing exponent power"), A && void 0 === T && invalidErr(e, "missing exponent base"), void 0 === A && (O || N) && invalidErr(e, "missing e before exponent") } if ("+" !== e[b] && "-" !== e[b] || (r = "-" === e[b++]), !isDigit(e[b]) && "." !== e[b]) { if ("i" === e[b] || "I" === e[b]) return new Decimal128(Buffer$2.from(r ? INF_NEGATIVE_BUFFER : INF_POSITIVE_BUFFER)); if ("N" === e[b]) return new Decimal128(Buffer$2.from(NAN_BUFFER)) } for (; isDigit(e[b]) || "." === e[b];)"." !== e[b] ? (d < 34 && ("0" !== e[b] || i) && (i || (c = s), i = !0, l[f++] = parseInt(e[b], 10), d += 1), i && (a += 1), n && (u += 1), s += 1, b += 1) : (n && invalidErr(e, "contains multiple periods"), n = !0, b += 1); if (n && !s) throw new TypeError(e + " not a valid Decimal128 string"); if ("e" === e[b] || "E" === e[b]) { var I = e.substr(++b).match(EXPONENT_REGEX); if (!I || !I[2]) return new Decimal128(Buffer$2.from(NAN_BUFFER)); h = parseInt(I[0], 10), b += I[0].length } if (e[b]) return new Decimal128(Buffer$2.from(NAN_BUFFER)); if (_ = 0, d) { if (p = d - 1, 1 !== (o = a)) for (; "0" === e[c + o - 1];)o -= 1 } else _ = 0, p = 0, l[0] = 0, a = 1, d = 1, o = 0; for (h <= u && u - h > 16384 ? h = EXPONENT_MIN : h -= u; h > EXPONENT_MAX;) { if ((p += 1) - _ > MAX_DIGITS) { if (l.join("").match(/^0+$/)) { h = EXPONENT_MAX; break } invalidErr(e, "overflow") } h -= 1 } for (; h < EXPONENT_MIN || d < a;) { if (0 === p && o < d) { h = EXPONENT_MIN, o = 0; break } if (d < a ? a -= 1 : p -= 1, h < EXPONENT_MAX) h += 1; else { if (l.join("").match(/^0+$/)) { h = EXPONENT_MAX; break } invalidErr(e, "overflow") } } if (p - _ + 1 < o) { var C = s; n && (c += 1, C += 1), r && (c += 1, C += 1); var R = parseInt(e[c + p + 1], 10), w = 0; if (R >= 5 && (w = 1, 5 === R)) for (w = l[p] % 2 == 1, g = c + p + 2; g < C; g++)if (parseInt(e[g], 10)) { w = 1; break } if (w) for (var D = p; D >= 0; D--)if (++l[D] > 9 && (l[D] = 0, 0 === D)) { if (!(h < EXPONENT_MAX)) return new Decimal128(Buffer$2.from(r ? INF_NEGATIVE_BUFFER : INF_POSITIVE_BUFFER)); h += 1, l[D] = 1 } } if (E = long_1.fromNumber(0), m = long_1.fromNumber(0), 0 === o) E = long_1.fromNumber(0), m = long_1.fromNumber(0); else if (p - _ < 17) { var M = _; for (m = long_1.fromNumber(l[M++]), E = new long_1(0, 0); M <= p; M++)m = (m = m.multiply(long_1.fromNumber(10))).add(long_1.fromNumber(l[M])) } else { var L = _; for (E = long_1.fromNumber(l[L++]); L <= p - 17; L++)E = (E = E.multiply(long_1.fromNumber(10))).add(long_1.fromNumber(l[L])); for (m = long_1.fromNumber(l[L++]); L <= p; L++)m = (m = m.multiply(long_1.fromNumber(10))).add(long_1.fromNumber(l[L])) } var j = multiply64x2(E, long_1.fromString("100000000000000000")); j.low = j.low.add(m), lessThan(j.low, m) && (j.high = j.high.add(long_1.fromNumber(1))), t = h + EXPONENT_BIAS; var P = { low: long_1.fromNumber(0), high: long_1.fromNumber(0) }; j.high.shiftRightUnsigned(49).and(long_1.fromNumber(1)).equals(long_1.fromNumber(1)) ? (P.high = P.high.or(long_1.fromNumber(3).shiftLeft(61)), P.high = P.high.or(long_1.fromNumber(t).and(long_1.fromNumber(16383).shiftLeft(47))), P.high = P.high.or(j.high.and(long_1.fromNumber(0x7fffffffffff)))) : (P.high = P.high.or(long_1.fromNumber(16383 & t).shiftLeft(49)), P.high = P.high.or(j.high.and(long_1.fromNumber(562949953421311)))), P.low = j.low, r && (P.high = P.high.or(long_1.fromString("9223372036854775808"))); var B = Buffer$2.alloc(16); return b = 0, B[b++] = 255 & P.low.low, B[b++] = P.low.low >> 8 & 255, B[b++] = P.low.low >> 16 & 255, B[b++] = P.low.low >> 24 & 255, B[b++] = 255 & P.low.high, B[b++] = P.low.high >> 8 & 255, B[b++] = P.low.high >> 16 & 255, B[b++] = P.low.high >> 24 & 255, B[b++] = 255 & P.high.low, B[b++] = P.high.low >> 8 & 255, B[b++] = P.high.low >> 16 & 255, B[b++] = P.high.low >> 24 & 255, B[b++] = 255 & P.high.high, B[b++] = P.high.high >> 8 & 255, B[b++] = P.high.high >> 16 & 255, B[b++] = P.high.high >> 24 & 255, new Decimal128(B) }; var COMBINATION_MASK = 31, EXPONENT_MASK = 16383, COMBINATION_INFINITY = 30, COMBINATION_NAN = 31; Decimal128.prototype.toString = function () { for (var e, t, r, n, i, o, s = 0, a = new Array(36), u = 0; u < a.length; u++)a[u] = 0; var c, l, d, f, _, p = 0, h = !1, g = { parts: new Array(4) }, E = []; p = 0; var m = this.bytes; if (n = m[p++] | m[p++] << 8 | m[p++] << 16 | m[p++] << 24, r = m[p++] | m[p++] << 8 | m[p++] << 16 | m[p++] << 24, t = m[p++] | m[p++] << 8 | m[p++] << 16 | m[p++] << 24, e = m[p++] | m[p++] << 8 | m[p++] << 16 | m[p++] << 24, p = 0, { low: new long_1(n, r), high: new long_1(t, e) }.high.lessThan(long_1.ZERO) && E.push("-"), (i = e >> 26 & COMBINATION_MASK) >> 3 == 3) { if (i === COMBINATION_INFINITY) return E.join("") + "Infinity"; if (i === COMBINATION_NAN) return "NaN"; o = e >> 15 & EXPONENT_MASK, d = 8 + (e >> 14 & 1) } else d = e >> 14 & 7, o = e >> 17 & EXPONENT_MASK; if (c = o - EXPONENT_BIAS, g.parts[0] = (16383 & e) + ((15 & d) << 14), g.parts[1] = t, g.parts[2] = r, g.parts[3] = n, 0 === g.parts[0] && 0 === g.parts[1] && 0 === g.parts[2] && 0 === g.parts[3]) h = !0; else for (_ = 3; _ >= 0; _--) { var b = 0, y = divideu128(g); if (g = y.quotient, b = y.rem.low) for (f = 8; f >= 0; f--)a[9 * _ + f] = b % 10, b = Math.floor(b / 10) } if (h) s = 1, a[p] = 0; else for (s = 36; !a[p];)s -= 1, p += 1; if ((l = s - 1 + c) >= 34 || l <= -7 || c > 0) { if (s > 34) return E.push(0), c > 0 ? E.push("E+" + c) : c < 0 && E.push("E" + c), E.join(""); E.push(a[p++]), (s -= 1) && E.push("."); for (var S = 0; S < s; S++)E.push(a[p++]); E.push("E"), l > 0 ? E.push("+" + l) : E.push(l) } else if (c >= 0) for (var v = 0; v < s; v++)E.push(a[p++]); else { var T = s + c; if (T > 0) for (var A = 0; A < T; A++)E.push(a[p++]); else E.push("0"); for (E.push("."); T++ < 0;)E.push("0"); for (var O = 0; O < s - Math.max(T - 1, 0); O++)E.push(a[p++]) } return E.join("") }, Decimal128.prototype.toJSON = function () { return { $numberDecimal: this.toString() } }, Decimal128.prototype.toExtendedJSON = function () { return { $numberDecimal: this.toString() } }, Decimal128.fromExtendedJSON = function (e) { return Decimal128.fromString(e.$numberDecimal) }, Object.defineProperty(Decimal128.prototype, "_bsontype", { value: "Decimal128" }); var decimal128 = Decimal128; function _classCallCheck$7(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function _defineProperties$7(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function _createClass$7(e, t, r) { return t && _defineProperties$7(e.prototype, t), r && _defineProperties$7(e, r), e } var MinKey = function () { function e() { _classCallCheck$7(this, e) } return _createClass$7(e, [{ key: "toExtendedJSON", value: function () { return { $minKey: 1 } } }], [{ key: "fromExtendedJSON", value: function () { return new e } }]), e }(); Object.defineProperty(MinKey.prototype, "_bsontype", { value: "MinKey" }); var min_key = MinKey; function _classCallCheck$8(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function _defineProperties$8(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function _createClass$8(e, t, r) { return t && _defineProperties$8(e.prototype, t), r && _defineProperties$8(e, r), e } var MaxKey = function () { function e() { _classCallCheck$8(this, e) } return _createClass$8(e, [{ key: "toExtendedJSON", value: function () { return { $maxKey: 1 } } }], [{ key: "fromExtendedJSON", value: function () { return new e } }]), e }(); Object.defineProperty(MaxKey.prototype, "_bsontype", { value: "MaxKey" }); var max_key = MaxKey; function _classCallCheck$9(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function _defineProperties$9(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function _createClass$9(e, t, r) { return t && _defineProperties$9(e.prototype, t), r && _defineProperties$9(e, r), e } var DBRef = function () { function e(t, r, n, i) { _classCallCheck$9(this, e); var o = t.split("."); 2 === o.length && (n = o.shift(), t = o.shift()), this.collection = t, this.oid = r, this.db = n, this.fields = i || {} } return _createClass$9(e, [{ key: "toJSON", value: function () { var e = Object.assign({ $ref: this.collection, $id: this.oid }, this.fields); return null != this.db && (e.$db = this.db), e } }, { key: "toExtendedJSON", value: function () { var e = { $ref: this.collection, $id: this.oid }; return this.db && (e.$db = this.db), e = Object.assign(e, this.fields) } }], [{ key: "fromExtendedJSON", value: function (t) { var r = Object.assign({}, t); return ["$ref", "$id", "$db"].forEach(function (e) { return delete r[e] }), new e(t.$ref, t.$id, t.$db, r) } }]), e }(); Object.defineProperty(DBRef.prototype, "_bsontype", { value: "DBRef" }), Object.defineProperty(DBRef.prototype, "namespace", { get: function () { return this.collection }, set: function (e) { this.collection = e }, configurable: !1 }); var db_ref = DBRef; function _classCallCheck$a(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function _defineProperties$a(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } function _createClass$a(e, t, r) { return t && _defineProperties$a(e.prototype, t), r && _defineProperties$a(e, r), e } var Buffer$3 = buffer__WEBPACK_IMPORTED_MODULE_1___default.a.Buffer, Binary = function () { function e(t, r) { if (_classCallCheck$a(this, e), !(null == t || "string" == typeof t || Buffer$3.isBuffer(t) || t instanceof Uint8Array || Array.isArray(t))) throw new TypeError("only String, Buffer, Uint8Array or Array accepted"); if (this.sub_type = null == r ? BSON_BINARY_SUBTYPE_DEFAULT : r, this.position = 0, null == t || t instanceof Number) void 0 !== Buffer$3 ? this.buffer = Buffer$3.alloc(e.BUFFER_SIZE) : "undefined" != typeof Uint8Array ? this.buffer = new Uint8Array(new ArrayBuffer(e.BUFFER_SIZE)) : this.buffer = new Array(e.BUFFER_SIZE); else { if ("string" == typeof t) if (void 0 !== Buffer$3) this.buffer = Buffer$3.from(t); else { if ("undefined" == typeof Uint8Array && !Array.isArray(t)) throw new TypeError("only String, Buffer, Uint8Array or Array accepted"); this.buffer = writeStringToArray(t) } else this.buffer = t; this.position = t.length } } return _createClass$a(e, [{ key: "put", value: function (t) { if (null != t.length && "number" != typeof t && 1 !== t.length) throw new TypeError("only accepts single character String, Uint8Array or Array"); if ("number" != typeof t && t < 0 || t > 255) throw new TypeError("only accepts number in a valid unsigned byte range 0-255"); var r = null; if (r = "string" == typeof t ? t.charCodeAt(0) : null != t.length ? t[0] : t, this.buffer.length > this.position) this.buffer[this.position++] = r; else if (void 0 !== Buffer$3 && Buffer$3.isBuffer(this.buffer)) { var n = Buffer$3.alloc(e.BUFFER_SIZE + this.buffer.length); this.buffer.copy(n, 0, 0, this.buffer.length), this.buffer = n, this.buffer[this.position++] = r } else { var i = null; i = isUint8Array(this.buffer) ? new Uint8Array(new ArrayBuffer(e.BUFFER_SIZE + this.buffer.length)) : new Array(e.BUFFER_SIZE + this.buffer.length); for (var o = 0; o < this.buffer.length; o++)i[o] = this.buffer[o]; this.buffer = i, this.buffer[this.position++] = r } } }, { key: "write", value: function (e, t) { if (t = "number" == typeof t ? t : this.position, this.buffer.length < t + e.length) { var r = null; if (void 0 !== Buffer$3 && Buffer$3.isBuffer(this.buffer)) r = Buffer$3.alloc(this.buffer.length + e.length), this.buffer.copy(r, 0, 0, this.buffer.length); else if (isUint8Array(this.buffer)) { r = new Uint8Array(new ArrayBuffer(this.buffer.length + e.length)); for (var n = 0; n < this.position; n++)r[n] = this.buffer[n] } this.buffer = r } if (void 0 !== Buffer$3 && Buffer$3.isBuffer(e) && Buffer$3.isBuffer(this.buffer)) e.copy(this.buffer, t, 0, e.length), this.position = t + e.length > this.position ? t + e.length : this.position; else if (void 0 !== Buffer$3 && "string" == typeof e && Buffer$3.isBuffer(this.buffer)) this.buffer.write(e, t, "binary"), this.position = t + e.length > this.position ? t + e.length : this.position; else if (isUint8Array(e) || Array.isArray(e) && "string" != typeof e) { for (var i = 0; i < e.length; i++)this.buffer[t++] = e[i]; this.position = t > this.position ? t : this.position } else if ("string" == typeof e) { for (var o = 0; o < e.length; o++)this.buffer[t++] = e.charCodeAt(o); this.position = t > this.position ? t : this.position } } }, { key: "read", value: function (e, t) { if (t = t && t > 0 ? t : this.position, this.buffer.slice) return this.buffer.slice(e, e + t); for (var r = "undefined" != typeof Uint8Array ? new Uint8Array(new ArrayBuffer(t)) : new Array(t), n = 0; n < t; n++)r[n] = this.buffer[e++]; return r } }, { key: "value", value: function (e) { if ((e = null != e && e) && void 0 !== Buffer$3 && Buffer$3.isBuffer(this.buffer) && this.buffer.length === this.position) return this.buffer; if (void 0 !== Buffer$3 && Buffer$3.isBuffer(this.buffer)) return e ? this.buffer.slice(0, this.position) : this.buffer.toString("binary", 0, this.position); if (e) { if (null != this.buffer.slice) return this.buffer.slice(0, this.position); for (var t = isUint8Array(this.buffer) ? new Uint8Array(new ArrayBuffer(this.position)) : new Array(this.position), r = 0; r < this.position; r++)t[r] = this.buffer[r]; return t } return convertArraytoUtf8BinaryString(this.buffer, 0, this.position) } }, { key: "length", value: function () { return this.position } }, { key: "toJSON", value: function () { return null != this.buffer ? this.buffer.toString("base64") : "" } }, { key: "toString", value: function (e) { return null != this.buffer ? this.buffer.slice(0, this.position).toString(e) : "" } }, { key: "toExtendedJSON", value: function () { var e = Buffer$3.isBuffer(this.buffer) ? this.buffer.toString("base64") : Buffer$3.from(this.buffer).toString("base64"), t = Number(this.sub_type).toString(16); return { $binary: { base64: e, subType: 1 === t.length ? "0" + t : t } } } }], [{ key: "fromExtendedJSON", value: function (t) { var r = t.$binary.subType ? parseInt(t.$binary.subType, 16) : 0; return new e(Buffer$3.from(t.$binary.base64, "base64"), r) } }]), e }(), BSON_BINARY_SUBTYPE_DEFAULT = 0; function isUint8Array(e) { return "[object Uint8Array]" === Object.prototype.toString.call(e) } function writeStringToArray(e) { for (var t = "undefined" != typeof Uint8Array ? new Uint8Array(new ArrayBuffer(e.length)) : new Array(e.length), r = 0; r < e.length; r++)t[r] = e.charCodeAt(r); return t } function convertArraytoUtf8BinaryString(e, t, r) { for (var n = "", i = t; i < r; i++)n += String.fromCharCode(e[i]); return n } Binary.BUFFER_SIZE = 256, Binary.SUBTYPE_DEFAULT = 0, Binary.SUBTYPE_FUNCTION = 1, Binary.SUBTYPE_BYTE_ARRAY = 2, Binary.SUBTYPE_UUID_OLD = 3, Binary.SUBTYPE_UUID = 4, Binary.SUBTYPE_MD5 = 5, Binary.SUBTYPE_USER_DEFINED = 128, Object.defineProperty(Binary.prototype, "_bsontype", { value: "Binary" }); var binary = Binary, constants = { BSON_INT32_MAX: 2147483647, BSON_INT32_MIN: -2147483648, BSON_INT64_MAX: Math.pow(2, 63) - 1, BSON_INT64_MIN: -Math.pow(2, 63), JS_INT_MAX: 9007199254740992, JS_INT_MIN: -9007199254740992, BSON_DATA_NUMBER: 1, BSON_DATA_STRING: 2, BSON_DATA_OBJECT: 3, BSON_DATA_ARRAY: 4, BSON_DATA_BINARY: 5, BSON_DATA_UNDEFINED: 6, BSON_DATA_OID: 7, BSON_DATA_BOOLEAN: 8, BSON_DATA_DATE: 9, BSON_DATA_NULL: 10, BSON_DATA_REGEXP: 11, BSON_DATA_DBPOINTER: 12, BSON_DATA_CODE: 13, BSON_DATA_SYMBOL: 14, BSON_DATA_CODE_W_SCOPE: 15, BSON_DATA_INT: 16, BSON_DATA_TIMESTAMP: 17, BSON_DATA_LONG: 18, BSON_DATA_DECIMAL128: 19, BSON_DATA_MIN_KEY: 255, BSON_DATA_MAX_KEY: 127, BSON_BINARY_SUBTYPE_DEFAULT: 0, BSON_BINARY_SUBTYPE_FUNCTION: 1, BSON_BINARY_SUBTYPE_BYTE_ARRAY: 2, BSON_BINARY_SUBTYPE_UUID: 3, BSON_BINARY_SUBTYPE_MD5: 4, BSON_BINARY_SUBTYPE_USER_DEFINED: 128 }; function _typeof$2(e) { return (_typeof$2 = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var keysToCodecs = { $oid: objectid, $binary: binary, $symbol: symbol, $numberInt: int_32, $numberDecimal: decimal128, $numberDouble: double_1, $numberLong: long_1, $minKey: min_key, $maxKey: max_key, $regularExpression: regexp, $timestamp: timestamp }; function deserializeValue(e, t, r, n) { if ("number" == typeof r) { if (n.relaxed) return r; if (Math.floor(r) === r) { if (r >= BSON_INT32_MIN && r <= BSON_INT32_MAX) return new int_32(r); if (r >= BSON_INT64_MIN && r <= BSON_INT64_MAX) return new long_1.fromNumber(r) } return new double_1(r) } if (null == r || "object" !== _typeof$2(r)) return r; if (r.$undefined) return null; for (var i = Object.keys(r).filter(function (e) { return e.startsWith("$") && null != r[e] }), o = 0; o < i.length; o++) { var s = keysToCodecs[i[o]]; if (s) return s.fromExtendedJSON(r, n) } if (null != r.$date) { var a = r.$date, u = new Date; return "string" == typeof a ? u.setTime(Date.parse(a)) : long_1.isLong(a) ? u.setTime(a.toNumber()) : "number" == typeof a && n.relaxed && u.setTime(a), u } if (null != r.$code) { var c = Object.assign({}, r); return r.$scope && (c.$scope = deserializeValue(e, null, r.$scope)), code.fromExtendedJSON(r) } if (null != r.$ref || null != r.$dbPointer) { var l = r.$ref ? r : r.$dbPointer; if (l instanceof db_ref) return l; var d = !0; if (Object.keys(l).filter(function (e) { return e.startsWith("$") }).forEach(function (e) { -1 === ["$ref", "$id", "$db"].indexOf(e) && (d = !1) }), d) return db_ref.fromExtendedJSON(l) } return r } function parse(e, t) { var r = this; return "boolean" == typeof (t = Object.assign({}, { relaxed: !0 }, t)).relaxed && (t.strict = !t.relaxed), "boolean" == typeof t.strict && (t.relaxed = !t.strict), JSON.parse(e, function (e, n) { return deserializeValue(r, e, n, t) }) } var BSON_INT32_MAX = 2147483647, BSON_INT32_MIN = -2147483648, BSON_INT64_MAX = 0x8000000000000000, BSON_INT64_MIN = -0x8000000000000000; function stringify(e, t, r, n) { null != r && "object" === _typeof$2(r) && (n = r, r = 0), null == t || "object" !== _typeof$2(t) || Array.isArray(t) || (n = t, t = null, r = 0), n = Object.assign({}, { relaxed: !0 }, n); var i = Array.isArray(e) ? serializeArray(e, n) : serializeDocument(e, n); return JSON.stringify(i, t, r) } function serialize(e, t) { return t = t || {}, JSON.parse(stringify(e, t)) } function deserialize(e, t) { return t = t || {}, parse(JSON.stringify(e), t) } function serializeArray(e, t) { return e.map(function (e) { return serializeValue(e, t) }) } function getISOString(e) { var t = e.toISOString(); return 0 !== e.getUTCMilliseconds() ? t : t.slice(0, -5) + "Z" } function serializeValue(e, t) { if (Array.isArray(e)) return serializeArray(e, t); if (void 0 === e) return null; if (e instanceof Date) { var r = e.getTime(), n = r > -1 && r < 2534023188e5; return t.relaxed && n ? { $date: getISOString(e) } : { $date: { $numberLong: e.getTime().toString() } } } if ("number" == typeof e && !t.relaxed) { if (Math.floor(e) === e) { var i = e >= BSON_INT64_MIN && e <= BSON_INT64_MAX; if (e >= BSON_INT32_MIN && e <= BSON_INT32_MAX) return { $numberInt: e.toString() }; if (i) return { $numberLong: e.toString() } } return { $numberDouble: e.toString() } } if (e instanceof RegExp) { var o = e.flags; return void 0 === o && (o = e.toString().match(/[gimuy]*$/)[0]), new regexp(e.source, o).toExtendedJSON() } return null != e && "object" === _typeof$2(e) ? serializeDocument(e, t) : e } var BSON_TYPE_MAPPINGS = { Binary: function (e) { return new binary(e.value(), e.subtype) }, Code: function (e) { return new code(e.code, e.scope) }, DBRef: function (e) { return new db_ref(e.collection || e.namespace, e.oid, e.db, e.fields) }, Decimal128: function (e) { return new decimal128(e.bytes) }, Double: function (e) { return new double_1(e.value) }, Int32: function (e) { return new int_32(e.value) }, Long: function (e) { return long_1.fromBits(null != e.low ? e.low : e.low_, null != e.low ? e.high : e.high_, null != e.low ? e.unsigned : e.unsigned_) }, MaxKey: function () { return new max_key }, MinKey: function () { return new min_key }, ObjectID: function (e) { return new objectid(e) }, ObjectId: function (e) { return new objectid(e) }, BSONRegExp: function (e) { return new regexp(e.pattern, e.options) }, Symbol: function (e) { return new symbol(e.value) }, Timestamp: function (e) { return timestamp.fromBits(e.low, e.high) } }; function serializeDocument(e, t) { if (null == e || "object" !== _typeof$2(e)) throw new Error("not an object instance"); var r = e._bsontype; if (void 0 === r) { var n = {}; for (var i in e) n[i] = serializeValue(e[i], t); return n } if ("string" == typeof r) { var o = e; if ("function" != typeof o.toExtendedJSON) { var s = BSON_TYPE_MAPPINGS[r]; if (!s) throw new TypeError("Unrecognized or invalid _bsontype: " + r); o = s(o) } return "Code" === r && o.scope ? o = new code(o.code, serializeValue(o.scope, t)) : "DBRef" === r && o.oid && (o = new db_ref(o.collection, serializeValue(o.oid, t), o.db, o.fields)), o.toExtendedJSON(t) } throw new Error("_bsontype must be a string, but was: " + _typeof$2(r)) } var extended_json = { parse: parse, deserialize: deserialize, serialize: serialize, stringify: stringify }, FIRST_BIT = 128, FIRST_TWO_BITS = 192, FIRST_THREE_BITS = 224, FIRST_FOUR_BITS = 240, FIRST_FIVE_BITS = 248, TWO_BIT_CHAR = 192, THREE_BIT_CHAR = 224, FOUR_BIT_CHAR = 240, CONTINUING_CHAR = 128; function validateUtf8(e, t, r) { for (var n = 0, i = t; i < r; i += 1) { var o = e[i]; if (n) { if ((o & FIRST_TWO_BITS) !== CONTINUING_CHAR) return !1; n -= 1 } else if (o & FIRST_BIT) if ((o & FIRST_THREE_BITS) === TWO_BIT_CHAR) n = 1; else if ((o & FIRST_FOUR_BITS) === THREE_BIT_CHAR) n = 2; else { if ((o & FIRST_FIVE_BITS) !== FOUR_BIT_CHAR) return !1; n = 3 } } return !n } var validateUtf8_1 = validateUtf8, validate_utf8 = { validateUtf8: validateUtf8_1 }, Buffer$4 = buffer__WEBPACK_IMPORTED_MODULE_1___default.a.Buffer, validateUtf8$1 = validate_utf8.validateUtf8, JS_INT_MAX_LONG = long_1.fromNumber(constants.JS_INT_MAX), JS_INT_MIN_LONG = long_1.fromNumber(constants.JS_INT_MIN), functionCache = {}; function deserialize$1(e, t, r) { var n = (t = null == t ? {} : t) && t.index ? t.index : 0, i = e[n] | e[n + 1] << 8 | e[n + 2] << 16 | e[n + 3] << 24; if (i < 5) throw new Error("bson size must be >= 5, is ".concat(i)); if (t.allowObjectSmallerThanBufferSize && e.length < i) throw new Error("buffer length ".concat(e.length, " must be >= bson size ").concat(i)); if (!t.allowObjectSmallerThanBufferSize && e.length !== i) throw new Error("buffer length ".concat(e.length, " must === bson size ").concat(i)); if (i + n > e.length) throw new Error("(bson size ".concat(i, " + options.index ").concat(n, " must be <= buffer length ").concat(Buffer$4.byteLength(e), ")")); if (0 !== e[n + i - 1]) throw new Error("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00"); return deserializeObject(e, n, t, r) } function deserializeObject(e, t, r, n) { var i = null != r.evalFunctions && r.evalFunctions, o = null != r.cacheFunctions && r.cacheFunctions, s = null != r.cacheFunctionsCrc32 && r.cacheFunctionsCrc32; if (!s) var a = null; var u = null == r.fieldsAsRaw ? null : r.fieldsAsRaw, c = null != r.raw && r.raw, l = "boolean" == typeof r.bsonRegExp && r.bsonRegExp, d = null != r.promoteBuffers && r.promoteBuffers, f = null == r.promoteLongs || r.promoteLongs, _ = null == r.promoteValues || r.promoteValues, p = t; if (e.length < 5) throw new Error("corrupt bson message < 5 bytes long"); var h = e[t++] | e[t++] << 8 | e[t++] << 16 | e[t++] << 24; if (h < 5 || h > e.length) throw new Error("corrupt bson message"); for (var g = n ? [] : {}, E = 0; ;) { var m = e[t++]; if (0 === m) break; for (var b = t; 0 !== e[b] && b < e.length;)b++; if (b >= Buffer$4.byteLength(e)) throw new Error("Bad BSON Document: illegal CString"); var y = n ? E++ : e.toString("utf8", t, b); if (t = b + 1, m === constants.BSON_DATA_STRING) { var S = e[t++] | e[t++] << 8 | e[t++] << 16 | e[t++] << 24; if (S <= 0 || S > e.length - t || 0 !== e[t + S - 1]) throw new Error("bad string length in bson"); if (!validateUtf8$1(e, t, t + S - 1)) throw new Error("Invalid UTF-8 string in BSON document"); var v = e.toString("utf8", t, t + S - 1); g[y] = v, t += S } else if (m === constants.BSON_DATA_OID) { var T = Buffer$4.alloc(12); e.copy(T, 0, t, t + 12), g[y] = new objectid(T), t += 12 } else if (m === constants.BSON_DATA_INT && !1 === _) g[y] = new int_32(e[t++] | e[t++] << 8 | e[t++] << 16 | e[t++] << 24); else if (m === constants.BSON_DATA_INT) g[y] = e[t++] | e[t++] << 8 | e[t++] << 16 | e[t++] << 24; else if (m === constants.BSON_DATA_NUMBER && !1 === _) g[y] = new double_1(e.readDoubleLE(t)), t += 8; else if (m === constants.BSON_DATA_NUMBER) g[y] = e.readDoubleLE(t), t += 8; else if (m === constants.BSON_DATA_DATE) { var A = e[t++] | e[t++] << 8 | e[t++] << 16 | e[t++] << 24, O = e[t++] | e[t++] << 8 | e[t++] << 16 | e[t++] << 24; g[y] = new Date(new long_1(A, O).toNumber()) } else if (m === constants.BSON_DATA_BOOLEAN) { if (0 !== e[t] && 1 !== e[t]) throw new Error("illegal boolean type value"); g[y] = 1 === e[t++] } else if (m === constants.BSON_DATA_OBJECT) { var N = t, I = e[t] | e[t + 1] << 8 | e[t + 2] << 16 | e[t + 3] << 24; if (I <= 0 || I > e.length - t) throw new Error("bad embedded document length in bson"); g[y] = c ? e.slice(t, t + I) : deserializeObject(e, N, r, !1), t += I } else if (m === constants.BSON_DATA_ARRAY) { var C = t, R = e[t] | e[t + 1] << 8 | e[t + 2] << 16 | e[t + 3] << 24, w = r, D = t + R; if (u && u[y]) { for (var M in w = {}, r) w[M] = r[M]; w.raw = !0 } if (g[y] = deserializeObject(e, C, w, !0), 0 !== e[(t += R) - 1]) throw new Error("invalid array terminator byte"); if (t !== D) throw new Error("corrupted array bson") } else if (m === constants.BSON_DATA_UNDEFINED) g[y] = void 0; else if (m === constants.BSON_DATA_NULL) g[y] = null; else if (m === constants.BSON_DATA_LONG) { var L = e[t++] | e[t++] << 8 | e[t++] << 16 | e[t++] << 24, j = e[t++] | e[t++] << 8 | e[t++] << 16 | e[t++] << 24, P = new long_1(L, j); g[y] = f && !0 === _ && P.lessThanOrEqual(JS_INT_MAX_LONG) && P.greaterThanOrEqual(JS_INT_MIN_LONG) ? P.toNumber() : P } else if (m === constants.BSON_DATA_DECIMAL128) { var B = Buffer$4.alloc(16); e.copy(B, 0, t, t + 16), t += 16; var x = new decimal128(B); g[y] = x.toObject ? x.toObject() : x } else if (m === constants.BSON_DATA_BINARY) { var U = e[t++] | e[t++] << 8 | e[t++] << 16 | e[t++] << 24, G = U, k = e[t++]; if (U < 0) throw new Error("Negative binary type element size found"); if (U > Buffer$4.byteLength(e)) throw new Error("Binary type size larger than document size"); if (null != e.slice) { if (k === binary.SUBTYPE_BYTE_ARRAY) { if ((U = e[t++] | e[t++] << 8 | e[t++] << 16 | e[t++] << 24) < 0) throw new Error("Negative binary type element size found for subtype 0x02"); if (U > G - 4) throw new Error("Binary type with subtype 0x02 contains to long binary size"); if (U < G - 4) throw new Error("Binary type with subtype 0x02 contains to short binary size") } g[y] = d && _ ? e.slice(t, t + U) : new binary(e.slice(t, t + U), k) } else { var F = "undefined" != typeof Uint8Array ? new Uint8Array(new ArrayBuffer(U)) : new Array(U); if (k === binary.SUBTYPE_BYTE_ARRAY) { if ((U = e[t++] | e[t++] << 8 | e[t++] << 16 | e[t++] << 24) < 0) throw new Error("Negative binary type element size found for subtype 0x02"); if (U > G - 4) throw new Error("Binary type with subtype 0x02 contains to long binary size"); if (U < G - 4) throw new Error("Binary type with subtype 0x02 contains to short binary size") } for (b = 0; b < U; b++)F[b] = e[t + b]; g[y] = d && _ ? F : new binary(F, k) } t += U } else if (m === constants.BSON_DATA_REGEXP && !1 === l) { for (b = t; 0 !== e[b] && b < e.length;)b++; if (b >= e.length) throw new Error("Bad BSON Document: illegal CString"); var Y = e.toString("utf8", t, b); for (b = t = b + 1; 0 !== e[b] && b < e.length;)b++; if (b >= e.length) throw new Error("Bad BSON Document: illegal CString"); var K = e.toString("utf8", t, b); t = b + 1; var q = new Array(K.length); for (b = 0; b < K.length; b++)switch (K[b]) { case "m": q[b] = "m"; break; case "s": q[b] = "g"; break; case "i": q[b] = "i" }g[y] = new RegExp(Y, q.join("")) } else if (m === constants.BSON_DATA_REGEXP && !0 === l) { for (b = t; 0 !== e[b] && b < e.length;)b++; if (b >= e.length) throw new Error("Bad BSON Document: illegal CString"); var $ = e.toString("utf8", t, b); for (b = t = b + 1; 0 !== e[b] && b < e.length;)b++; if (b >= e.length) throw new Error("Bad BSON Document: illegal CString"); var z = e.toString("utf8", t, b); t = b + 1, g[y] = new regexp($, z) } else if (m === constants.BSON_DATA_SYMBOL) { var W = e[t++] | e[t++] << 8 | e[t++] << 16 | e[t++] << 24; if (W <= 0 || W > e.length - t || 0 !== e[t + W - 1]) throw new Error("bad string length in bson"); g[y] = e.toString("utf8", t, t + W - 1), t += W } else if (m === constants.BSON_DATA_TIMESTAMP) { var J = e[t++] | e[t++] << 8 | e[t++] << 16 | e[t++] << 24, V = e[t++] | e[t++] << 8 | e[t++] << 16 | e[t++] << 24; g[y] = new timestamp(J, V) } else if (m === constants.BSON_DATA_MIN_KEY) g[y] = new min_key; else if (m === constants.BSON_DATA_MAX_KEY) g[y] = new max_key; else if (m === constants.BSON_DATA_CODE) { var H = e[t++] | e[t++] << 8 | e[t++] << 16 | e[t++] << 24; if (H <= 0 || H > e.length - t || 0 !== e[t + H - 1]) throw new Error("bad string length in bson"); var X = e.toString("utf8", t, t + H - 1); if (i) if (o) { var Q = s ? a(X) : X; g[y] = isolateEvalWithHash(functionCache, Q, X, g) } else g[y] = isolateEval(X); else g[y] = new code(X); t += H } else if (m === constants.BSON_DATA_CODE_W_SCOPE) { var Z = e[t++] | e[t++] << 8 | e[t++] << 16 | e[t++] << 24; if (Z < 13) throw new Error("code_w_scope total size shorter minimum expected length"); var ee = e[t++] | e[t++] << 8 | e[t++] << 16 | e[t++] << 24; if (ee <= 0 || ee > e.length - t || 0 !== e[t + ee - 1]) throw new Error("bad string length in bson"); var te = e.toString("utf8", t, t + ee - 1), re = t += ee, ne = e[t] | e[t + 1] << 8 | e[t + 2] << 16 | e[t + 3] << 24, ie = deserializeObject(e, re, r, !1); if (t += ne, Z < 8 + ne + ee) throw new Error("code_w_scope total size is to short, truncating scope"); if (Z > 8 + ne + ee) throw new Error("code_w_scope total size is to long, clips outer document"); if (i) { if (o) { var oe = s ? a(te) : te; g[y] = isolateEvalWithHash(functionCache, oe, te, g) } else g[y] = isolateEval(te); g[y].scope = ie } else g[y] = new code(te, ie) } else { if (m !== constants.BSON_DATA_DBPOINTER) throw new Error("Detected unknown BSON type " + m.toString(16) + ' for fieldname "' + y + '", are you using the latest BSON parser?'); var se = e[t++] | e[t++] << 8 | e[t++] << 16 | e[t++] << 24; if (se <= 0 || se > e.length - t || 0 !== e[t + se - 1]) throw new Error("bad string length in bson"); if (!validateUtf8$1(e, t, t + se - 1)) throw new Error("Invalid UTF-8 string in BSON document"); var ae = e.toString("utf8", t, t + se - 1); t += se; var ue = Buffer$4.alloc(12); e.copy(ue, 0, t, t + 12); var ce = new objectid(ue); t += 12, g[y] = new db_ref(ae, ce) } } if (h !== t - p) { if (n) throw new Error("corrupt array bson"); throw new Error("corrupt object bson") } var le = !0; if (Object.keys(g).filter(function (e) { return e.startsWith("$") }).forEach(function (e) { -1 === ["$ref", "$id", "$db"].indexOf(e) && (le = !1) }), !le) return g; if (null != g.$id && null != g.$ref) { var de = Object.assign({}, g); return delete de.$ref, delete de.$id, delete de.$db, new db_ref(g.$ref, g.$id, g.$db || null, de) } return g } function isolateEvalWithHash(functionCache, hash, functionString, object) { var value = null; return null == functionCache[hash] && (eval("value = " + functionString), functionCache[hash] = value), functionCache[hash].bind(object) } function isolateEval(functionString) { var value = null; return eval("value = " + functionString), value } var deserializer = deserialize$1; function readIEEE754(e, t, r, n, i) { var o, s, a = "big" === r, u = 8 * i - n - 1, c = (1 << u) - 1, l = c >> 1, d = -7, f = a ? 0 : i - 1, _ = a ? 1 : -1, p = e[t + f]; for (f += _, o = p & (1 << -d) - 1, p >>= -d, d += u; d > 0; o = 256 * o + e[t + f], f += _, d -= 8); for (s = o & (1 << -d) - 1, o >>= -d, d += n; d > 0; s = 256 * s + e[t + f], f += _, d -= 8); if (0 === o) o = 1 - l; else { if (o === c) return s ? NaN : 1 / 0 * (p ? -1 : 1); s += Math.pow(2, n), o -= l } return (p ? -1 : 1) * s * Math.pow(2, o - n) } function writeIEEE754(e, t, r, n, i, o) { var s, a, u, c = "big" === n, l = 8 * o - i - 1, d = (1 << l) - 1, f = d >> 1, _ = 23 === i ? Math.pow(2, -24) - Math.pow(2, -77) : 0, p = c ? o - 1 : 0, h = c ? -1 : 1, g = t < 0 || 0 === t && 1 / t < 0 ? 1 : 0; for (t = Math.abs(t), isNaN(t) || t === 1 / 0 ? (a = isNaN(t) ? 1 : 0, s = d) : (s = Math.floor(Math.log(t) / Math.LN2), t * (u = Math.pow(2, -s)) < 1 && (s-- , u *= 2), (t += s + f >= 1 ? _ / u : _ * Math.pow(2, 1 - f)) * u >= 2 && (s++ , u /= 2), s + f >= d ? (a = 0, s = d) : s + f >= 1 ? (a = (t * u - 1) * Math.pow(2, i), s += f) : (a = t * Math.pow(2, f - 1) * Math.pow(2, i), s = 0)), isNaN(t) && (a = 0); i >= 8;)e[r + p] = 255 & a, p += h, a /= 256, i -= 8; for (s = s << i | a, isNaN(t) && (s += 8), l += i; l > 0;)e[r + p] = 255 & s, p += h, s /= 256, l -= 8; e[r + p - h] |= 128 * g } var float_parser = { readIEEE754: readIEEE754, writeIEEE754: writeIEEE754 }; function _typeof$3(e) { return (_typeof$3 = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var Buffer$5 = buffer__WEBPACK_IMPORTED_MODULE_1___default.a.Buffer, writeIEEE754$1 = float_parser.writeIEEE754, normalizedFunctionString$1 = utils.normalizedFunctionString, regexp$1 = /\x00/, ignoreKeys = new Set(["$db", "$ref", "$id", "$clusterTime"]), isDate$1 = function (e) { return "object" === _typeof$3(e) && "[object Date]" === Object.prototype.toString.call(e) }, isRegExp$1 = function (e) { return "[object RegExp]" === Object.prototype.toString.call(e) }; function serializeString(e, t, r, n, i) { e[n++] = constants.BSON_DATA_STRING, e[(n = n + (i ? e.write(t, n, "ascii") : e.write(t, n, "utf8")) + 1) - 1] = 0; var o = e.write(r, n + 4, "utf8"); return e[n + 3] = o + 1 >> 24 & 255, e[n + 2] = o + 1 >> 16 & 255, e[n + 1] = o + 1 >> 8 & 255, e[n] = o + 1 & 255, n = n + 4 + o, e[n++] = 0, n } function serializeNumber(e, t, r, n, i) { if (Math.floor(r) === r && r >= constants.JS_INT_MIN && r <= constants.JS_INT_MAX) if (r >= constants.BSON_INT32_MIN && r <= constants.BSON_INT32_MAX) e[n++] = constants.BSON_DATA_INT, n += i ? e.write(t, n, "ascii") : e.write(t, n, "utf8"), e[n++] = 0, e[n++] = 255 & r, e[n++] = r >> 8 & 255, e[n++] = r >> 16 & 255, e[n++] = r >> 24 & 255; else if (r >= constants.JS_INT_MIN && r <= constants.JS_INT_MAX) { e[n++] = constants.BSON_DATA_NUMBER, n += i ? e.write(t, n, "ascii") : e.write(t, n, "utf8"), e[n++] = 0, writeIEEE754$1(e, r, n, "little", 52, 8), n += 8 } else { e[n++] = constants.BSON_DATA_LONG, n += i ? e.write(t, n, "ascii") : e.write(t, n, "utf8"), e[n++] = 0; var o = long_1.fromNumber(r), s = o.getLowBits(), a = o.getHighBits(); e[n++] = 255 & s, e[n++] = s >> 8 & 255, e[n++] = s >> 16 & 255, e[n++] = s >> 24 & 255, e[n++] = 255 & a, e[n++] = a >> 8 & 255, e[n++] = a >> 16 & 255, e[n++] = a >> 24 & 255 } else e[n++] = constants.BSON_DATA_NUMBER, n += i ? e.write(t, n, "ascii") : e.write(t, n, "utf8"), e[n++] = 0, writeIEEE754$1(e, r, n, "little", 52, 8), n += 8; return n } function serializeNull(e, t, r, n, i) { return e[n++] = constants.BSON_DATA_NULL, n += i ? e.write(t, n, "ascii") : e.write(t, n, "utf8"), e[n++] = 0, n } function serializeBoolean(e, t, r, n, i) { return e[n++] = constants.BSON_DATA_BOOLEAN, n += i ? e.write(t, n, "ascii") : e.write(t, n, "utf8"), e[n++] = 0, e[n++] = r ? 1 : 0, n } function serializeDate(e, t, r, n, i) { e[n++] = constants.BSON_DATA_DATE, n += i ? e.write(t, n, "ascii") : e.write(t, n, "utf8"), e[n++] = 0; var o = long_1.fromNumber(r.getTime()), s = o.getLowBits(), a = o.getHighBits(); return e[n++] = 255 & s, e[n++] = s >> 8 & 255, e[n++] = s >> 16 & 255, e[n++] = s >> 24 & 255, e[n++] = 255 & a, e[n++] = a >> 8 & 255, e[n++] = a >> 16 & 255, e[n++] = a >> 24 & 255, n } function serializeRegExp(e, t, r, n, i) { if (e[n++] = constants.BSON_DATA_REGEXP, n += i ? e.write(t, n, "ascii") : e.write(t, n, "utf8"), e[n++] = 0, r.source && null != r.source.match(regexp$1)) throw Error("value " + r.source + " must not contain null bytes"); return n += e.write(r.source, n, "utf8"), e[n++] = 0, r.ignoreCase && (e[n++] = 105), r.global && (e[n++] = 115), r.multiline && (e[n++] = 109), e[n++] = 0, n } function serializeBSONRegExp(e, t, r, n, i) { if (e[n++] = constants.BSON_DATA_REGEXP, n += i ? e.write(t, n, "ascii") : e.write(t, n, "utf8"), e[n++] = 0, null != r.pattern.match(regexp$1)) throw Error("pattern " + r.pattern + " must not contain null bytes"); return n += e.write(r.pattern, n, "utf8"), e[n++] = 0, n += e.write(r.options.split("").sort().join(""), n, "utf8"), e[n++] = 0, n } function serializeMinMax(e, t, r, n, i) { return null === r ? e[n++] = constants.BSON_DATA_NULL : "MinKey" === r._bsontype ? e[n++] = constants.BSON_DATA_MIN_KEY : e[n++] = constants.BSON_DATA_MAX_KEY, n += i ? e.write(t, n, "ascii") : e.write(t, n, "utf8"), e[n++] = 0, n } function serializeObjectId(e, t, r, n, i) { if (e[n++] = constants.BSON_DATA_OID, n += i ? e.write(t, n, "ascii") : e.write(t, n, "utf8"), e[n++] = 0, "string" == typeof r.id) e.write(r.id, n, "binary"); else { if (!r.id || !r.id.copy) throw new TypeError("object [" + JSON.stringify(r) + "] is not a valid ObjectId"); r.id.copy(e, n, 0, 12) } return n + 12 } function serializeBuffer(e, t, r, n, i) { e[n++] = constants.BSON_DATA_BINARY, n += i ? e.write(t, n, "ascii") : e.write(t, n, "utf8"), e[n++] = 0; var o = r.length; return e[n++] = 255 & o, e[n++] = o >> 8 & 255, e[n++] = o >> 16 & 255, e[n++] = o >> 24 & 255, e[n++] = constants.BSON_BINARY_SUBTYPE_DEFAULT, r.copy(e, n, 0, o), n += o } function serializeObject(e, t, r, n, i, o, s, a, u, c) { for (var l = 0; l < c.length; l++)if (c[l] === r) throw new Error("cyclic dependency detected"); c.push(r), e[n++] = Array.isArray(r) ? constants.BSON_DATA_ARRAY : constants.BSON_DATA_OBJECT, n += u ? e.write(t, n, "ascii") : e.write(t, n, "utf8"), e[n++] = 0; var d = serializeInto(e, r, i, n, o + 1, s, a, c); return c.pop(), d } function serializeDecimal128(e, t, r, n, i) { return e[n++] = constants.BSON_DATA_DECIMAL128, n += i ? e.write(t, n, "ascii") : e.write(t, n, "utf8"), e[n++] = 0, r.bytes.copy(e, n, 0, 16), n + 16 } function serializeLong(e, t, r, n, i) { e[n++] = "Long" === r._bsontype ? constants.BSON_DATA_LONG : constants.BSON_DATA_TIMESTAMP, n += i ? e.write(t, n, "ascii") : e.write(t, n, "utf8"), e[n++] = 0; var o = r.getLowBits(), s = r.getHighBits(); return e[n++] = 255 & o, e[n++] = o >> 8 & 255, e[n++] = o >> 16 & 255, e[n++] = o >> 24 & 255, e[n++] = 255 & s, e[n++] = s >> 8 & 255, e[n++] = s >> 16 & 255, e[n++] = s >> 24 & 255, n } function serializeInt32(e, t, r, n, i) { return e[n++] = constants.BSON_DATA_INT, n += i ? e.write(t, n, "ascii") : e.write(t, n, "utf8"), e[n++] = 0, e[n++] = 255 & r, e[n++] = r >> 8 & 255, e[n++] = r >> 16 & 255, e[n++] = r >> 24 & 255, n } function serializeDouble(e, t, r, n, i) { return e[n++] = constants.BSON_DATA_NUMBER, n += i ? e.write(t, n, "ascii") : e.write(t, n, "utf8"), e[n++] = 0, writeIEEE754$1(e, r.value, n, "little", 52, 8), n += 8 } function serializeFunction(e, t, r, n, i, o, s) { e[n++] = constants.BSON_DATA_CODE, n += s ? e.write(t, n, "ascii") : e.write(t, n, "utf8"), e[n++] = 0; var a = normalizedFunctionString$1(r), u = e.write(a, n + 4, "utf8") + 1; return e[n] = 255 & u, e[n + 1] = u >> 8 & 255, e[n + 2] = u >> 16 & 255, e[n + 3] = u >> 24 & 255, n = n + 4 + u - 1, e[n++] = 0, n } function serializeCode(e, t, r, n, i, o, s, a, u) { if (r.scope && "object" === _typeof$3(r.scope)) { e[n++] = constants.BSON_DATA_CODE_W_SCOPE, n += u ? e.write(t, n, "ascii") : e.write(t, n, "utf8"), e[n++] = 0; var c = n, l = "string" == typeof r.code ? r.code : r.code.toString(); n += 4; var d = e.write(l, n + 4, "utf8") + 1; e[n] = 255 & d, e[n + 1] = d >> 8 & 255, e[n + 2] = d >> 16 & 255, e[n + 3] = d >> 24 & 255, e[n + 4 + d - 1] = 0, n = n + d + 4; var f = serializeInto(e, r.scope, i, n, o + 1, s, a); n = f - 1; var _ = f - c; e[c++] = 255 & _, e[c++] = _ >> 8 & 255, e[c++] = _ >> 16 & 255, e[c++] = _ >> 24 & 255, e[n++] = 0 } else { e[n++] = constants.BSON_DATA_CODE, n += u ? e.write(t, n, "ascii") : e.write(t, n, "utf8"), e[n++] = 0; var p = r.code.toString(), h = e.write(p, n + 4, "utf8") + 1; e[n] = 255 & h, e[n + 1] = h >> 8 & 255, e[n + 2] = h >> 16 & 255, e[n + 3] = h >> 24 & 255, n = n + 4 + h - 1, e[n++] = 0 } return n } function serializeBinary(e, t, r, n, i) { e[n++] = constants.BSON_DATA_BINARY, n += i ? e.write(t, n, "ascii") : e.write(t, n, "utf8"), e[n++] = 0; var o = r.value(!0), s = r.position; return r.sub_type === binary.SUBTYPE_BYTE_ARRAY && (s += 4), e[n++] = 255 & s, e[n++] = s >> 8 & 255, e[n++] = s >> 16 & 255, e[n++] = s >> 24 & 255, e[n++] = r.sub_type, r.sub_type === binary.SUBTYPE_BYTE_ARRAY && (s -= 4, e[n++] = 255 & s, e[n++] = s >> 8 & 255, e[n++] = s >> 16 & 255, e[n++] = s >> 24 & 255), o.copy(e, n, 0, r.position), n += r.position } function serializeSymbol(e, t, r, n, i) { e[n++] = constants.BSON_DATA_SYMBOL, n += i ? e.write(t, n, "ascii") : e.write(t, n, "utf8"), e[n++] = 0; var o = e.write(r.value, n + 4, "utf8") + 1; return e[n] = 255 & o, e[n + 1] = o >> 8 & 255, e[n + 2] = o >> 16 & 255, e[n + 3] = o >> 24 & 255, n = n + 4 + o - 1, e[n++] = 0, n } function serializeDBRef(e, t, r, n, i, o, s) { e[n++] = constants.BSON_DATA_OBJECT, n += s ? e.write(t, n, "ascii") : e.write(t, n, "utf8"), e[n++] = 0; var a, u = n, c = { $ref: r.collection || r.namespace, $id: r.oid }; null != r.db && (c.$db = r.db); var l = (a = serializeInto(e, c = Object.assign(c, r.fields), !1, n, i + 1, o)) - u; return e[u++] = 255 & l, e[u++] = l >> 8 & 255, e[u++] = l >> 16 & 255, e[u++] = l >> 24 & 255, a } function serializeInto(e, t, r, n, i, o, s, a) { n = n || 0, (a = a || []).push(t); var u = n + 4; if (Array.isArray(t)) for (var c = 0; c < t.length; c++) { var l = "" + c, d = t[c]; if (d && d.toBSON) { if ("function" != typeof d.toBSON) throw new TypeError("toBSON is not a function"); d = d.toBSON() } var f = _typeof$3(d); if ("string" === f) u = serializeString(e, l, d, u, !0); else if ("number" === f) u = serializeNumber(e, l, d, u, !0); else if ("boolean" === f) u = serializeBoolean(e, l, d, u, !0); else if (d instanceof Date || isDate$1(d)) u = serializeDate(e, l, d, u, !0); else if (void 0 === d) u = serializeNull(e, l, d, u, !0); else if (null === d) u = serializeNull(e, l, d, u, !0); else if ("ObjectId" === d._bsontype || "ObjectID" === d._bsontype) u = serializeObjectId(e, l, d, u, !0); else if (Buffer$5.isBuffer(d)) u = serializeBuffer(e, l, d, u, !0); else if (d instanceof RegExp || isRegExp$1(d)) u = serializeRegExp(e, l, d, u, !0); else if ("object" === f && null == d._bsontype) u = serializeObject(e, l, d, u, r, i, o, s, !0, a); else if ("object" === f && "Decimal128" === d._bsontype) u = serializeDecimal128(e, l, d, u, !0); else if ("Long" === d._bsontype || "Timestamp" === d._bsontype) u = serializeLong(e, l, d, u, !0); else if ("Double" === d._bsontype) u = serializeDouble(e, l, d, u, !0); else if ("function" == typeof d && o) u = serializeFunction(e, l, d, u, r, i, o, !0); else if ("Code" === d._bsontype) u = serializeCode(e, l, d, u, r, i, o, s, !0); else if ("Binary" === d._bsontype) u = serializeBinary(e, l, d, u, !0); else if ("Symbol" === d._bsontype) u = serializeSymbol(e, l, d, u, !0); else if ("DBRef" === d._bsontype) u = serializeDBRef(e, l, d, u, i, o, !0); else if ("BSONRegExp" === d._bsontype) u = serializeBSONRegExp(e, l, d, u, !0); else if ("Int32" === d._bsontype) u = serializeInt32(e, l, d, u, !0); else if ("MinKey" === d._bsontype || "MaxKey" === d._bsontype) u = serializeMinMax(e, l, d, u, !0); else if (void 0 !== d._bsontype) throw new TypeError("Unrecognized or invalid _bsontype: " + d._bsontype) } else if (t instanceof map) for (var _ = t.entries(), p = !1; !p;) { var h = _.next(); if (!(p = h.done)) { var g = h.value[0], E = h.value[1], m = _typeof$3(E); if ("string" == typeof g && !ignoreKeys.has(g)) { if (null != g.match(regexp$1)) throw Error("key " + g + " must not contain null bytes"); if (r) { if ("$" === g[0]) throw Error("key " + g + " must not start with '$'"); if (~g.indexOf(".")) throw Error("key " + g + " must not contain '.'") } } if ("string" === m) u = serializeString(e, g, E, u); else if ("number" === m) u = serializeNumber(e, g, E, u); else if ("boolean" === m) u = serializeBoolean(e, g, E, u); else if (E instanceof Date || isDate$1(E)) u = serializeDate(e, g, E, u); else if (null === E || void 0 === E && !1 === s) u = serializeNull(e, g, E, u); else if ("ObjectId" === E._bsontype || "ObjectID" === E._bsontype) u = serializeObjectId(e, g, E, u); else if (Buffer$5.isBuffer(E)) u = serializeBuffer(e, g, E, u); else if (E instanceof RegExp || isRegExp$1(E)) u = serializeRegExp(e, g, E, u); else if ("object" === m && null == E._bsontype) u = serializeObject(e, g, E, u, r, i, o, s, !1, a); else if ("object" === m && "Decimal128" === E._bsontype) u = serializeDecimal128(e, g, E, u); else if ("Long" === E._bsontype || "Timestamp" === E._bsontype) u = serializeLong(e, g, E, u); else if ("Double" === E._bsontype) u = serializeDouble(e, g, E, u); else if ("Code" === E._bsontype) u = serializeCode(e, g, E, u, r, i, o, s); else if ("function" == typeof E && o) u = serializeFunction(e, g, E, u, r, i, o); else if ("Binary" === E._bsontype) u = serializeBinary(e, g, E, u); else if ("Symbol" === E._bsontype) u = serializeSymbol(e, g, E, u); else if ("DBRef" === E._bsontype) u = serializeDBRef(e, g, E, u, i, o); else if ("BSONRegExp" === E._bsontype) u = serializeBSONRegExp(e, g, E, u); else if ("Int32" === E._bsontype) u = serializeInt32(e, g, E, u); else if ("MinKey" === E._bsontype || "MaxKey" === E._bsontype) u = serializeMinMax(e, g, E, u); else if (void 0 !== E._bsontype) throw new TypeError("Unrecognized or invalid _bsontype: " + E._bsontype) } } else { if (t.toBSON) { if ("function" != typeof t.toBSON) throw new TypeError("toBSON is not a function"); if (null != (t = t.toBSON()) && "object" !== _typeof$3(t)) throw new TypeError("toBSON function did not return an object") } for (var b in t) { var y = t[b]; if (y && y.toBSON) { if ("function" != typeof y.toBSON) throw new TypeError("toBSON is not a function"); y = y.toBSON() } var S = _typeof$3(y); if ("string" == typeof b && !ignoreKeys.has(b)) { if (null != b.match(regexp$1)) throw Error("key " + b + " must not contain null bytes"); if (r) { if ("$" === b[0]) throw Error("key " + b + " must not start with '$'"); if (~b.indexOf(".")) throw Error("key " + b + " must not contain '.'") } } if ("string" === S) u = serializeString(e, b, y, u); else if ("number" === S) u = serializeNumber(e, b, y, u); else if ("boolean" === S) u = serializeBoolean(e, b, y, u); else if (y instanceof Date || isDate$1(y)) u = serializeDate(e, b, y, u); else if (void 0 === y) !1 === s && (u = serializeNull(e, b, y, u)); else if (null === y) u = serializeNull(e, b, y, u); else if ("ObjectId" === y._bsontype || "ObjectID" === y._bsontype) u = serializeObjectId(e, b, y, u); else if (Buffer$5.isBuffer(y)) u = serializeBuffer(e, b, y, u); else if (y instanceof RegExp || isRegExp$1(y)) u = serializeRegExp(e, b, y, u); else if ("object" === S && null == y._bsontype) u = serializeObject(e, b, y, u, r, i, o, s, !1, a); else if ("object" === S && "Decimal128" === y._bsontype) u = serializeDecimal128(e, b, y, u); else if ("Long" === y._bsontype || "Timestamp" === y._bsontype) u = serializeLong(e, b, y, u); else if ("Double" === y._bsontype) u = serializeDouble(e, b, y, u); else if ("Code" === y._bsontype) u = serializeCode(e, b, y, u, r, i, o, s); else if ("function" == typeof y && o) u = serializeFunction(e, b, y, u, r, i, o); else if ("Binary" === y._bsontype) u = serializeBinary(e, b, y, u); else if ("Symbol" === y._bsontype) u = serializeSymbol(e, b, y, u); else if ("DBRef" === y._bsontype) u = serializeDBRef(e, b, y, u, i, o); else if ("BSONRegExp" === y._bsontype) u = serializeBSONRegExp(e, b, y, u); else if ("Int32" === y._bsontype) u = serializeInt32(e, b, y, u); else if ("MinKey" === y._bsontype || "MaxKey" === y._bsontype) u = serializeMinMax(e, b, y, u); else if (void 0 !== y._bsontype) throw new TypeError("Unrecognized or invalid _bsontype: " + y._bsontype) } } a.pop(), e[u++] = 0; var v = u - n; return e[n++] = 255 & v, e[n++] = v >> 8 & 255, e[n++] = v >> 16 & 255, e[n++] = v >> 24 & 255, u } var serializer = serializeInto; function _typeof$4(e) { return (_typeof$4 = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e })(e) } var Buffer$6 = buffer__WEBPACK_IMPORTED_MODULE_1___default.a.Buffer, normalizedFunctionString$2 = utils.normalizedFunctionString; function isDate$2(e) { return "object" === _typeof$4(e) && "[object Date]" === Object.prototype.toString.call(e) } function calculateObjectSize(e, t, r) { var n = 5; if (Array.isArray(e)) for (var i = 0; i < e.length; i++)n += calculateElement(i.toString(), e[i], t, !0, r); else for (var o in e.toBSON && (e = e.toBSON()), e) n += calculateElement(o, e[o], t, !1, r); return n } function calculateElement(e, t, r, n, i) { switch (t && t.toBSON && (t = t.toBSON()), _typeof$4(t)) { case "string": return 1 + Buffer$6.byteLength(e, "utf8") + 1 + 4 + Buffer$6.byteLength(t, "utf8") + 1; case "number": return Math.floor(t) === t && t >= constants.JS_INT_MIN && t <= constants.JS_INT_MAX && t >= constants.BSON_INT32_MIN && t <= constants.BSON_INT32_MAX ? (null != e ? Buffer$6.byteLength(e, "utf8") + 1 : 0) + 5 : (null != e ? Buffer$6.byteLength(e, "utf8") + 1 : 0) + 9; case "undefined": return n || !i ? (null != e ? Buffer$6.byteLength(e, "utf8") + 1 : 0) + 1 : 0; case "boolean": return (null != e ? Buffer$6.byteLength(e, "utf8") + 1 : 0) + 2; case "object": if (null == t || "MinKey" === t._bsontype || "MaxKey" === t._bsontype) return (null != e ? Buffer$6.byteLength(e, "utf8") + 1 : 0) + 1; if ("ObjectId" === t._bsontype || "ObjectID" === t._bsontype) return (null != e ? Buffer$6.byteLength(e, "utf8") + 1 : 0) + 13; if (t instanceof Date || isDate$2(t)) return (null != e ? Buffer$6.byteLength(e, "utf8") + 1 : 0) + 9; if (void 0 !== Buffer$6 && Buffer$6.isBuffer(t)) return (null != e ? Buffer$6.byteLength(e, "utf8") + 1 : 0) + 6 + t.length; if ("Long" === t._bsontype || "Double" === t._bsontype || "Timestamp" === t._bsontype) return (null != e ? Buffer$6.byteLength(e, "utf8") + 1 : 0) + 9; if ("Decimal128" === t._bsontype) return (null != e ? Buffer$6.byteLength(e, "utf8") + 1 : 0) + 17; if ("Code" === t._bsontype) return null != t.scope && Object.keys(t.scope).length > 0 ? (null != e ? Buffer$6.byteLength(e, "utf8") + 1 : 0) + 1 + 4 + 4 + Buffer$6.byteLength(t.code.toString(), "utf8") + 1 + calculateObjectSize(t.scope, r, i) : (null != e ? Buffer$6.byteLength(e, "utf8") + 1 : 0) + 1 + 4 + Buffer$6.byteLength(t.code.toString(), "utf8") + 1; if ("Binary" === t._bsontype) return t.sub_type === binary.SUBTYPE_BYTE_ARRAY ? (null != e ? Buffer$6.byteLength(e, "utf8") + 1 : 0) + (t.position + 1 + 4 + 1 + 4) : (null != e ? Buffer$6.byteLength(e, "utf8") + 1 : 0) + (t.position + 1 + 4 + 1); if ("Symbol" === t._bsontype) return (null != e ? Buffer$6.byteLength(e, "utf8") + 1 : 0) + Buffer$6.byteLength(t.value, "utf8") + 4 + 1 + 1; if ("DBRef" === t._bsontype) { var o = Object.assign({ $ref: t.collection, $id: t.oid }, t.fields); return null != t.db && (o.$db = t.db), (null != e ? Buffer$6.byteLength(e, "utf8") + 1 : 0) + 1 + calculateObjectSize(o, r, i) } return t instanceof RegExp || "[object RegExp]" === Object.prototype.toString.call(t) ? (null != e ? Buffer$6.byteLength(e, "utf8") + 1 : 0) + 1 + Buffer$6.byteLength(t.source, "utf8") + 1 + (t.global ? 1 : 0) + (t.ignoreCase ? 1 : 0) + (t.multiline ? 1 : 0) + 1 : "BSONRegExp" === t._bsontype ? (null != e ? Buffer$6.byteLength(e, "utf8") + 1 : 0) + 1 + Buffer$6.byteLength(t.pattern, "utf8") + 1 + Buffer$6.byteLength(t.options, "utf8") + 1 : (null != e ? Buffer$6.byteLength(e, "utf8") + 1 : 0) + calculateObjectSize(t, r, i) + 1; case "function": if (t instanceof RegExp || "[object RegExp]" === Object.prototype.toString.call(t) || "[object RegExp]" === String.call(t)) return (null != e ? Buffer$6.byteLength(e, "utf8") + 1 : 0) + 1 + Buffer$6.byteLength(t.source, "utf8") + 1 + (t.global ? 1 : 0) + (t.ignoreCase ? 1 : 0) + (t.multiline ? 1 : 0) + 1; if (r && null != t.scope && Object.keys(t.scope).length > 0) return (null != e ? Buffer$6.byteLength(e, "utf8") + 1 : 0) + 1 + 4 + 4 + Buffer$6.byteLength(normalizedFunctionString$2(t), "utf8") + 1 + calculateObjectSize(t.scope, r, i); if (r) return (null != e ? Buffer$6.byteLength(e, "utf8") + 1 : 0) + 1 + 4 + Buffer$6.byteLength(normalizedFunctionString$2(t), "utf8") + 1 }return 0 } var calculate_size = calculateObjectSize, Buffer$7 = buffer__WEBPACK_IMPORTED_MODULE_1___default.a.Buffer, ensure_buffer = function (e) { if (e instanceof Buffer$7) return e; if (e instanceof Uint8Array) return Buffer$7.from(e.buffer); throw new TypeError("Must use either Buffer or Uint8Array") }, Buffer$8 = buffer__WEBPACK_IMPORTED_MODULE_1___default.a.Buffer, MAXSIZE = 17825792, buffer$1 = Buffer$8.alloc(MAXSIZE); function setInternalBufferSize(e) { buffer$1.length < e && (buffer$1 = Buffer$8.alloc(e)) } function serialize$1(e, t) { var r = "boolean" == typeof (t = t || {}).checkKeys && t.checkKeys, n = "boolean" == typeof t.serializeFunctions && t.serializeFunctions, i = "boolean" != typeof t.ignoreUndefined || t.ignoreUndefined, o = "number" == typeof t.minInternalBufferSize ? t.minInternalBufferSize : MAXSIZE; buffer$1.length < o && (buffer$1 = Buffer$8.alloc(o)); var s = serializer(buffer$1, e, r, 0, 0, n, i, []), a = Buffer$8.alloc(s); return buffer$1.copy(a, 0, 0, a.length), a } function serializeWithBufferAndIndex(e, t, r) { var n = "boolean" == typeof (r = r || {}).checkKeys && r.checkKeys, i = "boolean" == typeof r.serializeFunctions && r.serializeFunctions, o = "boolean" != typeof r.ignoreUndefined || r.ignoreUndefined, s = "number" == typeof r.index ? r.index : 0, a = serializer(buffer$1, e, n, 0, 0, i, o); return buffer$1.copy(t, s, 0, a), s + a - 1 } function deserialize$2(e, t) { return e = ensure_buffer(e), deserializer(e, t) } function calculateObjectSize$1(e, t) { var r = "boolean" == typeof (t = t || {}).serializeFunctions && t.serializeFunctions, n = "boolean" != typeof t.ignoreUndefined || t.ignoreUndefined; return calculate_size(e, r, n) } function deserializeStream(e, t, r, n, i, o) { o = Object.assign({ allowObjectSmallerThanBufferSize: !0 }, o), e = ensure_buffer(e); for (var s = t, a = 0; a < r; a++) { var u = e[s] | e[s + 1] << 8 | e[s + 2] << 16 | e[s + 3] << 24; o.index = s, n[i + a] = deserializer(e, o), s += u } return s } var bson = { BSON_INT32_MAX: constants.BSON_INT32_MAX, BSON_INT32_MIN: constants.BSON_INT32_MIN, BSON_INT64_MAX: constants.BSON_INT64_MAX, BSON_INT64_MIN: constants.BSON_INT64_MIN, JS_INT_MAX: constants.JS_INT_MAX, JS_INT_MIN: constants.JS_INT_MIN, BSON_DATA_NUMBER: constants.BSON_DATA_NUMBER, BSON_DATA_STRING: constants.BSON_DATA_STRING, BSON_DATA_OBJECT: constants.BSON_DATA_OBJECT, BSON_DATA_ARRAY: constants.BSON_DATA_ARRAY, BSON_DATA_BINARY: constants.BSON_DATA_BINARY, BSON_DATA_UNDEFINED: constants.BSON_DATA_UNDEFINED, BSON_DATA_OID: constants.BSON_DATA_OID, BSON_DATA_BOOLEAN: constants.BSON_DATA_BOOLEAN, BSON_DATA_DATE: constants.BSON_DATA_DATE, BSON_DATA_NULL: constants.BSON_DATA_NULL, BSON_DATA_REGEXP: constants.BSON_DATA_REGEXP, BSON_DATA_DBPOINTER: constants.BSON_DATA_DBPOINTER, BSON_DATA_CODE: constants.BSON_DATA_CODE, BSON_DATA_SYMBOL: constants.BSON_DATA_SYMBOL, BSON_DATA_CODE_W_SCOPE: constants.BSON_DATA_CODE_W_SCOPE, BSON_DATA_INT: constants.BSON_DATA_INT, BSON_DATA_TIMESTAMP: constants.BSON_DATA_TIMESTAMP, BSON_DATA_LONG: constants.BSON_DATA_LONG, BSON_DATA_DECIMAL128: constants.BSON_DATA_DECIMAL128, BSON_DATA_MIN_KEY: constants.BSON_DATA_MIN_KEY, BSON_DATA_MAX_KEY: constants.BSON_DATA_MAX_KEY, BSON_BINARY_SUBTYPE_DEFAULT: constants.BSON_BINARY_SUBTYPE_DEFAULT, BSON_BINARY_SUBTYPE_FUNCTION: constants.BSON_BINARY_SUBTYPE_FUNCTION, BSON_BINARY_SUBTYPE_BYTE_ARRAY: constants.BSON_BINARY_SUBTYPE_BYTE_ARRAY, BSON_BINARY_SUBTYPE_UUID: constants.BSON_BINARY_SUBTYPE_UUID, BSON_BINARY_SUBTYPE_MD5: constants.BSON_BINARY_SUBTYPE_MD5, BSON_BINARY_SUBTYPE_USER_DEFINED: constants.BSON_BINARY_SUBTYPE_USER_DEFINED, Code: code, Map: map, BSONSymbol: symbol, DBRef: db_ref, Binary: binary, ObjectId: objectid, Long: long_1, Timestamp: timestamp, Double: double_1, Int32: int_32, MinKey: min_key, MaxKey: max_key, BSONRegExp: regexp, Decimal128: decimal128, serialize: serialize$1, serializeWithBufferAndIndex: serializeWithBufferAndIndex, deserialize: deserialize$2, calculateObjectSize: calculateObjectSize$1, deserializeStream: deserializeStream, setInternalBufferSize: setInternalBufferSize, ObjectID: objectid, EJSON: extended_json }, bson_1 = bson.BSON_INT32_MAX, bson_2 = bson.BSON_INT32_MIN, bson_3 = bson.BSON_INT64_MAX, bson_4 = bson.BSON_INT64_MIN, bson_5 = bson.JS_INT_MAX, bson_6 = bson.JS_INT_MIN, bson_7 = bson.BSON_DATA_NUMBER, bson_8 = bson.BSON_DATA_STRING, bson_9 = bson.BSON_DATA_OBJECT, bson_10 = bson.BSON_DATA_ARRAY, bson_11 = bson.BSON_DATA_BINARY, bson_12 = bson.BSON_DATA_UNDEFINED, bson_13 = bson.BSON_DATA_OID, bson_14 = bson.BSON_DATA_BOOLEAN, bson_15 = bson.BSON_DATA_DATE, bson_16 = bson.BSON_DATA_NULL, bson_17 = bson.BSON_DATA_REGEXP, bson_18 = bson.BSON_DATA_DBPOINTER, bson_19 = bson.BSON_DATA_CODE, bson_20 = bson.BSON_DATA_SYMBOL, bson_21 = bson.BSON_DATA_CODE_W_SCOPE, bson_22 = bson.BSON_DATA_INT, bson_23 = bson.BSON_DATA_TIMESTAMP, bson_24 = bson.BSON_DATA_LONG, bson_25 = bson.BSON_DATA_DECIMAL128, bson_26 = bson.BSON_DATA_MIN_KEY, bson_27 = bson.BSON_DATA_MAX_KEY, bson_28 = bson.BSON_BINARY_SUBTYPE_DEFAULT, bson_29 = bson.BSON_BINARY_SUBTYPE_FUNCTION, bson_30 = bson.BSON_BINARY_SUBTYPE_BYTE_ARRAY, bson_31 = bson.BSON_BINARY_SUBTYPE_UUID, bson_32 = bson.BSON_BINARY_SUBTYPE_MD5, bson_33 = bson.BSON_BINARY_SUBTYPE_USER_DEFINED, bson_34 = bson.Code, bson_35 = bson.BSONSymbol, bson_36 = bson.DBRef, bson_37 = bson.Binary, bson_38 = bson.ObjectId, bson_39 = bson.Long, bson_40 = bson.Timestamp, bson_41 = bson.Double, bson_42 = bson.Int32, bson_43 = bson.MinKey, bson_44 = bson.MaxKey, bson_45 = bson.BSONRegExp, bson_46 = bson.Decimal128, bson_47 = bson.serialize, bson_48 = bson.serializeWithBufferAndIndex, bson_49 = bson.deserialize, bson_50 = bson.calculateObjectSize, bson_51 = bson.deserializeStream, bson_52 = bson.setInternalBufferSize, bson_53 = bson.ObjectID, bson_54 = bson.EJSON; __webpack_exports__.default = bson }.call(this, __webpack_require__("./node_modules/webpack/buildin/global.js"), __webpack_require__("./node_modules/node-libs-browser/node_modules/buffer/index.js").Buffer) }, "./node_modules/ieee754/index.js": function (e, t) { t.read = function (e, t, r, n, i) { var o, s, a = 8 * i - n - 1, u = (1 << a) - 1, c = u >> 1, l = -7, d = r ? i - 1 : 0, f = r ? -1 : 1, _ = e[t + d]; for (d += f, o = _ & (1 << -l) - 1, _ >>= -l, l += a; l > 0; o = 256 * o + e[t + d], d += f, l -= 8); for (s = o & (1 << -l) - 1, o >>= -l, l += n; l > 0; s = 256 * s + e[t + d], d += f, l -= 8); if (0 === o) o = 1 - c; else { if (o === u) return s ? NaN : 1 / 0 * (_ ? -1 : 1); s += Math.pow(2, n), o -= c } return (_ ? -1 : 1) * s * Math.pow(2, o - n) }, t.write = function (e, t, r, n, i, o) { var s, a, u, c = 8 * o - i - 1, l = (1 << c) - 1, d = l >> 1, f = 23 === i ? Math.pow(2, -24) - Math.pow(2, -77) : 0, _ = n ? 0 : o - 1, p = n ? 1 : -1, h = t < 0 || 0 === t && 1 / t < 0 ? 1 : 0; for (t = Math.abs(t), isNaN(t) || t === 1 / 0 ? (a = isNaN(t) ? 1 : 0, s = l) : (s = Math.floor(Math.log(t) / Math.LN2), t * (u = Math.pow(2, -s)) < 1 && (s-- , u *= 2), (t += s + d >= 1 ? f / u : f * Math.pow(2, 1 - d)) * u >= 2 && (s++ , u /= 2), s + d >= l ? (a = 0, s = l) : s + d >= 1 ? (a = (t * u - 1) * Math.pow(2, i), s += d) : (a = t * Math.pow(2, d - 1) * Math.pow(2, i), s = 0)); i >= 8; e[r + _] = 255 & a, _ += p, a /= 256, i -= 8); for (s = s << i | a, c += i; c > 0; e[r + _] = 255 & s, _ += p, s /= 256, c -= 8); e[r + _ - p] |= 128 * h } }, "./node_modules/isarray/index.js": function (e, t) { var r = {}.toString; e.exports = Array.isArray || function (e) { return "[object Array]" == r.call(e) } }, "./node_modules/lodash-es/_DataView.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_getNative.js"), i = r("./node_modules/lodash-es/_root.js"), o = Object(n.default)(i.default, "DataView"); t.default = o }, "./node_modules/lodash-es/_Hash.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_hashClear.js"), i = r("./node_modules/lodash-es/_hashDelete.js"), o = r("./node_modules/lodash-es/_hashGet.js"), s = r("./node_modules/lodash-es/_hashHas.js"), a = r("./node_modules/lodash-es/_hashSet.js"); function u(e) { var t = -1, r = null == e ? 0 : e.length; for (this.clear(); ++t < r;) { var n = e[t]; this.set(n[0], n[1]) } } u.prototype.clear = n.default, u.prototype.delete = i.default, u.prototype.get = o.default, u.prototype.has = s.default, u.prototype.set = a.default, t.default = u }, "./node_modules/lodash-es/_ListCache.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_listCacheClear.js"), i = r("./node_modules/lodash-es/_listCacheDelete.js"), o = r("./node_modules/lodash-es/_listCacheGet.js"), s = r("./node_modules/lodash-es/_listCacheHas.js"), a = r("./node_modules/lodash-es/_listCacheSet.js"); function u(e) { var t = -1, r = null == e ? 0 : e.length; for (this.clear(); ++t < r;) { var n = e[t]; this.set(n[0], n[1]) } } u.prototype.clear = n.default, u.prototype.delete = i.default, u.prototype.get = o.default, u.prototype.has = s.default, u.prototype.set = a.default, t.default = u }, "./node_modules/lodash-es/_Map.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_getNative.js"), i = r("./node_modules/lodash-es/_root.js"), o = Object(n.default)(i.default, "Map"); t.default = o }, "./node_modules/lodash-es/_MapCache.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_mapCacheClear.js"), i = r("./node_modules/lodash-es/_mapCacheDelete.js"), o = r("./node_modules/lodash-es/_mapCacheGet.js"), s = r("./node_modules/lodash-es/_mapCacheHas.js"), a = r("./node_modules/lodash-es/_mapCacheSet.js"); function u(e) { var t = -1, r = null == e ? 0 : e.length; for (this.clear(); ++t < r;) { var n = e[t]; this.set(n[0], n[1]) } } u.prototype.clear = n.default, u.prototype.delete = i.default, u.prototype.get = o.default, u.prototype.has = s.default, u.prototype.set = a.default, t.default = u }, "./node_modules/lodash-es/_Promise.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_getNative.js"), i = r("./node_modules/lodash-es/_root.js"), o = Object(n.default)(i.default, "Promise"); t.default = o }, "./node_modules/lodash-es/_Set.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_getNative.js"), i = r("./node_modules/lodash-es/_root.js"), o = Object(n.default)(i.default, "Set"); t.default = o }, "./node_modules/lodash-es/_Stack.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_ListCache.js"), i = r("./node_modules/lodash-es/_stackClear.js"), o = r("./node_modules/lodash-es/_stackDelete.js"), s = r("./node_modules/lodash-es/_stackGet.js"), a = r("./node_modules/lodash-es/_stackHas.js"), u = r("./node_modules/lodash-es/_stackSet.js"); function c(e) { var t = this.__data__ = new n.default(e); this.size = t.size } c.prototype.clear = i.default, c.prototype.delete = o.default, c.prototype.get = s.default, c.prototype.has = a.default, c.prototype.set = u.default, t.default = c }, "./node_modules/lodash-es/_Symbol.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_root.js").default.Symbol; t.default = n }, "./node_modules/lodash-es/_Uint8Array.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_root.js").default.Uint8Array; t.default = n }, "./node_modules/lodash-es/_WeakMap.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_getNative.js"), i = r("./node_modules/lodash-es/_root.js"), o = Object(n.default)(i.default, "WeakMap"); t.default = o }, "./node_modules/lodash-es/_arrayEach.js": function (e, t, r) { r.r(t), t.default = function (e, t) { for (var r = -1, n = null == e ? 0 : e.length; ++r < n && !1 !== t(e[r], r, e);); return e } }, "./node_modules/lodash-es/_arrayFilter.js": function (e, t, r) { r.r(t), t.default = function (e, t) { for (var r = -1, n = null == e ? 0 : e.length, i = 0, o = []; ++r < n;) { var s = e[r]; t(s, r, e) && (o[i++] = s) } return o } }, "./node_modules/lodash-es/_arrayLikeKeys.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_baseTimes.js"), i = r("./node_modules/lodash-es/isArguments.js"), o = r("./node_modules/lodash-es/isArray.js"), s = r("./node_modules/lodash-es/isBuffer.js"), a = r("./node_modules/lodash-es/_isIndex.js"), u = r("./node_modules/lodash-es/isTypedArray.js"), c = Object.prototype.hasOwnProperty; t.default = function (e, t) { var r = Object(o.default)(e), l = !r && Object(i.default)(e), d = !r && !l && Object(s.default)(e), f = !r && !l && !d && Object(u.default)(e), _ = r || l || d || f, p = _ ? Object(n.default)(e.length, String) : [], h = p.length; for (var g in e) !t && !c.call(e, g) || _ && ("length" == g || d && ("offset" == g || "parent" == g) || f && ("buffer" == g || "byteLength" == g || "byteOffset" == g) || Object(a.default)(g, h)) || p.push(g); return p } }, "./node_modules/lodash-es/_arrayMap.js": function (e, t, r) { r.r(t), t.default = function (e, t) { for (var r = -1, n = null == e ? 0 : e.length, i = Array(n); ++r < n;)i[r] = t(e[r], r, e); return i } }, "./node_modules/lodash-es/_arrayPush.js": function (e, t, r) { r.r(t), t.default = function (e, t) { for (var r = -1, n = t.length, i = e.length; ++r < n;)e[i + r] = t[r]; return e } }, "./node_modules/lodash-es/_assignValue.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_baseAssignValue.js"), i = r("./node_modules/lodash-es/eq.js"), o = Object.prototype.hasOwnProperty; t.default = function (e, t, r) { var s = e[t]; o.call(e, t) && Object(i.default)(s, r) && (void 0 !== r || t in e) || Object(n.default)(e, t, r) } }, "./node_modules/lodash-es/_assocIndexOf.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/eq.js"); t.default = function (e, t) { for (var r = e.length; r--;)if (Object(n.default)(e[r][0], t)) return r; return -1 } }, "./node_modules/lodash-es/_baseAssign.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_copyObject.js"), i = r("./node_modules/lodash-es/keys.js"); t.default = function (e, t) { return e && Object(n.default)(t, Object(i.default)(t), e) } }, "./node_modules/lodash-es/_baseAssignIn.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_copyObject.js"), i = r("./node_modules/lodash-es/keysIn.js"); t.default = function (e, t) { return e && Object(n.default)(t, Object(i.default)(t), e) } }, "./node_modules/lodash-es/_baseAssignValue.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_defineProperty.js"); t.default = function (e, t, r) { "__proto__" == t && n.default ? Object(n.default)(e, t, { configurable: !0, enumerable: !0, value: r, writable: !0 }) : e[t] = r } }, "./node_modules/lodash-es/_baseClone.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_Stack.js"), i = r("./node_modules/lodash-es/_arrayEach.js"), o = r("./node_modules/lodash-es/_assignValue.js"), s = r("./node_modules/lodash-es/_baseAssign.js"), a = r("./node_modules/lodash-es/_baseAssignIn.js"), u = r("./node_modules/lodash-es/_cloneBuffer.js"), c = r("./node_modules/lodash-es/_copyArray.js"), l = r("./node_modules/lodash-es/_copySymbols.js"), d = r("./node_modules/lodash-es/_copySymbolsIn.js"), f = r("./node_modules/lodash-es/_getAllKeys.js"), _ = r("./node_modules/lodash-es/_getAllKeysIn.js"), p = r("./node_modules/lodash-es/_getTag.js"), h = r("./node_modules/lodash-es/_initCloneArray.js"), g = r("./node_modules/lodash-es/_initCloneByTag.js"), E = r("./node_modules/lodash-es/_initCloneObject.js"), m = r("./node_modules/lodash-es/isArray.js"), b = r("./node_modules/lodash-es/isBuffer.js"), y = r("./node_modules/lodash-es/isMap.js"), S = r("./node_modules/lodash-es/isObject.js"), v = r("./node_modules/lodash-es/isSet.js"), T = r("./node_modules/lodash-es/keys.js"), A = 1, O = 2, N = 4, I = "[object Arguments]", C = "[object Function]", R = "[object GeneratorFunction]", w = "[object Object]", D = {}; D[I] = D["[object Array]"] = D["[object ArrayBuffer]"] = D["[object DataView]"] = D["[object Boolean]"] = D["[object Date]"] = D["[object Float32Array]"] = D["[object Float64Array]"] = D["[object Int8Array]"] = D["[object Int16Array]"] = D["[object Int32Array]"] = D["[object Map]"] = D["[object Number]"] = D[w] = D["[object RegExp]"] = D["[object Set]"] = D["[object String]"] = D["[object Symbol]"] = D["[object Uint8Array]"] = D["[object Uint8ClampedArray]"] = D["[object Uint16Array]"] = D["[object Uint32Array]"] = !0, D["[object Error]"] = D[C] = D["[object WeakMap]"] = !1, t.default = function e(t, r, M, L, j, P) { var B, x = r & A, U = r & O, G = r & N; if (M && (B = j ? M(t, L, j, P) : M(t)), void 0 !== B) return B; if (!Object(S.default)(t)) return t; var k = Object(m.default)(t); if (k) { if (B = Object(h.default)(t), !x) return Object(c.default)(t, B) } else { var F = Object(p.default)(t), Y = F == C || F == R; if (Object(b.default)(t)) return Object(u.default)(t, x); if (F == w || F == I || Y && !j) { if (B = U || Y ? {} : Object(E.default)(t), !x) return U ? Object(d.default)(t, Object(a.default)(B, t)) : Object(l.default)(t, Object(s.default)(B, t)) } else { if (!D[F]) return j ? t : {}; B = Object(g.default)(t, F, x) } } P || (P = new n.default); var K = P.get(t); if (K) return K; P.set(t, B), Object(v.default)(t) ? t.forEach(function (n) { B.add(e(n, r, M, n, t, P)) }) : Object(y.default)(t) && t.forEach(function (n, i) { B.set(i, e(n, r, M, i, t, P)) }); var q = G ? U ? _.default : f.default : U ? keysIn : T.default, $ = k ? void 0 : q(t); return Object(i.default)($ || t, function (n, i) { $ && (n = t[i = n]), Object(o.default)(B, i, e(n, r, M, i, t, P)) }), B } }, "./node_modules/lodash-es/_baseCreate.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/isObject.js"), i = Object.create, o = function () { function e() { } return function (t) { if (!Object(n.default)(t)) return {}; if (i) return i(t); e.prototype = t; var r = new e; return e.prototype = void 0, r } }(); t.default = o }, "./node_modules/lodash-es/_baseGet.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_castPath.js"), i = r("./node_modules/lodash-es/_toKey.js"); t.default = function (e, t) { for (var r = 0, o = (t = Object(n.default)(t, e)).length; null != e && r < o;)e = e[Object(i.default)(t[r++])]; return r && r == o ? e : void 0 } }, "./node_modules/lodash-es/_baseGetAllKeys.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_arrayPush.js"), i = r("./node_modules/lodash-es/isArray.js"); t.default = function (e, t, r) { var o = t(e); return Object(i.default)(e) ? o : Object(n.default)(o, r(e)) } }, "./node_modules/lodash-es/_baseGetTag.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_Symbol.js"), i = r("./node_modules/lodash-es/_getRawTag.js"), o = r("./node_modules/lodash-es/_objectToString.js"), s = "[object Null]", a = "[object Undefined]", u = n.default ? n.default.toStringTag : void 0; t.default = function (e) { return null == e ? void 0 === e ? a : s : u && u in Object(e) ? Object(i.default)(e) : Object(o.default)(e) } }, "./node_modules/lodash-es/_baseIsArguments.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_baseGetTag.js"), i = r("./node_modules/lodash-es/isObjectLike.js"), o = "[object Arguments]"; t.default = function (e) { return Object(i.default)(e) && Object(n.default)(e) == o } }, "./node_modules/lodash-es/_baseIsMap.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_getTag.js"), i = r("./node_modules/lodash-es/isObjectLike.js"), o = "[object Map]"; t.default = function (e) { return Object(i.default)(e) && Object(n.default)(e) == o } }, "./node_modules/lodash-es/_baseIsNative.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/isFunction.js"), i = r("./node_modules/lodash-es/_isMasked.js"), o = r("./node_modules/lodash-es/isObject.js"), s = r("./node_modules/lodash-es/_toSource.js"), a = /^\[object .+?Constructor\]$/, u = Function.prototype, c = Object.prototype, l = u.toString, d = c.hasOwnProperty, f = RegExp("^" + l.call(d).replace(/[\\^$.*+?()[\]{}|]/g, "\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g, "$1.*?") + "$"); t.default = function (e) { return !(!Object(o.default)(e) || Object(i.default)(e)) && (Object(n.default)(e) ? f : a).test(Object(s.default)(e)) } }, "./node_modules/lodash-es/_baseIsSet.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_getTag.js"), i = r("./node_modules/lodash-es/isObjectLike.js"), o = "[object Set]"; t.default = function (e) { return Object(i.default)(e) && Object(n.default)(e) == o } }, "./node_modules/lodash-es/_baseIsTypedArray.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_baseGetTag.js"), i = r("./node_modules/lodash-es/isLength.js"), o = r("./node_modules/lodash-es/isObjectLike.js"), s = {}; s["[object Float32Array]"] = s["[object Float64Array]"] = s["[object Int8Array]"] = s["[object Int16Array]"] = s["[object Int32Array]"] = s["[object Uint8Array]"] = s["[object Uint8ClampedArray]"] = s["[object Uint16Array]"] = s["[object Uint32Array]"] = !0, s["[object Arguments]"] = s["[object Array]"] = s["[object ArrayBuffer]"] = s["[object Boolean]"] = s["[object DataView]"] = s["[object Date]"] = s["[object Error]"] = s["[object Function]"] = s["[object Map]"] = s["[object Number]"] = s["[object Object]"] = s["[object RegExp]"] = s["[object Set]"] = s["[object String]"] = s["[object WeakMap]"] = !1, t.default = function (e) { return Object(o.default)(e) && Object(i.default)(e.length) && !!s[Object(n.default)(e)] } }, "./node_modules/lodash-es/_baseKeys.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_isPrototype.js"), i = r("./node_modules/lodash-es/_nativeKeys.js"), o = Object.prototype.hasOwnProperty; t.default = function (e) { if (!Object(n.default)(e)) return Object(i.default)(e); var t = []; for (var r in Object(e)) o.call(e, r) && "constructor" != r && t.push(r); return t } }, "./node_modules/lodash-es/_baseKeysIn.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/isObject.js"), i = r("./node_modules/lodash-es/_isPrototype.js"), o = r("./node_modules/lodash-es/_nativeKeysIn.js"), s = Object.prototype.hasOwnProperty; t.default = function (e) { if (!Object(n.default)(e)) return Object(o.default)(e); var t = Object(i.default)(e), r = []; for (var a in e) ("constructor" != a || !t && s.call(e, a)) && r.push(a); return r } }, "./node_modules/lodash-es/_baseSet.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_assignValue.js"), i = r("./node_modules/lodash-es/_castPath.js"), o = r("./node_modules/lodash-es/_isIndex.js"), s = r("./node_modules/lodash-es/isObject.js"), a = r("./node_modules/lodash-es/_toKey.js"); t.default = function (e, t, r, u) { if (!Object(s.default)(e)) return e; for (var c = -1, l = (t = Object(i.default)(t, e)).length, d = l - 1, f = e; null != f && ++c < l;) { var _ = Object(a.default)(t[c]), p = r; if (c != d) { var h = f[_]; void 0 === (p = u ? u(h, _, f) : void 0) && (p = Object(s.default)(h) ? h : Object(o.default)(t[c + 1]) ? [] : {}) } Object(n.default)(f, _, p), f = f[_] } return e } }, "./node_modules/lodash-es/_baseSlice.js": function (e, t, r) { r.r(t), t.default = function (e, t, r) { var n = -1, i = e.length; t < 0 && (t = -t > i ? 0 : i + t), (r = r > i ? i : r) < 0 && (r += i), i = t > r ? 0 : r - t >>> 0, t >>>= 0; for (var o = Array(i); ++n < i;)o[n] = e[n + t]; return o } }, "./node_modules/lodash-es/_baseTimes.js": function (e, t, r) { r.r(t), t.default = function (e, t) { for (var r = -1, n = Array(e); ++r < e;)n[r] = t(r); return n } }, "./node_modules/lodash-es/_baseToString.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_Symbol.js"), i = r("./node_modules/lodash-es/_arrayMap.js"), o = r("./node_modules/lodash-es/isArray.js"), s = r("./node_modules/lodash-es/isSymbol.js"), a = 1 / 0, u = n.default ? n.default.prototype : void 0, c = u ? u.toString : void 0; t.default = function e(t) { if ("string" == typeof t) return t; if (Object(o.default)(t)) return Object(i.default)(t, e) + ""; if (Object(s.default)(t)) return c ? c.call(t) : ""; var r = t + ""; return "0" == r && 1 / t == -a ? "-0" : r } }, "./node_modules/lodash-es/_baseUnary.js": function (e, t, r) { r.r(t), t.default = function (e) { return function (t) { return e(t) } } }, "./node_modules/lodash-es/_baseUnset.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_castPath.js"), i = r("./node_modules/lodash-es/last.js"), o = r("./node_modules/lodash-es/_parent.js"), s = r("./node_modules/lodash-es/_toKey.js"); t.default = function (e, t) { return t = Object(n.default)(t, e), null == (e = Object(o.default)(e, t)) || delete e[Object(s.default)(Object(i.default)(t))] } }, "./node_modules/lodash-es/_castPath.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/isArray.js"), i = r("./node_modules/lodash-es/_isKey.js"), o = r("./node_modules/lodash-es/_stringToPath.js"), s = r("./node_modules/lodash-es/toString.js"); t.default = function (e, t) { return Object(n.default)(e) ? e : Object(i.default)(e, t) ? [e] : Object(o.default)(Object(s.default)(e)) } }, "./node_modules/lodash-es/_cloneArrayBuffer.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_Uint8Array.js"); t.default = function (e) { var t = new e.constructor(e.byteLength); return new n.default(t).set(new n.default(e)), t } }, "./node_modules/lodash-es/_cloneBuffer.js": function (e, t, r) { r.r(t), function (e) { var n = r("./node_modules/lodash-es/_root.js"), i = "object" == typeof exports && exports && !exports.nodeType && exports, o = i && "object" == typeof e && e && !e.nodeType && e, s = o && o.exports === i ? n.default.Buffer : void 0, a = s ? s.allocUnsafe : void 0; t.default = function (e, t) { if (t) return e.slice(); var r = e.length, n = a ? a(r) : new e.constructor(r); return e.copy(n), n } }.call(this, r("./node_modules/webpack/buildin/harmony-module.js")(e)) }, "./node_modules/lodash-es/_cloneDataView.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_cloneArrayBuffer.js"); t.default = function (e, t) { var r = t ? Object(n.default)(e.buffer) : e.buffer; return new e.constructor(r, e.byteOffset, e.byteLength) } }, "./node_modules/lodash-es/_cloneRegExp.js": function (e, t, r) { r.r(t); var n = /\w*$/; t.default = function (e) { var t = new e.constructor(e.source, n.exec(e)); return t.lastIndex = e.lastIndex, t } }, "./node_modules/lodash-es/_cloneSymbol.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_Symbol.js"), i = n.default ? n.default.prototype : void 0, o = i ? i.valueOf : void 0; t.default = function (e) { return o ? Object(o.call(e)) : {} } }, "./node_modules/lodash-es/_cloneTypedArray.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_cloneArrayBuffer.js"); t.default = function (e, t) { var r = t ? Object(n.default)(e.buffer) : e.buffer; return new e.constructor(r, e.byteOffset, e.length) } }, "./node_modules/lodash-es/_copyArray.js": function (e, t, r) { r.r(t), t.default = function (e, t) { var r = -1, n = e.length; for (t || (t = Array(n)); ++r < n;)t[r] = e[r]; return t } }, "./node_modules/lodash-es/_copyObject.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_assignValue.js"), i = r("./node_modules/lodash-es/_baseAssignValue.js"); t.default = function (e, t, r, o) { var s = !r; r || (r = {}); for (var a = -1, u = t.length; ++a < u;) { var c = t[a], l = o ? o(r[c], e[c], c, r, e) : void 0; void 0 === l && (l = e[c]), s ? Object(i.default)(r, c, l) : Object(n.default)(r, c, l) } return r } }, "./node_modules/lodash-es/_copySymbols.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_copyObject.js"), i = r("./node_modules/lodash-es/_getSymbols.js"); t.default = function (e, t) { return Object(n.default)(e, Object(i.default)(e), t) } }, "./node_modules/lodash-es/_copySymbolsIn.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_copyObject.js"), i = r("./node_modules/lodash-es/_getSymbolsIn.js"); t.default = function (e, t) { return Object(n.default)(e, Object(i.default)(e), t) } }, "./node_modules/lodash-es/_coreJsData.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_root.js").default["__core-js_shared__"]; t.default = n }, "./node_modules/lodash-es/_defineProperty.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_getNative.js"), i = function () { try { var e = Object(n.default)(Object, "defineProperty"); return e({}, "", {}), e } catch (e) { } }(); t.default = i }, "./node_modules/lodash-es/_freeGlobal.js": function (e, t, r) { r.r(t), function (e) { var r = "object" == typeof e && e && e.Object === Object && e; t.default = r }.call(this, r("./node_modules/webpack/buildin/global.js")) }, "./node_modules/lodash-es/_getAllKeys.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_baseGetAllKeys.js"), i = r("./node_modules/lodash-es/_getSymbols.js"), o = r("./node_modules/lodash-es/keys.js"); t.default = function (e) { return Object(n.default)(e, o.default, i.default) } }, "./node_modules/lodash-es/_getAllKeysIn.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_baseGetAllKeys.js"), i = r("./node_modules/lodash-es/_getSymbolsIn.js"), o = r("./node_modules/lodash-es/keysIn.js"); t.default = function (e) { return Object(n.default)(e, o.default, i.default) } }, "./node_modules/lodash-es/_getMapData.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_isKeyable.js"); t.default = function (e, t) { var r = e.__data__; return Object(n.default)(t) ? r["string" == typeof t ? "string" : "hash"] : r.map } }, "./node_modules/lodash-es/_getNative.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_baseIsNative.js"), i = r("./node_modules/lodash-es/_getValue.js"); t.default = function (e, t) { var r = Object(i.default)(e, t); return Object(n.default)(r) ? r : void 0 } }, "./node_modules/lodash-es/_getPrototype.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_overArg.js"), i = Object(n.default)(Object.getPrototypeOf, Object); t.default = i }, "./node_modules/lodash-es/_getRawTag.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_Symbol.js"), i = Object.prototype, o = i.hasOwnProperty, s = i.toString, a = n.default ? n.default.toStringTag : void 0; t.default = function (e) { var t = o.call(e, a), r = e[a]; try { e[a] = void 0; var n = !0 } catch (e) { } var i = s.call(e); return n && (t ? e[a] = r : delete e[a]), i } }, "./node_modules/lodash-es/_getSymbols.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_arrayFilter.js"), i = r("./node_modules/lodash-es/stubArray.js"), o = Object.prototype.propertyIsEnumerable, s = Object.getOwnPropertySymbols, a = s ? function (e) { return null == e ? [] : (e = Object(e), Object(n.default)(s(e), function (t) { return o.call(e, t) })) } : i.default; t.default = a }, "./node_modules/lodash-es/_getSymbolsIn.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_arrayPush.js"), i = r("./node_modules/lodash-es/_getPrototype.js"), o = r("./node_modules/lodash-es/_getSymbols.js"), s = r("./node_modules/lodash-es/stubArray.js"), a = Object.getOwnPropertySymbols ? function (e) { for (var t = []; e;)Object(n.default)(t, Object(o.default)(e)), e = Object(i.default)(e); return t } : s.default; t.default = a }, "./node_modules/lodash-es/_getTag.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_DataView.js"), i = r("./node_modules/lodash-es/_Map.js"), o = r("./node_modules/lodash-es/_Promise.js"), s = r("./node_modules/lodash-es/_Set.js"), a = r("./node_modules/lodash-es/_WeakMap.js"), u = r("./node_modules/lodash-es/_baseGetTag.js"), c = r("./node_modules/lodash-es/_toSource.js"), l = Object(c.default)(n.default), d = Object(c.default)(i.default), f = Object(c.default)(o.default), _ = Object(c.default)(s.default), p = Object(c.default)(a.default), h = u.default; (n.default && "[object DataView]" != h(new n.default(new ArrayBuffer(1))) || i.default && "[object Map]" != h(new i.default) || o.default && "[object Promise]" != h(o.default.resolve()) || s.default && "[object Set]" != h(new s.default) || a.default && "[object WeakMap]" != h(new a.default)) && (h = function (e) { var t = Object(u.default)(e), r = "[object Object]" == t ? e.constructor : void 0, n = r ? Object(c.default)(r) : ""; if (n) switch (n) { case l: return "[object DataView]"; case d: return "[object Map]"; case f: return "[object Promise]"; case _: return "[object Set]"; case p: return "[object WeakMap]" }return t }), t.default = h }, "./node_modules/lodash-es/_getValue.js": function (e, t, r) { r.r(t), t.default = function (e, t) { return null == e ? void 0 : e[t] } }, "./node_modules/lodash-es/_hashClear.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_nativeCreate.js"); t.default = function () { this.__data__ = n.default ? Object(n.default)(null) : {}, this.size = 0 } }, "./node_modules/lodash-es/_hashDelete.js": function (e, t, r) { r.r(t), t.default = function (e) { var t = this.has(e) && delete this.__data__[e]; return this.size -= t ? 1 : 0, t } }, "./node_modules/lodash-es/_hashGet.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_nativeCreate.js"), i = "__lodash_hash_undefined__", o = Object.prototype.hasOwnProperty; t.default = function (e) { var t = this.__data__; if (n.default) { var r = t[e]; return r === i ? void 0 : r } return o.call(t, e) ? t[e] : void 0 } }, "./node_modules/lodash-es/_hashHas.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_nativeCreate.js"), i = Object.prototype.hasOwnProperty; t.default = function (e) { var t = this.__data__; return n.default ? void 0 !== t[e] : i.call(t, e) } }, "./node_modules/lodash-es/_hashSet.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_nativeCreate.js"), i = "__lodash_hash_undefined__"; t.default = function (e, t) { var r = this.__data__; return this.size += this.has(e) ? 0 : 1, r[e] = n.default && void 0 === t ? i : t, this } }, "./node_modules/lodash-es/_initCloneArray.js": function (e, t, r) { r.r(t); var n = Object.prototype.hasOwnProperty; t.default = function (e) { var t = e.length, r = new e.constructor(t); return t && "string" == typeof e[0] && n.call(e, "index") && (r.index = e.index, r.input = e.input), r } }, "./node_modules/lodash-es/_initCloneByTag.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_cloneArrayBuffer.js"), i = r("./node_modules/lodash-es/_cloneDataView.js"), o = r("./node_modules/lodash-es/_cloneRegExp.js"), s = r("./node_modules/lodash-es/_cloneSymbol.js"), a = r("./node_modules/lodash-es/_cloneTypedArray.js"), u = "[object Boolean]", c = "[object Date]", l = "[object Map]", d = "[object Number]", f = "[object RegExp]", _ = "[object Set]", p = "[object String]", h = "[object Symbol]", g = "[object ArrayBuffer]", E = "[object DataView]", m = "[object Float32Array]", b = "[object Float64Array]", y = "[object Int8Array]", S = "[object Int16Array]", v = "[object Int32Array]", T = "[object Uint8Array]", A = "[object Uint8ClampedArray]", O = "[object Uint16Array]", N = "[object Uint32Array]"; t.default = function (e, t, r) { var I = e.constructor; switch (t) { case g: return Object(n.default)(e); case u: case c: return new I(+e); case E: return Object(i.default)(e, r); case m: case b: case y: case S: case v: case T: case A: case O: case N: return Object(a.default)(e, r); case l: return new I; case d: case p: return new I(e); case f: return Object(o.default)(e); case _: return new I; case h: return Object(s.default)(e) } } }, "./node_modules/lodash-es/_initCloneObject.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_baseCreate.js"), i = r("./node_modules/lodash-es/_getPrototype.js"), o = r("./node_modules/lodash-es/_isPrototype.js"); t.default = function (e) { return "function" != typeof e.constructor || Object(o.default)(e) ? {} : Object(n.default)(Object(i.default)(e)) } }, "./node_modules/lodash-es/_isIndex.js": function (e, t, r) { r.r(t); var n = 9007199254740991, i = /^(?:0|[1-9]\d*)$/; t.default = function (e, t) { var r = typeof e; return !!(t = null == t ? n : t) && ("number" == r || "symbol" != r && i.test(e)) && e > -1 && e % 1 == 0 && e < t } }, "./node_modules/lodash-es/_isKey.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/isArray.js"), i = r("./node_modules/lodash-es/isSymbol.js"), o = /\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/, s = /^\w*$/; t.default = function (e, t) { if (Object(n.default)(e)) return !1; var r = typeof e; return !("number" != r && "symbol" != r && "boolean" != r && null != e && !Object(i.default)(e)) || s.test(e) || !o.test(e) || null != t && e in Object(t) } }, "./node_modules/lodash-es/_isKeyable.js": function (e, t, r) { r.r(t), t.default = function (e) { var t = typeof e; return "string" == t || "number" == t || "symbol" == t || "boolean" == t ? "__proto__" !== e : null === e } }, "./node_modules/lodash-es/_isMasked.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_coreJsData.js"), i = function () { var e = /[^.]+$/.exec(n.default && n.default.keys && n.default.keys.IE_PROTO || ""); return e ? "Symbol(src)_1." + e : "" }(); t.default = function (e) { return !!i && i in e } }, "./node_modules/lodash-es/_isPrototype.js": function (e, t, r) { r.r(t); var n = Object.prototype; t.default = function (e) { var t = e && e.constructor; return e === ("function" == typeof t && t.prototype || n) } }, "./node_modules/lodash-es/_listCacheClear.js": function (e, t, r) { r.r(t), t.default = function () { this.__data__ = [], this.size = 0 } }, "./node_modules/lodash-es/_listCacheDelete.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_assocIndexOf.js"), i = Array.prototype.splice; t.default = function (e) { var t = this.__data__, r = Object(n.default)(t, e); return !(r < 0 || (r == t.length - 1 ? t.pop() : i.call(t, r, 1), --this.size, 0)) } }, "./node_modules/lodash-es/_listCacheGet.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_assocIndexOf.js"); t.default = function (e) { var t = this.__data__, r = Object(n.default)(t, e); return r < 0 ? void 0 : t[r][1] } }, "./node_modules/lodash-es/_listCacheHas.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_assocIndexOf.js"); t.default = function (e) { return Object(n.default)(this.__data__, e) > -1 } }, "./node_modules/lodash-es/_listCacheSet.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_assocIndexOf.js"); t.default = function (e, t) { var r = this.__data__, i = Object(n.default)(r, e); return i < 0 ? (++this.size, r.push([e, t])) : r[i][1] = t, this } }, "./node_modules/lodash-es/_mapCacheClear.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_Hash.js"), i = r("./node_modules/lodash-es/_ListCache.js"), o = r("./node_modules/lodash-es/_Map.js"); t.default = function () { this.size = 0, this.__data__ = { hash: new n.default, map: new (o.default || i.default), string: new n.default } } }, "./node_modules/lodash-es/_mapCacheDelete.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_getMapData.js"); t.default = function (e) { var t = Object(n.default)(this, e).delete(e); return this.size -= t ? 1 : 0, t } }, "./node_modules/lodash-es/_mapCacheGet.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_getMapData.js"); t.default = function (e) { return Object(n.default)(this, e).get(e) } }, "./node_modules/lodash-es/_mapCacheHas.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_getMapData.js"); t.default = function (e) { return Object(n.default)(this, e).has(e) } }, "./node_modules/lodash-es/_mapCacheSet.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_getMapData.js"); t.default = function (e, t) { var r = Object(n.default)(this, e), i = r.size; return r.set(e, t), this.size += r.size == i ? 0 : 1, this } }, "./node_modules/lodash-es/_memoizeCapped.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/memoize.js"), i = 500; t.default = function (e) { var t = Object(n.default)(e, function (e) { return r.size === i && r.clear(), e }), r = t.cache; return t } }, "./node_modules/lodash-es/_nativeCreate.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_getNative.js"), i = Object(n.default)(Object, "create"); t.default = i }, "./node_modules/lodash-es/_nativeKeys.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_overArg.js"), i = Object(n.default)(Object.keys, Object); t.default = i }, "./node_modules/lodash-es/_nativeKeysIn.js": function (e, t, r) { r.r(t), t.default = function (e) { var t = []; if (null != e) for (var r in Object(e)) t.push(r); return t } }, "./node_modules/lodash-es/_nodeUtil.js": function (e, t, r) { r.r(t), function (e) { var n = r("./node_modules/lodash-es/_freeGlobal.js"), i = "object" == typeof exports && exports && !exports.nodeType && exports, o = i && "object" == typeof e && e && !e.nodeType && e, s = o && o.exports === i && n.default.process, a = function () { try { var e = o && o.require && o.require("util").types; return e || s && s.binding && s.binding("util") } catch (e) { } }(); t.default = a }.call(this, r("./node_modules/webpack/buildin/harmony-module.js")(e)) }, "./node_modules/lodash-es/_objectToString.js": function (e, t, r) { r.r(t); var n = Object.prototype.toString; t.default = function (e) { return n.call(e) } }, "./node_modules/lodash-es/_overArg.js": function (e, t, r) { r.r(t), t.default = function (e, t) { return function (r) { return e(t(r)) } } }, "./node_modules/lodash-es/_parent.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_baseGet.js"), i = r("./node_modules/lodash-es/_baseSlice.js"); t.default = function (e, t) { return t.length < 2 ? e : Object(n.default)(e, Object(i.default)(t, 0, -1)) } }, "./node_modules/lodash-es/_root.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_freeGlobal.js"), i = "object" == typeof self && self && self.Object === Object && self, o = n.default || i || Function("return this")(); t.default = o }, "./node_modules/lodash-es/_stackClear.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_ListCache.js"); t.default = function () { this.__data__ = new n.default, this.size = 0 } }, "./node_modules/lodash-es/_stackDelete.js": function (e, t, r) { r.r(t), t.default = function (e) { var t = this.__data__, r = t.delete(e); return this.size = t.size, r } }, "./node_modules/lodash-es/_stackGet.js": function (e, t, r) { r.r(t), t.default = function (e) { return this.__data__.get(e) } }, "./node_modules/lodash-es/_stackHas.js": function (e, t, r) { r.r(t), t.default = function (e) { return this.__data__.has(e) } }, "./node_modules/lodash-es/_stackSet.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_ListCache.js"), i = r("./node_modules/lodash-es/_Map.js"), o = r("./node_modules/lodash-es/_MapCache.js"), s = 200; t.default = function (e, t) { var r = this.__data__; if (r instanceof n.default) { var a = r.__data__; if (!i.default || a.length < s - 1) return a.push([e, t]), this.size = ++r.size, this; r = this.__data__ = new o.default(a) } return r.set(e, t), this.size = r.size, this } }, "./node_modules/lodash-es/_stringToPath.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_memoizeCapped.js"), i = /[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g, o = /\\(\\)?/g, s = Object(n.default)(function (e) { var t = []; return 46 === e.charCodeAt(0) && t.push(""), e.replace(i, function (e, r, n, i) { t.push(n ? i.replace(o, "$1") : r || e) }), t }); t.default = s }, "./node_modules/lodash-es/_toKey.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/isSymbol.js"), i = 1 / 0; t.default = function (e) { if ("string" == typeof e || Object(n.default)(e)) return e; var t = e + ""; return "0" == t && 1 / e == -i ? "-0" : t } }, "./node_modules/lodash-es/_toSource.js": function (e, t, r) { r.r(t); var n = Function.prototype.toString; t.default = function (e) { if (null != e) { try { return n.call(e) } catch (e) { } try { return e + "" } catch (e) { } } return "" } }, "./node_modules/lodash-es/cloneDeep.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_baseClone.js"), i = 1, o = 4; t.default = function (e) { return Object(n.default)(e, i | o) } }, "./node_modules/lodash-es/eq.js": function (e, t, r) { r.r(t), t.default = function (e, t) { return e === t || e != e && t != t } }, "./node_modules/lodash-es/isArguments.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_baseIsArguments.js"), i = r("./node_modules/lodash-es/isObjectLike.js"), o = Object.prototype, s = o.hasOwnProperty, a = o.propertyIsEnumerable, u = Object(n.default)(function () { return arguments }()) ? n.default : function (e) { return Object(i.default)(e) && s.call(e, "callee") && !a.call(e, "callee") }; t.default = u }, "./node_modules/lodash-es/isArray.js": function (e, t, r) { r.r(t); var n = Array.isArray; t.default = n }, "./node_modules/lodash-es/isArrayLike.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/isFunction.js"), i = r("./node_modules/lodash-es/isLength.js"); t.default = function (e) { return null != e && Object(i.default)(e.length) && !Object(n.default)(e) } }, "./node_modules/lodash-es/isBuffer.js": function (e, t, r) { r.r(t), function (e) { var n = r("./node_modules/lodash-es/_root.js"), i = r("./node_modules/lodash-es/stubFalse.js"), o = "object" == typeof exports && exports && !exports.nodeType && exports, s = o && "object" == typeof e && e && !e.nodeType && e, a = s && s.exports === o ? n.default.Buffer : void 0, u = (a ? a.isBuffer : void 0) || i.default; t.default = u }.call(this, r("./node_modules/webpack/buildin/harmony-module.js")(e)) }, "./node_modules/lodash-es/isFunction.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_baseGetTag.js"), i = r("./node_modules/lodash-es/isObject.js"), o = "[object AsyncFunction]", s = "[object Function]", a = "[object GeneratorFunction]", u = "[object Proxy]"; t.default = function (e) { if (!Object(i.default)(e)) return !1; var t = Object(n.default)(e); return t == s || t == a || t == o || t == u } }, "./node_modules/lodash-es/isLength.js": function (e, t, r) { r.r(t); var n = 9007199254740991; t.default = function (e) { return "number" == typeof e && e > -1 && e % 1 == 0 && e <= n } }, "./node_modules/lodash-es/isMap.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_baseIsMap.js"), i = r("./node_modules/lodash-es/_baseUnary.js"), o = r("./node_modules/lodash-es/_nodeUtil.js"), s = o.default && o.default.isMap, a = s ? Object(i.default)(s) : n.default; t.default = a }, "./node_modules/lodash-es/isObject.js": function (e, t, r) { r.r(t), t.default = function (e) { var t = typeof e; return null != e && ("object" == t || "function" == t) } }, "./node_modules/lodash-es/isObjectLike.js": function (e, t, r) { r.r(t), t.default = function (e) { return null != e && "object" == typeof e } }, "./node_modules/lodash-es/isSet.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_baseIsSet.js"), i = r("./node_modules/lodash-es/_baseUnary.js"), o = r("./node_modules/lodash-es/_nodeUtil.js"), s = o.default && o.default.isSet, a = s ? Object(i.default)(s) : n.default; t.default = a }, "./node_modules/lodash-es/isSymbol.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_baseGetTag.js"), i = r("./node_modules/lodash-es/isObjectLike.js"), o = "[object Symbol]"; t.default = function (e) { return "symbol" == typeof e || Object(i.default)(e) && Object(n.default)(e) == o } }, "./node_modules/lodash-es/isTypedArray.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_baseIsTypedArray.js"), i = r("./node_modules/lodash-es/_baseUnary.js"), o = r("./node_modules/lodash-es/_nodeUtil.js"), s = o.default && o.default.isTypedArray, a = s ? Object(i.default)(s) : n.default; t.default = a }, "./node_modules/lodash-es/keys.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_arrayLikeKeys.js"), i = r("./node_modules/lodash-es/_baseKeys.js"), o = r("./node_modules/lodash-es/isArrayLike.js"); t.default = function (e) { return Object(o.default)(e) ? Object(n.default)(e) : Object(i.default)(e) } }, "./node_modules/lodash-es/keysIn.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_arrayLikeKeys.js"), i = r("./node_modules/lodash-es/_baseKeysIn.js"), o = r("./node_modules/lodash-es/isArrayLike.js"); t.default = function (e) { return Object(o.default)(e) ? Object(n.default)(e, !0) : Object(i.default)(e) } }, "./node_modules/lodash-es/last.js": function (e, t, r) { r.r(t), t.default = function (e) { var t = null == e ? 0 : e.length; return t ? e[t - 1] : void 0 } }, "./node_modules/lodash-es/memoize.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_MapCache.js"), i = "Expected a function"; function o(e, t) { if ("function" != typeof e || null != t && "function" != typeof t) throw new TypeError(i); var r = function () { var n = arguments, i = t ? t.apply(this, n) : n[0], o = r.cache; if (o.has(i)) return o.get(i); var s = e.apply(this, n); return r.cache = o.set(i, s) || o, s }; return r.cache = new (o.Cache || n.default), r } o.Cache = n.default, t.default = o }, "./node_modules/lodash-es/set.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_baseSet.js"); t.default = function (e, t, r) { return null == e ? e : Object(n.default)(e, t, r) } }, "./node_modules/lodash-es/stubArray.js": function (e, t, r) { r.r(t), t.default = function () { return [] } }, "./node_modules/lodash-es/stubFalse.js": function (e, t, r) { r.r(t), t.default = function () { return !1 } }, "./node_modules/lodash-es/toString.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_baseToString.js"); t.default = function (e) { return null == e ? "" : Object(n.default)(e) } }, "./node_modules/lodash-es/unset.js": function (e, t, r) { r.r(t); var n = r("./node_modules/lodash-es/_baseUnset.js"); t.default = function (e, t) { return null == e || Object(n.default)(e, t) } }, "./node_modules/long/src/long.js": function (e, t) { e.exports = n; var r = null; try { r = new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0, 97, 115, 109, 1, 0, 0, 0, 1, 13, 2, 96, 0, 1, 127, 96, 4, 127, 127, 127, 127, 1, 127, 3, 7, 6, 0, 1, 1, 1, 1, 1, 6, 6, 1, 127, 1, 65, 0, 11, 7, 50, 6, 3, 109, 117, 108, 0, 1, 5, 100, 105, 118, 95, 115, 0, 2, 5, 100, 105, 118, 95, 117, 0, 3, 5, 114, 101, 109, 95, 115, 0, 4, 5, 114, 101, 109, 95, 117, 0, 5, 8, 103, 101, 116, 95, 104, 105, 103, 104, 0, 0, 10, 191, 1, 6, 4, 0, 35, 0, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 126, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 127, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 128, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 129, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 130, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11])), {}).exports } catch (e) { } function n(e, t, r) { this.low = 0 | e, this.high = 0 | t, this.unsigned = !!r } function i(e) { return !0 === (e && e.__isLong__) } n.prototype.__isLong__, Object.defineProperty(n.prototype, "__isLong__", { value: !0 }), n.isLong = i; var o = {}, s = {}; function a(e, t) { var r, n, i; return t ? (i = 0 <= (e >>>= 0) && e < 256) && (n = s[e]) ? n : (r = c(e, (0 | e) < 0 ? -1 : 0, !0), i && (s[e] = r), r) : (i = -128 <= (e |= 0) && e < 128) && (n = o[e]) ? n : (r = c(e, e < 0 ? -1 : 0, !1), i && (o[e] = r), r) } function u(e, t) { if (isNaN(e)) return t ? m : E; if (t) { if (e < 0) return m; if (e >= p) return T } else { if (e <= -h) return A; if (e + 1 >= h) return v } return e < 0 ? u(-e, t).neg() : c(e % _ | 0, e / _ | 0, t) } function c(e, t, r) { return new n(e, t, r) } n.fromInt = a, n.fromNumber = u, n.fromBits = c; var l = Math.pow; function d(e, t, r) { if (0 === e.length) throw Error("empty string"); if ("NaN" === e || "Infinity" === e || "+Infinity" === e || "-Infinity" === e) return E; if ("number" == typeof t ? (r = t, t = !1) : t = !!t, (r = r || 10) < 2 || 36 < r) throw RangeError("radix"); var n; if ((n = e.indexOf("-")) > 0) throw Error("interior hyphen"); if (0 === n) return d(e.substring(1), t, r).neg(); for (var i = u(l(r, 8)), o = E, s = 0; s < e.length; s += 8) { var a = Math.min(8, e.length - s), c = parseInt(e.substring(s, s + a), r); if (a < 8) { var f = u(l(r, a)); o = o.mul(f).add(u(c)) } else o = (o = o.mul(i)).add(u(c)) } return o.unsigned = t, o } function f(e, t) { return "number" == typeof e ? u(e, t) : "string" == typeof e ? d(e, t) : c(e.low, e.high, "boolean" == typeof t ? t : e.unsigned) } n.fromString = d, n.fromValue = f; var _ = 4294967296, p = _ * _, h = p / 2, g = a(1 << 24), E = a(0); n.ZERO = E; var m = a(0, !0); n.UZERO = m; var b = a(1); n.ONE = b; var y = a(1, !0); n.UONE = y; var S = a(-1); n.NEG_ONE = S; var v = c(-1, 2147483647, !1); n.MAX_VALUE = v; var T = c(-1, -1, !0); n.MAX_UNSIGNED_VALUE = T; var A = c(0, -2147483648, !1); n.MIN_VALUE = A; var O = n.prototype; O.toInt = function () { return this.unsigned ? this.low >>> 0 : this.low }, O.toNumber = function () { return this.unsigned ? (this.high >>> 0) * _ + (this.low >>> 0) : this.high * _ + (this.low >>> 0) }, O.toString = function (e) { if ((e = e || 10) < 2 || 36 < e) throw RangeError("radix"); if (this.isZero()) return "0"; if (this.isNegative()) { if (this.eq(A)) { var t = u(e), r = this.div(t), n = r.mul(t).sub(this); return r.toString(e) + n.toInt().toString(e) } return "-" + this.neg().toString(e) } for (var i = u(l(e, 6), this.unsigned), o = this, s = ""; ;) { var a = o.div(i), c = (o.sub(a.mul(i)).toInt() >>> 0).toString(e); if ((o = a).isZero()) return c + s; for (; c.length < 6;)c = "0" + c; s = "" + c + s } }, O.getHighBits = function () { return this.high }, O.getHighBitsUnsigned = function () { return this.high >>> 0 }, O.getLowBits = function () { return this.low }, O.getLowBitsUnsigned = function () { return this.low >>> 0 }, O.getNumBitsAbs = function () { if (this.isNegative()) return this.eq(A) ? 64 : this.neg().getNumBitsAbs(); for (var e = 0 != this.high ? this.high : this.low, t = 31; t > 0 && 0 == (e & 1 << t); t--); return 0 != this.high ? t + 33 : t + 1 }, O.isZero = function () { return 0 === this.high && 0 === this.low }, O.eqz = O.isZero, O.isNegative = function () { return !this.unsigned && this.high < 0 }, O.isPositive = function () { return this.unsigned || this.high >= 0 }, O.isOdd = function () { return 1 == (1 & this.low) }, O.isEven = function () { return 0 == (1 & this.low) }, O.equals = function (e) { return i(e) || (e = f(e)), (this.unsigned === e.unsigned || this.high >>> 31 != 1 || e.high >>> 31 != 1) && (this.high === e.high && this.low === e.low) }, O.eq = O.equals, O.notEquals = function (e) { return !this.eq(e) }, O.neq = O.notEquals, O.ne = O.notEquals, O.lessThan = function (e) { return this.comp(e) < 0 }, O.lt = O.lessThan, O.lessThanOrEqual = function (e) { return this.comp(e) <= 0 }, O.lte = O.lessThanOrEqual, O.le = O.lessThanOrEqual, O.greaterThan = function (e) { return this.comp(e) > 0 }, O.gt = O.greaterThan, O.greaterThanOrEqual = function (e) { return this.comp(e) >= 0 }, O.gte = O.greaterThanOrEqual, O.ge = O.greaterThanOrEqual, O.compare = function (e) { if (i(e) || (e = f(e)), this.eq(e)) return 0; var t = this.isNegative(), r = e.isNegative(); return t && !r ? -1 : !t && r ? 1 : this.unsigned ? e.high >>> 0 > this.high >>> 0 || e.high === this.high && e.low >>> 0 > this.low >>> 0 ? -1 : 1 : this.sub(e).isNegative() ? -1 : 1 }, O.comp = O.compare, O.negate = function () { return !this.unsigned && this.eq(A) ? A : this.not().add(b) }, O.neg = O.negate, O.add = function (e) { i(e) || (e = f(e)); var t = this.high >>> 16, r = 65535 & this.high, n = this.low >>> 16, o = 65535 & this.low, s = e.high >>> 16, a = 65535 & e.high, u = e.low >>> 16, l = 0, d = 0, _ = 0, p = 0; return _ += (p += o + (65535 & e.low)) >>> 16, d += (_ += n + u) >>> 16, l += (d += r + a) >>> 16, l += t + s, c((_ &= 65535) << 16 | (p &= 65535), (l &= 65535) << 16 | (d &= 65535), this.unsigned) }, O.subtract = function (e) { return i(e) || (e = f(e)), this.add(e.neg()) }, O.sub = O.subtract, O.multiply = function (e) { if (this.isZero()) return E; if (i(e) || (e = f(e)), r) return c(r.mul(this.low, this.high, e.low, e.high), r.get_high(), this.unsigned); if (e.isZero()) return E; if (this.eq(A)) return e.isOdd() ? A : E; if (e.eq(A)) return this.isOdd() ? A : E; if (this.isNegative()) return e.isNegative() ? this.neg().mul(e.neg()) : this.neg().mul(e).neg(); if (e.isNegative()) return this.mul(e.neg()).neg(); if (this.lt(g) && e.lt(g)) return u(this.toNumber() * e.toNumber(), this.unsigned); var t = this.high >>> 16, n = 65535 & this.high, o = this.low >>> 16, s = 65535 & this.low, a = e.high >>> 16, l = 65535 & e.high, d = e.low >>> 16, _ = 65535 & e.low, p = 0, h = 0, m = 0, b = 0; return m += (b += s * _) >>> 16, h += (m += o * _) >>> 16, m &= 65535, h += (m += s * d) >>> 16, p += (h += n * _) >>> 16, h &= 65535, p += (h += o * d) >>> 16, h &= 65535, p += (h += s * l) >>> 16, p += t * _ + n * d + o * l + s * a, c((m &= 65535) << 16 | (b &= 65535), (p &= 65535) << 16 | (h &= 65535), this.unsigned) }, O.mul = O.multiply, O.divide = function (e) { if (i(e) || (e = f(e)), e.isZero()) throw Error("division by zero"); var t, n, o; if (r) return this.unsigned || -2147483648 !== this.high || -1 !== e.low || -1 !== e.high ? c((this.unsigned ? r.div_u : r.div_s)(this.low, this.high, e.low, e.high), r.get_high(), this.unsigned) : this; if (this.isZero()) return this.unsigned ? m : E; if (this.unsigned) { if (e.unsigned || (e = e.toUnsigned()), e.gt(this)) return m; if (e.gt(this.shru(1))) return y; o = m } else { if (this.eq(A)) return e.eq(b) || e.eq(S) ? A : e.eq(A) ? b : (t = this.shr(1).div(e).shl(1)).eq(E) ? e.isNegative() ? b : S : (n = this.sub(e.mul(t)), o = t.add(n.div(e))); else if (e.eq(A)) return this.unsigned ? m : E; if (this.isNegative()) return e.isNegative() ? this.neg().div(e.neg()) : this.neg().div(e).neg(); if (e.isNegative()) return this.div(e.neg()).neg(); o = E } for (n = this; n.gte(e);) { t = Math.max(1, Math.floor(n.toNumber() / e.toNumber())); for (var s = Math.ceil(Math.log(t) / Math.LN2), a = s <= 48 ? 1 : l(2, s - 48), d = u(t), _ = d.mul(e); _.isNegative() || _.gt(n);)_ = (d = u(t -= a, this.unsigned)).mul(e); d.isZero() && (d = b), o = o.add(d), n = n.sub(_) } return o }, O.div = O.divide, O.modulo = function (e) { return i(e) || (e = f(e)), r ? c((this.unsigned ? r.rem_u : r.rem_s)(this.low, this.high, e.low, e.high), r.get_high(), this.unsigned) : this.sub(this.div(e).mul(e)) }, O.mod = O.modulo, O.rem = O.modulo, O.not = function () { return c(~this.low, ~this.high, this.unsigned) }, O.and = function (e) { return i(e) || (e = f(e)), c(this.low & e.low, this.high & e.high, this.unsigned) }, O.or = function (e) { return i(e) || (e = f(e)), c(this.low | e.low, this.high | e.high, this.unsigned) }, O.xor = function (e) { return i(e) || (e = f(e)), c(this.low ^ e.low, this.high ^ e.high, this.unsigned) }, O.shiftLeft = function (e) { return i(e) && (e = e.toInt()), 0 == (e &= 63) ? this : e < 32 ? c(this.low << e, this.high << e | this.low >>> 32 - e, this.unsigned) : c(0, this.low << e - 32, this.unsigned) }, O.shl = O.shiftLeft, O.shiftRight = function (e) { return i(e) && (e = e.toInt()), 0 == (e &= 63) ? this : e < 32 ? c(this.low >>> e | this.high << 32 - e, this.high >> e, this.unsigned) : c(this.high >> e - 32, this.high >= 0 ? 0 : -1, this.unsigned) }, O.shr = O.shiftRight, O.shiftRightUnsigned = function (e) { if (i(e) && (e = e.toInt()), 0 === (e &= 63)) return this; var t = this.high; return e < 32 ? c(this.low >>> e | t << 32 - e, t >>> e, this.unsigned) : c(32 === e ? t : t >>> e - 32, 0, this.unsigned) }, O.shru = O.shiftRightUnsigned, O.shr_u = O.shiftRightUnsigned, O.toSigned = function () { return this.unsigned ? c(this.low, this.high, !1) : this }, O.toUnsigned = function () { return this.unsigned ? this : c(this.low, this.high, !0) }, O.toBytes = function (e) { return e ? this.toBytesLE() : this.toBytesBE() }, O.toBytesLE = function () { var e = this.high, t = this.low; return [255 & t, t >>> 8 & 255, t >>> 16 & 255, t >>> 24, 255 & e, e >>> 8 & 255, e >>> 16 & 255, e >>> 24] }, O.toBytesBE = function () { var e = this.high, t = this.low; return [e >>> 24, e >>> 16 & 255, e >>> 8 & 255, 255 & e, t >>> 24, t >>> 16 & 255, t >>> 8 & 255, 255 & t] }, n.fromBytes = function (e, t, r) { return r ? n.fromBytesLE(e, t) : n.fromBytesBE(e, t) }, n.fromBytesLE = function (e, t) { return new n(e[0] | e[1] << 8 | e[2] << 16 | e[3] << 24, e[4] | e[5] << 8 | e[6] << 16 | e[7] << 24, t) }, n.fromBytesBE = function (e, t) { return new n(e[4] << 24 | e[5] << 16 | e[6] << 8 | e[7], e[0] << 24 | e[1] << 16 | e[2] << 8 | e[3], t) } }, "./node_modules/node-libs-browser/node_modules/buffer/index.js": function (e, t, r) { (function (e) { var n = r("./node_modules/base64-js/index.js"), i = r("./node_modules/ieee754/index.js"), o = r("./node_modules/isarray/index.js"); function s() { return u.TYPED_ARRAY_SUPPORT ? 2147483647 : 1073741823 } function a(e, t) { if (s() < t) throw new RangeError("Invalid typed array length"); return u.TYPED_ARRAY_SUPPORT ? (e = new Uint8Array(t)).__proto__ = u.prototype : (null === e && (e = new u(t)), e.length = t), e } function u(e, t, r) { if (!(u.TYPED_ARRAY_SUPPORT || this instanceof u)) return new u(e, t, r); if ("number" == typeof e) { if ("string" == typeof t) throw new Error("If encoding is specified then the first argument must be a string"); return d(this, e) } return c(this, e, t, r) } function c(e, t, r, n) { if ("number" == typeof t) throw new TypeError('"value" argument must not be a number'); return "undefined" != typeof ArrayBuffer && t instanceof ArrayBuffer ? function (e, t, r, n) { if (t.byteLength, r < 0 || t.byteLength < r) throw new RangeError("'offset' is out of bounds"); if (t.byteLength < r + (n || 0)) throw new RangeError("'length' is out of bounds"); t = void 0 === r && void 0 === n ? new Uint8Array(t) : void 0 === n ? new Uint8Array(t, r) : new Uint8Array(t, r, n); u.TYPED_ARRAY_SUPPORT ? (e = t).__proto__ = u.prototype : e = f(e, t); return e }(e, t, r, n) : "string" == typeof t ? function (e, t, r) { "string" == typeof r && "" !== r || (r = "utf8"); if (!u.isEncoding(r)) throw new TypeError('"encoding" must be a valid string encoding'); var n = 0 | p(t, r), i = (e = a(e, n)).write(t, r); i !== n && (e = e.slice(0, i)); return e }(e, t, r) : function (e, t) { if (u.isBuffer(t)) { var r = 0 | _(t.length); return 0 === (e = a(e, r)).length ? e : (t.copy(e, 0, 0, r), e) } if (t) { if ("undefined" != typeof ArrayBuffer && t.buffer instanceof ArrayBuffer || "length" in t) return "number" != typeof t.length || function (e) { return e != e }(t.length) ? a(e, 0) : f(e, t); if ("Buffer" === t.type && o(t.data)) return f(e, t.data) } throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.") }(e, t) } function l(e) { if ("number" != typeof e) throw new TypeError('"size" argument must be a number'); if (e < 0) throw new RangeError('"size" argument must not be negative') } function d(e, t) { if (l(t), e = a(e, t < 0 ? 0 : 0 | _(t)), !u.TYPED_ARRAY_SUPPORT) for (var r = 0; r < t; ++r)e[r] = 0; return e } function f(e, t) { var r = t.length < 0 ? 0 : 0 | _(t.length); e = a(e, r); for (var n = 0; n < r; n += 1)e[n] = 255 & t[n]; return e } function _(e) { if (e >= s()) throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x" + s().toString(16) + " bytes"); return 0 | e } function p(e, t) { if (u.isBuffer(e)) return e.length; if ("undefined" != typeof ArrayBuffer && "function" == typeof ArrayBuffer.isView && (ArrayBuffer.isView(e) || e instanceof ArrayBuffer)) return e.byteLength; "string" != typeof e && (e = "" + e); var r = e.length; if (0 === r) return 0; for (var n = !1; ;)switch (t) { case "ascii": case "latin1": case "binary": return r; case "utf8": case "utf-8": case void 0: return k(e).length; case "ucs2": case "ucs-2": case "utf16le": case "utf-16le": return 2 * r; case "hex": return r >>> 1; case "base64": return F(e).length; default: if (n) return k(e).length; t = ("" + t).toLowerCase(), n = !0 } } function h(e, t, r) { var n = e[t]; e[t] = e[r], e[r] = n } function g(e, t, r, n, i) { if (0 === e.length) return -1; if ("string" == typeof r ? (n = r, r = 0) : r > 2147483647 ? r = 2147483647 : r < -2147483648 && (r = -2147483648), r = +r, isNaN(r) && (r = i ? 0 : e.length - 1), r < 0 && (r = e.length + r), r >= e.length) { if (i) return -1; r = e.length - 1 } else if (r < 0) { if (!i) return -1; r = 0 } if ("string" == typeof t && (t = u.from(t, n)), u.isBuffer(t)) return 0 === t.length ? -1 : E(e, t, r, n, i); if ("number" == typeof t) return t &= 255, u.TYPED_ARRAY_SUPPORT && "function" == typeof Uint8Array.prototype.indexOf ? i ? Uint8Array.prototype.indexOf.call(e, t, r) : Uint8Array.prototype.lastIndexOf.call(e, t, r) : E(e, [t], r, n, i); throw new TypeError("val must be string, number or Buffer") } function E(e, t, r, n, i) { var o, s = 1, a = e.length, u = t.length; if (void 0 !== n && ("ucs2" === (n = String(n).toLowerCase()) || "ucs-2" === n || "utf16le" === n || "utf-16le" === n)) { if (e.length < 2 || t.length < 2) return -1; s = 2, a /= 2, u /= 2, r /= 2 } function c(e, t) { return 1 === s ? e[t] : e.readUInt16BE(t * s) } if (i) { var l = -1; for (o = r; o < a; o++)if (c(e, o) === c(t, -1 === l ? 0 : o - l)) { if (-1 === l && (l = o), o - l + 1 === u) return l * s } else -1 !== l && (o -= o - l), l = -1 } else for (r + u > a && (r = a - u), o = r; o >= 0; o--) { for (var d = !0, f = 0; f < u; f++)if (c(e, o + f) !== c(t, f)) { d = !1; break } if (d) return o } return -1 } function m(e, t, r, n) { r = Number(r) || 0; var i = e.length - r; n ? (n = Number(n)) > i && (n = i) : n = i; var o = t.length; if (o % 2 != 0) throw new TypeError("Invalid hex string"); n > o / 2 && (n = o / 2); for (var s = 0; s < n; ++s) { var a = parseInt(t.substr(2 * s, 2), 16); if (isNaN(a)) return s; e[r + s] = a } return s } function b(e, t, r, n) { return Y(k(t, e.length - r), e, r, n) } function y(e, t, r, n) { return Y(function (e) { for (var t = [], r = 0; r < e.length; ++r)t.push(255 & e.charCodeAt(r)); return t }(t), e, r, n) } function S(e, t, r, n) { return y(e, t, r, n) } function v(e, t, r, n) { return Y(F(t), e, r, n) } function T(e, t, r, n) { return Y(function (e, t) { for (var r, n, i, o = [], s = 0; s < e.length && !((t -= 2) < 0); ++s)r = e.charCodeAt(s), n = r >> 8, i = r % 256, o.push(i), o.push(n); return o }(t, e.length - r), e, r, n) } function A(e, t, r) { return 0 === t && r === e.length ? n.fromByteArray(e) : n.fromByteArray(e.slice(t, r)) } function O(e, t, r) { r = Math.min(e.length, r); for (var n = [], i = t; i < r;) { var o, s, a, u, c = e[i], l = null, d = c > 239 ? 4 : c > 223 ? 3 : c > 191 ? 2 : 1; if (i + d <= r) switch (d) { case 1: c < 128 && (l = c); break; case 2: 128 == (192 & (o = e[i + 1])) && (u = (31 & c) << 6 | 63 & o) > 127 && (l = u); break; case 3: o = e[i + 1], s = e[i + 2], 128 == (192 & o) && 128 == (192 & s) && (u = (15 & c) << 12 | (63 & o) << 6 | 63 & s) > 2047 && (u < 55296 || u > 57343) && (l = u); break; case 4: o = e[i + 1], s = e[i + 2], a = e[i + 3], 128 == (192 & o) && 128 == (192 & s) && 128 == (192 & a) && (u = (15 & c) << 18 | (63 & o) << 12 | (63 & s) << 6 | 63 & a) > 65535 && u < 1114112 && (l = u) }null === l ? (l = 65533, d = 1) : l > 65535 && (l -= 65536, n.push(l >>> 10 & 1023 | 55296), l = 56320 | 1023 & l), n.push(l), i += d } return function (e) { var t = e.length; if (t <= N) return String.fromCharCode.apply(String, e); var r = "", n = 0; for (; n < t;)r += String.fromCharCode.apply(String, e.slice(n, n += N)); return r }(n) } t.Buffer = u, t.SlowBuffer = function (e) { +e != e && (e = 0); return u.alloc(+e) }, t.INSPECT_MAX_BYTES = 50, u.TYPED_ARRAY_SUPPORT = void 0 !== e.TYPED_ARRAY_SUPPORT ? e.TYPED_ARRAY_SUPPORT : function () { try { var e = new Uint8Array(1); return e.__proto__ = { __proto__: Uint8Array.prototype, foo: function () { return 42 } }, 42 === e.foo() && "function" == typeof e.subarray && 0 === e.subarray(1, 1).byteLength } catch (e) { return !1 } }(), t.kMaxLength = s(), u.poolSize = 8192, u._augment = function (e) { return e.__proto__ = u.prototype, e }, u.from = function (e, t, r) { return c(null, e, t, r) }, u.TYPED_ARRAY_SUPPORT && (u.prototype.__proto__ = Uint8Array.prototype, u.__proto__ = Uint8Array, "undefined" != typeof Symbol && Symbol.species && u[Symbol.species] === u && Object.defineProperty(u, Symbol.species, { value: null, configurable: !0 })), u.alloc = function (e, t, r) { return function (e, t, r, n) { return l(t), t <= 0 ? a(e, t) : void 0 !== r ? "string" == typeof n ? a(e, t).fill(r, n) : a(e, t).fill(r) : a(e, t) }(null, e, t, r) }, u.allocUnsafe = function (e) { return d(null, e) }, u.allocUnsafeSlow = function (e) { return d(null, e) }, u.isBuffer = function (e) { return !(null == e || !e._isBuffer) }, u.compare = function (e, t) { if (!u.isBuffer(e) || !u.isBuffer(t)) throw new TypeError("Arguments must be Buffers"); if (e === t) return 0; for (var r = e.length, n = t.length, i = 0, o = Math.min(r, n); i < o; ++i)if (e[i] !== t[i]) { r = e[i], n = t[i]; break } return r < n ? -1 : n < r ? 1 : 0 }, u.isEncoding = function (e) { switch (String(e).toLowerCase()) { case "hex": case "utf8": case "utf-8": case "ascii": case "latin1": case "binary": case "base64": case "ucs2": case "ucs-2": case "utf16le": case "utf-16le": return !0; default: return !1 } }, u.concat = function (e, t) { if (!o(e)) throw new TypeError('"list" argument must be an Array of Buffers'); if (0 === e.length) return u.alloc(0); var r; if (void 0 === t) for (t = 0, r = 0; r < e.length; ++r)t += e[r].length; var n = u.allocUnsafe(t), i = 0; for (r = 0; r < e.length; ++r) { var s = e[r]; if (!u.isBuffer(s)) throw new TypeError('"list" argument must be an Array of Buffers'); s.copy(n, i), i += s.length } return n }, u.byteLength = p, u.prototype._isBuffer = !0, u.prototype.swap16 = function () { var e = this.length; if (e % 2 != 0) throw new RangeError("Buffer size must be a multiple of 16-bits"); for (var t = 0; t < e; t += 2)h(this, t, t + 1); return this }, u.prototype.swap32 = function () { var e = this.length; if (e % 4 != 0) throw new RangeError("Buffer size must be a multiple of 32-bits"); for (var t = 0; t < e; t += 4)h(this, t, t + 3), h(this, t + 1, t + 2); return this }, u.prototype.swap64 = function () { var e = this.length; if (e % 8 != 0) throw new RangeError("Buffer size must be a multiple of 64-bits"); for (var t = 0; t < e; t += 8)h(this, t, t + 7), h(this, t + 1, t + 6), h(this, t + 2, t + 5), h(this, t + 3, t + 4); return this }, u.prototype.toString = function () { var e = 0 | this.length; return 0 === e ? "" : 0 === arguments.length ? O(this, 0, e) : function (e, t, r) { var n = !1; if ((void 0 === t || t < 0) && (t = 0), t > this.length) return ""; if ((void 0 === r || r > this.length) && (r = this.length), r <= 0) return ""; if ((r >>>= 0) <= (t >>>= 0)) return ""; for (e || (e = "utf8"); ;)switch (e) { case "hex": return R(this, t, r); case "utf8": case "utf-8": return O(this, t, r); case "ascii": return I(this, t, r); case "latin1": case "binary": return C(this, t, r); case "base64": return A(this, t, r); case "ucs2": case "ucs-2": case "utf16le": case "utf-16le": return w(this, t, r); default: if (n) throw new TypeError("Unknown encoding: " + e); e = (e + "").toLowerCase(), n = !0 } }.apply(this, arguments) }, u.prototype.equals = function (e) { if (!u.isBuffer(e)) throw new TypeError("Argument must be a Buffer"); return this === e || 0 === u.compare(this, e) }, u.prototype.inspect = function () { var e = "", r = t.INSPECT_MAX_BYTES; return this.length > 0 && (e = this.toString("hex", 0, r).match(/.{2}/g).join(" "), this.length > r && (e += " ... ")), "<Buffer " + e + ">" }, u.prototype.compare = function (e, t, r, n, i) { if (!u.isBuffer(e)) throw new TypeError("Argument must be a Buffer"); if (void 0 === t && (t = 0), void 0 === r && (r = e ? e.length : 0), void 0 === n && (n = 0), void 0 === i && (i = this.length), t < 0 || r > e.length || n < 0 || i > this.length) throw new RangeError("out of range index"); if (n >= i && t >= r) return 0; if (n >= i) return -1; if (t >= r) return 1; if (t >>>= 0, r >>>= 0, n >>>= 0, i >>>= 0, this === e) return 0; for (var o = i - n, s = r - t, a = Math.min(o, s), c = this.slice(n, i), l = e.slice(t, r), d = 0; d < a; ++d)if (c[d] !== l[d]) { o = c[d], s = l[d]; break } return o < s ? -1 : s < o ? 1 : 0 }, u.prototype.includes = function (e, t, r) { return -1 !== this.indexOf(e, t, r) }, u.prototype.indexOf = function (e, t, r) { return g(this, e, t, r, !0) }, u.prototype.lastIndexOf = function (e, t, r) { return g(this, e, t, r, !1) }, u.prototype.write = function (e, t, r, n) { if (void 0 === t) n = "utf8", r = this.length, t = 0; else if (void 0 === r && "string" == typeof t) n = t, r = this.length, t = 0; else { if (!isFinite(t)) throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported"); t |= 0, isFinite(r) ? (r |= 0, void 0 === n && (n = "utf8")) : (n = r, r = void 0) } var i = this.length - t; if ((void 0 === r || r > i) && (r = i), e.length > 0 && (r < 0 || t < 0) || t > this.length) throw new RangeError("Attempt to write outside buffer bounds"); n || (n = "utf8"); for (var o = !1; ;)switch (n) { case "hex": return m(this, e, t, r); case "utf8": case "utf-8": return b(this, e, t, r); case "ascii": return y(this, e, t, r); case "latin1": case "binary": return S(this, e, t, r); case "base64": return v(this, e, t, r); case "ucs2": case "ucs-2": case "utf16le": case "utf-16le": return T(this, e, t, r); default: if (o) throw new TypeError("Unknown encoding: " + n); n = ("" + n).toLowerCase(), o = !0 } }, u.prototype.toJSON = function () { return { type: "Buffer", data: Array.prototype.slice.call(this._arr || this, 0) } }; var N = 4096; function I(e, t, r) { var n = ""; r = Math.min(e.length, r); for (var i = t; i < r; ++i)n += String.fromCharCode(127 & e[i]); return n } function C(e, t, r) { var n = ""; r = Math.min(e.length, r); for (var i = t; i < r; ++i)n += String.fromCharCode(e[i]); return n } function R(e, t, r) { var n = e.length; (!t || t < 0) && (t = 0), (!r || r < 0 || r > n) && (r = n); for (var i = "", o = t; o < r; ++o)i += G(e[o]); return i } function w(e, t, r) { for (var n = e.slice(t, r), i = "", o = 0; o < n.length; o += 2)i += String.fromCharCode(n[o] + 256 * n[o + 1]); return i } function D(e, t, r) { if (e % 1 != 0 || e < 0) throw new RangeError("offset is not uint"); if (e + t > r) throw new RangeError("Trying to access beyond buffer length") } function M(e, t, r, n, i, o) { if (!u.isBuffer(e)) throw new TypeError('"buffer" argument must be a Buffer instance'); if (t > i || t < o) throw new RangeError('"value" argument is out of bounds'); if (r + n > e.length) throw new RangeError("Index out of range") } function L(e, t, r, n) { t < 0 && (t = 65535 + t + 1); for (var i = 0, o = Math.min(e.length - r, 2); i < o; ++i)e[r + i] = (t & 255 << 8 * (n ? i : 1 - i)) >>> 8 * (n ? i : 1 - i) } function j(e, t, r, n) { t < 0 && (t = 4294967295 + t + 1); for (var i = 0, o = Math.min(e.length - r, 4); i < o; ++i)e[r + i] = t >>> 8 * (n ? i : 3 - i) & 255 } function P(e, t, r, n, i, o) { if (r + n > e.length) throw new RangeError("Index out of range"); if (r < 0) throw new RangeError("Index out of range") } function B(e, t, r, n, o) { return o || P(e, 0, r, 4), i.write(e, t, r, n, 23, 4), r + 4 } function x(e, t, r, n, o) { return o || P(e, 0, r, 8), i.write(e, t, r, n, 52, 8), r + 8 } u.prototype.slice = function (e, t) { var r, n = this.length; if (e = ~~e, t = void 0 === t ? n : ~~t, e < 0 ? (e += n) < 0 && (e = 0) : e > n && (e = n), t < 0 ? (t += n) < 0 && (t = 0) : t > n && (t = n), t < e && (t = e), u.TYPED_ARRAY_SUPPORT) (r = this.subarray(e, t)).__proto__ = u.prototype; else { var i = t - e; r = new u(i, void 0); for (var o = 0; o < i; ++o)r[o] = this[o + e] } return r }, u.prototype.readUIntLE = function (e, t, r) { e |= 0, t |= 0, r || D(e, t, this.length); for (var n = this[e], i = 1, o = 0; ++o < t && (i *= 256);)n += this[e + o] * i; return n }, u.prototype.readUIntBE = function (e, t, r) { e |= 0, t |= 0, r || D(e, t, this.length); for (var n = this[e + --t], i = 1; t > 0 && (i *= 256);)n += this[e + --t] * i; return n }, u.prototype.readUInt8 = function (e, t) { return t || D(e, 1, this.length), this[e] }, u.prototype.readUInt16LE = function (e, t) { return t || D(e, 2, this.length), this[e] | this[e + 1] << 8 }, u.prototype.readUInt16BE = function (e, t) { return t || D(e, 2, this.length), this[e] << 8 | this[e + 1] }, u.prototype.readUInt32LE = function (e, t) { return t || D(e, 4, this.length), (this[e] | this[e + 1] << 8 | this[e + 2] << 16) + 16777216 * this[e + 3] }, u.prototype.readUInt32BE = function (e, t) { return t || D(e, 4, this.length), 16777216 * this[e] + (this[e + 1] << 16 | this[e + 2] << 8 | this[e + 3]) }, u.prototype.readIntLE = function (e, t, r) { e |= 0, t |= 0, r || D(e, t, this.length); for (var n = this[e], i = 1, o = 0; ++o < t && (i *= 256);)n += this[e + o] * i; return n >= (i *= 128) && (n -= Math.pow(2, 8 * t)), n }, u.prototype.readIntBE = function (e, t, r) { e |= 0, t |= 0, r || D(e, t, this.length); for (var n = t, i = 1, o = this[e + --n]; n > 0 && (i *= 256);)o += this[e + --n] * i; return o >= (i *= 128) && (o -= Math.pow(2, 8 * t)), o }, u.prototype.readInt8 = function (e, t) { return t || D(e, 1, this.length), 128 & this[e] ? -1 * (255 - this[e] + 1) : this[e] }, u.prototype.readInt16LE = function (e, t) { t || D(e, 2, this.length); var r = this[e] | this[e + 1] << 8; return 32768 & r ? 4294901760 | r : r }, u.prototype.readInt16BE = function (e, t) { t || D(e, 2, this.length); var r = this[e + 1] | this[e] << 8; return 32768 & r ? 4294901760 | r : r }, u.prototype.readInt32LE = function (e, t) { return t || D(e, 4, this.length), this[e] | this[e + 1] << 8 | this[e + 2] << 16 | this[e + 3] << 24 }, u.prototype.readInt32BE = function (e, t) { return t || D(e, 4, this.length), this[e] << 24 | this[e + 1] << 16 | this[e + 2] << 8 | this[e + 3] }, u.prototype.readFloatLE = function (e, t) { return t || D(e, 4, this.length), i.read(this, e, !0, 23, 4) }, u.prototype.readFloatBE = function (e, t) { return t || D(e, 4, this.length), i.read(this, e, !1, 23, 4) }, u.prototype.readDoubleLE = function (e, t) { return t || D(e, 8, this.length), i.read(this, e, !0, 52, 8) }, u.prototype.readDoubleBE = function (e, t) { return t || D(e, 8, this.length), i.read(this, e, !1, 52, 8) }, u.prototype.writeUIntLE = function (e, t, r, n) { (e = +e, t |= 0, r |= 0, n) || M(this, e, t, r, Math.pow(2, 8 * r) - 1, 0); var i = 1, o = 0; for (this[t] = 255 & e; ++o < r && (i *= 256);)this[t + o] = e / i & 255; return t + r }, u.prototype.writeUIntBE = function (e, t, r, n) { (e = +e, t |= 0, r |= 0, n) || M(this, e, t, r, Math.pow(2, 8 * r) - 1, 0); var i = r - 1, o = 1; for (this[t + i] = 255 & e; --i >= 0 && (o *= 256);)this[t + i] = e / o & 255; return t + r }, u.prototype.writeUInt8 = function (e, t, r) { return e = +e, t |= 0, r || M(this, e, t, 1, 255, 0), u.TYPED_ARRAY_SUPPORT || (e = Math.floor(e)), this[t] = 255 & e, t + 1 }, u.prototype.writeUInt16LE = function (e, t, r) { return e = +e, t |= 0, r || M(this, e, t, 2, 65535, 0), u.TYPED_ARRAY_SUPPORT ? (this[t] = 255 & e, this[t + 1] = e >>> 8) : L(this, e, t, !0), t + 2 }, u.prototype.writeUInt16BE = function (e, t, r) { return e = +e, t |= 0, r || M(this, e, t, 2, 65535, 0), u.TYPED_ARRAY_SUPPORT ? (this[t] = e >>> 8, this[t + 1] = 255 & e) : L(this, e, t, !1), t + 2 }, u.prototype.writeUInt32LE = function (e, t, r) { return e = +e, t |= 0, r || M(this, e, t, 4, 4294967295, 0), u.TYPED_ARRAY_SUPPORT ? (this[t + 3] = e >>> 24, this[t + 2] = e >>> 16, this[t + 1] = e >>> 8, this[t] = 255 & e) : j(this, e, t, !0), t + 4 }, u.prototype.writeUInt32BE = function (e, t, r) { return e = +e, t |= 0, r || M(this, e, t, 4, 4294967295, 0), u.TYPED_ARRAY_SUPPORT ? (this[t] = e >>> 24, this[t + 1] = e >>> 16, this[t + 2] = e >>> 8, this[t + 3] = 255 & e) : j(this, e, t, !1), t + 4 }, u.prototype.writeIntLE = function (e, t, r, n) { if (e = +e, t |= 0, !n) { var i = Math.pow(2, 8 * r - 1); M(this, e, t, r, i - 1, -i) } var o = 0, s = 1, a = 0; for (this[t] = 255 & e; ++o < r && (s *= 256);)e < 0 && 0 === a && 0 !== this[t + o - 1] && (a = 1), this[t + o] = (e / s >> 0) - a & 255; return t + r }, u.prototype.writeIntBE = function (e, t, r, n) { if (e = +e, t |= 0, !n) { var i = Math.pow(2, 8 * r - 1); M(this, e, t, r, i - 1, -i) } var o = r - 1, s = 1, a = 0; for (this[t + o] = 255 & e; --o >= 0 && (s *= 256);)e < 0 && 0 === a && 0 !== this[t + o + 1] && (a = 1), this[t + o] = (e / s >> 0) - a & 255; return t + r }, u.prototype.writeInt8 = function (e, t, r) { return e = +e, t |= 0, r || M(this, e, t, 1, 127, -128), u.TYPED_ARRAY_SUPPORT || (e = Math.floor(e)), e < 0 && (e = 255 + e + 1), this[t] = 255 & e, t + 1 }, u.prototype.writeInt16LE = function (e, t, r) { return e = +e, t |= 0, r || M(this, e, t, 2, 32767, -32768), u.TYPED_ARRAY_SUPPORT ? (this[t] = 255 & e, this[t + 1] = e >>> 8) : L(this, e, t, !0), t + 2 }, u.prototype.writeInt16BE = function (e, t, r) { return e = +e, t |= 0, r || M(this, e, t, 2, 32767, -32768), u.TYPED_ARRAY_SUPPORT ? (this[t] = e >>> 8, this[t + 1] = 255 & e) : L(this, e, t, !1), t + 2 }, u.prototype.writeInt32LE = function (e, t, r) { return e = +e, t |= 0, r || M(this, e, t, 4, 2147483647, -2147483648), u.TYPED_ARRAY_SUPPORT ? (this[t] = 255 & e, this[t + 1] = e >>> 8, this[t + 2] = e >>> 16, this[t + 3] = e >>> 24) : j(this, e, t, !0), t + 4 }, u.prototype.writeInt32BE = function (e, t, r) { return e = +e, t |= 0, r || M(this, e, t, 4, 2147483647, -2147483648), e < 0 && (e = 4294967295 + e + 1), u.TYPED_ARRAY_SUPPORT ? (this[t] = e >>> 24, this[t + 1] = e >>> 16, this[t + 2] = e >>> 8, this[t + 3] = 255 & e) : j(this, e, t, !1), t + 4 }, u.prototype.writeFloatLE = function (e, t, r) { return B(this, e, t, !0, r) }, u.prototype.writeFloatBE = function (e, t, r) { return B(this, e, t, !1, r) }, u.prototype.writeDoubleLE = function (e, t, r) { return x(this, e, t, !0, r) }, u.prototype.writeDoubleBE = function (e, t, r) { return x(this, e, t, !1, r) }, u.prototype.copy = function (e, t, r, n) { if (r || (r = 0), n || 0 === n || (n = this.length), t >= e.length && (t = e.length), t || (t = 0), n > 0 && n < r && (n = r), n === r) return 0; if (0 === e.length || 0 === this.length) return 0; if (t < 0) throw new RangeError("targetStart out of bounds"); if (r < 0 || r >= this.length) throw new RangeError("sourceStart out of bounds"); if (n < 0) throw new RangeError("sourceEnd out of bounds"); n > this.length && (n = this.length), e.length - t < n - r && (n = e.length - t + r); var i, o = n - r; if (this === e && r < t && t < n) for (i = o - 1; i >= 0; --i)e[i + t] = this[i + r]; else if (o < 1e3 || !u.TYPED_ARRAY_SUPPORT) for (i = 0; i < o; ++i)e[i + t] = this[i + r]; else Uint8Array.prototype.set.call(e, this.subarray(r, r + o), t); return o }, u.prototype.fill = function (e, t, r, n) { if ("string" == typeof e) { if ("string" == typeof t ? (n = t, t = 0, r = this.length) : "string" == typeof r && (n = r, r = this.length), 1 === e.length) { var i = e.charCodeAt(0); i < 256 && (e = i) } if (void 0 !== n && "string" != typeof n) throw new TypeError("encoding must be a string"); if ("string" == typeof n && !u.isEncoding(n)) throw new TypeError("Unknown encoding: " + n) } else "number" == typeof e && (e &= 255); if (t < 0 || this.length < t || this.length < r) throw new RangeError("Out of range index"); if (r <= t) return this; var o; if (t >>>= 0, r = void 0 === r ? this.length : r >>> 0, e || (e = 0), "number" == typeof e) for (o = t; o < r; ++o)this[o] = e; else { var s = u.isBuffer(e) ? e : k(new u(e, n).toString()), a = s.length; for (o = 0; o < r - t; ++o)this[o + t] = s[o % a] } return this }; var U = /[^+\/0-9A-Za-z-_]/g; function G(e) { return e < 16 ? "0" + e.toString(16) : e.toString(16) } function k(e, t) { var r; t = t || 1 / 0; for (var n = e.length, i = null, o = [], s = 0; s < n; ++s) { if ((r = e.charCodeAt(s)) > 55295 && r < 57344) { if (!i) { if (r > 56319) { (t -= 3) > -1 && o.push(239, 191, 189); continue } if (s + 1 === n) { (t -= 3) > -1 && o.push(239, 191, 189); continue } i = r; continue } if (r < 56320) { (t -= 3) > -1 && o.push(239, 191, 189), i = r; continue } r = 65536 + (i - 55296 << 10 | r - 56320) } else i && (t -= 3) > -1 && o.push(239, 191, 189); if (i = null, r < 128) { if ((t -= 1) < 0) break; o.push(r) } else if (r < 2048) { if ((t -= 2) < 0) break; o.push(r >> 6 | 192, 63 & r | 128) } else if (r < 65536) { if ((t -= 3) < 0) break; o.push(r >> 12 | 224, r >> 6 & 63 | 128, 63 & r | 128) } else { if (!(r < 1114112)) throw new Error("Invalid code point"); if ((t -= 4) < 0) break; o.push(r >> 18 | 240, r >> 12 & 63 | 128, r >> 6 & 63 | 128, 63 & r | 128) } } return o } function F(e) { return n.toByteArray(function (e) { if ((e = function (e) { return e.trim ? e.trim() : e.replace(/^\s+|\s+$/g, "") }(e).replace(U, "")).length < 2) return ""; for (; e.length % 4 != 0;)e += "="; return e }(e)) } function Y(e, t, r, n) { for (var i = 0; i < n && !(i + r >= t.length || i >= e.length); ++i)t[i + r] = e[i]; return i } }).call(this, r("./node_modules/webpack/buildin/global.js")) }, "./node_modules/process/browser.js": function (e, t) { var r, n, i = e.exports = {}; function o() { throw new Error("setTimeout has not been defined") } function s() { throw new Error("clearTimeout has not been defined") } function a(e) { if (r === setTimeout) return setTimeout(e, 0); if ((r === o || !r) && setTimeout) return r = setTimeout, setTimeout(e, 0); try { return r(e, 0) } catch (t) { try { return r.call(null, e, 0) } catch (t) { return r.call(this, e, 0) } } } !function () { try { r = "function" == typeof setTimeout ? setTimeout : o } catch (e) { r = o } try { n = "function" == typeof clearTimeout ? clearTimeout : s } catch (e) { n = s } }(); var u, c = [], l = !1, d = -1; function f() { l && u && (l = !1, u.length ? c = u.concat(c) : d = -1, c.length && _()) } function _() { if (!l) { var e = a(f); l = !0; for (var t = c.length; t;) { for (u = c, c = []; ++d < t;)u && u[d].run(); d = -1, t = c.length } u = null, l = !1, function (e) { if (n === clearTimeout) return clearTimeout(e); if ((n === s || !n) && clearTimeout) return n = clearTimeout, clearTimeout(e); try { n(e) } catch (t) { try { return n.call(null, e) } catch (t) { return n.call(this, e) } } }(e) } } function p(e, t) { this.fun = e, this.array = t } function h() { } i.nextTick = function (e) { var t = new Array(arguments.length - 1); if (arguments.length > 1) for (var r = 1; r < arguments.length; r++)t[r - 1] = arguments[r]; c.push(new p(e, t)), 1 !== c.length || l || a(_) }, p.prototype.run = function () { this.fun.apply(null, this.array) }, i.title = "browser", i.browser = !0, i.env = {}, i.argv = [], i.version = "", i.versions = {}, i.on = h, i.addListener = h, i.once = h, i.off = h, i.removeListener = h, i.removeAllListeners = h, i.emit = h, i.prependListener = h, i.prependOnceListener = h, i.listeners = function (e) { return [] }, i.binding = function (e) { throw new Error("process.binding is not supported") }, i.cwd = function () { return "/" }, i.chdir = function (e) { throw new Error("process.chdir is not supported") }, i.umask = function () { return 0 } }, "./node_modules/setimmediate/setImmediate.js": function (e, t, r) { (function (e, t) { !function (e, r) { if (!e.setImmediate) { var n, i = 1, o = {}, s = !1, a = e.document, u = Object.getPrototypeOf && Object.getPrototypeOf(e); u = u && u.setTimeout ? u : e, "[object process]" === {}.toString.call(e.process) ? n = function (e) { t.nextTick(function () { l(e) }) } : function () { if (e.postMessage && !e.importScripts) { var t = !0, r = e.onmessage; return e.onmessage = function () { t = !1 }, e.postMessage("", "*"), e.onmessage = r, t } }() ? function () { var t = "setImmediate$" + Math.random() + "$", r = function (r) { r.source === e && "string" == typeof r.data && 0 === r.data.indexOf(t) && l(+r.data.slice(t.length)) }; e.addEventListener ? e.addEventListener("message", r, !1) : e.attachEvent("onmessage", r), n = function (r) { e.postMessage(t + r, "*") } }() : e.MessageChannel ? function () { var e = new MessageChannel; e.port1.onmessage = function (e) { l(e.data) }, n = function (t) { e.port2.postMessage(t) } }() : a && "onreadystatechange" in a.createElement("script") ? function () { var e = a.documentElement; n = function (t) { var r = a.createElement("script"); r.onreadystatechange = function () { l(t), r.onreadystatechange = null, e.removeChild(r), r = null }, e.appendChild(r) } }() : n = function (e) { setTimeout(l, 0, e) }, u.setImmediate = function (e) { "function" != typeof e && (e = new Function("" + e)); for (var t = new Array(arguments.length - 1), r = 0; r < t.length; r++)t[r] = arguments[r + 1]; var s = { callback: e, args: t }; return o[i] = s, n(i), i++ }, u.clearImmediate = c } function c(e) { delete o[e] } function l(e) { if (s) setTimeout(l, 0, e); else { var t = o[e]; if (t) { s = !0; try { !function (e) { var t = e.callback, n = e.args; switch (n.length) { case 0: t(); break; case 1: t(n[0]); break; case 2: t(n[0], n[1]); break; case 3: t(n[0], n[1], n[2]); break; default: t.apply(r, n) } }(t) } finally { c(e), s = !1 } } } } }("undefined" == typeof self ? void 0 === e ? this : e : self) }).call(this, r("./node_modules/webpack/buildin/global.js"), r("./node_modules/process/browser.js")) }, "./node_modules/timers-browserify/main.js": function (e, t, r) { (function (e) { var n = void 0 !== e && e || "undefined" != typeof self && self || window, i = Function.prototype.apply; function o(e, t) { this._id = e, this._clearFn = t } t.setTimeout = function () { return new o(i.call(setTimeout, n, arguments), clearTimeout) }, t.setInterval = function () { return new o(i.call(setInterval, n, arguments), clearInterval) }, t.clearTimeout = t.clearInterval = function (e) { e && e.close() }, o.prototype.unref = o.prototype.ref = function () { }, o.prototype.close = function () { this._clearFn.call(n, this._id) }, t.enroll = function (e, t) { clearTimeout(e._idleTimeoutId), e._idleTimeout = t }, t.unenroll = function (e) { clearTimeout(e._idleTimeoutId), e._idleTimeout = -1 }, t._unrefActive = t.active = function (e) { clearTimeout(e._idleTimeoutId); var t = e._idleTimeout; t >= 0 && (e._idleTimeoutId = setTimeout(function () { e._onTimeout && e._onTimeout() }, t)) }, r("./node_modules/setimmediate/setImmediate.js"), t.setImmediate = "undefined" != typeof self && self.setImmediate || void 0 !== e && e.setImmediate || this && this.setImmediate, t.clearImmediate = "undefined" != typeof self && self.clearImmediate || void 0 !== e && e.clearImmediate || this && this.clearImmediate }).call(this, r("./node_modules/webpack/buildin/global.js")) }, "./node_modules/tslib/tslib.es6.js": function (e, t, r) { r.r(t), r.d(t, "__extends", function () { return i }), r.d(t, "__assign", function () { return o }), r.d(t, "__rest", function () { return s }), r.d(t, "__decorate", function () { return a }), r.d(t, "__param", function () { return u }), r.d(t, "__metadata", function () { return c }), r.d(t, "__awaiter", function () { return l }), r.d(t, "__generator", function () { return d }), r.d(t, "__exportStar", function () { return f }), r.d(t, "__values", function () { return _ }), r.d(t, "__read", function () { return p }), r.d(t, "__spread", function () { return h }), r.d(t, "__spreadArrays", function () { return g }), r.d(t, "__await", function () { return E }), r.d(t, "__asyncGenerator", function () { return m }), r.d(t, "__asyncDelegator", function () { return b }), r.d(t, "__asyncValues", function () { return y }), r.d(t, "__makeTemplateObject", function () { return S }), r.d(t, "__importStar", function () { return v }), r.d(t, "__importDefault", function () { return T }); var n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }; function i(e, t) { function r() { Object.defineProperty(this, "constructor", { value: e }) } n(e, t), e.prototype = null === t ? Object.create(t) : (r.prototype = t.prototype, new r) } var o = function () { return (o = Object.assign || function (e) { for (var t, r = 1, n = arguments.length; r < n; r++)for (var i in t = arguments[r]) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e }).apply(this, arguments) }; function s(e, t) { var r = {}; for (var n in e) Object.prototype.hasOwnProperty.call(e, n) && t.indexOf(n) < 0 && (r[n] = e[n]); if (null != e && "function" == typeof Object.getOwnPropertySymbols) { var i = 0; for (n = Object.getOwnPropertySymbols(e); i < n.length; i++)t.indexOf(n[i]) < 0 && Object.prototype.propertyIsEnumerable.call(e, n[i]) && (r[n[i]] = e[n[i]]) } return r } function a(e, t, r, n) { var i, o = arguments.length, s = o < 3 ? t : null === n ? n = Object.getOwnPropertyDescriptor(t, r) : n; if ("object" == typeof Reflect && "function" == typeof Reflect.decorate) s = Reflect.decorate(e, t, r, n); else for (var a = e.length - 1; a >= 0; a--)(i = e[a]) && (s = (o < 3 ? i(s) : o > 3 ? i(t, r, s) : i(t, r)) || s); return o > 3 && s && Object.defineProperty(t, r, s), s } function u(e, t) { return function (r, n) { t(r, n, e) } } function c(e, t) { if ("object" == typeof Reflect && "function" == typeof Reflect.metadata) return Reflect.metadata(e, t) } function l(e, t, r, n) { return new (r || (r = Promise))(function (i, o) { function s(e) { try { u(n.next(e)) } catch (e) { o(e) } } function a(e) { try { u(n.throw(e)) } catch (e) { o(e) } } function u(e) { e.done ? i(e.value) : new r(function (t) { t(e.value) }).then(s, a) } u((n = n.apply(e, t || [])).next()) }) } function d(e, t) { var r, n, i, o, s = { label: 0, sent: function () { if (1 & i[0]) throw i[1]; return i[1] }, trys: [], ops: [] }; return o = { next: a(0), throw: a(1), return: a(2) }, "function" == typeof Symbol && (o[Symbol.iterator] = function () { return this }), o; function a(o) { return function (a) { return function (o) { if (r) throw new TypeError("Generator is already executing."); for (; s;)try { if (r = 1, n && (i = 2 & o[0] ? n.return : o[0] ? n.throw || ((i = n.return) && i.call(n), 0) : n.next) && !(i = i.call(n, o[1])).done) return i; switch (n = 0, i && (o = [2 & o[0], i.value]), o[0]) { case 0: case 1: i = o; break; case 4: return s.label++ , { value: o[1], done: !1 }; case 5: s.label++ , n = o[1], o = [0]; continue; case 7: o = s.ops.pop(), s.trys.pop(); continue; default: if (!(i = (i = s.trys).length > 0 && i[i.length - 1]) && (6 === o[0] || 2 === o[0])) { s = 0; continue } if (3 === o[0] && (!i || o[1] > i[0] && o[1] < i[3])) { s.label = o[1]; break } if (6 === o[0] && s.label < i[1]) { s.label = i[1], i = o; break } if (i && s.label < i[2]) { s.label = i[2], s.ops.push(o); break } i[2] && s.ops.pop(), s.trys.pop(); continue }o = t.call(e, s) } catch (e) { o = [6, e], n = 0 } finally { r = i = 0 } if (5 & o[0]) throw o[1]; return { value: o[0] ? o[1] : void 0, done: !0 } }([o, a]) } } } function f(e, t) { for (var r in e) t.hasOwnProperty(r) || (t[r] = e[r]) } function _(e) { var t = "function" == typeof Symbol && e[Symbol.iterator], r = 0; return t ? t.call(e) : { next: function () { return e && r >= e.length && (e = void 0), { value: e && e[r++], done: !e } } } } function p(e, t) { var r = "function" == typeof Symbol && e[Symbol.iterator]; if (!r) return e; var n, i, o = r.call(e), s = []; try { for (; (void 0 === t || t-- > 0) && !(n = o.next()).done;)s.push(n.value) } catch (e) { i = { error: e } } finally { try { n && !n.done && (r = o.return) && r.call(o) } finally { if (i) throw i.error } } return s } function h() { for (var e = [], t = 0; t < arguments.length; t++)e = e.concat(p(arguments[t])); return e } function g() { for (var e = 0, t = 0, r = arguments.length; t < r; t++)e += arguments[t].length; var n = Array(e), i = 0; for (t = 0; t < r; t++)for (var o = arguments[t], s = 0, a = o.length; s < a; s++ , i++)n[i] = o[s]; return n } function E(e) { return this instanceof E ? (this.v = e, this) : new E(e) } function m(e, t, r) { if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined."); var n, i = r.apply(e, t || []), o = []; return n = {}, s("next"), s("throw"), s("return"), n[Symbol.asyncIterator] = function () { return this }, n; function s(e) { i[e] && (n[e] = function (t) { return new Promise(function (r, n) { o.push([e, t, r, n]) > 1 || a(e, t) }) }) } function a(e, t) { try { !function (e) { e.value instanceof E ? Promise.resolve(e.value.v).then(u, c) : l(o[0][2], e) }(i[e](t)) } catch (e) { l(o[0][3], e) } } function u(e) { a("next", e) } function c(e) { a("throw", e) } function l(e, t) { e(t), o.shift(), o.length && a(o[0][0], o[0][1]) } } function b(e) { var t, r; return t = {}, n("next"), n("throw", function (e) { throw e }), n("return"), t[Symbol.iterator] = function () { return this }, t; function n(n, i) { t[n] = e[n] ? function (t) { return (r = !r) ? { value: E(e[n](t)), done: "return" === n } : i ? i(t) : t } : i } } function y(e) { if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined."); var t, r = e[Symbol.asyncIterator]; return r ? r.call(e) : (e = _(e), t = {}, n("next"), n("throw"), n("return"), t[Symbol.asyncIterator] = function () { return this }, t); function n(r) { t[r] = e[r] && function (t) { return new Promise(function (n, i) { (function (e, t, r, n) { Promise.resolve(n).then(function (t) { e({ value: t, done: r }) }, t) })(n, i, (t = e[r](t)).done, t.value) }) } } } function S(e, t) { return Object.defineProperty ? Object.defineProperty(e, "raw", { value: t }) : e.raw = t, e } function v(e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) Object.hasOwnProperty.call(e, r) && (t[r] = e[r]); return t.default = e, t } function T(e) { return e && e.__esModule ? e : { default: e } } }, "./node_modules/webpack/buildin/global.js": function (e, t) { var r; r = function () { return this }(); try { r = r || Function("return this")() || (0, eval)("this") } catch (e) { "object" == typeof window && (r = window) } e.exports = r }, "./node_modules/webpack/buildin/harmony-module.js": function (e, t) { e.exports = function (e) { if (!e.webpackPolyfill) { var t = Object.create(e); t.children || (t.children = []), Object.defineProperty(t, "loaded", { enumerable: !0, get: function () { return t.l } }), Object.defineProperty(t, "id", { enumerable: !0, get: function () { return t.i } }), Object.defineProperty(t, "exports", { enumerable: !0 }), t.webpackPolyfill = 1 } return t } }, "./src/cloud/index.ts": function (e, t, r) { (function (e) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"), i = r("./src/services/index.ts"), o = r("./src/utils/error.ts"), s = r("./src/utils/type.ts"), a = r("./src/network/tunnel.ts"), u = r("./src/config/error.config.ts"), c = r("./src/externals/public-lib/appserviceSdk.ts"), l = r("./src/externals/globals/wxconfig.ts"), d = r("./src/utils/report.ts"), f = r("./src/config/app.config.ts"), _ = r("./src/externals/globals/devtools.ts"); function p() { return { maxReconnect: f.clientConfigDefaults.REALTIME_DB_MAX_RECONNECT, reconnectInterval: f.clientConfigDefaults.REALTIME_DB_WS_RECONNECT_INTERVAL, totalConnectionTimeout: f.clientConfigDefaults.REALTIME_DB_TOTAL_CONNECTION_TIMEOUT } } t.getCloudAPI = function (e) { void 0 === e && (e = {}); var r = e.identifiers, n = e.sdk, i = new (t.getCloudClass())(r); return n && c.setSDK(i.identifiers, n), i.exportAPI }, t.getCloudClass = function () { return function () { function t(t) { var r = this; this.inited = !1, this.services = {}, this.apiServiceMap = {}, this.debug = !1, this.identifiers = t || {}, this.request = a.getBoundTunnelRequest({ cloud: this }), this.exportAPI = { init: this.init.bind(this) }, i.registerServices(this), this.meta = { session_id: (+new Date).toString() }, this.config = { database: p() }, this.appConfig = n.__assign({}, f.default), this.apiPermissions = {}; try { l.default.onReady(function () { setTimeout(function () { d.init() }, 2e3) }), e.env.TEST && (this.exportAPI.getCloudInstance = function () { return r }) } catch (e) { } } return t.prototype.getMetaData = function () { return this.meta }, t.prototype.getConfig = function () { return this.config }, t.prototype.getEnvForService = function (e) { var t = this.config; if (t.env) switch (s.getType(t.env)) { case "string": return t.env; case "object": return t.env[e]; default: return } }, t.prototype.checkAPIPermission = function (e) { return !this.apiPermissions.hasOwnProperty(e) || 1 === this.apiPermissions[e] }, t.prototype.init = function (e) { void 0 === e && (e = {}), this.inited || (this.inited = !0, this.initConfig(e), this.sendInitRequest(), this.testSpeed(), l.isDevTools() && _.devtoolsNetworkLog({ reqId: Math.random() + "-" + +new Date, type: "init", config: this.config, console: this.debug })) }, t.prototype.initConfig = function (e) { this.config = JSON.parse(JSON.stringify(e)), this.config.database ? (this.config.database.hasOwnProperty("maxReconnect") || (this.config.database.maxReconnect = f.clientConfigDefaults.REALTIME_DB_MAX_RECONNECT), this.config.database.hasOwnProperty("reconnectInterval") || (this.config.database.reconnectInterval = f.clientConfigDefaults.REALTIME_DB_WS_RECONNECT_INTERVAL), this.config.database.hasOwnProperty("totalConnectionTimeout") || (this.config.database.totalConnectionTimeout = f.clientConfigDefaults.REALTIME_DB_TOTAL_CONNECTION_TIMEOUT)) : this.config.database = p() }, t.prototype.sendInitRequest = function () { var e = this, t = JSON.stringify({ trace_user: !1 !== this.config.traceUser }), r = +new Date, i = r; a.tunnel(a.constructTunnelReq({ cloud: this, apiName: "tcbapi_init", serializedReqData: t, env: "string" == typeof this.config.env ? this.config.env : void 0 })).then(function (t) { var o = +new Date, s = t.data; e.appConfig = n.__assign({}, e.appConfig, s.config); for (var a = s.tcb_api_list || [], u = 0, c = a.length; u < c; u++)e.apiPermissions[a[u].apiname] = a[u].status; d.reportAPISpeed({ apiName: "cloud.init", apiEndTime: +new Date, apiStartTime: r, tunnelEndTime: o, tunnelStartTime: i, tunnelTimeNoCSNetCost: s.baseresponse.stat.qbase_cost_time }) }).catch(function (e) { console.error("cloud init error: ", e) }) }, t.prototype.testSpeed = function () { return n.__awaiter(this, void 0, void 0, function () { var e, t; return n.__generator(this, function (r) { return e = +new Date, t = e, a.tunnel(a.constructTunnelReq({ cloud: this, apiName: "tcbapi_testspeed", serializedReqData: null }), { fireOnIdle: !0, onFire: function () { e = +new Date, t = e } }).then(function (r) { d.reportAPISpeed({ apiName: "cloud.testspeed", apiEndTime: +new Date, apiStartTime: e, tunnelEndTime: +new Date, tunnelStartTime: t, tunnelTimeNoCSNetCost: r.data.baseresponse.stat.qbase_cost_time }) }).catch(function (e) { 0 }), [2] }) }) }, t.prototype.registerService = function (e) { this.services[e.name] = e; var t = e.getAPIs(); for (var r in t) this.apiServiceMap[r] = e.name, this.registerFunction(r, t[r]) }, t.prototype.registerFunction = function (e, t) { var r = this; this.exportAPI[e] = function () { if (!r.inited) throw new o.CloudSDKError({ errMsg: "Cloud API isn't enabled, please call wx.cloud.init first\n请先调用 wx.cloud.init() 完成初始化后再调用其他云 API。init 方法可传入一个对象用于设置默认配置，详见文档。" }); if (!r.checkAPIPermission(e)) throw new o.CloudSDKError({ errCode: u.ERR_CODE.SDK_API_PERMISSION_DENIED, errMsg: u.ERR_CODE[u.ERR_CODE.SDK_API_PERMISSION_DENIED] }); return t.apply(r, arguments) } }, t.prototype.toJSON = function () { }, t }() } }).call(this, r("./node_modules/process/browser.js")) }, "./src/config/app.config.ts": function (e, t) { Object.defineProperty(t, "__esModule", { value: !0 }), t.serverConfigurable = { db_doc_size_limit: 524288, db_realtime_ping_interval: 15e3, db_realtime_pong_wait_timeout: 15e3, upload_max_file_size: 20971520, get_temp_file_url_max_requests: 50, call_function_poll_max_retry: 10, call_function_max_req_data_size: 5242880, call_function_client_poll_timeout: 15e3, call_function_valid_start_retry_gap: 6e4 }, t.clientConfigDefaults = { REALTIME_DB_MAX_RECONNECT: 5, REALTIME_DB_WS_RECONNECT_INTERVAL: 5e3, REALTIME_DB_TOTAL_CONNECTION_TIMEOUT: 1 / 0 }, t.default = t.serverConfigurable }, "./src/config/error.config.ts": function (e, t) { Object.defineProperty(t, "__esModule", { value: !0 }), t.ERR_CODE = { "-1": "", UNKNOWN_ERROR: -1, "-401001": "api permission denied", SDK_API_PERMISSION_DENIED: -401001, "-401002": "api parameter error", SDK_API_PARAMETER_ERROR: -401002, "-401003": "api parameter type error", SDK_API_PARAMETER_TYPE_ERROR: -401003, "-402001": "circular reference detected", SDK_DATABASE_CIRCULAR_REFERENCE: -402001, "-402002": "realtime listener init watch fail", SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL: -402002, "-402003": "realtime listener reconnect watch fail", SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL: -402003, "-402004": "realtime listener rebuild watch fail", SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL: -402004, "-402005": "realtime listener rebuild watch fail", SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL: -402005, "-402006": "realtime listener receive server error msg", SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG: -402006, "-402007": "realtime listener receive invalid server data", SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA: -402007, "-402008": "realtime listener websocket connection error", SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR: -402008, "-402009": "realtime listener websocket connection closed", SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED: -402009, "-402010": "realtime listener check last fail", SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL: -402010, "-402011": "realtime listener unexpected fatal error", SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR: -402011, "-403001": "max upload file size exceeded", SDK_STORAGE_EXCEED_MAX_UPLOAD_SIZE: -403001, "-403002": "internal server error: empty upload url", SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_UPLOAD_URL: -403002, "-403003": "internal server error: empty download url", SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_DOWNLOAD_URL: -403003, "-404001": "empty call result", SDK_FUNCTIONS_EMPTY_CALL_RESULT: -404001, "-404002": "empty event id", SDK_FUNCTIONS_EMPTY_EVENT_ID: -404002, "-404003": "empty poll url", SDK_FUNCTIONS_EMPTY_POLL_URL: -404003, "-404004": "empty poll result json", SDK_FUNCTIONS_EMPTY_POLL_RESULT_JSON: -404004, "-404005": "exceed max poll retry", SDK_FUNCTIONS_EXCEED_MAX_POLL_RETRY: -404005, "-404006": "empty poll result base resp", SDK_FUNCTIONS_EMPTY_POLL_RESULT_BASE_RESP: -404006, "-404007": "error while waiting for the result", SDK_FUNCTIONS_POLL_RESULT_BASE_RESP_RET_ABNORMAL: -404007, "-404008": "error while waiting for the result", SDK_FUNCTIONS_POLL_RESULT_STATUS_CODE_ERROR: -404008, "-404009": "error while waiting for the result", SDK_FUNCTIONS_POLL_ERROR: -404009, "-404010": "result expired", SDK_FUNCTIONS_POLL_RESULT_EXPIRED: -404010, "-404011": "cloud function execution error", SDK_FUNCTIONS_CLOUD_FUNCTION_EXECUTION_ERROR: -404011, "-404012": "error while waiting for the result", SDK_FUNCTIONS_EXCEED_MAX_TIMEOUT_POLL_RETRY: -404012, "-404013": "error while waiting for the result", SDK_FUNCTIONS_EXCEED_MAX_SYSTEM_ERROR_POLL_RETRY: -404013, "-601001": "system error", WX_SYSTEM_ERROR: -601001, "-601002": "system args error", WX_SYSTEM_ARGS_ERROR: -601002, "-601003": "system network error", WX_SYSTEM_NETWORK_ERROR: -601003, "-601004": "api permission denied", WX_API_PERMISSION_DENIED: -601004, "-501001": "resource system error", TCB_RESOURCE_SYSTEM_ERROR: -501001, "-501002": "resource server timeout", TCB_RESOURCE_SERVER_TIMEOUT: -501002, "-501003": "exceed request limit", TCB_EXCEED_REQUEST_LIMIT: -501003, "-501004": "exceed concurrent request limit", TCB_EXCEED_CONCURRENT_REQUEST_LIMIT: -501004, "-501005": "invalid env", TCB_INVALID_ENV: -501005, "-501006": "invalid common parameters", TCB_INVALID_COMMON_PARAM: -501006, "-501007": "invalid parameters", TCB_INVALID_PARAM: -501007, "-501008": "invalid request source", TCB_INVALID_REQUEST_SOURCE: -501008, "-501009": "resource not initialized", TCB_RESOURCE_NOT_INITIALIZED: -501009, "-502001": "database request fail", TCB_DB_REQUEST_FAIL: -502001, "-502002": "database invalid command", TCB_DB_INVALID_COMMAND: -502002, "-502003": "database permission denied", TCB_DB_PERMISSION_DENIED: -502003, "-502004": "database exceed collection limit", TCB_DB_EXCEED_COLLECTION_LIMIT: -502004, "-502005": "database collection not exists", TCB_DB_COLLECTION_NOT_EXISTS: -502005, "-503001": "storage request fail", TCB_STORAGE_REQUEST_FAIL: -503001, "-503002": "storage permission denied", TCB_STORAGE_PERMISSION_DENIED: -503002, "-503003": "storage file not exists", TCB_STORAGE_FILE_NOT_EXISTS: -503003, "-503004": "storage invalid sign parameter", TCB_STORAGE_INVALID_SIGN_PARAM: -503004, "-504001": "functions request fail", TCB_FUNCTIONS_REQUEST_FAIL: -504001, "-504002": "functions execute fail", TCB_FUNCTIONS_EXEC_FAIL: -504002 } }, "./src/config/report.config.ts": function (e, t) { Object.defineProperty(t, "__esModule", { value: !0 }), t.ErrorID = 1128, t.ErrorKey = { REALTIME_DB_INIT_WS_SUCCESS: 1, REALTIME_DB_INIT_WS_FAIL: 2, REALTIME_DB_RECONNECT_WS_SUCCESS: 3, REALTIME_DB_RECONNECT_WS_FAIL: 4, REALTIME_DB_INIT_WATCH_SUCCESS: 5, REALTIME_DB_INIT_WATCH_FAIL: 6, REALTIME_DB_REBUILD_WATCH_SUCCESS: 7, REALTIME_DB_REBUILD_WATCH_FAIL: 8, REALTIME_DB_WS_ONERROR_BEFORE_OPEN: 9, REALTIME_DB_WS_ONERROR_WHILE_ACTIVE: 10, REALTIME_DB_WS_ONCLOSE: 11, REALTIME_DB_WS_ONCLOSE_HEARTBEAT_PING_FAIL: 12, REALTIME_DB_WS_ONCLOSE_HEARTBEAT_PONG_TIMEOUT: 13, REALTIME_DB_WS_ONCLOSE_AB_NORMAL_CLOSURE: 14, REALTIME_DB_WS_ONCLOSE_SERVER_CLOSE_NO_AUTH: 15, REALTIME_DB_WS_ONCLOSE_UNKNOWN_ORIGIN: 16, REALTIME_DB_WS_TOTAL_CONNECTION_TIMEOUT: 17, REALTIME_DB_RECV_MSG_WITH_CLOSED_WATCHID: 30, REALTIME_DB_RECV_MSG_WITH_UNKNOWN_WATCHID: 31, REALTIME_DB_RECV_MSG_WITHOUT_WATCHID: 32, REALTIME_DB_HANDLE_EVENT_ERROR: 33, REALTIME_DB_RECV_DUPLICATE_EVENT: 34, REALTIME_DB_RECV_DUPLICATE_EVENT_AND_EVENT_OUT_OF_ORDER: 35, REALTIME_DB_UNEXPECTED_EVENT_DATATYPE_UPDATE_NO_ASSOCIATED_DOC: 36, REALTIME_DB_UNEXPECTED_EVENT_REMOVE_NO_ASSOCIATED_DOC: 37, REALTIME_DB_UNEXPECTED_EVENT_DEQUEUE_NO_ASSOCIATED_DOC: 38, REALTIME_DB_UNEXPECTED_EVENT_QUEUETYPE_UPDATE_NO_ASSOCIATED_DOC: 39, REALTIME_DB_EVENT_OUT_OF_ORDER: 40 } }, "./src/externals/globals/devtools.ts": function (e, t, r) { var n = this; Object.defineProperty(t, "__esModule", { value: !0 }); var i = r("./node_modules/tslib/tslib.es6.js"), o = r("./src/externals/globals/wxconfig.ts"), s = function (e) { return i.__assign({}, e, { errMsg: void 0 }) }; t.devtoolsNetworkLog = function (e) { try { o.isDevTools() && "undefined" != typeof __global && __global.networkLog && __global.networkLog(i.__assign({}, e, { domain: "cloud", method: "POST", timestampMs: e.timestampMs || +new Date, callFramesIgnoreLength: e.hasOwnProperty("callFramesIgnoreLength") ? e.callFramesIgnoreLength : 1 })) } catch (e) { } }, t.autoDevtoolsNetworkLog = function (e, r) { try { if (o.isDevTools() && "undefined" != typeof __global && __global.networkLog) { var a = r(), u = Math.random() + "-" + +new Date, c = a.console || !1, l = a.resultGetter || s; t.devtoolsNetworkLog({ reqId: u, type: "requestWillBeSent", url: a.url, headers: a.headers || {}, body: a.reqBody, console: c, callFramesIgnoreLength: 2 }), e.then(function (e) { return i.__awaiter(n, void 0, void 0, function () { return i.__generator(this, function (r) { switch (r.label) { case 0: return r.trys.push([0, 2, , 3]), [4, function (e) { return void 0 === e && (e = 0), new Promise(function (t) { return setTimeout(t, e) }) }()]; case 1: return r.sent(), t.devtoolsNetworkLog({ reqId: u, type: "loadingFinished", body: JSON.stringify(l(e), null, 2), console: c, callFramesIgnoreLength: 2 }), [3, 3]; case 2: return r.sent(), [3, 3]; case 3: return [2] } }) }) }).catch(function (e) { try { t.devtoolsNetworkLog({ reqId: u, type: "loadingFailed", errorCode: e && e.errCode || -1, errorMsg: e.toString(), console: c, callFramesIgnoreLength: 2 }) } catch (e) { } }) } } catch (e) { 0 } } }, "./src/externals/globals/wxconfig.ts": function (e, t, r) { (function (e) { Object.defineProperty(t, "__esModule", { value: !0 }); var n, i = r("./node_modules/tslib/tslib.es6.js"); try { __wxConfig.platform, n = i.__assign({}, __wxConfig), __wxConfig.onReady(function () { n = Object.assign(n, __wxConfig) }) } catch (t) { n = { platform: "ios", onReady: function (e) { setTimeout(function () { e() }) } }, e.__wxConfig = n } t.default = n, t.isDevTools = function () { return "devtools" === n.platform }, t.isMINA = function () { return "mina" === n.vendor } }).call(this, r("./node_modules/webpack/buildin/global.js")) }, "./src/externals/public-lib/appserviceSdk.ts": function (e, t) { Object.defineProperty(t, "__esModule", { value: !0 }); var r = new WeakMap; t.getSDK = function (e) { if (!e) return wx; var t = r.get(e); return t && t || wx }, t.setSDK = function (e, t) { r.set(e, t) } }, "./src/externals/public-lib/reporter.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n, i = r("./src/utils/fail-safe.ts"), o = { surroundThirdByTryCatch: function (e, t) { return function () { for (var r = [], n = 0; n < arguments.length; n++)r[n] = arguments[n]; return i.tryCatch(function () { try { return e.apply(e, r) } catch (r) { throw console.error(JSON.stringify(r) + "; " + t + "\n" + r.stack), console.error(e.toString()), r } }, t) } }, reportIDKey: function () { for (var e = [], t = 0; t < arguments.length; t++)e[t] = arguments[t] }, reportIDKeyDirectly: function () { for (var e = [], t = 0; t < arguments.length; t++)e[t] = arguments[t] }, reportKeyValue: function () { for (var e = [], t = 0; t < arguments.length; t++)e[t] = arguments[t] } }, s = !1, a = 10; function u() { try { return s ? Reporter : a <= 0 ? n : (a-- , Reporter.surroundThirdByTryCatch, n = Reporter, s = !0, n) } catch (e) { return n = o } } t.default = { surroundThirdByTryCatch: function (e, t) { return u().surroundThirdByTryCatch(e, t) }, reportIDKey: function (e) { return u().reportIDKey(e) }, reportIDKeyDirectly: function (e) { return u().reportIDKeyDirectly(e) }, reportKeyValue: function (e) { return u().reportKeyValue(e) } } }, "./src/hook/invoke.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/utils/type.ts"), i = r("./src/utils/fail-safe.ts"); function o(e, t, r) { t.success && n.isFunction(t.success) && i.wrapWithTryCatch(t.success, "at api " + e + " success callback function;")(r) } function s(e, t, r) { t.fail && n.isFunction(t.fail) && i.wrapWithTryCatch(t.fail, "at api " + e + " fail callback function;")(r) } function a(e, t, r) { t.complete && n.isFunction(t.complete) && i.wrapWithTryCatch(t.complete, "at api " + e + " complete callback function;")(r) } t.invokeSuccessCallback = o, t.invokeFailCallback = s, t.invokeCompleteCallback = a, t.invokeSuccessCompleteCallbacks = function (e, t, r) { o(e, t, r), a(e, t, r) }, t.invokeFailCompleteCallbacks = function (e, t, r) { s(e, t, r), a(e, t, r) }, t.hasAPICallback = function (e) { return e && (e.success || e.fail || e.complete) } }, "./src/index.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }), r("./node_modules/tslib/tslib.es6.js").__exportStar(r("./src/cloud/index.ts"), t) }, "./src/network/tunnel.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"), i = r("./src/utils/error.ts"), o = r("./src/externals/public-lib/appserviceSdk.ts"), s = new (function () { function e() { this._running = 0, this._onIdleCallbacks = [] } return Object.defineProperty(e.prototype, "running", { get: function () { return this._running }, enumerable: !0, configurable: !0 }), e.prototype.incrementRunning = function (e) { void 0 === e && (e = 1), this._running += e, this._idleTriggerTimer && clearTimeout(this._idleTriggerTimer) }, e.prototype.decrementRunning = function (e) { var t = this; void 0 === e && (e = 1), this._running -= e, this._running < 0 && (this._running = 0), this._running <= 0 && this._onIdleCallbacks.length && (this._idleTriggerTimer = setTimeout(function () { if (t._idleTriggerTimer = null, t._onIdleCallbacks.length) { var e = t._onIdleCallbacks.shift(); e && e() } }, 50)) }, e.prototype.onceIdle = function (e) { this._running > 0 ? this._onIdleCallbacks.push(e) : e() }, e }()); function a(e, t) { var r = this; if (void 0 === t && (t = {}), t.fireOnIdle && s.running > 0) return new Promise(function (i, o) { s.onceIdle(function () { return n.__awaiter(r, void 0, void 0, function () { var r, s; return n.__generator(this, function (n) { switch (n.label) { case 0: return n.trys.push([0, 2, , 3]), [4, a(e, t)]; case 1: return r = n.sent(), i(r), [3, 3]; case 2: return s = n.sent(), o(s), [3, 3]; case 3: return [2] } }) }) }) }); if (t.onFire) try { t.onFire() } catch (e) { } return new Promise(function (r, a) { s.incrementRunning(), o.getSDK((e.cloud || t.cloud || {}).identifiers).operateWXData({ apiName: e.apiName || "qbase_commapi", reqData: e.data, requestInQueue: !1, success: function (e) { var o = n.__assign({}, e, { data: e.rawData }); if (e.rawData) try { var s = JSON.parse(e.rawData); if (s.baseresponse && 0 !== s.baseresponse.errcode) { var u = new i.CloudSDKError({ errCode: s.baseresponse.errcode, errMsg: s.baseresponse.errmsg }); return void a(u) } o = n.__assign({}, e, { data: s }) } catch (e) { u = new i.CloudSDKError({ errMsg: e && e.toString() }); return void a(u) } else if (t && t.requireDataNotEmpty) { u = new i.CloudSDKError({ errCode: e.errCode, errMsg: "error empty internal server response, " + e.errMsg }); return void a(u) } r(o) }, fail: function (e) { if (e && e.errMsg) if (e.errMsg.includes("invalid scope")) { var t = "invalid scope 没有权限，请先开通云服务"; (e = new Error(t)).errMsg = t, e.operateWXDataFail = !0 } else { t = e.errMsg.replace(/^operateWXData:fail /, ""); (e = new Error(t)).errMsg = t, e.operateWXDataFail = !0 } a(e) }, complete: function () { e.complete && e.complete.apply(null, arguments), s.decrementRunning() } }) }) } t.tunnel = a, t.constructTunnelReq = function (e) { var t = e.cloud; return { apiName: "qbase_commapi", data: { qbase_api_name: e.apiName, qbase_req: e.serializedReqData, qbase_options: { env: e.env }, qbase_meta: t.getMetaData(), cli_req_id: +new Date + "_" + Math.random() }, cloud: t } }, t.getBoundTunnelRequest = function (e) { var t = e.cloud; return function (e) { return a({ apiName: "qbase_commapi", data: { qbase_api_name: e.apiName, qbase_req: e.serializedReqData, qbase_options: { env: e.env }, qbase_meta: t.getMetaData(), cli_req_id: +new Date + "_" + Math.random() }, cloud: t }) } }, t.default = a }, "./src/services/database/api/api.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/api/database.ts"); t.getAPIs = function (e) { return { database: n.default.bind(null, e) } } }, "./src/services/database/api/database.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/api/database/command.ts"), i = r("./src/services/database/api/database/collection.ts"), o = r("./src/services/database/api/database/geo.ts"), s = r("./src/services/database/api/database/date.ts"), a = r("./src/services/database/api/database/regexp.ts"), u = r("./src/services/database/internal/grammar/engine.ts"), c = r("./src/utils/assert.ts"), l = r("./src/services/database/internal/grammar/stringifier/query-condition.ts"), d = r("./src/services/database/internal/grammar/stringifier/update-condition.ts"); function f(e, t) { return new (p(e.identifiers || {}))({ context: e, config: t }) } function _(e) { return e.debug } t.getDatabase = f, t.default = f; var p = function (e) { var t, r; return function () { function f(f) { var p = f.config, h = f.context, g = this; this.identifiers = e, this.config = p || {}, t = { database: this, serviceContext: h, engine: u.getEngine() }, r = i.getCollectionReferenceClass(t), p && p.env && c.assertType(p.env, "string"), this.command = n.commands, this.Geo = o, this.serverDate = s.serverDate, this.RegExp = a.regExp, p && p.hasOwnProperty("debug") && Object.defineProperties(this, { debug: { value: !0 }, QuerySerializer: { enumerable: !1, configurable: !1, get: function () { return function (e) { return _(e.database) ? e.engine.QuerySerializer : void 0 }(t) }, set: function () { } }, UpdateSerializer: { enumerable: !1, configurable: !1, get: function () { return function (e) { return _(e.database) ? e.engine.UpdateSerializer : void 0 }(t) }, set: function () { } }, AggregateSerializer: { enumerable: !1, configurable: !1, get: function () { return function (e) { return _(e.database) ? e.engine.AggregateSerializer : void 0 }(t) }, set: function () { } }, Decoder: { enumerable: !1, configurable: !1, get: function () { return function (e) { return _(e.database) ? e.engine.Decoder : void 0 }(t) }, set: function () { } }, QueryConditionStringifier: { enumerable: !1, configurable: !1, get: function () { return function (e) { return _(e) ? l.QueryConditionStringifier : void 0 }(g) }, set: function () { } }, UpdateConditionStringifier: { enumerable: !1, configurable: !1, get: function () { return function (e) { return _(e) ? d.UpdateConditionStringifier : void 0 }(g) }, set: function () { } } }) } return f.prototype.collection = function (e) { return new r(e) }, f.prototype.toJSON = function () { }, f }() } }, "./src/services/database/api/database/aggregate.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"), i = r("./src/services/database/api/database/helper/symbol.ts"), o = r("./src/hook/invoke.ts"), s = r("./src/utils/msg.ts"), a = r("./src/utils/error.ts"), u = r("./src/utils/report.ts"), c = r("./src/services/database/internal/backend-api/backend-api.ts"), l = r("./src/externals/globals/devtools.ts"), d = r("./src/services/database/internal/grammar/stringifier/index.ts"), f = r("./src/externals/globals/wxconfig.ts"); t.getAggregateClass = function (e) { var t = function () { function e(e) { this._internalType = i.SYMBOL_AGGREGATE_PIPELINE, this._stages = e } return e.prototype.pushStage = function (t, r) { return new e(n.__spread(this._stages, [new _(t, r)])) }, e.prototype.addFields = function (e) { return this.pushStage("addFields", e) }, e.prototype.bucket = function (e) { return this.pushStage("bucket", e) }, e.prototype.bucketAuto = function (e) { return this.pushStage("bucketAuto", e) }, e.prototype.collStats = function (e) { return this.pushStage("collStats", e) }, e.prototype.count = function (e) { return this.pushStage("count", e) }, e.prototype.facet = function (e) { return this.pushStage("facet", e) }, e.prototype.geoNear = function (e) { return this.pushStage("geoNear", e) }, e.prototype.graphLookup = function (e) { return this.pushStage("graphLookup", e) }, e.prototype.group = function (e) { return this.pushStage("group", e) }, e.prototype.indexStats = function () { return this.pushStage("indexStats", {}) }, e.prototype.limit = function (e) { return this.pushStage("limit", e) }, e.prototype.lookup = function (e) { return this.pushStage("lookup", e) }, e.prototype.match = function (e) { return this.pushStage("match", e) }, e.prototype.out = function (e) { return this.pushStage("out", e) }, e.prototype.project = function (e) { return this.pushStage("project", e) }, e.prototype.redact = function (e) { return this.pushStage("redact", e) }, e.prototype.replaceRoot = function (e) { return this.pushStage("replaceRoot", e) }, e.prototype.sample = function (e) { return this.pushStage("sample", e) }, e.prototype.skip = function (e) { return this.pushStage("skip", e) }, e.prototype.sort = function (e) { return this.pushStage("sort", e) }, e.prototype.sortByCount = function (e) { return this.pushStage("sortByCount", e) }, e.prototype.unwind = function (e) { return this.pushStage("unwind", e) }, e.prototype.end = function () { }, e }(), r = (function (e) { function t() { return null !== e && e.apply(this, arguments) || this } n.__extends(t, e), t.prototype.pushStage = function (e, r) { return new t(n.__spread(this._stages, [new _(e, r)])) } }(t), function (t) { function r(e, r) { var n = t.call(this, r) || this; return n._internalType = i.SYMBOL_AGGREGATE, n.collection = e, n } return n.__extends(r, t), r.prototype.pushStage = function (e, t) { return new r(this.collection, n.__spread(this._stages, [new _(e, t)])) }, r.prototype.end = function (t) { var r = this; void 0 === t && (t = {}); var i = "collection.aggregate", _ = { apiStartTime: +new Date }; var p = o.hasAPICallback(t), h = new Promise(function (t, o) { return n.__awaiter(r, void 0, void 0, function () { var l, d; return n.__generator(this, function (f) { switch (f.label) { case 0: return f.trys.push([0, 2, 3, 4]), [4, c.runAggregate({ env: e.database.config.env, collectionName: r.collection.collectionName, stages: e.engine.AggregateSerializer.encode(r._stages), instanceContext: e, timing: _ })]; case 1: return l = f.sent(), t({ list: l.list, errMsg: s.apiSuccessMsg(i) }), [3, 4]; case 2: return d = f.sent(), o(a.returnAsFinalCloudSDKError(d, i)), [3, 4]; case 3: return u.reportAPISpeed(n.__assign({}, _, { apiEndTime: +new Date, apiName: "cloud.db." + i })), [7]; case 4: return [2] } }) }) }); if (f.isDevTools() && l.autoDevtoolsNetworkLog(h, function () { return { url: "db.collection.aggregate", headers: { Env: e.serviceContext.env }, reqBody: d.AggregateStringifier.stringify(r), console: e.serviceContext.debug, resultGetter: function (e) { return { _id: e._id } } } }), !p) return h; h.then(function (e) { o.invokeSuccessCompleteCallbacks(i, t, e) }).catch(function (e) { o.invokeFailCompleteCallbacks(i, t, e) }) }, r }(t)), _ = function () { return function (e, t) { this._internalType = i.SYMBOL_AGGREGATE_PIPELINE_STAGE, this.stage = e, this.val = t } }(); return r }, t.isAggregate = function (e) { return e && e._internalType === i.SYMBOL_AGGREGATE }, t.isPipeline = function (e) { return e && e._internalType === i.SYMBOL_AGGREGATE_PIPELINE }, t.isPipelineStage = function (e) { return e && e._internalType === i.SYMBOL_AGGREGATE_PIPELINE_STAGE } }, "./src/services/database/api/database/collection.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"), i = r("./src/services/database/api/database/query.ts"), o = r("./src/services/database/api/database/document.ts"), s = r("./src/services/database/api/database/aggregate.ts"), a = r("./src/hook/invoke.ts"), u = r("./src/services/database/internal/backend-api/backend-api.ts"), c = r("./src/utils/msg.ts"), l = r("./src/utils/error.ts"), d = r("./src/utils/assert.ts"), f = r("./src/utils/report.ts"), _ = r("./src/externals/globals/devtools.ts"), p = r("./src/services/database/internal/grammar/stringifier/index.ts"), h = r("./src/externals/globals/wxconfig.ts"); t.getCollectionReferenceClass = function (e) { var t = i.getQueryClass(e), r = o.getDocumentReferenceClass(e), g = s.getAggregateClass(e); return function (t) { function i(e) { var r = t.call(this, e) || this; return r.collectionName = e, r } return n.__extends(i, t), i.prototype.doc = function (e) { if (null === e || void 0 === e) throw l.returnAsFinalCloudSDKError({ errCode: -1, errMsg: "docId must not be empty" }, "collection.doc"); return new r(this, e) }, i.prototype.add = function (t) { var r = this, i = "collection.add", o = { apiStartTime: +new Date }; var s = a.hasAPICallback(t), g = new Promise(function (s, a) { return n.__awaiter(r, void 0, void 0, function () { var _, p; return n.__generator(this, function (h) { switch (h.label) { case 0: return h.trys.push([0, 2, 3, 4]), d.assertType(t, { data: "object" }), [4, u.addDocument({ env: e.database.config.env, collectionName: r.collectionName, data: e.engine.encodeInternalDataType(t.data), instanceContext: e, timing: o })]; case 1: return _ = h.sent(), s({ _id: _._id, errMsg: c.apiSuccessMsg(i) }), [3, 4]; case 2: return p = h.sent(), a(l.returnAsFinalCloudSDKError(p, i)), [3, 4]; case 3: return f.reportAPISpeed(n.__assign({}, o, { apiEndTime: +new Date, apiName: "cloud.db." + i })), [7]; case 4: return [2] } }) }) }); if (h.isDevTools() && _.autoDevtoolsNetworkLog(g, function () { return { url: "db.collection.add", headers: { Env: e.serviceContext.env }, reqBody: p.CollectionAddStringifier.stringify(r, t.data), console: e.serviceContext.debug, resultGetter: function (e) { return { _id: e._id } } } }), !s) return g; g.then(function (e) { a.invokeSuccessCompleteCallbacks(i, t, e) }).catch(function (e) { a.invokeFailCompleteCallbacks(i, t, e) }) }, i.prototype.aggregate = function () { return new g(this, []) }, i }(t) } }, "./src/services/database/api/database/command.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/api/database/commands/query.ts"), i = r("./src/services/database/api/database/commands/logic.ts"), o = r("./src/services/database/api/database/commands/update.ts"), s = r("./src/services/database/api/database/commands/aggregate.ts"), a = r("./src/utils/type.ts"); t.commands = { eq: function (e) { return new n.QueryCommmand(n.QUERY_COMMANDS_LITERAL.EQ, [e]) }, neq: function (e) { return new n.QueryCommmand(n.QUERY_COMMANDS_LITERAL.NEQ, [e]) }, lt: function (e) { return new n.QueryCommmand(n.QUERY_COMMANDS_LITERAL.LT, [e]) }, lte: function (e) { return new n.QueryCommmand(n.QUERY_COMMANDS_LITERAL.LTE, [e]) }, gt: function (e) { return new n.QueryCommmand(n.QUERY_COMMANDS_LITERAL.GT, [e]) }, gte: function (e) { return new n.QueryCommmand(n.QUERY_COMMANDS_LITERAL.GTE, [e]) }, in: function (e) { return new n.QueryCommmand(n.QUERY_COMMANDS_LITERAL.IN, e) }, nin: function (e) { return new n.QueryCommmand(n.QUERY_COMMANDS_LITERAL.NIN, e) }, geoNear: function (e) { return new n.QueryCommmand(n.QUERY_COMMANDS_LITERAL.GEO_NEAR, [e]) }, geoWithin: function (e) { return new n.QueryCommmand(n.QUERY_COMMANDS_LITERAL.GEO_WITHIN, [e]) }, geoIntersects: function (e) { return new n.QueryCommmand(n.QUERY_COMMANDS_LITERAL.GEO_INTERSECTS, [e]) }, and: function () { for (var e = [], t = 0; t < arguments.length; t++)e[t] = arguments[t]; var r = a.isArray(arguments[0]) ? arguments[0] : Array.from(arguments); return new i.LogicCommmand(i.LOGIC_COMMANDS_LITERAL.AND, r) }, or: function () { for (var e = [], t = 0; t < arguments.length; t++)e[t] = arguments[t]; var r = a.isArray(arguments[0]) ? arguments[0] : Array.from(arguments); return new i.LogicCommmand(i.LOGIC_COMMANDS_LITERAL.OR, r) }, set: function (e) { return new o.UpdateCommand(o.UPDATE_COMMANDS_LITERAL.SET, [e]) }, remove: function () { return new o.UpdateCommand(o.UPDATE_COMMANDS_LITERAL.REMOVE, []) }, inc: function (e) { return new o.UpdateCommand(o.UPDATE_COMMANDS_LITERAL.INC, [e]) }, mul: function (e) { return new o.UpdateCommand(o.UPDATE_COMMANDS_LITERAL.MUL, [e]) }, push: function () { for (var e = [], t = 0; t < arguments.length; t++)e[t] = arguments[t]; var r = a.isArray(arguments[0]) ? arguments[0] : Array.from(arguments); return new o.UpdateCommand(o.UPDATE_COMMANDS_LITERAL.PUSH, r) }, pop: function () { return new o.UpdateCommand(o.UPDATE_COMMANDS_LITERAL.POP, []) }, shift: function () { return new o.UpdateCommand(o.UPDATE_COMMANDS_LITERAL.SHIFT, []) }, unshift: function () { for (var e = [], t = 0; t < arguments.length; t++)e[t] = arguments[t]; var r = a.isArray(arguments[0]) ? arguments[0] : Array.from(arguments); return new o.UpdateCommand(o.UPDATE_COMMANDS_LITERAL.UNSHIFT, r) }, aggregate: { abs: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.ABS, [e]) }, add: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.ADD, [e]) }, addToSet: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.ADDTOSET, [e]) }, allElementsTrue: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.ALLELEMENTSTRUE, [e]) }, and: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.AND, [e]) }, anyElementTrue: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.ANYELEMENTTRUE, [e]) }, arrayElemAt: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.ARRAYELEMAT, [e]) }, arrayToObject: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.ARRAYTOOBJECT, [e]) }, avg: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.AVG, [e]) }, ceil: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.CEIL, [e]) }, cmp: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.CMP, [e]) }, concat: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.CONCAT, [e]) }, concatArrays: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.CONCATARRAYS, [e]) }, cond: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.COND, [e]) }, convert: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.CONVERT, [e]) }, dateFromParts: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.DATEFROMPARTS, [e]) }, dateToParts: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.DATETOPARTS, [e]) }, dateFromString: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.DATEFROMSTRING, [e]) }, dateToString: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.DATETOSTRING, [e]) }, dayOfMonth: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.DAYOFMONTH, [e]) }, dayOfWeek: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.DAYOFWEEK, [e]) }, dayOfYear: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.DAYOFYEAR, [e]) }, divide: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.DIVIDE, [e]) }, eq: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.EQ, [e]) }, exp: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.EXP, [e]) }, filter: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.FILTER, [e]) }, first: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.FIRST, [e]) }, floor: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.FLOOR, [e]) }, gt: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.GT, [e]) }, gte: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.GTE, [e]) }, hour: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.HOUR, [e]) }, ifNull: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.IFNULL, [e]) }, in: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.IN, [e]) }, indexOfArray: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.INDEXOFARRAY, [e]) }, indexOfBytes: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.INDEXOFBYTES, [e]) }, indexOfCP: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.INDEXOFCP, [e]) }, isArray: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.ISARRAY, [e]) }, isoDayOfWeek: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.ISODAYOFWEEK, [e]) }, isoWeek: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.ISOWEEK, [e]) }, isoWeekYear: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.ISOWEEKYEAR, [e]) }, last: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.LAST, [e]) }, let: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.LET, [e]) }, literal: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.LITERAL, [e]) }, ln: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.LN, [e]) }, log: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.LOG, [e]) }, log10: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.LOG10, [e]) }, lt: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.LT, [e]) }, lte: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.LTE, [e]) }, ltrim: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.LTRIM, [e]) }, map: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.MAP, [e]) }, max: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.MAX, [e]) }, mergeObjects: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.MERGEOBJECTS, [e]) }, meta: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.META, [e]) }, min: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.MIN, [e]) }, millisecond: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.MILLISECOND, [e]) }, minute: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.MINUTE, [e]) }, mod: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.MOD, [e]) }, month: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.MONTH, [e]) }, multiply: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.MULTIPLY, [e]) }, neq: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.NEQ, [e]) }, not: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.NOT, [e]) }, objectToArray: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.OBJECTTOARRAY, [e]) }, or: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.OR, [e]) }, pow: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.POW, [e]) }, push: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.PUSH, [e]) }, range: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.RANGE, [e]) }, reduce: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.REDUCE, [e]) }, reverseArray: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.REVERSEARRAY, [e]) }, rtrim: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.RTRIM, [e]) }, second: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SECOND, [e]) }, setDifference: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SETDIFFERENCE, [e]) }, setEquals: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SETEQUALS, [e]) }, setIntersection: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SETINTERSECTION, [e]) }, setIsSubset: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SETISSUBSET, [e]) }, setUnion: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SETUNION, [e]) }, size: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SIZE, [e]) }, slice: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SLICE, [e]) }, split: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SPLIT, [e]) }, sqrt: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SQRT, [e]) }, stdDevPop: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.STDDEVPOP, [e]) }, stdDevSamp: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.STDDEVSAMP, [e]) }, strcasecmp: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.STRCASECMP, [e]) }, strLenBytes: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.STRLENBYTES, [e]) }, strLenCP: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.STRLENCP, [e]) }, substr: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SUBSTR, [e]) }, substrBytes: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SUBSTRBYTES, [e]) }, substrCP: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SUBSTRCP, [e]) }, subtract: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SUBTRACT, [e]) }, sum: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SUM, [e]) }, switch: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SWITCH, [e]) }, toBool: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TOBOOL, [e]) }, toDate: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TODATE, [e]) }, toDecimal: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TODECIMAL, [e]) }, toDouble: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TODOUBLE, [e]) }, toInt: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TOINT, [e]) }, toLong: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TOLONG, [e]) }, toObjectId: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TOOBJECTID, [e]) }, toString: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TOSTRING, [e]) }, toLower: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TOLOWER, [e]) }, toUpper: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TOUPPER, [e]) }, trim: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TRIM, [e]) }, trunc: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TRUNC, [e]) }, type: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TYPE, [e]) }, week: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.WEEK, [e]) }, year: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.YEAR, [e]) }, zip: function (e) { return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.ZIP, [e]) } } }, t.default = t.commands }, "./src/services/database/api/database/commands/aggregate.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n, i = r("./src/services/database/api/database/helper/symbol.ts"); !function (e) { e.ABS = "abs", e.ADD = "add", e.ADDTOSET = "addToSet", e.ALLELEMENTSTRUE = "allElementsTrue", e.AND = "and", e.ANYELEMENTTRUE = "anyElementTrue", e.ARRAYELEMAT = "arrayElemAt", e.ARRAYTOOBJECT = "arrayToObject", e.AVG = "avg", e.CEIL = "ceil", e.CMP = "cmp", e.CONCAT = "concat", e.CONCATARRAYS = "concatArrays", e.COND = "cond", e.CONVERT = "convert", e.DATEFROMPARTS = "dateFromParts", e.DATETOPARTS = "dateToParts", e.DATEFROMSTRING = "dateFromString", e.DATETOSTRING = "dateToString", e.DAYOFMONTH = "dayOfMonth", e.DAYOFWEEK = "dayOfWeek", e.DAYOFYEAR = "dayOfYear", e.DIVIDE = "divide", e.EQ = "eq", e.EXP = "exp", e.FILTER = "filter", e.FIRST = "first", e.FLOOR = "floor", e.GT = "gt", e.GTE = "gte", e.HOUR = "hour", e.IFNULL = "ifNull", e.IN = "in", e.INDEXOFARRAY = "indexOfArray", e.INDEXOFBYTES = "indexOfBytes", e.INDEXOFCP = "indexOfCP", e.ISARRAY = "isArray", e.ISODAYOFWEEK = "isoDayOfWeek", e.ISOWEEK = "isoWeek", e.ISOWEEKYEAR = "isoWeekYear", e.LAST = "last", e.LET = "let", e.LITERAL = "literal", e.LN = "ln", e.LOG = "log", e.LOG10 = "log10", e.LT = "lt", e.LTE = "lte", e.LTRIM = "ltrim", e.MAP = "map", e.MAX = "max", e.MERGEOBJECTS = "mergeObjects", e.META = "meta", e.MIN = "min", e.MILLISECOND = "millisecond", e.MINUTE = "minute", e.MOD = "mod", e.MONTH = "month", e.MULTIPLY = "multiply", e.NEQ = "ne", e.NOT = "not", e.OBJECTTOARRAY = "objectToArray", e.OR = "or", e.POW = "pow", e.PUSH = "push", e.RANGE = "range", e.REDUCE = "reduce", e.REVERSEARRAY = "reverseArray", e.RTRIM = "rtrim", e.SECOND = "second", e.SETDIFFERENCE = "setDifference", e.SETEQUALS = "setEquals", e.SETINTERSECTION = "setIntersection", e.SETISSUBSET = "setIsSubset", e.SETUNION = "setUnion", e.SIZE = "size", e.SLICE = "slice", e.SPLIT = "split", e.SQRT = "sqrt", e.STDDEVPOP = "stdDevPop", e.STDDEVSAMP = "stdDevSamp", e.STRCASECMP = "strcasecmp", e.STRLENBYTES = "strLenBytes", e.STRLENCP = "strLenCP", e.SUBSTR = "substr", e.SUBSTRBYTES = "substrBytes", e.SUBSTRCP = "substrCP", e.SUBTRACT = "subtract", e.SUM = "sum", e.SWITCH = "switch", e.TOBOOL = "toBool", e.TODATE = "toDate", e.TODECIMAL = "toDecimal", e.TODOUBLE = "toDouble", e.TOINT = "toInt", e.TOLONG = "toLong", e.TOOBJECTID = "toObjectId", e.TOSTRING = "toString", e.TOLOWER = "toLower", e.TOUPPER = "toUpper", e.TRIM = "trim", e.TRUNC = "trunc", e.TYPE = "type", e.WEEK = "week", e.YEAR = "year", e.ZIP = "zip" }(n = t.AGGREGATE_COMMANDS_LITERAL || (t.AGGREGATE_COMMANDS_LITERAL = {})), t.ABS = n.ABS, t.ADD = n.ADD, t.ADDTOSET = n.ADDTOSET, t.ALLELEMENTSTRUE = n.ALLELEMENTSTRUE, t.AND = n.AND, t.ANYELEMENTTRUE = n.ANYELEMENTTRUE, t.ARRAYELEMAT = n.ARRAYELEMAT, t.ARRAYTOOBJECT = n.ARRAYTOOBJECT, t.AVG = n.AVG, t.CEIL = n.CEIL, t.CMP = n.CMP, t.CONCAT = n.CONCAT, t.CONCATARRAYS = n.CONCATARRAYS, t.COND = n.COND, t.CONVERT = n.CONVERT, t.DATEFROMPARTS = n.DATEFROMPARTS, t.DATETOPARTS = n.DATETOPARTS, t.DATEFROMSTRING = n.DATEFROMSTRING, t.DATETOSTRING = n.DATETOSTRING, t.DAYOFMONTH = n.DAYOFMONTH, t.DAYOFWEEK = n.DAYOFWEEK, t.DAYOFYEAR = n.DAYOFYEAR, t.DIVIDE = n.DIVIDE, t.EQ = n.EQ, t.EXP = n.EXP, t.FILTER = n.FILTER, t.FIRST = n.FIRST, t.FLOOR = n.FLOOR, t.GT = n.GT, t.GTE = n.GTE, t.HOUR = n.HOUR, t.IFNULL = n.IFNULL, t.IN = n.IN, t.INDEXOFARRAY = n.INDEXOFARRAY, t.INDEXOFBYTES = n.INDEXOFBYTES, t.INDEXOFCP = n.INDEXOFCP, t.ISARRAY = n.ISARRAY, t.ISODAYOFWEEK = n.ISODAYOFWEEK, t.ISOWEEK = n.ISOWEEK, t.ISOWEEKYEAR = n.ISOWEEKYEAR, t.LAST = n.LAST, t.LET = n.LET, t.LITERAL = n.LITERAL, t.LN = n.LN, t.LOG = n.LOG, t.LOG10 = n.LOG10, t.LT = n.LT, t.LTE = n.LTE, t.LTRIM = n.LTRIM, t.MAP = n.MAP, t.MAX = n.MAX, t.MERGEOBJECTS = n.MERGEOBJECTS, t.META = n.META, t.MIN = n.MIN, t.MILLISECOND = n.MILLISECOND, t.MINUTE = n.MINUTE, t.MOD = n.MOD, t.MONTH = n.MONTH, t.MULTIPLY = n.MULTIPLY, t.NEQ = n.NEQ, t.NOT = n.NOT, t.OBJECTTOARRAY = n.OBJECTTOARRAY, t.OR = n.OR, t.POW = n.POW, t.PUSH = n.PUSH, t.RANGE = n.RANGE, t.REDUCE = n.REDUCE, t.REVERSEARRAY = n.REVERSEARRAY, t.RTRIM = n.RTRIM, t.SECOND = n.SECOND, t.SETDIFFERENCE = n.SETDIFFERENCE, t.SETEQUALS = n.SETEQUALS, t.SETINTERSECTION = n.SETINTERSECTION, t.SETISSUBSET = n.SETISSUBSET, t.SETUNION = n.SETUNION, t.SIZE = n.SIZE, t.SLICE = n.SLICE, t.SPLIT = n.SPLIT, t.SQRT = n.SQRT, t.STDDEVPOP = n.STDDEVPOP, t.STDDEVSAMP = n.STDDEVSAMP, t.STRCASECMP = n.STRCASECMP, t.STRLENBYTES = n.STRLENBYTES, t.STRLENCP = n.STRLENCP, t.SUBSTR = n.SUBSTR, t.SUBSTRBYTES = n.SUBSTRBYTES, t.SUBSTRCP = n.SUBSTRCP, t.SUBTRACT = n.SUBTRACT, t.SUM = n.SUM, t.SWITCH = n.SWITCH, t.TOBOOL = n.TOBOOL, t.TODATE = n.TODATE, t.TODECIMAL = n.TODECIMAL, t.TODOUBLE = n.TODOUBLE, t.TOINT = n.TOINT, t.TOLONG = n.TOLONG, t.TOOBJECTID = n.TOOBJECTID, t.TOSTRING = n.TOSTRING, t.TOLOWER = n.TOLOWER, t.TOUPPER = n.TOUPPER, t.TRIM = n.TRIM, t.TRUNC = n.TRUNC, t.TYPE = n.TYPE, t.WEEK = n.WEEK, t.YEAR = n.YEAR, t.ZIP = n.ZIP; var o = function () { function e(e, t, r) { this._internalType = i.SYMBOL_AGGREGATE_COMMAND, Object.defineProperties(this, { _internalType: { enumerable: !1, configurable: !1 } }), this.operator = e, this.operands = t, this.fieldName = r || i.SYMBOL_UNSET_FIELD_NAME } return e.prototype._setFieldName = function (t) { return new e(this.operator, this.operands, t) }, e }(); function s(e) { return e && e instanceof o && e._internalType === i.SYMBOL_AGGREGATE_COMMAND } t.AggregateCommand = o, t.isAggregateCommand = s, t.isKnownAggregateCommand = function (e) { return s(e) && e.operator.toUpperCase() in n }, t.default = o }, "./src/services/database/api/database/commands/logic.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n, i = r("./src/services/database/api/database/helper/symbol.ts"), o = r("./src/utils/assert.ts"), s = r("./src/utils/type.ts"), a = r("./src/services/database/api/database/commands/query.ts"); t.AND = "and", t.OR = "or", t.NOT = "not", t.NOR = "nor", function (e) { e.AND = "and", e.OR = "or", e.NOT = "not", e.NOR = "nor" }(n = t.LOGIC_COMMANDS_LITERAL || (t.LOGIC_COMMANDS_LITERAL = {})); var u = function () { function e(e, t, r) { this._internalType = i.SYMBOL_LOGIC_COMMAND, Object.defineProperties(this, { _internalType: { enumerable: !1, configurable: !1 } }), this.operator = e, this.operands = t; this.fieldName = r || i.SYMBOL_UNSET_FIELD_NAME; if (this.fieldName !== i.SYMBOL_UNSET_FIELD_NAME) { t = t.slice(), this.operands = t; for (var n = 0, o = t.length; n < o; n++) { var s = t[n]; (c(s) || a.isQueryCommand(s)) && (t[n] = s._setFieldName(this.fieldName)) } } } return e.prototype._setFieldName = function (t) { var r = this.operands.map(function (r) { return r instanceof e ? r._setFieldName(t) : r }); return new e(this.operator, r, t) }, e.prototype.and = function () { for (var t = [], r = 0; r < arguments.length; r++)t[r] = arguments[r]; o.assertRequiredParam(arguments[0], "expressions", "and"); var i = s.isArray(arguments[0]) ? arguments[0] : Array.from(arguments); return i.unshift(this), new e(n.AND, i, this.fieldName) }, e.prototype.or = function () { for (var t = [], r = 0; r < arguments.length; r++)t[r] = arguments[r]; o.assertRequiredParam(arguments[0], "expressions", "or"); var i = s.isArray(arguments[0]) ? arguments[0] : Array.from(arguments); return i.unshift(this), new e(n.OR, i, this.fieldName) }, e.prototype.toJSON = function () { }, e }(); function c(e) { return e && e instanceof u && e._internalType === i.SYMBOL_LOGIC_COMMAND } t.LogicCommmand = u, t.isLogicCommand = c, t.isKnownLogicCommand = function (e) { return c(e) && e.operator.toUpperCase() in n }, t.default = u }, "./src/services/database/api/database/commands/query.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n, i = r("./node_modules/tslib/tslib.es6.js"), o = r("./src/services/database/api/database/commands/logic.ts"), s = r("./src/services/database/api/database/helper/symbol.ts"), a = r("./src/utils/assert.ts"); t.EQ = "eq", t.NEQ = "neq", t.GT = "gt", t.GTE = "gte", t.LT = "lt", t.LTE = "lte", t.IN = "in", t.NIN = "nin", t.GEO_NEAR = "nearSphere", t.GEO_WITHIN = "geoWithin", t.GEO_INTERSECTS = "geoIntersects", function (e) { e.EQ = "eq", e.NEQ = "neq", e.GT = "gt", e.GTE = "gte", e.LT = "lt", e.LTE = "lte", e.IN = "in", e.NIN = "nin", e.GEO_NEAR = "geoNear", e.GEO_WITHIN = "geoWithin", e.GEO_INTERSECTS = "geoIntersects" }(n = t.QUERY_COMMANDS_LITERAL || (t.QUERY_COMMANDS_LITERAL = {})); var u = function (e) { function t(t, r, n) { var i = e.call(this, t, r, n) || this; return i.operator = t, i._internalType = s.SYMBOL_QUERY_COMMAND, i } return i.__extends(t, e), t.prototype._setFieldName = function (e) { return new t(this.operator, this.operands, e) }, t.prototype.eq = function (e) { var r = new t(n.EQ, [e], this.fieldName); return this.and(r) }, t.prototype.neq = function (e) { var r = new t(n.NEQ, [e], this.fieldName); return this.and(r) }, t.prototype.gt = function (e) { var r = new t(n.GT, [e], this.fieldName); return this.and(r) }, t.prototype.gte = function (e) { var r = new t(n.GTE, [e], this.fieldName); return this.and(r) }, t.prototype.lt = function (e) { var r = new t(n.LT, [e], this.fieldName); return this.and(r) }, t.prototype.lte = function (e) { var r = new t(n.LTE, [e], this.fieldName); return this.and(r) }, t.prototype.in = function (e) { a.assertType(e, "array"); var r = new t(n.IN, e, this.fieldName); return this.and(r) }, t.prototype.nin = function (e) { a.assertType(e, "array"); var r = new t(n.NIN, e, this.fieldName); return this.and(r) }, t.prototype.geoNear = function (e) { var r = new t(n.GEO_NEAR, [e], this.fieldName); return this.and(r) }, t.prototype.geoWithin = function (e) { var r = new t(n.GEO_WITHIN, [e], this.fieldName); return this.and(r) }, t.prototype.geoIntersects = function (e) { var r = new t(n.GEO_INTERSECTS, [e], this.fieldName); return this.and(r) }, t }(o.LogicCommmand); function c(e) { return e && e instanceof u && e._internalType === s.SYMBOL_QUERY_COMMAND } t.QueryCommmand = u, t.isQueryCommand = c, t.isKnownQueryCommand = function (e) { return c(e) && e.operator.toUpperCase() in n }, t.isComparisonCommand = function (e) { return c(e) }, t.default = u }, "./src/services/database/api/database/commands/update.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n, i = r("./src/services/database/api/database/helper/symbol.ts"); t.SET = "set", t.REMOVE = "remove", t.INC = "inc", t.MUL = "mul", t.PUSH = "push", t.POP = "pop", t.SHIFT = "shift", t.UNSHIFT = "unshift", function (e) { e.SET = "set", e.REMOVE = "remove", e.INC = "inc", e.MUL = "mul", e.PUSH = "push", e.POP = "pop", e.SHIFT = "shift", e.UNSHIFT = "unshift" }(n = t.UPDATE_COMMANDS_LITERAL || (t.UPDATE_COMMANDS_LITERAL = {})); var o = function () { function e(e, t, r) { this._internalType = i.SYMBOL_UPDATE_COMMAND, Object.defineProperties(this, { _internalType: { enumerable: !1, configurable: !1 } }), this.operator = e, this.operands = t, this.fieldName = r || i.SYMBOL_UNSET_FIELD_NAME } return e.prototype._setFieldName = function (t) { return new e(this.operator, this.operands, t) }, e.prototype.toJSON = function () { }, e }(); function s(e) { return e && e instanceof o && e._internalType === i.SYMBOL_UPDATE_COMMAND } t.UpdateCommand = o, t.isUpdateCommand = s, t.isKnownUpdateCommand = function (e) { return s(e) && e.operator.toUpperCase() in n }, t.default = o }, "./src/services/database/api/database/date.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }), r("./node_modules/tslib/tslib.es6.js").__exportStar(r("./src/services/database/api/database/date/serverDate.ts"), t) }, "./src/services/database/api/database/date/serverDate.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/api/database/helper/symbol.ts"), i = r("./src/utils/assert.ts"); t.serverDate = function (e) { return new o(e) }; var o = function () { function e(e) { void 0 === e && (e = { offset: 0 }), i.assertType(e, "object", "serverDate.options"), this.options = e } return Object.defineProperty(e.prototype, "_internalType", { get: function () { return n.SYMBOL_SERVER_DATE }, enumerable: !0, configurable: !0 }), e.prototype.toJSON = function () { return { $date: this.options } }, e }(); t.ServerDate = o }, "./src/services/database/api/database/document.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"), i = r("./src/hook/invoke.ts"), o = r("./src/services/database/internal/backend-api/backend-api.ts"), s = r("./src/utils/msg.ts"), a = r("./src/utils/error.ts"), u = r("./src/services/database/internal/grammar/default/extractor.ts"), c = r("./src/utils/assert.ts"), l = r("./src/utils/report.ts"), d = r("./src/externals/globals/devtools.ts"), f = r("./src/services/database/internal/grammar/stringifier/index.ts"), _ = r("./src/externals/globals/wxconfig.ts"), p = r("./src/config/error.config.ts"), h = r("./src/services/database/api/database/realtime/websocket-client.ts"); t.getDocumentReferenceClass = function (e) { return function () { function t(t, r) { var i = this; if (this.watch = function (t) { return c.assertType(t, { onChange: "function", onError: "function" }), e.serviceContext.ws || (e.serviceContext.ws = new h.RealtimeWebSocketClient({ instanceContext: e })), e.serviceContext.ws.watch(n.__assign({}, t, { envId: e.database.config.env || e.serviceContext.env, collectionName: i.collection.collectionName, query: JSON.stringify({ _id: i._id }), reportAPIName: "cloud.db.document.watch" })) }, this.collection = t, this._id = r, null === r || void 0 === r) throw new a.CloudSDKError({ errCode: p.ERR_CODE.SDK_API_PARAMETER_TYPE_ERROR, errMsg: "docId must not be null or undefined" }); Object.defineProperties(this, { _field: { enumerable: !1, configurable: !1, writable: !0 } }), this._field = {} } return t.prototype.field = function (e) { return c.assertRequiredParam(e, "object", "field"), c.assertType(e, "object", "field"), this._field = e, this }, t.prototype.get = function (t) { var r = this, c = { apiStartTime: +new Date }; var p = i.hasAPICallback(t), h = new Promise(function (t, i) { return n.__awaiter(r, void 0, void 0, function () { var d, f, _; return n.__generator(this, function (p) { switch (p.label) { case 0: return p.trys.push([0, 2, 3, 4]), d = this._id, [4, o.queryDocument({ env: e.database.config.env, collectionName: r.collection.collectionName, query: e.engine.QuerySerializer.encode({ _id: r._id }), options: { projection: u.getProjectionDefinition(r._field) }, instanceContext: e, timing: c })]; case 1: if (!(f = p.sent()).list || !f.list.length) throw new Error("cannot find document with _id " + d + ", please make sure that the document exists and you have the corresponding access permission"); return t({ data: f.list[0], errMsg: s.apiSuccessMsg("document.get") }), [3, 4]; case 2: return _ = p.sent(), i(a.returnAsFinalCloudSDKError(_, "document.get")), [3, 4]; case 3: return l.reportAPISpeed(n.__assign({}, c, { apiEndTime: +new Date, apiName: "cloud.db.document.get" })), [7]; case 4: return [2] } }) }) }); if (_.isDevTools() && d.autoDevtoolsNetworkLog(h, function () { return { url: "db.collection.doc.get", headers: { Env: e.serviceContext.env }, reqBody: f.DocumentGetStringifier.stringify(r), console: e.serviceContext.debug, resultGetter: function (e) { return e.data } } }), !p) return h; h.then(function (e) { i.invokeSuccessCompleteCallbacks("document.get", t, e) }).catch(function (e) { i.invokeFailCompleteCallbacks("document.get", t, e) }) }, t.prototype.set = function (t) { var r = this, u = { apiStartTime: +new Date }; var p = i.hasAPICallback(t), h = new Promise(function (i, d) { return n.__awaiter(r, void 0, void 0, function () { var f, _; return n.__generator(this, function (p) { switch (p.label) { case 0: return p.trys.push([0, 2, 3, 4]), c.assertType(t, { data: "object" }), c.assertObjectNotEmpty({ name: "options.data", target: t.data }), [4, o.setDocument({ env: e.database.config.env, collectionName: r.collection.collectionName, _id: r._id, data: e.engine.encodeInternalDataType(t.data), options: {}, instanceContext: e, timing: u })]; case 1: return f = p.sent(), i({ _id: f._id, errMsg: s.apiSuccessMsg("document.set"), stats: { updated: f.updated, created: f.created } }), [3, 4]; case 2: return _ = p.sent(), d(a.returnAsFinalCloudSDKError(_, "document.set")), [3, 4]; case 3: return l.reportAPISpeed(n.__assign({}, u, { apiEndTime: +new Date, apiName: "cloud.db.document.set" })), [7]; case 4: return [2] } }) }) }); if (_.isDevTools() && d.autoDevtoolsNetworkLog(h, function () { return { url: "db.collection.doc.set", headers: { Env: e.serviceContext.env }, reqBody: f.DocumentSetStringifier.stringify(r, t.data), console: e.serviceContext.debug } }), !p) return h; h.then(function (e) { i.invokeSuccessCompleteCallbacks("document.set", t, e) }).catch(function (e) { i.invokeFailCompleteCallbacks("document.set", t, e) }) }, t.prototype.update = function (t) { var r = this, u = { apiStartTime: +new Date }; var p = i.hasAPICallback(t), h = new Promise(function (i, d) { return n.__awaiter(r, void 0, void 0, function () { var f, _; return n.__generator(this, function (p) { switch (p.label) { case 0: return p.trys.push([0, 2, 3, 4]), c.assertType(t, { data: "object" }), c.assertObjectNotEmpty({ name: "options.data", target: t.data }), [4, o.updateDocument({ env: e.database.config.env, collectionName: r.collection.collectionName, query: e.engine.QuerySerializer.encode({ _id: r._id }), data: e.engine.UpdateSerializer.encode(t.data), options: { multi: !1, merge: !1 }, instanceContext: e, timing: u })]; case 1: return f = p.sent(), i({ stats: { updated: f.updated }, errMsg: s.apiSuccessMsg("document.update") }), [3, 4]; case 2: return _ = p.sent(), d(a.returnAsFinalCloudSDKError(_, "document.update")), [3, 4]; case 3: return l.reportAPISpeed(n.__assign({}, u, { apiEndTime: +new Date, apiName: "cloud.db.document.update" })), [7]; case 4: return [2] } }) }) }); if (_.isDevTools() && d.autoDevtoolsNetworkLog(h, function () { return { url: "db.collection.doc.update", headers: { Env: e.serviceContext.env }, reqBody: f.DocumentUpdateStringifier.stringify(r, t.data), console: e.serviceContext.debug } }), !p) return h; h.then(function (e) { i.invokeSuccessCompleteCallbacks("document.update", t, e) }).catch(function (e) { i.invokeFailCompleteCallbacks("document.update", t, e) }) }, t.prototype.remove = function (t) { var r = this, u = { apiStartTime: +new Date }; var c = i.hasAPICallback(t), p = new Promise(function (t, i) { return n.__awaiter(r, void 0, void 0, function () { var c, d, f; return n.__generator(this, function (_) { switch (_.label) { case 0: return _.trys.push([0, 2, 3, 4]), c = this._id, [4, o.removeDocument({ env: e.database.config.env, collectionName: r.collection.collectionName, query: e.engine.QuerySerializer.encode({ _id: r._id }), options: {}, instanceContext: e, timing: u })]; case 1: if (0 === (d = _.sent()).removed) throw new Error("cannot remove document with _id " + c + ", please make sure that the document exists and you have the corresponding Write permission"); return t({ stats: { removed: d.removed || 0 }, errMsg: s.apiSuccessMsg("document.remove") }), [3, 4]; case 2: return f = _.sent(), i(a.returnAsFinalCloudSDKError(f, "document.remove")), [3, 4]; case 3: return l.reportAPISpeed(n.__assign({}, u, { apiEndTime: +new Date, apiName: "cloud.db.document.remove" })), [7]; case 4: return [2] } }) }) }); if (_.isDevTools() && d.autoDevtoolsNetworkLog(p, function () { return { url: "db.collection.doc.remove", headers: { Env: e.serviceContext.env }, reqBody: f.DocumentRemoveStringifier.stringify(r), console: e.serviceContext.debug } }), !c) return p; p.then(function (e) { i.invokeSuccessCompleteCallbacks("document.remove", t, e) }).catch(function (e) { i.invokeFailCompleteCallbacks("document.remove", t, e) }) }, t.prototype.toJSON = function () { }, t }() } }, "./src/services/database/api/database/geo.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"); n.__exportStar(r("./src/services/database/api/database/geo/point.ts"), t), n.__exportStar(r("./src/services/database/api/database/geo/multipoint.ts"), t), n.__exportStar(r("./src/services/database/api/database/geo/linestring.ts"), t), n.__exportStar(r("./src/services/database/api/database/geo/multilinestring.ts"), t), n.__exportStar(r("./src/services/database/api/database/geo/polygon.ts"), t), n.__exportStar(r("./src/services/database/api/database/geo/multipolygon.ts"), t); t.__safe_props__ = void 0 }, "./src/services/database/api/database/geo/linestring.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/api/database/helper/symbol.ts"), i = r("./src/services/database/api/database/helper/geojson.ts"); t.LineString = function (e) { return i.isGeoJSONLineString(e) ? i.toLineString(e) : new o(e) }; var o = function () { function e(e) { this._internalType = n.SYMBOL_GEO_LINESTRING, Object.defineProperties(this, { _internalType: { enumerable: !1, configurable: !1 } }), this.points = e } return e.prototype.toJSON = function () { return i.toGeoJSONLineString(this) }, e.prototype.toString = function () { return JSON.stringify(this.toJSON()) }, e }(); t.GeoLineString = o }, "./src/services/database/api/database/geo/multilinestring.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/api/database/helper/symbol.ts"), i = r("./src/services/database/api/database/helper/geojson.ts"); t.MultiLineString = function (e) { return i.isGeoJSONMultiLineString(e) ? i.toMultiLineString(e) : new o(e) }; var o = function () { function e(e) { this._internalType = n.SYMBOL_GEO_MULTILINESTRING, Object.defineProperties(this, { _internalType: { enumerable: !1, configurable: !1 } }), this.lines = e } return e.prototype.toJSON = function () { return i.toGeoJSONMultiLineString(this) }, e.prototype.toString = function () { return JSON.stringify(this.toJSON()) }, e }(); t.GeoMultiLineString = o }, "./src/services/database/api/database/geo/multipoint.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/api/database/helper/symbol.ts"), i = r("./src/services/database/api/database/helper/geojson.ts"); t.MultiPoint = function (e) { return i.isGeoJSONMultiPoint(e) ? i.toMultiPoint(e) : new o(e) }; var o = function () { function e(e) { this._internalType = n.SYMBOL_GEO_MULTIPOINT, Object.defineProperties(this, { _internalType: { enumerable: !1, configurable: !1 } }), this.points = e } return e.prototype.toJSON = function () { return i.toGeoJSONMultiPoint(this) }, e.prototype.toString = function () { return JSON.stringify(this.toJSON()) }, e }(); t.GeoMultiPoint = o }, "./src/services/database/api/database/geo/multipolygon.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/api/database/helper/symbol.ts"), i = r("./src/services/database/api/database/helper/geojson.ts"); t.MultiPolygon = function (e) { return i.isGeoJSONMultiPolygon(e) ? i.toMultiPolygon(e) : new o(e) }; var o = function () { function e(e) { this._internalType = n.SYMBOL_GEO_MULTIPOLYGON, Object.defineProperties(this, { _internalType: { enumerable: !1, configurable: !1 } }), this.polygons = e } return e.prototype.toJSON = function () { return i.toGeoJSONMultiPolygon(this) }, e.prototype.toString = function () { return JSON.stringify(this.toJSON()) }, e }(); t.GeoMultiPolygon = o }, "./src/services/database/api/database/geo/point.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/api/database/helper/symbol.ts"), i = r("./src/utils/assert.ts"), o = r("./src/utils/error.ts"), s = r("./src/services/database/api/database/helper/geojson.ts"); t.Point = function (e, t) { return s.isGeoJSONPoint(e) ? s.toPoint(e) : new a(e, t) }; var a = function () { function e(e, t) { this._internalType = n.SYMBOL_GEO_POINT, Object.defineProperties(this, { _internalType: { enumerable: !1, configurable: !1 } }); var r = e, s = t; Object.defineProperties(this, { longitude: { enumerable: !0, configurable: !1, get: function () { return r }, set: function (e) { if (i.assertType(e, "number", "longitude"), e > 180 || e < -180) throw new o.CloudSDKError({ errMsg: "longitude should be a number ranges from -180 to 180" }) } }, latitude: { enumerable: !0, configurable: !1, get: function () { return s }, set: function (e) { if (i.assertType(e, "number", "latitude"), e > 90 || e < -90) throw new o.CloudSDKError({ errMsg: "latitude should be a number ranges from -90 to 90" }) } } }), this.longitude = r, this.latitude = s } return e.prototype.toJSON = function () { return s.toGeoJSONPoint(this) }, e.prototype.toString = function () { return JSON.stringify(this.toJSON()) }, e }(); t.GeoPoint = a }, "./src/services/database/api/database/geo/polygon.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/api/database/helper/symbol.ts"), i = r("./src/services/database/api/database/helper/geojson.ts"); t.Polygon = function (e) { return i.isGeoJSONPolygon(e) ? i.toPolygon(e) : new o(e) }; var o = function () { function e(e) { this._internalType = n.SYMBOL_GEO_POLYGON, Object.defineProperties(this, { _internalType: { enumerable: !1, configurable: !1 } }), this.lines = e } return e.prototype.toJSON = function () { return i.toGeoJSONPolygon(this) }, e.prototype.toString = function () { return JSON.stringify(this.toJSON()) }, e }(); t.GeoPolygon = o }, "./src/services/database/api/database/helper/geojson.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/api/database/geo.ts"), i = r("./src/utils/type.ts"), o = r("./src/utils/error.ts"); function s(e) { return new n.Point(e.coordinates[0], e.coordinates[1]) } function a(e) { return new n.MultiPoint(e.coordinates.map(function (e) { return new n.Point(e[0], e[1]) })) } function u(e) { return new n.LineString(e.coordinates.map(function (e) { return new n.Point(e[0], e[1]) })) } function c(e) { return new n.MultiLineString(e.coordinates.map(function (e) { return new n.LineString(e.map(function (e) { return new n.Point(e[0], e[1]) })) })) } function l(e) { return new n.Polygon(e.coordinates.map(function (e) { return new n.LineString(e.map(function (e) { return new n.Point(e[0], e[1]) })) })) } function d(e) { return new n.MultiPolygon(e.coordinates.map(function (e) { return new n.Polygon(e.map(function (e) { return new n.LineString(e.map(function (e) { return new n.Point(e[0], e[1]) })) })) })) } function f(e) { return i.isArray(e) && i.isNumber(e[0]) && i.isNumber(e[1]) } function _(e) { return i.isArray(e) && e.every(f) } function p(e) { return _(e) } function h(e) { return i.isArray(e) && e.every(p) } function g(e) { return h(e) } function E(e) { return i.isArray(e) && e.every(g) } t.fromGeoJSON = function (e) { switch (e.type) { case "Point": return s(e); case "MultiPoint": return a(e); case "LineString": return u(e); case "MultiLineString": return c(e); case "Polygon": return l(e); case "MultiPolygon": return d(e); default: throw new o.CloudSDKError({ errCode: -1, errMsg: "Invalid GeoJSON input" }) } }, t.toPoint = s, t.toMultiPoint = a, t.toLineString = u, t.toMultiLineString = c, t.toPolygon = l, t.toMultiPolygon = d, t.toGeoJSONPoint = function (e) { return { type: "Point", coordinates: [e.longitude, e.latitude] } }, t.toGeoJSONMultiPoint = function (e) { return { type: "MultiPoint", coordinates: e.points.map(function (e) { return [e.longitude, e.latitude] }) } }, t.toGeoJSONLineString = function (e) { return { type: "LineString", coordinates: e.points.map(function (e) { return [e.longitude, e.latitude] }) } }, t.toGeoJSONMultiLineString = function (e) { return { type: "MultiLineString", coordinates: e.lines.map(function (e) { return e.points.map(function (e) { return [e.longitude, e.latitude] }) }) } }, t.toGeoJSONPolygon = function (e) { return { type: "Polygon", coordinates: e.lines.map(function (e) { return e.points.map(function (e) { return [e.longitude, e.latitude] }) }) } }, t.toGeoJSONMultiPolygon = function (e) { return { type: "MultiPolygon", coordinates: e.polygons.map(function (e) { return e.lines.map(function (e) { return e.points.map(function (e) { return [e.longitude, e.latitude] }) }) }) } }, t.isGeoJSONPoint = function (e) { return i.isObject(e) && f(e.coordinates) }, t.isGeoJSONMultiPoint = function (e) { return i.isObject(e) && _(e.coordinates) }, t.isGeoJSONLineString = function (e) { return i.isObject(e) && p(e.coordinates) }, t.isGeoJSONMultiLineString = function (e) { return i.isObject(e) && h(e.coordinates) }, t.isGeoJSONPolygon = function (e) { return i.isObject(e) && g(e.coordinates) }, t.isGeoJSONMultiPolygon = function (e) { return i.isObject(e) && E(e.coordinates) }, t.isPointCoordinates = f, t.isMultiPointCoordinates = _, t.isLineStringCoordinates = p, t.isMultiLineStringCoordinates = h, t.isPolygonCoordinates = g, t.isMultiPolygonCoordinates = E }, "./src/services/database/api/database/helper/symbol.ts": function (e, t) { Object.defineProperty(t, "__esModule", { value: !0 }), t.SYMBOL_UNSET_FIELD_NAME = Symbol.for("UNSET_FIELD_NAME"), t.SYMBOL_AGGREGATE = Symbol.for("AGGREGATE"), t.SYMBOL_AGGREGATE_PIPELINE = Symbol.for("AGGREGATE_PIPELINE"), t.SYMBOL_AGGREGATE_PIPELINE_STAGE = Symbol.for("AGGREGATE_PIPELINE_STAGE"), t.SYMBOL_UPDATE_COMMAND = Symbol.for("UPDATE_COMMAND"), t.SYMBOL_QUERY_COMMAND = Symbol.for("QUERY_COMMAND"), t.SYMBOL_LOGIC_COMMAND = Symbol.for("LOGIC_COMMAND"), t.SYMBOL_AGGREGATE_COMMAND = Symbol.for("AGGREGATE_COMMAND"), t.SYMBOL_GEO_POINT = Symbol.for("GEO_POINT"), t.SYMBOL_GEO_LINESTRING = Symbol.for("GEO_LINESTRING"), t.SYMBOL_GEO_POLYGON = Symbol.for("GEO_POLYGON"), t.SYMBOL_GEO_MULTIPOINT = Symbol.for("GEO_MULTIPOINT"), t.SYMBOL_GEO_MULTILINESTRING = Symbol.for("GEO_MULTILINESTRING"), t.SYMBOL_GEO_MULTIPOLYGON = Symbol.for("GEO_MULTIPOLYGON"), t.SYMBOL_SERVER_DATE = Symbol.for("SERVER_DATE"), t.SYMBOL_REGEXP = Symbol.for("REGEXP") }, "./src/services/database/api/database/query.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"), i = r("./src/utils/msg.ts"), o = r("./src/services/database/internal/grammar/default/extractor.ts"), s = r("./src/services/database/internal/grammar/stringifier/index.ts"), a = r("./src/utils/assert.ts"), u = r("./src/services/database/internal/backend-api/backend-api.ts"), c = r("./src/hook/invoke.ts"), l = r("./src/utils/error.ts"), d = r("./src/utils/report.ts"), f = r("./src/services/database/api/database/command.ts"), _ = r("./src/externals/globals/devtools.ts"), p = r("./src/externals/globals/wxconfig.ts"), h = r("./src/services/database/api/database/realtime/websocket-client.ts"), g = r("./src/config/error.config.ts"); !function (e) { e.ASC = "asc", e.DESC = "desc" }(t.ORDER_DIRECTION || (t.ORDER_DIRECTION = {})), t.getQueryClass = function (e) { var t = function () { function t(t, i) { var o = this; if (this.watch = function (t) { return a.assertType(t, { onChange: "function", onError: "function" }), e.serviceContext.ws || (e.serviceContext.ws = new h.RealtimeWebSocketClient({ instanceContext: e })), e.serviceContext.ws.watch(n.__assign({}, t, { envId: e.database.config.env || e.serviceContext.env, collectionName: o.collectionName, query: JSON.stringify(e.engine.QuerySerializer.encode(o._query.where || {})), reportAPIName: "cloud.db.collection.watch" })) }, !t) throw new l.CloudSDKError({ errCode: g.ERR_CODE.SDK_API_PARAMETER_TYPE_ERROR, errMsg: "collectionName must be provided" }); this.collectionName = t, this._query = new r(i), Object.defineProperties(this, { _field: { enumerable: !1, configurable: !1, writable: !0 } }), this._field = i && i.field || {} } return t.prototype.field = function (e) { return a.assertRequiredParam(e, "object", "field"), new t(this.collectionName, n.__assign({}, this._query.getProperties(), { field: e })) }, t.prototype.where = function (e) { return a.assertRequiredParam(e, "condition", "where"), this._query.where ? new t(this.collectionName, n.__assign({}, this._query.getProperties(), { where: f.commands.and(this._query.where, e) })) : new t(this.collectionName, n.__assign({}, this._query.getProperties(), { where: e })) }, t.prototype.orderBy = function (e, r) { return a.assertRequiredParam(e, "fieldPath", "orderBy"), a.assertRequiredParam(r, "order", "orderBy"), new t(this.collectionName, n.__assign({}, this._query.getProperties(), { order: n.__spread(this._query.order || [], [{ fieldPath: e, order: r }]) })) }, t.prototype.limit = function (e) { return a.assertRequiredParam(e, "max", "limit"), new t(this.collectionName, n.__assign({}, this._query.getProperties(), { limit: e })) }, t.prototype.skip = function (e) { return a.assertRequiredParam(e, "offset", "skip"), new t(this.collectionName, n.__assign({}, this._query.getProperties(), { offset: e })) }, t.prototype.get = function (t) { var r = this, a = "collection.get", f = { apiStartTime: +new Date }; var h = c.hasAPICallback(t), g = new Promise(function (t, s) { return n.__awaiter(r, void 0, void 0, function () { var c, _; return n.__generator(this, function (p) { switch (p.label) { case 0: return p.trys.push([0, 2, 3, 4]), [4, u.queryDocument({ env: e.database.config.env, collectionName: r.collectionName, query: e.engine.QuerySerializer.encode(r._query.where || {}), options: o.extractQueryOptions(r), instanceContext: e, timing: f })]; case 1: return c = p.sent(), t({ data: c.list, errMsg: i.apiSuccessMsg(a) }), [3, 4]; case 2: return _ = p.sent(), s(l.returnAsFinalCloudSDKError(_, a)), [3, 4]; case 3: return d.reportAPISpeed(n.__assign({}, f, { apiEndTime: +new Date, apiName: "cloud.db." + a })), [7]; case 4: return [2] } }) }) }); if (p.isDevTools() && _.autoDevtoolsNetworkLog(g, function () { return { url: "db.collection.where.get", headers: { Env: e.serviceContext.env }, reqBody: s.QueryGetStringifier.stringify(r), console: e.serviceContext.debug, resultGetter: function (e) { return e.data } } }), !h) return g; g.then(function (e) { c.invokeSuccessCompleteCallbacks(a, t, e) }).catch(function (e) { c.invokeFailCompleteCallbacks(a, t, e) }) }, t.prototype.update = function (e) { throw new l.CloudSDKError({ errCode: -1, errMsg: "query.update is only available in server SDK / API" }) }, t.prototype.remove = function (e) { throw new l.CloudSDKError({ errCode: -1, errMsg: "query.remove is only available in server SDK / API" }) }, t.prototype.count = function (t) { var r = this, o = "collection.count", a = { apiStartTime: +new Date }; var f = c.hasAPICallback(t), h = new Promise(function (t, s) { return n.__awaiter(r, void 0, void 0, function () { var c, f; return n.__generator(this, function (_) { switch (_.label) { case 0: return _.trys.push([0, 2, 3, 4]), [4, u.countDocument({ env: e.database.config.env, collectionName: r.collectionName, query: e.engine.QuerySerializer.encode(r._query.where || {}), instanceContext: e, timing: a })]; case 1: return c = _.sent(), t({ total: c.total, errMsg: i.apiSuccessMsg(o) }), [3, 4]; case 2: return f = _.sent(), s(l.returnAsFinalCloudSDKError(f, o)), [3, 4]; case 3: return d.reportAPISpeed(n.__assign({}, a, { apiEndTime: +new Date, apiName: "cloud.db." + o })), [7]; case 4: return [2] } }) }) }); if (p.isDevTools() && _.autoDevtoolsNetworkLog(h, function () { return { url: "db.collection.where.count", headers: { Env: e.serviceContext.env }, reqBody: s.QueryCountStringifier.stringify(r), console: e.serviceContext.debug } }), !f) return h; h.then(function (e) { c.invokeSuccessCompleteCallbacks(o, t, e) }).catch(function (e) { c.invokeFailCompleteCallbacks(o, t, e) }) }, t.prototype.toJSON = function () { }, t }(), r = function () { function e(e) { this.where = e && e.where, this.offset = e && e.offset, this.limit = e && e.limit, this.order = e && e.order, this.field = e && e.field } return e.prototype.getProperties = function () { return { where: this.where, offset: this.offset, limit: this.limit, order: this.order, field: this.field } }, e }(); return t } }, "./src/services/database/api/database/realtime/error.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"), i = function (e) { function t(t) { var r = e.call(this, "Watch Error " + JSON.stringify(t.msgData) + " (requestid: " + t.requestId + ")") || this; return r.isRealtimeErrorMessageError = !0, r.payload = t, r } return n.__extends(t, e), t }(Error); t.RealtimeErrorMessageError = i, t.isRealtimeErrorMessageError = function (e) { return e && e.isRealtimeErrorMessageError } }, "./src/services/database/api/database/realtime/listener.ts": function (e, t) { Object.defineProperty(t, "__esModule", { value: !0 }); var r = function () { return function (e) { this.close = e.close, this.onChange = e.onChange, this.onError = e.onError, e.debug && Object.defineProperty(this, "virtualClient", { get: function () { return e.virtualClient } }) } }(); t.RealtimeListener = r }, "./src/services/database/api/database/realtime/message.ts": function (e, t) { Object.defineProperty(t, "__esModule", { value: !0 }), t.genRequestId = function (e) { return void 0 === e && (e = ""), (e ? e + "_" : "") + +new Date + "_" + Math.random() }, t.isInitEventMessage = function (e) { return "INIT_EVENT" === e.msgType } }, "./src/services/database/api/database/realtime/snapshot.ts": function (e, t) { Object.defineProperty(t, "__esModule", { value: !0 }); var r = function () { return function (e) { var t, r, n = e.id, i = e.docChanges, o = e.docs, s = e.type, a = e.EJSON; Object.defineProperties(this, { id: { get: function () { return n }, enumerable: !0 }, docChanges: { get: function () { return t || (t = a.parse(JSON.stringify(i))), t }, enumerable: !0 }, docs: { get: function () { return r || (r = a.parse(JSON.stringify(o))), r }, enumerable: !0 }, type: { get: function () { return s }, enumerable: !0 } }) } }(); t.Snapshot = r }, "./src/services/database/api/database/realtime/virtual-websocket-client.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n, i = r("./node_modules/tslib/tslib.es6.js"), o = r("./node_modules/lodash-es/set.js"), s = r("./node_modules/lodash-es/unset.js"), a = r("./node_modules/lodash-es/cloneDeep.js"), u = r("./src/services/database/api/database/realtime/message.ts"), c = r("./src/utils/error.ts"), l = r("./src/config/error.config.ts"), d = r("./src/utils/utils.ts"), f = r("./src/externals/public-lib/reporter.ts"), _ = r("./src/utils/report.ts"), p = r("./src/config/report.config.ts"), h = r("./src/services/database/api/database/realtime/listener.ts"), g = r("./src/services/database/api/database/realtime/snapshot.ts"), E = r("./src/services/database/api/database/realtime/error.ts"); !function (e) { e.LOGGINGIN = "LOGGINGIN", e.INITING = "INITING", e.REBUILDING = "REBUILDING", e.ACTIVE = "ACTIVE", e.ERRORED = "ERRORED", e.CLOSING = "CLOSING", e.CLOSED = "CLOSED", e.PAUSED = "PAUSED", e.RESUMING = "RESUMING" }(n || (n = {})); var m = 100, b = 2, y = 2, S = 1e4, v = 1e4, T = 1e4, A = function () { function e(e) { var t = this; this.watchStatus = n.INITING, this._snapshotHistory = [], this._login = function (e, r) { return i.__awaiter(t, void 0, void 0, function () { var t; return i.__generator(this, function (i) { switch (i.label) { case 0: return this.watchStatus = n.LOGGINGIN, [4, this.login(e, r, this.timing)]; case 1: return t = i.sent(), this.envId || (this.envId = t.envId), [2, t] } }) }) }, this.initWatch = function (e) { return i.__awaiter(t, void 0, void 0, function () { var t, r, o, s, a = this; return i.__generator(this, function (c) { switch (c.label) { case 0: if (this._initWatchPromise) return [2, this._initWatchPromise]; t = Date.now(), r = !1, o = this._initWatchPromise = new Promise(function (t, o) { return i.__awaiter(a, void 0, void 0, function () { var s, a, c, l, d, h, E, m, y, S, T, A, O, N = this; return i.__generator(this, function (I) { switch (I.label) { case 0: s = u.genRequestId(), I.label = 1; case 1: return I.trys.push([1, 4, , 5]), this.watchStatus === n.PAUSED ? [2, t()] : [4, this._login(this.envId, e)]; case 2: return a = I.sent().envId, this.watchStatus === n.PAUSED ? [2, t()] : (this.watchStatus = n.INITING, c = { watchId: this.watchId, requestId: s, msgType: "INIT_WATCH", msgData: { envId: a, collName: this.collectionName, query: this.query } }, [4, this.send({ msg: c, waitResponse: !0, skipOnMessage: !0, timeout: v })]); case 3: if (l = I.sent(), d = l.msgData, h = d.events, E = d.currEvent, this.sessionInfo = { queryID: l.msgData.queryID, currentEventId: E - 1, currentDocs: [] }, h.length > 0) { try { for (m = i.__values(h), y = m.next(); !y.done; y = m.next())y.value.ID = E } catch (e) { A = { error: e } } finally { try { y && !y.done && (O = m.return) && O.call(m) } finally { if (A) throw A.error } } this.handleServerEvents(l) } else this.sessionInfo.currentEventId = E, S = new g.Snapshot({ id: E, docChanges: [], docs: [], type: "init", EJSON: this.getEJSON() }), f.default.surroundThirdByTryCatch(function () { return N.listener.onChange(S) })(), this.scheduleSendACK(), this.debug && this._snapshotHistory.push(S); return this.onWatchStart(this, this.sessionInfo.queryID), this.watchStatus = n.ACTIVE, this._availableRetries.INIT_WATCH = b, r = !0, t(), _.reportIDKey(p.ErrorID, p.ErrorKey.REALTIME_DB_INIT_WATCH_SUCCESS, !0), [3, 5]; case 4: return T = I.sent(), this.handleWatchEstablishmentError(T, { operationName: "INIT_WATCH", requestId: s, resolve: t, reject: o }), [3, 5]; case 5: return [2] } }) }) }), s = !1, c.label = 1; case 1: return c.trys.push([1, , 3, 4]), [4, o]; case 2: return c.sent(), s = !0, [3, 4]; case 3: return o === this._initWatchPromise && (r ? _.reportAPISpeed({ apiName: "_realtime.initWatch(success)", apiStartTime: t, apiEndTime: Date.now() }) : s || _.reportAPISpeed({ apiName: "_realtime.initWatch(fail)", apiStartTime: t, apiEndTime: Date.now() })), this._initWatchPromise = void 0, [7]; case 4: return [2] } }) }) }, this.rebuildWatch = function (e) { return i.__awaiter(t, void 0, void 0, function () { var t, r, o, s, a = this; return i.__generator(this, function (c) { switch (c.label) { case 0: if (this._rebuildWatchPromise) return [2, this._rebuildWatchPromise]; t = Date.now(), r = !1, o = this._rebuildWatchPromise = new Promise(function (t, o) { return i.__awaiter(a, void 0, void 0, function () { var s, a, c, l, d; return i.__generator(this, function (i) { switch (i.label) { case 0: s = u.genRequestId(), i.label = 1; case 1: return i.trys.push([1, 5, , 6]), this.watchStatus === n.PAUSED ? [2, t()] : [4, this._login(this.envId, e)]; case 2: if (a = i.sent().envId, !this.sessionInfo) throw new Error("can not rebuildWatch without a successful initWatch (lack of sessionInfo)"); return this.watchStatus === n.PAUSED ? [2, t()] : (this.watchStatus = n.REBUILDING, c = { watchId: this.watchId, requestId: s, msgType: "REBUILD_WATCH", msgData: { envId: a, collName: this.collectionName, queryID: this.sessionInfo.queryID, eventID: this.sessionInfo.currentEventId } }, [4, this.send({ msg: c, waitResponse: !0, skipOnMessage: !0, timeout: T })]); case 3: return l = i.sent(), [4, this.handleServerEvents(l)]; case 4: return i.sent(), this.watchStatus = n.ACTIVE, this._availableRetries.REBUILD_WATCH = b, r = !0, t(), _.reportIDKey(p.ErrorID, p.ErrorKey.REALTIME_DB_REBUILD_WATCH_SUCCESS, !0), [3, 6]; case 5: return d = i.sent(), this.handleWatchEstablishmentError(d, { operationName: "REBUILD_WATCH", requestId: s, resolve: t, reject: o }), [3, 6]; case 6: return [2] } }) }) }), s = !1, c.label = 1; case 1: return c.trys.push([1, , 3, 4]), [4, o]; case 2: return c.sent(), s = !0, [3, 4]; case 3: return o === this._initWatchPromise && (r ? _.reportAPISpeed({ apiName: "_realtime.rebuildWatch(success)", apiStartTime: t, apiEndTime: Date.now() }) : s || _.reportAPISpeed({ apiName: "_realtime.rebuildWatch(fail)", apiStartTime: t, apiEndTime: Date.now() })), this._rebuildWatchPromise = void 0, [7]; case 4: return [2] } }) }) }, this.handleWatchEstablishmentError = function (e, r) { return i.__awaiter(t, void 0, void 0, function () { var t, o, s, a = this; return i.__generator(this, function (u) { return t = "INIT_WATCH" === r.operationName, o = function (n) { var i = (n || e) + " (" + (t ? "initWatch" : "rebuildWatch") + " requestId " + r.requestId + ")"; a.closeWithError(new c.CloudSDKError({ errCode: t ? l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL : l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL, errMsg: i })), r.reject(i), _.reportIDKey(p.ErrorID, t ? p.ErrorKey.REALTIME_DB_INIT_WATCH_FAIL : p.ErrorKey.REALTIME_DB_REBUILD_WATCH_FAIL, !0) }, s = function (e, n) { a.useRetryTicket(r.operationName) ? t ? (a._initWatchPromise = void 0, r.resolve(a.initWatch(e))) : (a._rebuildWatchPromise = void 0, r.resolve(a.rebuildWatch(e))) : o() }, this.handleCommonError(e, { onSignError: function () { return s(!0, "sign error") }, onTimeoutError: function (e) { e.payload && "totalConnectionTimeout" === e.payload.subtype ? o(e) : s(!1, "timeout") }, onNotRetryableError: o, onCancelledError: r.reject, onUnknownError: function (e) { return i.__awaiter(a, void 0, void 0, function () { var t, a, u = this; return i.__generator(this, function (l) { switch (l.label) { case 0: return l.trys.push([0, 8, , 9]), t = function () { return i.__awaiter(u, void 0, void 0, function () { return i.__generator(this, function (e) { switch (e.label) { case 0: return this.pause(), [4, this.onceWSConnected()]; case 1: return e.sent(), s(!0, "ws reconnected"), [2] } }) }) }, this.isWSConnected() ? [3, 2] : [4, t()]; case 1: return l.sent(), [3, 7]; case 2: return [4, d.sleep(m)]; case 3: return l.sent(), this.watchStatus !== n.PAUSED ? [3, 4] : (r.reject(new c.CancelledError(r.operationName + " cancelled due to pause after unknownError")), [3, 7]); case 4: return this.isWSConnected() ? [3, 6] : [4, t()]; case 5: return l.sent(), [3, 7]; case 6: s(!1, "unknown error " + e), l.label = 7; case 7: return [3, 9]; case 8: return a = l.sent(), c.isTimeoutError(a) && "totalConnectionTimeout" === a.payload.subtype ? o(a) : s(!0, "error whiling processing unknown error: " + a), [3, 9]; case 9: return [2] } }) }) } }), [2] }) }) }, this.closeWatch = function () { return i.__awaiter(t, void 0, void 0, function () { var e, t, r; return i.__generator(this, function (i) { switch (i.label) { case 0: switch (e = this.sessionInfo ? this.sessionInfo.queryID : "", this.watchStatus) { case n.ACTIVE: break; case n.CLOSED: case n.CLOSING: case n.ERRORED: return [2]; default: return this.watchStatus = n.CLOSED, this.onWatchClose(this, e), [2] }i.label = 1; case 1: return i.trys.push([1, 3, 4, 5]), this.watchStatus = n.CLOSING, t = { watchId: this.watchId, requestId: u.genRequestId(), msgType: "CLOSE_WATCH", msgData: null }, [4, this.send({ msg: t })]; case 2: return i.sent(), this.sessionInfo = void 0, this.watchStatus = n.CLOSED, [3, 5]; case 3: return r = i.sent(), this.closeWithError(new c.CloudSDKError({ errCode: l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL, errMsg: r }), !1), [3, 5]; case 4: return this.onWatchClose(this, e), [7]; case 5: return [2] } }) }) }, this.scheduleSendACK = function () { t.clearACKSchedule(), t._ackTimeoutId = setTimeout(function () { t._waitExpectedTimeoutId ? t.scheduleSendACK() : t.sendACK() }, S) }, this.clearACKSchedule = function () { t._ackTimeoutId && clearTimeout(t._ackTimeoutId) }, this.sendACK = function () { return i.__awaiter(t, void 0, void 0, function () { var e, t, r; return i.__generator(this, function (i) { switch (i.label) { case 0: return i.trys.push([0, 2, , 3]), this.watchStatus !== n.ACTIVE ? (this.scheduleSendACK(), [2]) : this.sessionInfo ? (e = { watchId: this.watchId, requestId: u.genRequestId(), msgType: "CHECK_LAST", msgData: { queryID: this.sessionInfo.queryID, eventID: this.sessionInfo.currentEventId } }, [4, this.send({ msg: e })]) : (console.warn("[realtime listener] can not send ack without a successful initWatch (lack of sessionInfo)"), [2]); case 1: return i.sent(), this.scheduleSendACK(), [3, 3]; case 2: if (t = i.sent(), E.isRealtimeErrorMessageError(t)) switch ((r = t.payload).msgData.code) { case "CHECK_LOGIN_FAILED": case "SIGN_EXPIRED_ERROR": case "SIGN_INVALID_ERROR": case "SIGN_PARAM_INVALID": return this.rebuildWatch(), [2]; case "QUERYID_INVALID_ERROR": case "SYS_ERR": case "INVALIID_ENV": case "COLLECTION_PERMISSION_DENIED": return this.closeWithError(new c.CloudSDKError({ errCode: l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL, errMsg: r.msgData.code })), [2] }return this._availableRetries.CHECK_LAST && this._availableRetries.CHECK_LAST > 0 ? (this._availableRetries.CHECK_LAST-- , this.scheduleSendACK()) : this.closeWithError(new c.CloudSDKError({ errCode: l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL, errMsg: t })), [3, 3]; case 3: return [2] } }) }) }, this.handleCommonError = function (e, t) { if (E.isRealtimeErrorMessageError(e)) { switch (e.payload.msgData.code) { case "CHECK_LOGIN_FAILED": case "SIGN_EXPIRED_ERROR": case "SIGN_INVALID_ERROR": case "SIGN_PARAM_INVALID": return void t.onSignError(e); case "QUERYID_INVALID_ERROR": case "SYS_ERR": case "INVALIID_ENV": case "COLLECTION_PERMISSION_DENIED": default: return void t.onNotRetryableError(e) } } else { if (c.isTimeoutError(e)) return void t.onTimeoutError(e); if (c.isCancelledError(e)) return void t.onCancelledError(e) } t.onUnknownError(e) }, this.watchId = "watchid_" + +new Date + "_" + Math.random(), this.envId = e.envId, this.collectionName = e.collectionName, this.query = e.query, this.send = e.send, this.login = e.login, this.isWSConnected = e.isWSConnected, this.onceWSConnected = e.onceWSConnected, this.getWaitExpectedTimeoutLength = e.getWaitExpectedTimeoutLength, this.getEJSON = e.getEJSON, this.onWatchStart = e.onWatchStart, this.onWatchClose = e.onWatchClose, this.timing = e.timing, this.debug = e.debug, this._availableRetries = { INIT_WATCH: b, REBUILD_WATCH: b, CHECK_LAST: y }, this.listener = new h.RealtimeListener({ close: this.closeWatch, onChange: e.onChange, onError: e.onError, debug: this.debug, virtualClient: this }), this.initWatch().catch(function (e) { 0 }) } return e.prototype.useRetryTicket = function (e) { return !!(this._availableRetries[e] && this._availableRetries[e] > 0) && (this._availableRetries[e]-- , !0) }, e.prototype.handleServerEvents = function (e) { return i.__awaiter(this, void 0, void 0, function () { var t; return i.__generator(this, function (r) { switch (r.label) { case 0: return r.trys.push([0, 2, , 3]), this.scheduleSendACK(), [4, this._handleServerEvents(e)]; case 1: return r.sent(), this._postHandleServerEventsValidityCheck(e), [3, 3]; case 2: throw t = r.sent(), _.reportIDKey(p.ErrorID, p.ErrorKey.REALTIME_DB_HANDLE_EVENT_ERROR, !0), t; case 3: return [2] } }) }) }, e.prototype._handleServerEvents = function (e) { return i.__awaiter(this, void 0, void 0, function () { var t, r, n, u, d, h, E, m, b, y, S, v = this; return i.__generator(this, function (T) { switch (T.label) { case 0: if (t = e.requestId, !(r = e.msgData.events).length || !this.sessionInfo) return [2]; n = this.sessionInfo; try { u = r.map(O) } catch (e) { return this.closeWithError(new c.CloudSDKError({ errCode: l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA, errMsg: e })), [2] } d = i.__spread(n.currentDocs), h = !1, E = function (r, E) { var b, y, S, T, A, O, N, I, C, R, w, D, M; return i.__generator(this, function (L) { switch (L.label) { case 0: return b = u[r], n.currentEventId >= b.id ? (!u[r - 1] || b.id > u[r - 1].id ? _.reportIDKey(p.ErrorID, p.ErrorKey.REALTIME_DB_RECV_DUPLICATE_EVENT, !0) : (console.error("[realtime listener] server non-fatal error: events out of order (the latter event's id is smaller than that of the former) (requestId " + t + ")"), _.reportIDKey(p.ErrorID, p.ErrorKey.REALTIME_DB_RECV_DUPLICATE_EVENT_AND_EVENT_OUT_OF_ORDER, !0)), [2, "continue"]) : [3, 1]; case 1: if (n.currentEventId !== b.id - 1) return [3, 2]; switch (b.dataType) { case "update": if (!b.doc) switch (b.queueType) { case "update": case "dequeue": if (y = d.find(function (e) { return e._id === b.docId })) { if (N = a.default(y), b.updatedFields) for (A in b.updatedFields) o.default(N, A, b.updatedFields[A]); if (b.removedFields) try { for (D = void 0, S = i.__values(b.removedFields), T = S.next(); !T.done; T = S.next())A = T.value, s.default(N, A) } catch (e) { D = { error: e } } finally { try { T && !T.done && (M = S.return) && M.call(S) } finally { if (D) throw D.error } } b.doc = N } else console.error("[realtime listener] internal non-fatal server error: unexpected update dataType event where no doc is associated."), _.reportIDKey(p.ErrorID, p.ErrorKey.REALTIME_DB_UNEXPECTED_EVENT_DATATYPE_UPDATE_NO_ASSOCIATED_DOC, !0); break; case "enqueue": throw O = new c.CloudSDKError({ errCode: l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR, errMsg: 'HandleServerEvents: full doc is not provided with dataType="update" and queueType="enqueue" (requestId ' + e.requestId + ")" }), m.closeWithError(O), O }break; case "replace": if (!b.doc) throw O = new c.CloudSDKError({ errCode: l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR, errMsg: 'HandleServerEvents: full doc is not provided with dataType="replace" (requestId ' + e.requestId + ")" }), m.closeWithError(O), O; break; case "remove": (N = d.find(function (e) { return e._id === b.docId })) ? b.doc = N : (console.error("[realtime listener] internal non-fatal server error: unexpected remove event where no doc is associated."), _.reportIDKey(p.ErrorID, p.ErrorKey.REALTIME_DB_UNEXPECTED_EVENT_REMOVE_NO_ASSOCIATED_DOC, !0)) }switch (b.queueType) { case "init": h ? d.push(b.doc) : (h = !0, d = [b.doc]); break; case "enqueue": d.push(b.doc); break; case "dequeue": (I = d.findIndex(function (e) { return e._id === b.docId })) > -1 ? d.splice(I, 1) : (console.error("[realtime listener] internal non-fatal server error: unexpected dequeue event where no doc is associated."), _.reportIDKey(p.ErrorID, p.ErrorKey.REALTIME_DB_UNEXPECTED_EVENT_DEQUEUE_NO_ASSOCIATED_DOC, !0)); break; case "update": (I = d.findIndex(function (e) { return e._id === b.docId })) > -1 ? d[I] = b.doc : (console.error("[realtime listener] internal non-fatal server error: unexpected queueType update event where no doc is associated."), _.reportIDKey(p.ErrorID, p.ErrorKey.REALTIME_DB_UNEXPECTED_EVENT_QUEUETYPE_UPDATE_NO_ASSOCIATED_DOC, !0)) }return (r === E - 1 || u[r + 1] && u[r + 1].id !== b.id) && (C = i.__spread(d), R = u.slice(0, r + 1).filter(function (e) { return e.id === b.id }), m.sessionInfo.currentEventId = b.id, m.sessionInfo.currentDocs = d, w = new g.Snapshot({ id: b.id, docChanges: R, docs: C, EJSON: m.getEJSON() }), f.default.surroundThirdByTryCatch(function () { return v.listener.onChange(w) })(), m.debug && m._snapshotHistory.push(w)), [3, 4]; case 2: return _.reportIDKey(p.ErrorID, p.ErrorKey.REALTIME_DB_EVENT_OUT_OF_ORDER, !0), [4, m.rebuildWatch()]; case 3: return L.sent(), [2, { value: void 0 }]; case 4: return [2] } }) }, m = this, b = 0, y = u.length, T.label = 1; case 1: return b < y ? [5, E(b, y)] : [3, 4]; case 2: if ("object" == typeof (S = T.sent())) return [2, S.value]; T.label = 3; case 3: return b++ , [3, 1]; case 4: return [2] } }) }) }, e.prototype._postHandleServerEventsValidityCheck = function (e) { this.sessionInfo ? (this.sessionInfo.expectEventId && this.sessionInfo.currentEventId >= this.sessionInfo.expectEventId && this.clearWaitExpectedEvent(), this.sessionInfo.currentEventId < e.msgData.currEvent && console.warn("[realtime listener] internal non-fatal error: client eventId " + this.sessionInfo.currentEventId + " does not match with server event id after server event handling " + e.msgData.currEvent + " (requestId " + e.requestId + ")")) : console.error("[realtime listener] internal non-fatal error: sessionInfo lost after server event handling, this should never occur. (requestId " + e.requestId + ")") }, e.prototype.clearWaitExpectedEvent = function () { this._waitExpectedTimeoutId && (clearTimeout(this._waitExpectedTimeoutId), this._waitExpectedTimeoutId = void 0) }, e.prototype.onMessage = function (e) { var t = this; switch (this.watchStatus) { case n.PAUSED: if ("ERROR" !== e.msgType) return; break; case n.LOGGINGIN: case n.INITING: case n.REBUILDING: return void console.warn("[realtime listener] internal non-fatal error: unexpected message received while " + this.watchStatus); case n.CLOSED: return void console.warn("[realtime listener] internal non-fatal error: unexpected message received when the watch has closed"); case n.ERRORED: return void console.warn("[realtime listener] internal non-fatal error: unexpected message received when the watch has ended with error") }if (this.sessionInfo) switch (this.scheduleSendACK(), e.msgType) { case "NEXT_EVENT": 0, this.handleServerEvents(e); break; case "CHECK_EVENT": this.sessionInfo.currentEventId < e.msgData.currEvent && (this.sessionInfo.expectEventId = e.msgData.currEvent, this.clearWaitExpectedEvent(), this._waitExpectedTimeoutId = setTimeout(function () { t.rebuildWatch() }, this.getWaitExpectedTimeoutLength())); break; case "ERROR": this.closeWithError(new c.CloudSDKError({ errCode: l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG, errMsg: e.msgData.code + " - " + e.msgData.message })); break; default: 0 } else console.warn("[realtime listener] internal non-fatal error: sessionInfo not found while message is received.") }, Object.defineProperty(e.prototype, "pendingInitWatch", { get: function () { return this._initWatchPromise }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "pendingRebuildWatch", { get: function () { return this._rebuildWatchPromise }, enumerable: !0, configurable: !0 }), e.prototype.closeWithError = function (e, t) { var r = this; void 0 === t && (t = !0), this.watchStatus = n.ERRORED, this.clearACKSchedule(), f.default.surroundThirdByTryCatch(function () { return r.listener.onError(e) })(), this.onWatchClose(this, this.sessionInfo && this.sessionInfo.queryID || ""), t && this.closeWatch() }, e.prototype.pause = function () { this.watchStatus = n.PAUSED }, e.prototype.resume = function () { return i.__awaiter(this, void 0, void 0, function () { return i.__generator(this, function (e) { switch (e.label) { case 0: this.watchStatus = n.RESUMING, e.label = 1; case 1: return e.trys.push([1, 3, , 4]), [4, this.sessionInfo ? this.rebuildWatch() : this.initWatch()]; case 2: return e.sent(), [3, 4]; case 3: return e.sent(), [3, 4]; case 4: return [2] } }) }) }, e }(); function O(e) { var t = { id: e.ID, dataType: e.DataType, queueType: e.QueueType, docId: e.DocID, doc: e.Doc && "{}" !== e.Doc ? JSON.parse(e.Doc) : void 0 }; return "update" === e.DataType && (e.UpdatedFields && (t.updatedFields = JSON.parse(e.UpdatedFields)), (e.removedFields || e.RemovedFields) && (t.removedFields = e.removedFields ? JSON.parse(e.removedFields) : JSON.parse(e.RemovedFields))), t } t.VirtualWebSocketClient = A }, "./src/services/database/api/database/realtime/websocket-client.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"), i = r("./src/externals/public-lib/appserviceSdk.ts"), o = r("./src/services/database/api/database/realtime/virtual-websocket-client.ts"), s = r("./src/utils/utils.ts"), a = r("./src/services/database/internal/backend-api/backend-api.ts"), u = r("./src/services/database/api/database/realtime/message.ts"), c = r("./src/services/database/api/database/realtime/ws-event.ts"), l = r("./src/utils/error.ts"), d = r("./src/services/database/api/database/realtime/error.ts"), f = r("./src/config/error.config.ts"), _ = r("./src/externals/globals/wxconfig.ts"), p = r("./src/utils/report.ts"), h = r("./src/config/report.config.ts"), g = r("./src/utils/report.ts"), E = r("./src/externals/public-lib/reporter.ts"), m = { CONNECTING: 0, OPEN: 1, CLOSING: 2, CLOSED: 3 }, b = 3, y = 5e3, S = 1e4, v = 5e3, T = function () { function e(e) { var t = this; this._virtualWSClient = new Set, this._queryIdClientMap = new Map, this._watchIdClientMap = new Map, this._pingFailed = 0, this._pongMissed = 0, this._logins = new Map, this._signatures = new Map, this._wsReadySubsribers = [], this._wsResponseWait = new Map, this._rttObserved = [], this._closedWatches = new Set, this.initWebSocketConnection = function (e, o) { return void 0 === o && (o = t._maxReconnect), n.__awaiter(t, void 0, void 0, function () { var t, a, u, d = this; return n.__generator(this, function (E) { switch (E.label) { case 0: if (this._EJSON || (t = function () { return n.__awaiter(this, void 0, void 0, function () { var e; return n.__generator(this, function (t) { switch (t.label) { case 0: return e = Promise.resolve().then(function () { return r("./node_modules/bson/dist/bson.browser.esm.js") }), p.wrapTiming(e, { timing: {}, startKey: "apiStartTime", endKey: "apiEndTime", autoReport: "_realtime.importBSON" }), [4, e]; case 1: return [2, t.sent().EJSON] } }) }) }().then(function (e) { return d._EJSON = e })), this._wsInitPromise) return [2, this._wsInitPromise]; 0, this.pauseClients(), this.close(c.CLOSE_EVENT_CODE.ReconnectWebSocket), a = !1, this._wsInitPromise = new Promise(function (r, u) { return n.__awaiter(d, void 0, void 0, function () { var c, d, E, m, b, y = this; return n.__generator(this, function (n) { switch (n.label) { case 0: !this._totalConnectionTimeoutId && this._totalConnectionTimeout && this._totalConnectionTimeout !== 1 / 0 && (c = this._totalConnectionTimeout, this._totalConnectionTimeoutId = setTimeout(function () { a = !0, y._totalConnectionTimeoutId = void 0; var e = new l.TimeoutError("reconnect timedout (reach totalConnectionTimeout " + c + "s)", { subtype: "totalConnectionTimeout" }); u(e), y._virtualWSClient.forEach(function (t) { t.pendingInitWatch || t.pendingRebuildWatch || t.closeWithError(e) }), p.reportIDKey(h.ErrorID, h.ErrorKey.REALTIME_DB_WS_TOTAL_CONNECTION_TIMEOUT, !0) }, 1e3 * c)), n.label = 1; case 1: return n.trys.push([1, 8, , 17]), [4, s.throwErrorIfNetworkOffline()]; case 2: return n.sent(), a ? [2] : [4, this.getSignature()]; case 3: return d = n.sent(), a ? [2] : (E = Date.now(), [4, new Promise(function (e, t) { y._ws = i.getSDK(y._context.identifiers).connectSocket({ url: d.wsUrl, header: { "content-type": "application/json" }, perMessageDeflate: !0, success: function () { return e() }, fail: t }) })]); case 4: return n.sent(), a ? [2] : (g.reportAPISpeed({ apiName: "_realtime.connectSocket", apiStartTime: E, apiEndTime: Date.now() }), [4, this.initWebSocketEvent()]); case 5: return n.sent(), a ? [2] : t ? [4, t] : [3, 7]; case 6: if (n.sent(), a) return [2]; n.label = 7; case 7: return r(), this.resumeClients(), p.reportIDKey(h.ErrorID, e ? h.ErrorKey.REALTIME_DB_RECONNECT_WS_SUCCESS : h.ErrorKey.REALTIME_DB_INIT_WS_SUCCESS, !0), [3, 17]; case 8: return m = n.sent(), o > 0 ? [4, s.getNetworkStatus()] : [3, 15]; case 9: return b = n.sent().isConnected, a ? [2] : b ? [4, s.sleep(this._reconnectInterval)] : [3, 11]; case 10: if (n.sent(), a) return [2]; n.label = 11; case 11: return [4, s.onceNetworkOnline()]; case 12: return n.sent(), a ? [2] : _.isDevTools() ? [4, s.sleep(0)] : [3, 14]; case 13: if (n.sent(), a) return [2]; n.label = 14; case 14: return this._wsInitPromise = void 0, r(this.initWebSocketConnection(e, o - 1)), [3, 16]; case 15: u(m), e && this.closeAllClients(new l.CloudSDKError({ errCode: f.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL, errMsg: m })), p.reportIDKey(h.ErrorID, e ? h.ErrorKey.REALTIME_DB_RECONNECT_WS_FAIL : h.ErrorKey.REALTIME_DB_INIT_WS_FAIL, !0), n.label = 16; case 16: return [3, 17]; case 17: return [2] } }) }) }), !1, E.label = 1; case 1: return E.trys.push([1, 3, 4, 5]), [4, this._wsInitPromise]; case 2: return E.sent(), !0, this._wsReadySubsribers.forEach(function (e) { return (0, e.resolve)() }), [3, 5]; case 3: return u = E.sent(), this._wsReadySubsribers.forEach(function (e) { return (0, e.reject)(u) }), [3, 5]; case 4: return this._wsInitPromise = void 0, this._wsReadySubsribers = [], this.clearTotalReconnectTimeout(), [7]; case 5: return [2] } }) }) }, this.initWebSocketEvent = function () { return new Promise(function (e, r) { if (!t._ws) throw new Error("can not initWebSocketEvent, ws not exists"); var n = !1; t._ws.onOpen(function (r) { t._context.debug && console.warn("[realtime] ws event: open", r), n = !0, e() }), t._ws.onError(function (e) { t._logins = new Map, n ? (t._context.debug && console.error("[realtime] ws event: error", e), t.clearHeartbeat(), t.closeAllClients(new l.CloudSDKError({ errCode: f.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR, errMsg: e })), p.reportIDKey(h.ErrorID, h.ErrorKey.REALTIME_DB_WS_ONERROR_WHILE_ACTIVE, !0)) : (t._context.debug && console.error("[realtime] ws open failed with ws event: error", e), r(e), p.reportIDKey(h.ErrorID, h.ErrorKey.REALTIME_DB_WS_ONERROR_BEFORE_OPEN, !0)) }), t._ws.onClose(function (e) { switch (t._logins = new Map, t.clearHeartbeat(), e.code) { case c.CLOSE_EVENT_CODE.ReconnectWebSocket: case c.CLOSE_EVENT_CODE.NoRealtimeListeners: break; case c.CLOSE_EVENT_CODE.HeartbeatPingError: case c.CLOSE_EVENT_CODE.HeartbeatPongTimeoutError: case c.CLOSE_EVENT_CODE.NormalClosure: case c.CLOSE_EVENT_CODE.AbnormalClosure: t._maxReconnect > 0 ? t.initWebSocketConnection(!0, t._maxReconnect) : t.closeAllClients(c.getWSCloseError(e.code)), e.code === c.CLOSE_EVENT_CODE.HeartbeatPingError ? p.reportIDKey(h.ErrorID, h.ErrorKey.REALTIME_DB_WS_ONCLOSE_HEARTBEAT_PING_FAIL, !0) : e.code === c.CLOSE_EVENT_CODE.HeartbeatPongTimeoutError ? p.reportIDKey(h.ErrorID, h.ErrorKey.REALTIME_DB_WS_ONCLOSE_HEARTBEAT_PONG_TIMEOUT, !0) : p.reportIDKey(h.ErrorID, h.ErrorKey.REALTIME_DB_WS_ONCLOSE_AB_NORMAL_CLOSURE, !0); break; case c.CLOSE_EVENT_CODE.NoAuthentication: t.closeAllClients(c.getWSCloseError(e.code, e.reason)), p.reportIDKey(h.ErrorID, h.ErrorKey.REALTIME_DB_WS_ONCLOSE_SERVER_CLOSE_NO_AUTH, !0); break; default: t._maxReconnect > 0 ? t.initWebSocketConnection(!0, t._maxReconnect) : t.closeAllClients(c.getWSCloseError(e.code)), p.reportIDKey(h.ErrorID, h.ErrorKey.REALTIME_DB_WS_ONCLOSE_UNKNOWN_ORIGIN, !0) }p.reportIDKey(h.ErrorID, h.ErrorKey.REALTIME_DB_WS_ONCLOSE, !0) }); var i = { timing: {}, startKey: "apiStartTime", endKey: "apiEndTime", samplePicker: p.socketOnMessageSamplePicker, autoReport: "_realtime.onSocketMessage" }; t._ws.onMessage(p.wrapTiming(t.onSocketMessage, i)), t.heartbeat() }) }, this.isWSConnected = function () { return Boolean(t._ws && t._ws.readyState === m.OPEN) }, this.onceWSConnected = function () { return n.__awaiter(t, void 0, void 0, function () { var e = this; return n.__generator(this, function (t) { return this.isWSConnected() ? [2] : this._wsInitPromise ? [2, this._wsInitPromise] : [2, new Promise(function (t, r) { e._wsReadySubsribers.push({ resolve: t, reject: r }) })] }) }) }, this.onSocketMessage = function (e) { var r, n = e.data; t.heartbeat(); try { r = JSON.parse(n) } catch (e) { throw new Error("[realtime] onMessage parse res.data error: " + e) } t._context.debug && console.log("[realtime] onMessage " + r.msgType + " (" + (new Date).toLocaleString() + ")", r); var i = t._wsResponseWait.get(r.requestId); if (i) { try { "ERROR" === r.msgType ? i.reject(new d.RealtimeErrorMessageError(r)) : i.resolve(r) } catch (e) { t._context.debug && console.error("ws onMessage responseWaitSpec.resolve(msg) errored:", e) } finally { t._wsResponseWait.delete(r.requestId) } if (i.skipOnMessage) return } if ("PONG" !== r.msgType) { var o = r.watchId && t._watchIdClientMap.get(r.watchId); if (o) o.onMessage(r); else switch (r.watchId ? t._closedWatches.has(r.watchId) ? p.reportIDKey(h.ErrorID, h.ErrorKey.REALTIME_DB_RECV_MSG_WITH_CLOSED_WATCHID, !0) : p.reportIDKey(h.ErrorID, h.ErrorKey.REALTIME_DB_RECV_MSG_WITH_UNKNOWN_WATCHID, !0) : p.reportIDKey(h.ErrorID, h.ErrorKey.REALTIME_DB_RECV_MSG_WITHOUT_WATCHID, !0), r.msgType) { case "INIT_EVENT": case "NEXT_EVENT": case "CHECK_EVENT": (o = t._queryIdClientMap.get(r.msgData.queryID)) && o.onMessage(r) } } else if (t._lastPingSendTS) { var s = Date.now() - t._lastPingSendTS; if (s > S) return void (t._context.debug && console.warn("[realtime] untrusted rtt observed: " + s)); t._rttObserved.length >= b && t._rttObserved.splice(0, t._rttObserved.length - b + 1), t._rttObserved.push(s) } }, this.login = function (e, r, i) { return n.__awaiter(t, void 0, void 0, function () { var t, o, a, c, l, d, f, _, h = this; return n.__generator(this, function (g) { switch (g.label) { case 0: if (e = e || this._context.env || this._defaultEnvId, !r) if (e) { if (t = this._logins.get(e)) { if (t.loggedIn && t.loginResult) return [2, t.loginResult]; if (t.loggingInPromise) return [2, t.loggingInPromise] } } else if ((o = this._logins.get("")) && o.loggingInPromise) return [2, o.loggingInPromise]; 0, a = new Promise(function (t, o) { return n.__awaiter(h, void 0, void 0, function () { var a, c, l, d, f; return n.__generator(this, function (n) { switch (n.label) { case 0: return n.trys.push([0, 3, , 4]), [4, i ? p.wrapTiming(this.getSignature(e, r), { timing: i, startKey: "tunnelStartTime", endKey: "tunnelEndTime", condition: { emptyKey: !0 } }) : this.getSignature(e, r)]; case 1: return a = n.sent(), c = s.getWXVersion(), l = { watchId: void 0, requestId: u.genRequestId(), msgType: "LOGIN", msgData: { envId: a.envId, signStr: a.signStr, secretVersion: a.secretVersion, referrer: "mp", sdkVersion: c.version, dataVersion: c.updateDateInDashes } }, [4, this.send({ msg: l, waitResponse: !0, skipOnMessage: !0, timeout: v })]; case 2: return (d = n.sent()).msgData.code ? o(new Error(d.msgData.code + " " + d.msgData.message)) : t({ envId: a.envId }), [3, 4]; case 3: return f = n.sent(), o(f), [3, 4]; case 4: return [2] } }) }) }), c = e && this._logins.get(e), l = Date.now(), c ? (c.loggedIn = !1, c.loggingInPromise = a, c.loginStartTS = l) : (c = { loggedIn: !1, loggingInPromise: a, loginStartTS: l }, this._logins.set(e || "", c)), g.label = 1; case 1: return g.trys.push([1, 3, , 4]), [4, a]; case 2: if (d = g.sent(), (f = e && this._logins.get(e)) && f === c && f.loginStartTS === l) return c.loggedIn = !0, c.loggingInPromise = void 0, c.loginStartTS = void 0, c.loginResult = d, [2, d]; if (f) { if (f.loggedIn && f.loginResult) return [2, f.loginResult]; if (f.loggingInPromise) return [2, f.loggingInPromise]; throw new Error("ws unexpected login info") } throw new Error("ws login info reset"); case 3: throw _ = g.sent(), c.loggedIn = !1, c.loggingInPromise = void 0, c.loginStartTS = void 0, c.loginResult = void 0, _; case 4: return [2] } }) }) }, this.getSignature = function (e, r) { return n.__awaiter(t, void 0, void 0, function () { var t, i, o; return n.__generator(this, function (s) { switch (s.label) { case 0: if (e = e || this._context.env || this._defaultEnvId, !r && e && this._signatures.has(e)) { if (t = this._signatures.get(e), Date.now() < t.expireTS) return [2, t] } else 0; return [4, a.getRealtimeConnectionSignature(this._instanceContext)]; case 1: return i = s.sent(), o = n.__assign({}, i, { expireTS: +new Date + 6e4 }), this._signatures.set(o.envId, o), e || (this._defaultEnvId = o.envId), [2, o] } }) }) }, this.getWaitExpectedTimeoutLength = function () { return t._rttObserved.length ? t._rttObserved.reduce(function (e, t) { return e + t }) / t._rttObserved.length * 1.5 : y }, this.ping = function () { return n.__awaiter(t, void 0, void 0, function () { var e; return n.__generator(this, function (t) { switch (t.label) { case 0: return e = { watchId: void 0, requestId: u.genRequestId(), msgType: "PING", msgData: null }, [4, this.send({ msg: e })]; case 1: return t.sent(), this._context.debug && console.log("ping sent"), [2] } }) }) }, this.send = function (e) { return new Promise(function (r, i) { return n.__awaiter(t, void 0, void 0, function () { var t, o, a, u, c, d, f = this; return n.__generator(this, function (_) { switch (_.label) { case 0: o = !1, a = !1, u = function (e) { o = !0, t && clearTimeout(t), r(e) }, c = function (e) { a = !0, t && clearTimeout(t), i(e) }, e.timeout && (t = setTimeout(function () { return n.__awaiter(f, void 0, void 0, function () { return n.__generator(this, function (e) { switch (e.label) { case 0: return o && a ? [3, 2] : [4, s.sleep(0)]; case 1: e.sent(), o && a || c(new l.TimeoutError("wsclient.send timedout")), e.label = 2; case 2: return [2] } }) }) }, e.timeout)), _.label = 1; case 1: return _.trys.push([1, 4, , 5]), this._context.debug && console.log("[realtime] ws send " + e.msg.msgType + " (" + (new Date).toLocaleString() + "): ", e), this._wsInitPromise ? [4, this._wsInitPromise] : [3, 3]; case 2: _.sent(), _.label = 3; case 3: return this._ws ? this._ws.readyState !== m.OPEN ? (c(new Error("ws readyState invalid: " + this._ws.readyState + ", can not send message")), [2]) : (e.waitResponse && this._wsResponseWait.set(e.msg.requestId, { resolve: u, reject: c, skipOnMessage: e.skipOnMessage }), this._ws.send({ data: JSON.stringify(e.msg), success: function (t) { e.waitResponse || u(t) }, fail: function (t) { c(t), e.waitResponse && f._wsResponseWait.delete(e.msg.requestId) } }), [3, 5]) : (c(new Error("invalid state: ws connection not exists, can not send message")), [2]); case 4: return d = _.sent(), c(d), [3, 5]; case 5: return [2] } }) }) }) }, this.closeAllClients = function (e) { t._virtualWSClient.forEach(function (t) { t.closeWithError(e) }) }, this.pauseClients = function (e) { (e || t._virtualWSClient).forEach(function (e) { e.pause() }) }, this.resumeClients = function (e) { (e || t._virtualWSClient).forEach(function (e) { e.resume() }) }, this.onWatchStart = function (e, r) { t._queryIdClientMap.set(r, e) }, this.onWatchClose = function (e, r) { r && t._queryIdClientMap.delete(r), t._watchIdClientMap.delete(e.watchId), t._virtualWSClient.delete(e), t._closedWatches.add(e.watchId), t._virtualWSClient.size || t.close(c.CLOSE_EVENT_CODE.NoRealtimeListeners) }, this.getEJSON = function () { return t._EJSON }, this._instanceContext = e.instanceContext } return Object.defineProperty(e.prototype, "_context", { get: function () { return this._instanceContext.serviceContext }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "_maxReconnect", { get: function () { return this._context.appConfig.realtimeMaxReconnect }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "_reconnectInterval", { get: function () { return this._context.appConfig.realtimeReconnectInterval }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "_totalConnectionTimeout", { get: function () { return this._context.appConfig.realtimeTotalConnectionTimeout }, enumerable: !0, configurable: !0 }), e.prototype.heartbeat = function (e) { var t = this; this.clearHeartbeat(), this._pingTimeoutId = setTimeout(function () { return n.__awaiter(t, void 0, void 0, function () { var e = this; return n.__generator(this, function (t) { switch (t.label) { case 0: return t.trys.push([0, 2, , 3]), this._ws && this._ws.readyState === m.OPEN ? (this._lastPingSendTS = Date.now(), [4, this.ping()]) : [2]; case 1: return t.sent(), this._pingFailed = 0, this._pongTimeoutId = setTimeout(function () { e._context.debug && console.error("pong timed out"), e._pongMissed < 2 ? (e._pongMissed++ , e.heartbeat(!0)) : e.initWebSocketConnection(!0) }, this._context.appConfig.realtimePongWaitTimeout), [3, 3]; case 2: return t.sent(), this._pingFailed < 2 ? (this._pingFailed++ , this.heartbeat()) : this.close(c.CLOSE_EVENT_CODE.HeartbeatPingError), [3, 3]; case 3: return [2] } }) }) }, e ? 0 : this._context.appConfig.realtimePingInterval) }, e.prototype.clearHeartbeat = function () { this._pingTimeoutId && clearTimeout(this._pingTimeoutId), this._pongTimeoutId && clearTimeout(this._pongTimeoutId) }, e.prototype.clearTotalReconnectTimeout = function () { this._totalConnectionTimeoutId && clearTimeout(this._totalConnectionTimeoutId) }, e.prototype.close = function (e) { this.clearHeartbeat(), this._ws && (this._ws.close({ code: e, reason: c.CLOSE_EVENT_CODE_INFO[e].name }), this._ws = void 0) }, e.prototype.watch = function (e) { var t = { apiStartTime: Date.now() }, r = !1, i = function () { g.reportAPISpeed(n.__assign({}, t, { apiName: e.reportAPIName })) }, s = e.onChange, a = e.onError; this._ws || this._wsInitPromise || this.initWebSocketConnection(!1); var u = new o.VirtualWebSocketClient(n.__assign({}, e, { send: this.send, login: this.login, isWSConnected: this.isWSConnected, onceWSConnected: this.onceWSConnected, getWaitExpectedTimeoutLength: this.getWaitExpectedTimeoutLength, getEJSON: this.getEJSON, onWatchStart: this.onWatchStart, onWatchClose: this.onWatchClose, debug: this._context.debug, timing: t, onChange: l, onError: d })); this._virtualWSClient.add(u), this._watchIdClientMap.set(u.watchId, u); var c = u.listener; return c; function l() { for (var e = this, n = [], o = 0; o < arguments.length; o++)n[o] = arguments[o]; r || (r = !0, t.apiEndTime = Date.now(), i()), f(), E.default.surroundThirdByTryCatch(function () { return c.onChange.apply(e, n) })() } function d() { for (var e = this, n = [], o = 0; o < arguments.length; o++)n[o] = arguments[o]; r || (r = !0, t.apiEndTime = Date.now(), i()), f(), E.default.surroundThirdByTryCatch(function () { return c.onError.apply(e, n) })() } function f() { c.onChange === l && (c.onChange = s), c.onError === d && (c.onError = a) } }, e }(); t.RealtimeWebSocketClient = T }, "./src/services/database/api/database/realtime/ws-event.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/utils/error.ts"), i = r("./src/config/error.config.ts"); t.CLOSE_EVENT_CODE_INFO = { 1000: { code: 1e3, name: "Normal Closure", description: "Normal closure; the connection successfully completed whatever purpose for which it was created." }, 1001: { code: 1001, name: "Going Away", description: "The endpoint is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection." }, 1002: { code: 1002, name: "Protocol Error", description: "The endpoint is terminating the connection due to a protocol error." }, 1003: { code: 1003, name: "Unsupported Data", description: "The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data)." }, 1005: { code: 1005, name: "No Status Received", description: "Indicates that no status code was provided even though one was expected." }, 1006: { code: 1006, name: "Abnormal Closure", description: "Used to indicate that a connection was closed abnormally (that is, with no close frame being sent) when a status code is expected." }, 1007: { code: 1007, name: "Invalid frame payload data", description: "The endpoint is terminating the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message)." }, 1008: { code: 1008, name: "Policy Violation", description: "The endpoint is terminating the connection because it received a message that violates its policy. This is a generic status code, used when codes 1003 and 1009 are not suitable." }, 1009: { code: 1009, name: "Message too big", description: "The endpoint is terminating the connection because a data frame was received that is too large." }, 1010: { code: 1010, name: "Missing Extension", description: "The client is terminating the connection because it expected the server to negotiate one or more extension, but the server didn't." }, 1011: { code: 1011, name: "Internal Error", description: "The server is terminating the connection because it encountered an unexpected condition that prevented it from fulfilling the request." }, 1012: { code: 1012, name: "Service Restart", description: "The server is terminating the connection because it is restarting." }, 1013: { code: 1013, name: "Try Again Later", description: "The server is terminating the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients." }, 1014: { code: 1014, name: "Bad Gateway", description: "The server was acting as a gateway or proxy and received an invalid response from the upstream server. This is similar to 502 HTTP Status Code." }, 1015: { code: 1015, name: "TLS Handshake", description: "Indicates that the connection was closed due to a failure to perform a TLS handshake (e.g., the server certificate can't be verified)." }, 3000: { code: 3e3, name: "Reconnect WebSocket", description: "The client is terminating the connection because it wants to reconnect" }, 3001: { code: 3001, name: "No Realtime Listeners", description: "The client is terminating the connection because no more realtime listeners exist" }, 3002: { code: 3002, name: "Heartbeat Ping Error", description: "The client is terminating the connection due to its failure in sending heartbeat messages" }, 3003: { code: 3003, name: "Heartbeat Pong Timeout Error", description: "The client is terminating the connection because no heartbeat response is received from the server" }, 3050: { code: 3050, name: "Server Close", description: "The client is terminating the connection because no heartbeat response is received from the server" } }, function (e) { e[e.NormalClosure = 1e3] = "NormalClosure", e[e.GoingAway = 1001] = "GoingAway", e[e.ProtocolError = 1002] = "ProtocolError", e[e.UnsupportedData = 1003] = "UnsupportedData", e[e.NoStatusReceived = 1005] = "NoStatusReceived", e[e.AbnormalClosure = 1006] = "AbnormalClosure", e[e.InvalidFramePayloadData = 1007] = "InvalidFramePayloadData", e[e.PolicyViolation = 1008] = "PolicyViolation", e[e.MessageTooBig = 1009] = "MessageTooBig", e[e.MissingExtension = 1010] = "MissingExtension", e[e.InternalError = 1011] = "InternalError", e[e.ServiceRestart = 1012] = "ServiceRestart", e[e.TryAgainLater = 1013] = "TryAgainLater", e[e.BadGateway = 1014] = "BadGateway", e[e.TLSHandshake = 1015] = "TLSHandshake", e[e.ReconnectWebSocket = 3e3] = "ReconnectWebSocket", e[e.NoRealtimeListeners = 3001] = "NoRealtimeListeners", e[e.HeartbeatPingError = 3002] = "HeartbeatPingError", e[e.HeartbeatPongTimeoutError = 3003] = "HeartbeatPongTimeoutError", e[e.NoAuthentication = 3050] = "NoAuthentication" }(t.CLOSE_EVENT_CODE || (t.CLOSE_EVENT_CODE = {})), t.getWSCloseError = function (e, r) { var o = t.CLOSE_EVENT_CODE_INFO[e], s = o ? o.name + ", code " + e + ", reason " + (r || o.description) : "code " + e; return new n.CloudSDKError({ errCode: i.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED, errMsg: s }) } }, "./src/services/database/api/database/regexp.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/api/database/helper/symbol.ts"), i = r("./src/utils/assert.ts"); t.regExp = function (e) { return new o(e) }; var o = function () { function e(e) { i.assertType(e, { regexp: "string" }, "RegExp options"), e.options && i.assertType(e.options, "string"), this.regexp = e.regexp, this.options = e.options || "" } return Object.defineProperty(e.prototype, "_internalType", { get: function () { return n.SYMBOL_REGEXP }, enumerable: !0, configurable: !0 }), e.prototype.toJSON = function () { return { $regex: this.regexp, $options: this.options } }, e }(); t.RegExp = o }, "./src/services/database/index.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/api/api.ts"), i = "database"; t.registerService = function (e) { e.registerService(function (e) { var t = { name: i, identifiers: e.identifiers, request: e.request, get debug() { return e.debug }, get env() { return e.getEnvForService(i) }, appConfig: { get docSizeLimit() { return e.appConfig.db_doc_size_limit }, get realtimePingInterval() { return e.appConfig.db_realtime_ping_interval }, get realtimePongWaitTimeout() { return e.appConfig.db_realtime_pong_wait_timeout }, get realtimeMaxReconnect() { return e.config.database.maxReconnect }, get realtimeReconnectInterval() { return e.config.database.reconnectInterval }, get realtimeTotalConnectionTimeout() { return e.config.database.totalConnectionTimeout } } }; return { name: i, context: t, getAPIs: n.getAPIs.bind(null, t) } }(e)) } }, "./src/services/database/internal/backend-api/backend-api.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n, i = r("./node_modules/tslib/tslib.es6.js"), o = r("./src/utils/assert.ts"), s = r("./src/utils/type.ts"); !function (e) { e[e.STRING = 1] = "STRING", e[e.NUMBER = 2] = "NUMBER" }(n = t._ID_TYPE || (t._ID_TYPE = {})), function (e) { e[e.ASC = 0] = "ASC", e[e.DESC = 1] = "DESC" }(t.ORDER_DIRECTION || (t.ORDER_DIRECTION = {})), t.addDocument = function (e) { return i.__awaiter(this, void 0, void 0, function () { var t, r, s, a, u, c, l, d, f, _; return i.__generator(this, function (i) { switch (i.label) { case 0: return t = e.env, r = e.collectionName, s = e.data, a = e.instanceContext, u = e.timing, c = JSON.stringify(s), o.assertStringLength({ input: c, max: a.serviceContext.appConfig.docSizeLimit, name: "record", maxWording: (a.serviceContext.appConfig.docSizeLimit / 1024).toFixed(0) + " KB" }), l = { collection_name: r, data: c }, d = JSON.stringify(l), u.tunnelStartTime = +new Date, [4, a.serviceContext.request({ apiName: "tcbapi_db_adddocument", serviceName: a.serviceContext.name, serializedReqData: d, requireDataNotEmpty: !0, env: t || a.serviceContext.env })]; case 1: return f = i.sent(), u.tunnelEndTime = +new Date, _ = f.data, u.tunnelTimeNoCSNetCost = _.baseresponse.stat.qbase_cost_time, [2, { _id: _._id_type === n.NUMBER ? _._id_number : _._id }] } }) }) }, t.removeDocument = function (e) { return i.__awaiter(this, void 0, void 0, function () { var t, r, n, o, s, a, u, c, l, d; return i.__generator(this, function (i) { switch (i.label) { case 0: return t = e.collectionName, r = e.query, n = e.options, o = e.instanceContext, s = e.timing, a = e.env, u = n && n.multi, c = JSON.stringify({ collection_name: t, query: JSON.stringify(r), multi: u }), s.tunnelStartTime = +new Date, [4, o.serviceContext.request({ apiName: "tcbapi_db_deletedocument", serviceName: o.serviceContext.name, serializedReqData: c, requireDataNotEmpty: !0, env: a || o.serviceContext.env })]; case 1: return l = i.sent(), s.tunnelEndTime = +new Date, d = l.data, s.tunnelTimeNoCSNetCost = d.baseresponse.stat.qbase_cost_time, [2, { removed: d.deleted }] } }) }) }, t.queryDocument = function (e) { return i.__awaiter(this, void 0, void 0, function () { var t, r, n, o, s, a, u, c, l, d, f, _; return i.__generator(this, function (i) { switch (i.label) { case 0: return t = e.env, r = e.collectionName, n = e.query, o = e.options, s = void 0 === o ? {} : o, a = e.instanceContext, u = e.timing, c = { collection_name: r, query: JSON.stringify(n) }, s.offset && (c.offset = s.offset), s.limit && (c.limit = s.limit), s.order && (c.order = s.order), s.projection && (c.projection = JSON.stringify(s.projection)), l = JSON.stringify(c), u.tunnelStartTime = +new Date, [4, a.serviceContext.request({ apiName: "tcbapi_db_querydocument", serviceName: a.serviceContext.name, serializedReqData: l, requireDataNotEmpty: !0, env: t || a.serviceContext.env })]; case 1: return d = i.sent(), u.tunnelEndTime = +new Date, f = d.data, u.tunnelTimeNoCSNetCost = f.baseresponse.stat.qbase_cost_time, _ = f.data_list ? JSON.parse(f.data_list) : [], [2, { list: _ = a.engine.Decoder.decode(_), offset: f.offset, limit: f.limit, total: f.total }] } }) }) }, t.updateDocument = function (e) { return i.__awaiter(this, void 0, void 0, function () { var t, r, n, s, a, u, c, l, d, f, _, p, h; return i.__generator(this, function (i) { switch (i.label) { case 0: return t = e.env, r = e.collectionName, n = e.query, s = e.data, a = e.options, u = void 0 === a ? {} : a, c = e.instanceContext, l = e.timing, d = JSON.stringify(s), o.assertStringLength({ input: d, max: c.serviceContext.appConfig.docSizeLimit, name: "update expression", maxWording: (c.serviceContext.appConfig.docSizeLimit / 1024).toFixed(0) + " KB" }), (f = { collection_name: r, query: JSON.stringify(n), data: d }).multi = !1 !== u.multi, f.merge = !1 !== u.merge, u.upsert && (f.upsert = u.upsert), _ = JSON.stringify(f), l.tunnelStartTime = +new Date, [4, c.serviceContext.request({ apiName: "tcbapi_db_updatedocument", serviceName: c.serviceContext.name, serializedReqData: _, requireDataNotEmpty: !0, env: t || c.serviceContext.env })]; case 1: return p = i.sent(), l.tunnelEndTime = +new Date, h = p.data, l.tunnelTimeNoCSNetCost = h.baseresponse.stat.qbase_cost_time, [2, { updated: h.updated }] } }) }) }, t.setDocument = function (e) { return i.__awaiter(this, void 0, void 0, function () { var t, r, a, u, c, l, d, f, _, p, h, g; return i.__generator(this, function (i) { switch (i.label) { case 0: return t = e.env, r = e.collectionName, a = e._id, u = e.data, e.options, c = e.instanceContext, l = e.timing, d = JSON.stringify(u), o.assertStringLength({ input: d, max: c.serviceContext.appConfig.docSizeLimit, name: "record", maxWording: (c.serviceContext.appConfig.docSizeLimit / 1024).toFixed(0) + " KB" }), f = s.isNumber(a), _ = { collection_name: r, _id_type: f ? n.NUMBER : n.STRING, data: d }, f ? _._id_number = a : _._id = a, p = JSON.stringify(_), l.tunnelStartTime = +new Date, [4, c.serviceContext.request({ apiName: "tcbapi_db_setdocument", serviceName: c.serviceContext.name, serializedReqData: p, requireDataNotEmpty: !0, env: t || c.serviceContext.env })]; case 1: return h = i.sent(), l.tunnelEndTime = +new Date, g = h.data, l.tunnelTimeNoCSNetCost = g.baseresponse.stat.qbase_cost_time, [2, { _id: g._id_type === n.NUMBER ? g._id_number : g._id, updated: g._id ? 0 : 1, created: g._id ? 1 : 0 }] } }) }) }, t.countDocument = function (e) { return i.__awaiter(this, void 0, void 0, function () { var t, r, n, o, s, a, u, c, l; return i.__generator(this, function (i) { switch (i.label) { case 0: return t = e.env, r = e.collectionName, n = e.query, o = e.instanceContext, s = e.timing, a = { collection_name: r, query: JSON.stringify(n) }, u = JSON.stringify(a), s.tunnelStartTime = +new Date, [4, o.serviceContext.request({ apiName: "tcbapi_db_countdocument", serviceName: o.serviceContext.name, serializedReqData: u, requireDataNotEmpty: !0, env: t || o.serviceContext.env })]; case 1: return c = i.sent(), s.tunnelEndTime = +new Date, l = c.data, s.tunnelTimeNoCSNetCost = l.baseresponse.stat.qbase_cost_time, [2, { total: l.total }] } }) }) }, t.runAggregate = function (e) { return i.__awaiter(this, void 0, void 0, function () { var t, n, o, s, a, u, c, l, d; return i.__generator(this, function (i) { switch (i.label) { case 0: return e.env, t = e.collectionName, n = e.stages, o = e.instanceContext, s = e.timing, a = { collection_name: t, stages: n.map(function (e) { return { stage_key: e.stageKey, stage_value: JSON.stringify(e.stageValue) } }) }, u = JSON.stringify(a), s.tunnelStartTime = +new Date, [4, o.serviceContext.request({ apiName: "tcbapi_db_aggregate", serviceName: o.serviceContext.name, serializedReqData: u, requireDataNotEmpty: !0 })]; case 1: return c = i.sent(), s.tunnelEndTime = +new Date, l = c.data, s.tunnelTimeNoCSNetCost = l.baseresponse.stat.qbase_cost_time, [4, Promise.resolve().then(function () { return r("./node_modules/bson/dist/bson.browser.esm.js") })]; case 2: return d = i.sent().EJSON, [2, { list: JSON.parse(l.list).map(function (e) { return d.parse(e) }) }] } }) }) }, t.getRealtimeConnectionSignature = function (e) { return i.__awaiter(this, void 0, void 0, function () { var t, r; return i.__generator(this, function (n) { switch (n.label) { case 0: return [4, e.serviceContext.request({ apiName: "tcbapi_db_get_realtime_connection", env: e.database.config.env || e.serviceContext.env, serviceName: e.serviceContext.name, serializedReqData: JSON.stringify({}), requireDataNotEmpty: !0 })]; case 1: return t = n.sent(), [2, { envId: (r = t.data).env_id, secretVersion: r.secret_version, signStr: r.sign_str, wsUrl: r.ws_url }] } }) }) } }, "./src/services/database/internal/grammar/default/extractor.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/api/database/query.ts"), i = r("./src/services/database/internal/backend-api/backend-api.ts"), o = r("./src/services/database/internal/grammar/default/serializer/common.ts"); function s(e) { var t = o.flattenObject(e); for (var r in t) !0 === t[r] || 1 === t[r] ? t[r] = 1 : !1 === t[r] || 0 === t[r] ? t[r] = 0 : delete t[r]; return t } t.extractQueryOptions = function (e) { return { limit: e._query.limit, offset: e._query.offset, order: function (e) { return e.map(function (e) { return { field: e.fieldPath, direction: e.order === n.ORDER_DIRECTION.DESC ? i.ORDER_DIRECTION.DESC : i.ORDER_DIRECTION.ASC } }) }(e._query.order || []), projection: s(e._field) } }, t.getProjectionDefinition = s }, "./src/services/database/internal/grammar/default/index.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"); n.__exportStar(r("./src/services/database/internal/grammar/default/extractor.ts"), t), n.__exportStar(r("./src/services/database/internal/grammar/default/operator-map.ts"), t), n.__exportStar(r("./src/services/database/internal/grammar/default/serializer.ts"), t) }, "./src/services/database/internal/grammar/default/operator-map.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/api/database/commands/query.ts"), i = r("./src/services/database/api/database/commands/logic.ts"), o = r("./src/services/database/api/database/commands/update.ts"), s = r("./src/services/database/api/database/commands/aggregate.ts"); for (var a in t.OperatorMap = {}, t.AggregateOperatorMap = {}, n.QUERY_COMMANDS_LITERAL) t.OperatorMap[a] = "$" + a.toLowerCase(); for (var a in i.LOGIC_COMMANDS_LITERAL) t.OperatorMap[a] = "$" + a.toLowerCase(); for (var a in o.UPDATE_COMMANDS_LITERAL) t.OperatorMap[a] = "$" + a.toLowerCase(); for (var a in s.AGGREGATE_COMMANDS_LITERAL) t.AggregateOperatorMap[s.AGGREGATE_COMMANDS_LITERAL[a]] = "$" + s.AGGREGATE_COMMANDS_LITERAL[a]; t.OperatorMap[n.QUERY_COMMANDS_LITERAL.NEQ] = "$ne", t.OperatorMap[o.UPDATE_COMMANDS_LITERAL.REMOVE] = "$unset", t.OperatorMap[o.UPDATE_COMMANDS_LITERAL.SHIFT] = "$pop", t.OperatorMap[o.UPDATE_COMMANDS_LITERAL.UNSHIFT] = "$push", t.OperatorMap[n.QUERY_COMMANDS_LITERAL.GEO_NEAR] = "$nearSphere", t.OperatorMap[n.QUERY_COMMANDS_LITERAL.GEO_WITHIN] = "$geoWithin", t.OperatorMap[n.QUERY_COMMANDS_LITERAL.GEO_INTERSECTS] = "$geoIntersects", t.operatorToString = function (e) { return t.OperatorMap[e] || "$" + e.toLowerCase() }, t.aggregateOperatorToString = function (e) { return t.AggregateOperatorMap[e] || "$" + e.toLowerCase() } }, "./src/services/database/internal/grammar/default/serializer.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"); n.__exportStar(r("./src/services/database/internal/grammar/default/serializer/query.ts"), t), n.__exportStar(r("./src/services/database/internal/grammar/default/serializer/update.ts"), t), n.__exportStar(r("./src/services/database/internal/grammar/default/serializer/decoder.ts"), t), n.__exportStar(r("./src/services/database/internal/grammar/default/serializer/aggregate.ts"), t), n.__exportStar(r("./src/services/database/internal/grammar/default/serializer/common.ts"), t) }, "./src/services/database/internal/grammar/default/serializer/aggregate.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/internal/grammar/default/serializer/common.ts"), i = r("./src/services/database/api/database/aggregate.ts"), o = r("./src/services/database/api/database/commands/aggregate.ts"), s = r("./src/utils/type.ts"), a = r("./src/services/database/internal/grammar/default/operator-map.ts"), u = function () { function e() { } return e.encode = function (e) { return (new c).encode(e) }, e }(); t.AggregateSerializer = u; var c = function () { function e() { } return e.prototype.encode = function (e) { var t = this; return e.map(function (e) { return t.encodePipelineStage(e) }) }, e.prototype.encodeAny = function (e) { var t = this; return n.isConversionRequired(e) ? i.isPipeline(e) ? this.encodePipeline(e) : i.isPipelineStage(e) ? this.encodePipelineStage(e) : o.isAggregateCommand(e) ? this.encodeAggregateCommand(e) : n.encodeInternalDataType(e) : s.isObject(e) ? this.encodeObject(e) : s.isArray(e) ? e.map(function (e) { return t.encodeAny(e) }) : e }, e.prototype.encodeObject = function (e) { var t = {}; for (var r in e) t[r] = this.encodeAny(e[r]); return t }, e.prototype.encodePipeline = function (e) { var t = this; return e._stages.map(function (e) { return t.encodeAny(e) }) }, e.prototype.encodePipelineStage = function (e) { return { stageKey: "$" + e.stage, stageValue: this.encodeAny(e.val) } }, e.prototype.encodeAggregateCommand = function (e) { var t; return (t = {})[a.aggregateOperatorToString(e.operator)] = this.encodeAny(e.operands[0]), t }, e }() }, "./src/services/database/internal/grammar/default/serializer/common.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"), i = r("./src/utils/error.ts"), o = r("./src/config/error.config.ts"), s = r("./src/utils/type.ts"), a = r("./src/services/database/internal/grammar/default/serializer/datatype.ts"); function u(e, t, r, a) { var c = n.__assign({}, e); for (var l in e) if (!/^\$/.test(l)) { var d = e[l]; if (d && s.isObject(d) && !t(d)) { if (a.indexOf(d) > -1) throw new i.CloudSDKError({ errCode: o.ERR_CODE.SDK_DATABASE_CIRCULAR_REFERENCE, errMsg: "Cannot convert circular structure to JSON" }); var f = u(d, t, n.__spread(r, [l]), n.__spread(a, [d])); c[l] = f; var _ = !1; for (var p in f) /^\$/.test(p) ? _ = !0 : (c[l + "." + p] = f[p], delete c[l][p]); _ || delete c[l] } } return c } function c(e) { return s.isInternalObject(e) || s.isDate(e) || s.isRegExp(e) } t.flattenQueryObject = function (e) { return u(e, c, [], [e]) }, t.flattenObject = function (e) { return u(e, function (e) { return !1 }, [], [e]) }, t.mergeConditionAfterEncode = function (e, t, r) { for (var n in t[r] || delete e[r], t) e[n] ? s.isArray(e[n]) ? e[n].push(t[n]) : s.isObject(e[n]) ? s.isObject(t[n]) ? Object.assign(e[n], t[n]) : (console.warn("unmergable condition, query is object but condition is " + s.getType(t) + ", can only overwrite", t, r), e[n] = t[n]) : (console.warn("to-merge query is of type " + s.getType(e) + ", can only overwrite", e, t, r), e[n] = t[n]) : e[n] = t[n] }, t.isConversionRequired = c, t.encodeInternalDataType = function (e) { return a.serialize(e) }, t.decodeInternalDataType = function (e) { return a.deserialize(e) } }, "./src/services/database/internal/grammar/default/serializer/datatype.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"), i = r("./src/services/database/api/database/helper/symbol.ts"), o = r("./src/utils/type.ts"), s = r("./src/services/database/api/database/date.ts"), a = r("./src/utils/error.ts"), u = r("./src/config/error.config.ts"), c = r("./src/services/database/api/database/helper/geojson.ts"); t.serialize = function (e) { return function e(t, r) { if (!o.isInternalObject(t)) { if (o.isDate(t)) return { $date: +t }; if (o.isRegExp(t)) return { $regex: t.source, $options: t.flags }; if (o.isArray(t)) return t.map(function (t) { if (r.indexOf(t) > -1) throw new a.CloudSDKError({ errCode: u.ERR_CODE.SDK_DATABASE_CIRCULAR_REFERENCE, errMsg: "Cannot convert circular structure to JSON" }); return e(t, n.__spread(r, [t])) }); if (o.isObject(t)) { var s = n.__assign({}, t); for (var c in s) { if (r.indexOf(s[c]) > -1) throw new a.CloudSDKError({ errCode: u.ERR_CODE.SDK_DATABASE_CIRCULAR_REFERENCE, errMsg: "Cannot convert circular structure to JSON" }); s[c] = e(s[c], n.__spread(r, [s[c]])) } return s } return t } switch (t._internalType) { case i.SYMBOL_GEO_POINT: case i.SYMBOL_GEO_MULTIPOINT: case i.SYMBOL_GEO_LINESTRING: case i.SYMBOL_GEO_MULTILINESTRING: case i.SYMBOL_GEO_POLYGON: case i.SYMBOL_GEO_MULTIPOLYGON: return t.toJSON(); case i.SYMBOL_SERVER_DATE: return { $date: t.options }; case i.SYMBOL_REGEXP: return { $regex: t.regexp, $options: t.options }; default: return t.toJSON ? t.toJSON() : t } }(e, [e]) }, t.deserialize = function (e) { var t = n.__assign({}, e); for (var r in t) switch (r) { case "$date": switch (o.getType(t[r])) { case "number": return new Date(t[r]); case "object": return s.serverDate(t[r]) }break; case "type": switch (t.coordinates, t.type) { case "Point": if (c.isGeoJSONPoint(t)) return c.toPoint(t); break; case "MultiPoint": if (c.isGeoJSONMultiPoint(t)) return c.toMultiPoint(t); break; case "LineString": if (c.isGeoJSONLineString(t)) return c.toLineString(t); break; case "MultiLineString": if (c.isGeoJSONMultiLineString(t)) return c.toMultiLineString(t); break; case "Polygon": if (c.isGeoJSONPolygon(t)) return c.toPolygon(t); break; case "MultiPolygon": if (c.isGeoJSONMultiPolygon(t)) return c.toMultiPolygon(t) } }return e } }, "./src/services/database/internal/grammar/default/serializer/decoder.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"), i = r("./src/utils/type.ts"), o = r("./src/services/database/internal/grammar/default/serializer/common.ts"), s = function () { function e() { } return e.decode = function (t) { return (new e).decodeData(t) }, e.prototype.decodeData = function (e) { var t = this; switch (i.getType(e)) { case "object": return this.decodeObject(e); case "array": return e.map(function (e) { if (i.isObject(e)) { var r = o.decodeInternalDataType(e); return r !== e ? r : t.decodeObject(e) } return e }); default: return e } }, e.prototype.decodeObject = function (e) { var t = n.__assign({}, e); for (var r in t) { var s = t[r]; switch (i.getType(s)) { case "object": var a = o.decodeInternalDataType(s); t[r] = a !== s ? a : this.decodeObject(t[r]); break; case "array": (a = this.decodeData(s)) !== s && (t[r] = a); break; default: continue } } return t }, e }(); t.Decoder = s }, "./src/services/database/internal/grammar/default/serializer/query.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"), i = r("./src/services/database/api/database/commands/query.ts"), o = r("./src/services/database/api/database/commands/logic.ts"), s = r("./src/services/database/api/database/helper/symbol.ts"), a = r("./src/utils/type.ts"), u = r("./src/utils/error.ts"), c = r("./src/services/database/internal/grammar/default/operator-map.ts"), l = r("./src/services/database/internal/grammar/default/serializer/common.ts"), d = function () { function e() { } return e.encode = function (e) { return (new f).encodeQuery(e) }, e }(); t.QuerySerializer = d; var f = function () { function e() { } return e.prototype.encodeQuery = function (e) { return l.isConversionRequired(e) ? o.isLogicCommand(e) ? this.encodeLogicCommand(e) : i.isQueryCommand(e) ? this.encodeQueryCommand(e) : this.encodeQueryObject(e) : a.isObject(e) ? this.encodeQueryObject(e) : e }, e.prototype.encodeLogicCommand = function (e) { var t, r, n; switch (e.operator) { case o.LOGIC_COMMANDS_LITERAL.AND: case o.LOGIC_COMMANDS_LITERAL.OR: var i = c.operatorToString(e.operator), s = e.operands.map(this.encodeQuery.bind(this)); return (t = {})[i] = s, t; default: i = c.operatorToString(e.operator); if (1 === e.operands.length) { var a = this.encodeQuery(e.operands[0]); return (r = {})[i] = a, r } s = e.operands.map(this.encodeQuery.bind(this)); return (n = {})[i] = s, n } }, e.prototype.encodeQueryCommand = function (e) { return i.isComparisonCommand(e), this.encodeComparisonCommand(e) }, e.prototype.encodeComparisonCommand = function (e) { var t, r, n, o, a, d, f, _, p, h; if (e.fieldName === s.SYMBOL_UNSET_FIELD_NAME) throw new u.CloudSDKError({ errMsg: "Cannot encode a comparison command with unset field name" }); var g = c.operatorToString(e.operator); switch (e.operator) { case i.QUERY_COMMANDS_LITERAL.EQ: case i.QUERY_COMMANDS_LITERAL.NEQ: case i.QUERY_COMMANDS_LITERAL.LT: case i.QUERY_COMMANDS_LITERAL.LTE: case i.QUERY_COMMANDS_LITERAL.GT: case i.QUERY_COMMANDS_LITERAL.GTE: return (t = {})[e.fieldName] = ((r = {})[g] = l.encodeInternalDataType(e.operands[0]), r), t; case i.QUERY_COMMANDS_LITERAL.IN: case i.QUERY_COMMANDS_LITERAL.NIN: return (n = {})[e.fieldName] = ((o = {})[g] = l.encodeInternalDataType(e.operands), o), n; case i.QUERY_COMMANDS_LITERAL.GEO_NEAR: return (a = {})[e.fieldName] = ((d = {})[g] = { $geometry: l.encodeInternalDataType(e.operands[0].geometry), $maxDistance: e.operands[0].maxDistance, $minDistance: e.operands[0].minDistance }, d), a; case i.QUERY_COMMANDS_LITERAL.GEO_WITHIN: case i.QUERY_COMMANDS_LITERAL.GEO_INTERSECTS: return (f = {})[e.fieldName] = ((_ = {})[g] = { $geometry: l.encodeInternalDataType(e.operands[0].geometry) }, _), f; default: return (p = {})[e.fieldName] = ((h = {})[g] = l.encodeInternalDataType(e.operands[0]), h), p } }, e.prototype.encodeQueryObject = function (e) { var t, r, n = l.flattenQueryObject(e), s = []; for (var a in n) { var u = n[a]; if (o.isLogicCommand(u)) { n[a] = u._setFieldName(a); var c = this.encodeLogicCommand(n[a]); s.push(c) } else if (i.isComparisonCommand(u)) { n[a] = u._setFieldName(a); c = this.encodeComparisonCommand(n[a]); s.push(c) } else l.isConversionRequired(u) ? s.push(((t = {})[a] = l.encodeInternalDataType(u), t)) : s.push(((r = {})[a] = u, r)) } return this.mergeQueries(s) }, e.prototype.mergeQueries = function (e) { var t, r, i = {}; try { for (var o = n.__values(e), s = o.next(); !s.done; s = o.next()) { var u = s.value; for (var c in u) i.hasOwnProperty(c) ? a.isObject(i[c]) && a.isObject(u[c]) ? Object.assign(i[c], u[c]) : a.isArray(i[c]) && a.isArray(u[c]) ? i[c] = n.__spread(i[c], u[c]) : i[c] = u[c] : i[c] = u[c] } } catch (e) { t = { error: e } } finally { try { s && !s.done && (r = o.return) && r.call(o) } finally { if (t) throw t.error } } return i }, e.prototype.mergeConditionAfterEncode = function (e, t, r) { for (var n in t[r] || delete e[r], t) e[n] ? a.isArray(e[n]) ? e[n].push(t[n]) : a.isObject(e[n]) ? a.isObject(t[n]) ? Object.assign(e, t) : (console.warn("unmergable condition, query is object but condition is " + a.getType(t) + ", can only overwrite", t, r), e[n] = t[n]) : (console.warn("to-merge query is of type " + a.getType(e) + ", can only overwrite", e, t, r), e[n] = t[n]) : e[n] = t[n] }, e }() }, "./src/services/database/internal/grammar/default/serializer/update.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/api/database/commands/update.ts"), i = r("./src/services/database/api/database/helper/symbol.ts"), o = r("./src/utils/type.ts"), s = r("./src/utils/error.ts"), a = r("./src/services/database/internal/grammar/default/operator-map.ts"), u = r("./src/services/database/internal/grammar/default/serializer/common.ts"), c = function () { function e() { } return e.encode = function (t) { return (new e).encodeUpdate(t) }, e.prototype.encodeUpdate = function (e) { return n.isUpdateCommand(e) ? this.encodeUpdateCommand(e) : "object" === o.getType(e) ? this.encodeUpdateObject(e) : e }, e.prototype.encodeUpdateCommand = function (e) { if (e.fieldName === i.SYMBOL_UNSET_FIELD_NAME) throw new s.CloudSDKError({ errMsg: "Cannot encode a comparison command with unset field name" }); switch (e.operator) { case n.UPDATE_COMMANDS_LITERAL.SET: case n.UPDATE_COMMANDS_LITERAL.REMOVE: case n.UPDATE_COMMANDS_LITERAL.INC: case n.UPDATE_COMMANDS_LITERAL.MUL: return this.encodeFieldUpdateCommand(e); case n.UPDATE_COMMANDS_LITERAL.PUSH: case n.UPDATE_COMMANDS_LITERAL.POP: case n.UPDATE_COMMANDS_LITERAL.SHIFT: case n.UPDATE_COMMANDS_LITERAL.UNSHIFT: return this.encodeArrayUpdateCommand(e); default: return this.encodeFieldUpdateCommand(e) } }, e.prototype.encodeFieldUpdateCommand = function (e) { var t, r, i, o, s = a.operatorToString(e.operator); switch (e.operator) { case n.UPDATE_COMMANDS_LITERAL.REMOVE: return (t = {})[s] = ((r = {})[e.fieldName] = "", r), t; case n.UPDATE_COMMANDS_LITERAL.SET: case n.UPDATE_COMMANDS_LITERAL.INC: case n.UPDATE_COMMANDS_LITERAL.MUL: default: return (i = {})[s] = ((o = {})[e.fieldName] = e.operands[0], o), i } }, e.prototype.encodeArrayUpdateCommand = function (e) { var t, r, i, o, s, c, l, d, f, _, p = a.operatorToString(e.operator); switch (e.operator) { case n.UPDATE_COMMANDS_LITERAL.PUSH: var h = { $each: e.operands.map(u.encodeInternalDataType) }; return (t = {})[p] = ((r = {})[e.fieldName] = h, r), t; case n.UPDATE_COMMANDS_LITERAL.UNSHIFT: h = { $each: e.operands.map(u.encodeInternalDataType), $position: 0 }; return (i = {})[p] = ((o = {})[e.fieldName] = h, o), i; case n.UPDATE_COMMANDS_LITERAL.POP: return (s = {})[p] = ((c = {})[e.fieldName] = 1, c), s; case n.UPDATE_COMMANDS_LITERAL.SHIFT: return (l = {})[p] = ((d = {})[e.fieldName] = -1, d), l; default: return (f = {})[p] = ((_ = {})[e.fieldName] = u.encodeInternalDataType(e.operands), _), f } }, e.prototype.encodeUpdateObject = function (e) { var t = u.flattenQueryObject(e); for (var r in t) if (!/^\$/.test(r)) { var i = t[r]; if (n.isUpdateCommand(i)) { t[r] = i._setFieldName(r); var o = this.encodeUpdateCommand(t[r]); u.mergeConditionAfterEncode(t, o, r) } else { t[r] = i = u.encodeInternalDataType(i); var s = new n.UpdateCommand(n.UPDATE_COMMANDS_LITERAL.SET, [i], r); o = this.encodeUpdateCommand(s); u.mergeConditionAfterEncode(t, o, r) } } return t }, e }(); t.UpdateSerializer = c }, "./src/services/database/internal/grammar/engine.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n, i = r("./src/services/database/internal/grammar/default/index.ts"); !function (e) { e[e.DEFAULT = 0] = "DEFAULT" }(n = t.ENGINES || (t.ENGINES = {})), t.getEngine = function (e) { return void 0 === e && (e = n.DEFAULT), i } }, "./src/services/database/internal/grammar/stringifier/aggregate.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/internal/grammar/stringifier/index.ts"), i = r("./src/utils/type.ts"), o = function () { function e() { } return e.stringify = function (e, t, r) { void 0 === t && (t = 2), void 0 === r && (r = 0); var n = r + 1, i = (t && " ".repeat(r * t), t ? " ".repeat(n * t) : ""), o = t ? "\n" : ""; return "db.collection('" + e.collection.collectionName + "').aggregate()" + o + e._stages.map(function (e) { return s.stringify(e, t, n) }).join(o) + o + i + ".end()" }, e }(); t.AggregateStringifier = o; var s = function () { function e() { } return e.stringify = function (t, r, n) { void 0 === r && (r = 2), void 0 === n && (n = 0); var i = n + 1, o = r ? " ".repeat(n * r) : ""; r && " ".repeat(i * r); return o + "." + t.stage + "(" + e._stringifyVal(t.val, r, n) + ")" }, e._stringifyVal = function (t, r, o) { if (void 0 === r && (r = 2), void 0 === o && (o = 0), void 0 === t) return "undefined"; if (null === t) return "null"; if (i.isInternalObject(t)) return n.InternalObjectStringifier.stringify(t, e._stringifyVal, r, o); if ("function" == typeof t.toJSON) return e._stringifyVal(t.toJSON(), r, o); if (i.isDate(t)) return n.DateStringifier.stringify(t); var s = o + 1, a = " ".repeat(o * r), u = " ".repeat(s * r), c = r ? "\n" : "", l = r ? " " : ""; if (i.isRegExp(t)) return n.RegExpStringifier.stringify(t, r, s); switch (Object.prototype.toString.call(t).slice(8, -1)) { case "Object": var d = []; for (var f in t) { var _ = /[a-zA-Z0-9_]/.test(f) ? f : "'" + f + "'"; d.push("" + u + _ + ":" + l + e._stringifyVal(t[f], r, s)) } return "{" + c + d.join("," + c) + c + a + "}"; case "Array": return "[" + c + t.map(function (t) { return u + e._stringifyVal(t, r, s) }).join("," + c) + c + a + "]"; case "Number": return t.toString(); case "String": return "'" + t + "'"; default: return "'" + t.toString() + "'" } }, e }(); t.AggregationStageStringifier = s }, "./src/services/database/internal/grammar/stringifier/collection.add.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/internal/grammar/stringifier/index.ts"), i = function () { function e() { } return e.stringify = function (e, t, r, i) { void 0 === r && (r = 2), void 0 === i && (i = 0); var o = i + 1, s = r ? " ".repeat(i * r) : "", a = r ? " ".repeat(o * r) : "", u = r ? "\n" : "", c = r ? " " : ""; return n.CollectionStringifier.stringify(e, r) + ".add({" + u + a + "data:" + c + n.CommonObjectStringifier.stringify(t, r, o) + u + s + "})" }, e }(); t.CollectionAddStringifier = i }, "./src/services/database/internal/grammar/stringifier/collection.ts": function (e, t) { Object.defineProperty(t, "__esModule", { value: !0 }); var r = function () { function e() { } return e.stringify = function (e, t, r) { return void 0 === t && (t = 2), void 0 === r && (r = 0), "db.collection('" + e.collectionName + "')" }, e }(); t.CollectionStringifier = r }, "./src/services/database/internal/grammar/stringifier/common-object.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/api/database/helper/symbol.ts"), i = r("./src/utils/type.ts"), o = function () { function e() { } return e.stringify = function (t, r, n) { if (void 0 === r && (r = 2), void 0 === n && (n = 0), void 0 === t) return "undefined"; if (null === t) return "null"; if (i.isInternalObject(t)) return e._stringifyInternalObject(t, r, n); if ("function" == typeof t.toJSON) return e.stringify(t.toJSON(), r, n); if (i.isDate(t)) return e._stringifyDate(t); if (i.isRegExp(t)) return e._stringifyRegExp(t, r, n); var o = n + 1, s = " ".repeat(n * r), a = " ".repeat(o * r), u = r ? "\n" : "", c = r ? " " : ""; switch (Object.prototype.toString.call(t).slice(8, -1)) { case "Object": var l = []; for (var d in t) { var f = /[a-zA-Z0-9_]/.test(d) ? d : "'" + d + "'"; l.push("" + a + f + ":" + c + e.stringify(t[d], r, o)) } return "{" + u + l.join("," + u) + u + s + "}"; case "Array": return "[" + u + t.map(function (t) { return a + e.stringify(t, r, o) }).join("," + u) + u + s + "]"; case "Number": return t.toString(); case "String": return "'" + t + "'"; default: return "'" + t.toString() + "'" } }, e._stringifyInternalObject = function (t, r, i) { var o = i + 1, s = " ".repeat(i * r), a = " ".repeat(o * r), u = r ? "\n" : "", c = r ? " " : ""; switch (t._internalType) { case n.SYMBOL_GEO_POINT: return "db.Geo.Point(" + t.longitude + "," + c + t.latitude + ")"; case n.SYMBOL_GEO_MULTIPOINT: return "db.Geo.MultiPoint([" + u + t.points.map(function (t) { return a + e.stringify(t, r, o) }).join("," + u) + u + s + "])"; case n.SYMBOL_GEO_LINESTRING: return "db.Geo.LineString([" + u + t.points.map(function (t) { return a + e.stringify(t, r, o) }).join("," + u) + u + s + "])"; case n.SYMBOL_GEO_MULTILINESTRING: return "db.Geo.MultiLineString([" + u + t.lines.map(function (t) { return a + e.stringify(t, r, o) }).join("," + u) + u + s + "])"; case n.SYMBOL_GEO_POLYGON: return "db.Geo.Polygon([" + u + t.lines.map(function (t) { return a + e.stringify(t, r, o) }).join("," + u) + u + s + "])"; case n.SYMBOL_GEO_MULTIPOLYGON: return "db.Geo.MultiPolygon([" + u + t.polygons.map(function (t) { return a + e.stringify(t, r, o) }).join("," + u) + u + s + "])"; case n.SYMBOL_SERVER_DATE: return "db.serverDate(" + e.stringify(t.options, r, i) + ")"; case n.SYMBOL_REGEXP: var l = { regexp: t.regexp, options: t.options }; return "db.RegExp(" + e.stringify(l, r, i) + ")"; default: return t.toJSON ? e.stringify(t.toJSON(), r, i) : "'" + t.toString() + "'" } }, e._stringifyDate = function (e) { return "new Date(" + e + ")" }, e._stringifyRegExp = function (t, r, n) { var i = { regexp: t.source, options: t.flags }; return "db.RegExp(" + e.stringify(i, r, n) + ")" }, e }(); t.CommonObjectStringifier = o }, "./src/services/database/internal/grammar/stringifier/date.ts": function (e, t) { Object.defineProperty(t, "__esModule", { value: !0 }); var r = function () { function e() { } return e.stringify = function (e) { return "new Date(" + e + ")" }, e }(); t.DateStringifier = r }, "./src/services/database/internal/grammar/stringifier/doc.get.ts": function (e, t) { Object.defineProperty(t, "__esModule", { value: !0 }); var r = function () { function e() { } return e.stringify = function (t, r) { return void 0 === r && (r = 2), e._stringify(t, r) }, e._stringify = function (e, t, r) { return void 0 === t && (t = 2), void 0 === r && (r = 0), "db.collection('" + e.collection.collectionName + "').doc('" + e._id + "').get()" }, e }(); t.DocumentGetStringifier = r }, "./src/services/database/internal/grammar/stringifier/doc.remove.ts": function (e, t) { Object.defineProperty(t, "__esModule", { value: !0 }); var r = function () { function e() { } return e.stringify = function (e, t, r) { return void 0 === t && (t = 2), void 0 === r && (r = 0), "db.collection('" + e.collection.collectionName + "').doc('" + e._id + "').remove()" }, e }(); t.DocumentRemoveStringifier = r }, "./src/services/database/internal/grammar/stringifier/doc.set.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/internal/grammar/stringifier/index.ts"), i = function () { function e() { } return e.stringify = function (e, t, r, i) { void 0 === r && (r = 2), void 0 === i && (i = 0); var o = i + 1, s = r ? " ".repeat(i * r) : "", a = r ? " ".repeat(o * r) : "", u = r ? "\n" : "", c = r ? " " : ""; return "db.collection('" + e.collection.collectionName + "').doc('" + e._id + "').set({" + u + a + "data:" + c + n.CommonObjectStringifier.stringify(t, r, o) + u + s + "})" }, e }(); t.DocumentSetStringifier = i }, "./src/services/database/internal/grammar/stringifier/doc.update.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/internal/grammar/stringifier/index.ts"), i = function () { function e() { } return e.stringify = function (e, t, r, i) { void 0 === r && (r = 2), void 0 === i && (i = 0); var o = i + 1, s = r ? " ".repeat(i * r) : "", a = r ? " ".repeat(o * r) : "", u = r ? "\n" : "", c = r ? " " : ""; return "db.collection('" + e.collection.collectionName + "').doc('" + e._id + "').update({" + u + a + "data:" + c + n.UpdateConditionStringifier.stringify(t, r, o) + u + s + "})" }, e }(); t.DocumentUpdateStringifier = i }, "./src/services/database/internal/grammar/stringifier/index.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"); n.__exportStar(r("./src/services/database/internal/grammar/stringifier/query.ts"), t), n.__exportStar(r("./src/services/database/internal/grammar/stringifier/collection.ts"), t), n.__exportStar(r("./src/services/database/internal/grammar/stringifier/aggregate.ts"), t), n.__exportStar(r("./src/services/database/internal/grammar/stringifier/common-object.ts"), t), n.__exportStar(r("./src/services/database/internal/grammar/stringifier/internal-object.ts"), t), n.__exportStar(r("./src/services/database/internal/grammar/stringifier/query-condition.ts"), t), n.__exportStar(r("./src/services/database/internal/grammar/stringifier/update-condition.ts"), t), n.__exportStar(r("./src/services/database/internal/grammar/stringifier/query.get.ts"), t), n.__exportStar(r("./src/services/database/internal/grammar/stringifier/query.count.ts"), t), n.__exportStar(r("./src/services/database/internal/grammar/stringifier/collection.add.ts"), t), n.__exportStar(r("./src/services/database/internal/grammar/stringifier/doc.get.ts"), t), n.__exportStar(r("./src/services/database/internal/grammar/stringifier/doc.set.ts"), t), n.__exportStar(r("./src/services/database/internal/grammar/stringifier/doc.update.ts"), t), n.__exportStar(r("./src/services/database/internal/grammar/stringifier/doc.remove.ts"), t), n.__exportStar(r("./src/services/database/internal/grammar/stringifier/date.ts"), t), n.__exportStar(r("./src/services/database/internal/grammar/stringifier/regexp.ts"), t) }, "./src/services/database/internal/grammar/stringifier/internal-object.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/api/database/helper/symbol.ts"), i = function () { function e() { } return e.stringify = function (e, t, r, i) { void 0 === r && (r = 2), void 0 === i && (i = 0); var o = i + 1, s = " ".repeat(i * r), a = " ".repeat(o * r), u = r ? "\n" : "", c = r ? " " : ""; switch (e._internalType) { case n.SYMBOL_QUERY_COMMAND: case n.SYMBOL_LOGIC_COMMAND: case n.SYMBOL_UPDATE_COMMAND: var l = e.operands.map(function (e) { return t(e, r, i) }); return "_." + e.operator + "(" + l.join("," + c) + ")"; case n.SYMBOL_AGGREGATE_COMMAND: l = e.operands.map(function (e) { return t(e, r, i) }); return "$." + e.operator + "(" + l.join("," + c) + ")"; case n.SYMBOL_GEO_POINT: return "db.Geo.Point(" + e.longitude + "," + c + e.latitude + ")"; case n.SYMBOL_GEO_MULTIPOINT: return "db.Geo.MultiPoint([" + u + e.points.map(function (e) { return a + t(e, r, o) }).join("," + u) + u + s + "])"; case n.SYMBOL_GEO_LINESTRING: return "db.Geo.LineString([" + u + e.points.map(function (e) { return a + t(e, r, o) }).join("," + u) + u + s + "])"; case n.SYMBOL_GEO_MULTILINESTRING: return "db.Geo.MultiLineString([" + u + e.lines.map(function (e) { return a + t(e, r, o) }).join("," + u) + u + s + "])"; case n.SYMBOL_GEO_POLYGON: return "db.Geo.Polygon([" + u + e.lines.map(function (e) { return a + t(e, r, o) }).join("," + u) + u + s + "])"; case n.SYMBOL_GEO_MULTIPOLYGON: return "db.Geo.MultiPolygon([" + u + e.polygons.map(function (e) { return a + t(e, r, o) }).join("," + u) + u + s + "])"; case n.SYMBOL_SERVER_DATE: return "db.serverDate(" + t(e.options, r, i) + ")"; case n.SYMBOL_REGEXP: var d = { regexp: e.regexp, options: e.options }; return "db.RegExp(" + t(d, r, i) + ")"; default: return e.toJSON ? t(e.toJSON(), r, i) : "'" + e.toString() + "'" } }, e }(); t.InternalObjectStringifier = i }, "./src/services/database/internal/grammar/stringifier/query-condition.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/api/database/helper/symbol.ts"), i = r("./src/utils/type.ts"), o = function () { function e() { } return e.stringify = function (t, r) { return void 0 === r && (r = 2), e._stringify(t, r) }, e._stringify = function (t, r, n) { if (void 0 === r && (r = 2), void 0 === n && (n = 0), void 0 === t) return "undefined"; if (null === t) return "null"; if (i.isInternalObject(t)) return e._stringifyInternalObject(t, r, n); if ("function" == typeof t.toJSON) return e._stringify(t.toJSON(), r, n); if (i.isDate(t)) return e._stringifyDate(t); if (i.isRegExp(t)) return e._stringifyRegExp(t, r, n); var o = n + 1, s = " ".repeat(n * r), a = " ".repeat(o * r), u = r ? "\n" : "", c = r ? " " : ""; switch (Object.prototype.toString.call(t).slice(8, -1)) { case "Object": var l = []; for (var d in t) { var f = /[a-zA-Z0-9_]/.test(d) ? d : "'" + d + "'"; l.push("" + a + f + ":" + c + e._stringify(t[d], r, o)) } return "{" + u + l.join("," + u) + u + s + "}"; case "Array": return "[" + u + t.map(function (t) { return a + e._stringify(t, r, o) }).join("," + u) + u + s + "]"; case "Number": return t.toString(); case "String": return "'" + t + "'"; default: return "'" + t.toString() + "'" } }, e._stringifyInternalObject = function (t, r, i) { var o = i + 1, s = " ".repeat(i * r), a = " ".repeat(o * r), u = r ? "\n" : "", c = r ? " " : ""; switch (t._internalType) { case n.SYMBOL_QUERY_COMMAND: case n.SYMBOL_LOGIC_COMMAND: case n.SYMBOL_UPDATE_COMMAND: var l = t.operands.map(function (t) { return e._stringify(t, r, i) }); return "_." + t.operator + "(" + l.join("," + c) + ")"; case n.SYMBOL_GEO_POINT: return "db.Geo.Point(" + t.longitude + "," + c + t.latitude + ")"; case n.SYMBOL_GEO_MULTIPOINT: return "db.Geo.MultiPoint([" + u + t.points.map(function (t) { return a + e._stringify(t, r, o) }).join("," + u) + u + s + "])"; case n.SYMBOL_GEO_LINESTRING: return "db.Geo.LineString([" + u + t.points.map(function (t) { return a + e._stringify(t, r, o) }).join("," + u) + u + s + "])"; case n.SYMBOL_GEO_MULTILINESTRING: return "db.Geo.MultiLineString([" + u + t.lines.map(function (t) { return a + e._stringify(t, r, o) }).join("," + u) + u + s + "])"; case n.SYMBOL_GEO_POLYGON: return "db.Geo.Polygon([" + u + t.lines.map(function (t) { return a + e._stringify(t, r, o) }).join("," + u) + u + s + "])"; case n.SYMBOL_GEO_MULTIPOLYGON: return "db.Geo.MultiPolygon([" + u + t.polygons.map(function (t) { return a + e._stringify(t, r, o) }).join("," + u) + u + s + "])"; case n.SYMBOL_SERVER_DATE: return "db.serverDate(" + e._stringify(t.options, r, i) + ")"; case n.SYMBOL_REGEXP: var d = { regexp: t.regexp, options: t.options }; return "db.RegExp(" + e._stringify(d, r, i) + ")"; default: return t.toJSON ? e._stringify(t.toJSON(), r, i) : "'" + t.toString() + "'" } }, e._stringifyDate = function (e) { return "new Date(" + e + ")" }, e._stringifyRegExp = function (t, r, n) { var i = { regexp: t.source, options: t.flags }; return "db.RegExp(" + e._stringify(i, r, n) + ")" }, e }(); t.QueryConditionStringifier = o }, "./src/services/database/internal/grammar/stringifier/query.count.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/internal/grammar/stringifier/query.ts"), i = function () { function e() { } return e.stringify = function (e, t, r) { void 0 === t && (t = 2), void 0 === r && (r = 0); var i = t ? "\n" : ""; return n.QueryStringifier.stringify(e, t) + i + ".count()" }, e }(); t.QueryCountStringifier = i }, "./src/services/database/internal/grammar/stringifier/query.get.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/internal/grammar/stringifier/query.ts"), i = function () { function e() { } return e.stringify = function (t, r) { return void 0 === r && (r = 2), e._stringify(t, r) }, e._stringify = function (e, t, r) { void 0 === t && (t = 2), void 0 === r && (r = 0); var i = t ? "\n" : ""; return n.QueryStringifier.stringify(e) + i + ".get()" }, e }(); t.QueryGetStringifier = i }, "./src/services/database/internal/grammar/stringifier/query.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/api/database/query.ts"), i = r("./src/services/database/internal/grammar/stringifier/query-condition.ts"), o = r("./src/services/database/internal/grammar/stringifier/index.ts"), s = function () { function e() { } return e.stringify = function (t, r) { return void 0 === r && (r = 2), e._stringify(t, r) }, e._stringify = function (e, t, r) { void 0 === t && (t = 2), void 0 === r && (r = 0); var s = r + 1, a = (" ".repeat(r * t), " ".repeat(s * t), t ? "\n" : ""), u = t ? " " : "", c = "", l = "", d = "", f = ""; return e._query.offset && (c = a + ".skip(" + e._query.offset + ")"), e._query.limit && (l = a + ".limit(" + e._query.limit + ")"), e._query.order && e._query.order.length && (d = a + e._query.order.map(function (e) { var t = e.order === n.ORDER_DIRECTION.ASC ? "asc" : "desc"; return ".orderBy('" + e.fieldPath + "'," + u + "'" + t + "')" }).join(a)), e._query.field && (f = a + ".field(" + o.CommonObjectStringifier.stringify(e._query.field, t, r) + ")"), "db.collection('" + e.collectionName + "').where(" + (i.QueryConditionStringifier.stringify(e._query.where || {}) || "{}") + ")" + c + l + d + f }, e }(); t.QueryStringifier = s }, "./src/services/database/internal/grammar/stringifier/regexp.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/internal/grammar/stringifier/index.ts"), i = function () { function e() { } return e.stringify = function (e, t, r) { void 0 === t && (t = 2), void 0 === r && (r = 0); var i = { regexp: e.source, options: e.flags }; return "db.RegExp(" + n.CommonObjectStringifier.stringify(i, t, r) + ")" }, e }(); t.RegExpStringifier = i }, "./src/services/database/internal/grammar/stringifier/update-condition.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/database/api/database/helper/symbol.ts"), i = r("./src/utils/type.ts"), o = function () { function e() { } return e.stringify = function (t, r, n) { if (void 0 === r && (r = 2), void 0 === n && (n = 0), void 0 === t) return "undefined"; if (null === t) return "null"; if (i.isInternalObject(t)) return e._stringifyInternalObject(t, r, n); if ("function" == typeof t.toJSON) return e.stringify(t.toJSON(), r, n); if (i.isDate(t)) return e._stringifyDate(t); if (i.isRegExp(t)) return e._stringifyRegExp(t, r, n); var o = n + 1, s = " ".repeat(n * r), a = " ".repeat(o * r), u = r ? "\n" : "", c = r ? " " : ""; switch (Object.prototype.toString.call(t).slice(8, -1)) { case "Object": var l = []; for (var d in t) { var f = /[a-zA-Z0-9_]/.test(d) ? d : "'" + d + "'"; l.push("" + a + f + ":" + c + e.stringify(t[d], r, o)) } return "{" + u + l.join("," + u) + u + s + "}"; case "Array": return "[" + u + t.map(function (t) { return a + e.stringify(t, r, o) }).join("," + u) + u + s + "]"; case "Number": return t.toString(); case "String": return "'" + t + "'"; default: return "'" + t.toString() + "'" } }, e._stringifyInternalObject = function (t, r, i) { var o = i + 1, s = " ".repeat(i * r), a = " ".repeat(o * r), u = r ? "\n" : "", c = r ? " " : ""; switch (t._internalType) { case n.SYMBOL_UPDATE_COMMAND: var l = t.operands.map(function (t) { return e.stringify(t, r, i) }); return "_." + t.operator + "(" + l.join("," + c) + ")"; case n.SYMBOL_GEO_POINT: return "db.Geo.Point(" + t.longitude + "," + c + t.latitude + ")"; case n.SYMBOL_GEO_MULTIPOINT: return "db.Geo.MultiPoint([" + u + t.points.map(function (t) { return a + e.stringify(t, r, o) }).join("," + u) + u + s + "])"; case n.SYMBOL_GEO_LINESTRING: return "db.Geo.LineString([" + u + t.points.map(function (t) { return a + e.stringify(t, r, o) }).join("," + u) + u + s + "])"; case n.SYMBOL_GEO_MULTILINESTRING: return "db.Geo.MultiLineString([" + u + t.lines.map(function (t) { return a + e.stringify(t, r, o) }).join("," + u) + u + s + "])"; case n.SYMBOL_GEO_POLYGON: return "db.Geo.Polygon([" + u + t.lines.map(function (t) { return a + e.stringify(t, r, o) }).join("," + u) + u + s + "])"; case n.SYMBOL_GEO_MULTIPOLYGON: return "db.Geo.MultiPolygon([" + u + t.polygons.map(function (t) { return a + e.stringify(t, r, o) }).join("," + u) + u + s + "])"; case n.SYMBOL_SERVER_DATE: return "db.serverDate(" + e.stringify(t.options, r, i) + ")"; default: return t.toJSON ? e.stringify(t.toJSON(), r, i) : "'" + t.toString() + "'" } }, e._stringifyDate = function (e) { return "new Date(" + e + ")" }, e._stringifyRegExp = function (t, r, n) { var i = { regexp: t.source, options: t.flags }; return "db.RegExp(" + e.stringify(i, r, n) + ")" }, e }(); t.UpdateConditionStringifier = o }, "./src/services/functions/api/api.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/functions/api/callFunction.ts"); t.getAPIs = function (e) { return { callFunction: n.default(e) } } }, "./src/services/functions/api/callFunction.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"), i = r("./src/hook/invoke.ts"), o = r("./src/utils/assert.ts"), s = r("./src/utils/error.ts"), a = r("./src/utils/fail-safe.ts"), u = r("./src/utils/fn/clone.ts"), c = r("./src/utils/report.ts"), l = r("./src/externals/globals/wxconfig.ts"), d = r("./src/services/functions/api/callFunction/sync.ts"), f = r("./src/services/functions/api/callFunction/slow.ts"), _ = r("./src/services/functions/api/callFunction/slow.v2.ts"), p = r("./src/utils/serializer.ts"), h = r("./src/externals/globals/devtools.ts"), g = r("./src/externals/globals/wxconfig.ts"); !function (e) { e[e.INITIATE_CALL = 1] = "INITIATE_CALL", e[e.NORMAL_POLL_RETRY = 2] = "NORMAL_POLL_RETRY", e[e.SYSTEM_ERROR_RETRY = 3] = "SYSTEM_ERROR_RETRY", e[e.TIMEOUT_RETRY = 4] = "TIMEOUT_RETRY" }(t.SlowCallScene || (t.SlowCallScene = {})), function (e) { e[e.PENDING = 0] = "PENDING", e[e.DONE = 1] = "DONE", e[e.TIMEOUT = 2] = "TIMEOUT" }(t.ResultStatus || (t.ResultStatus = {})), t.API_NAME = "cloud.callFunction", t.API_NAME_V2 = "cloud.callFunction_real_v2", t.default = function (e) { var r, E, m; return function (e) { var r = +new Date; o.assertType(e, "object"); var n = u.shallowClone(e); return n.data || (n.data = {}), n.context = { tunnelTimeNoCSNetCost: 0 }, n.context.apiStartTime = r, i.hasAPICallback(n) ? function (e) { a.wrapParamCallbacksWithTryCatch({ apiName: t.API_NAME, param: e }), b(e).then(function (r) { i.invokeSuccessCompleteCallbacks(t.API_NAME, e, r) }).catch(function (r) { i.invokeFailCompleteCallbacks(t.API_NAME, e, r) }) }(n) : b(n) }; function b(i) { return n.__awaiter(this, void 0, void 0, function () { function a() { return "devtools" === l.default.platform || g.isMINA() || 1 === i.version } var u, b; return n.__generator(this, function (l) { switch (l.label) { case 0: return l.trys.push([0, 8, 9, 10]), function (e) { o.assertType(e, { name: "string" }), e.data && o.assertType(e.data, "object"), e.config && e.config.env && o.assertType(e.config.env, "string") }(i), a() ? (u = (r || (r = f.default(e)), r)(i), g.isDevTools() && h.autoDevtoolsNetworkLog(u, function () { return { url: "wx.cloud.callFunction." + i.name, headers: { Env: i.config && i.config.env || e.env }, reqBody: p.serialize(i.data), console: e.debug } }), [4, u]) : [3, 2]; case 1: return [2, l.sent()]; case 2: return [4, (E || (E = _.default(e)), E)(i)]; case 3: return [2, l.sent()]; case 4: return [3, 7]; case 5: return [4, (m || (m = d.default(e)), m)(i)]; case 6: return [2, l.sent()]; case 7: return [3, 10]; case 8: throw b = l.sent(), s.returnAsFinalCloudSDKError(b, t.API_NAME); case 9: return c.reportAPISpeed(n.__assign({}, i.context, { apiEndTime: +new Date, apiName: a() ? t.API_NAME : t.API_NAME_V2 })), [7]; case 10: return [2] } }) }) } } }, "./src/services/functions/api/callFunction/slow.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"), i = r("./src/config/error.config.ts"), o = r("./src/externals/public-lib/appserviceSdk.ts"), s = r("./src/utils/assert.ts"), a = r("./src/utils/error.ts"), u = r("./src/utils/msg.ts"), c = r("./src/utils/serializer.ts"), l = r("./src/services/functions/utils/extract.ts"), d = r("./src/services/functions/api/callFunction.ts"); t.default = function (e) { return function (t) { return n.__awaiter(this, void 0, void 0, function () { function r(t) { return n.__awaiter(this, void 0, void 0, function () { return n.__generator(this, function (r) { return [2, new Promise(function (r, s) { !function t(r, s, u, l) { return n.__awaiter(this, void 0, void 0, function () { return n.__generator(this, function (n) { return o.getSDK(e.identifiers).request({ url: r, success: function (e) { try { if (200 !== e.statusCode) return l(a.returnAsFinalCloudSDKError({ errCode: i.ERR_CODE.SDK_FUNCTIONS_POLL_RESULT_STATUS_CODE_ERROR, errMsg: "polling status code " + e.statusCode }, d.API_NAME)); var n = e.data; if (!n) return l(a.returnAsFinalCloudSDKError({ errCode: i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_RESULT_JSON, errMsg: i.ERR_CODE[i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_RESULT_JSON] }, d.API_NAME)); if (n.base_resp && 0 === n.base_resp.ret) { if (0 !== n.status) { if (1 === n.status) { if (0 !== n.service_errcode) { var o = a.returnAsFinalCloudSDKError({ errCode: i.ERR_CODE.SDK_FUNCTIONS_CLOUD_FUNCTION_EXECUTION_ERROR, errMsg: "requestID " + n.func_req_id + ", cloud function service error code " + (n.service_errcode || "unknown") + ", error message " + (n.service_errmsg || "unknown") }, d.API_NAME); return o.requestID = n.func_req_id, l(o) } var f = n.content; try { f = c.deserialize(f) } catch (e) { try { f = JSON.parse(f) } catch (e) { } } return u({ result: f, requestID: n.func_req_id }) } return l(a.returnAsFinalCloudSDKError({ errCode: i.ERR_CODE.SDK_FUNCTIONS_POLL_RESULT_EXPIRED, errMsg: "timeout for result fetching" }, d.API_NAME)) } if (!(s >= 0)) return l(a.returnAsFinalCloudSDKError({ errCode: i.ERR_CODE.SDK_FUNCTIONS_EXCEED_MAX_POLL_RETRY, errMsg: i.ERR_CODE[i.ERR_CODE.SDK_FUNCTIONS_EXCEED_MAX_POLL_RETRY] }, d.API_NAME)); t(r, s - 1, u, l) } else { if (!n.base_resp) return l(a.returnAsFinalCloudSDKError({ errCode: i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_RESULT_BASE_RESP, errMsg: i.ERR_CODE[i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_RESULT_BASE_RESP] }, d.API_NAME)); if (0 !== n.base_resp.ret) return l(a.returnAsFinalCloudSDKError({ errCode: i.ERR_CODE.SDK_FUNCTIONS_POLL_RESULT_BASE_RESP_RET_ABNORMAL, errMsg: "polling base_resp.ret " + n.base_resp.ret }, d.API_NAME)) } } catch (e) { l(a.returnAsFinalCloudSDKError({ errCode: i.ERR_CODE.SDK_FUNCTIONS_POLL_ERROR, errMsg: "polling catch error: " + e }, d.API_NAME)) } }, fail: function (e) { l(a.returnAsFinalCloudSDKError(e, d.API_NAME)) } }), [2] }) }) }(t, e.appConfig.maxPollRetry || 50, r, s) })] }) }) } var f, _, p, h, g, E, m, b, y, S, v, T, A, O, N; return n.__generator(this, function (o) { switch (o.label) { case 0: if (f = n.__assign({}, t.data), (_ = l.extractCloudID(f).map(function (e) { return { key_name: e.key, cloud_id: e.cloudID } })).length) try { for (p = n.__values(_), h = p.next(); !h.done; h = p.next())g = h.value, delete f[g.key_name] } catch (e) { O = { error: e } } finally { try { h && !h.done && (N = p.return) && N.call(p) } finally { if (O) throw O.error } } return E = c.serialize(f), s.assertStringLength({ input: E, max: e.appConfig.maxReqDataSize, name: "callFunction data", maxWording: e.appConfig.maxReqDataSize / 1024 + " KB" }), m = { function_name: t.name, data: E, cloudid_list: _ }, b = c.serialize(m), t.context.tunnelStartTime = +new Date, [4, e.request({ apiName: "tcbapi_slowcallfunction", serviceName: e.name, serializedReqData: b, env: t.config && t.config.env || e.env })]; case 1: if (y = o.sent(), t.context.tunnelEndTime = +new Date, !(S = y.data)) throw a.returnAsFinalCloudSDKError({ errCode: i.ERR_CODE.SDK_FUNCTIONS_EMPTY_CALL_RESULT, errMsg: i.ERR_CODE[i.ERR_CODE.SDK_FUNCTIONS_EMPTY_CALL_RESULT] }, d.API_NAME); if (S.event_id, !S.poll_url) throw a.returnAsFinalCloudSDKError({ errCode: i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_URL, errMsg: i.ERR_CODE[i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_URL] }, d.API_NAME); return S.poll_url.indexOf("?") > -1 ? S.poll_url += "&devtools_ignore=true&skip_domain_check=true" : S.poll_url += "?devtools_ignore=true&skip_domain_check=true", t.context.pollStartTime = +new Date, [4, r(S.poll_url)]; case 2: return v = o.sent(), T = v.result, A = v.requestID, t.context.pollEndTime = +new Date, [2, { errMsg: u.apiSuccessMsg(d.API_NAME), result: T, requestID: A }] } }) }) } } }, "./src/services/functions/api/callFunction/slow.v2.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"), i = r("./src/config/error.config.ts"), o = r("./src/utils/assert.ts"), s = r("./src/utils/error.ts"), a = r("./src/utils/msg.ts"), u = r("./src/utils/serializer.ts"), c = r("./src/services/functions/utils/extract.ts"), l = r("./src/utils/utils.ts"), d = r("./src/externals/globals/wxconfig.ts"), f = r("./src/services/functions/api/callFunction.ts"), _ = 50, p = 2, h = 2, g = 2e4; t.default = function (e) { return function (t) { return n.__awaiter(this, void 0, void 0, function () { function r(o) { return n.__awaiter(this, void 0, void 0, function () { function a(e) { try { if (O) return; I(), w(e); var t = e.data; if (!t) return v(s.returnAsFinalCloudSDKError({ errCode: i.ERR_CODE.SDK_FUNCTIONS_EMPTY_CALL_RESULT, errMsg: i.ERR_CODE[i.ERR_CODE.SDK_FUNCTIONS_EMPTY_CALL_RESULT] }, f.API_NAME)); if (!t.baseresponse || 0 !== t.baseresponse.errcode) return t.baseresponse ? 0 !== t.baseresponse.errcode ? v(s.returnAsFinalCloudSDKError({ errCode: i.ERR_CODE.SDK_FUNCTIONS_POLL_RESULT_BASE_RESP_RET_ABNORMAL, errMsg: "polling base_resp.errcode " + t.baseresponse.errcode + " errmsg " + t.baseresponse.errmsg }, f.API_NAME)) : v(s.returnAsFinalCloudSDKError({ errCode: i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_RESULT_BASE_RESP, errMsg: "polling base_resp " + JSON.stringify(t.baseresponse) }, f.API_NAME)) : v(s.returnAsFinalCloudSDKError({ errCode: i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_RESULT_BASE_RESP, errMsg: i.ERR_CODE[i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_RESULT_BASE_RESP] }, f.API_NAME)); if (0 !== t.status) { if (1 === t.status) { if (0 !== t.service_errcode) { var a = s.returnAsFinalCloudSDKError({ errCode: i.ERR_CODE.SDK_FUNCTIONS_CLOUD_FUNCTION_EXECUTION_ERROR, errMsg: "requestID " + t.func_request_id + ", cloud function service error code " + (t.service_errcode || "unknown") + ", error message " + (t.service_errmsg || "unknown") }, f.API_NAME); return a.requestID = t.func_request_id, v(a) } var c = t.data; try { c = u.deserialize(c) } catch (e) { try { c = JSON.parse(c) } catch (e) { } } return S({ result: c, requestID: t.func_request_id }) } return v(s.returnAsFinalCloudSDKError({ errCode: i.ERR_CODE.SDK_FUNCTIONS_POLL_RESULT_EXPIRED, errMsg: "timeout for result fetching, result cannot be fetched anymore" }, f.API_NAME)) } if (!(E >= 0)) return v(s.returnAsFinalCloudSDKError({ errCode: i.ERR_CODE.SDK_FUNCTIONS_EXCEED_MAX_POLL_RETRY, errMsg: i.ERR_CODE[i.ERR_CODE.SDK_FUNCTIONS_EXCEED_MAX_POLL_RETRY] }, f.API_NAME)); r(n.__assign({}, o, { scene: f.SlowCallScene.NORMAL_POLL_RETRY, tryCount: E - 1 })) } catch (e) { v(s.returnAsFinalCloudSDKError({ errCode: i.ERR_CODE.SDK_FUNCTIONS_POLL_ERROR, errMsg: "polling catch error: " + e }, f.API_NAME)) } } var c, _, p, h, E, b, y, S, v, T, A, O, N, I, C, R, w, D = this; return n.__generator(this, function (M) { return c = o.functionName, _ = o.data, p = o.callID, h = o.scene, E = o.tryCount, b = o.systemErrorRetry, y = o.timeoutErrorRetry, S = o.resolve, v = o.reject, T = { function_name: c, data: h === f.SlowCallScene.INITIATE_CALL ? _ : void 0, scene: h, call_id: p, cloudid_list: h === f.SlowCallScene.INITIATE_CALL ? m : [] }, A = u.serialize(T), O = !1, N = !1, I = function () { clearTimeout(R), N = !0 }, C = +new Date, R = setTimeout(function () { return n.__awaiter(D, void 0, void 0, function () { return n.__generator(this, function (t) { switch (t.label) { case 0: return +new Date - C > (e.appConfig.clientPollTimeout || g) ? [4, l.sleep()] : [3, 2]; case 1: if (t.sent(), N) return [2]; t.label = 2; case 2: return !d.isDevTools() && +new Date - C > e.appConfig.maxStartRetryGap ? [2, v(s.returnAsFinalCloudSDKError({ errCode: i.ERR_CODE.SDK_FUNCTIONS_POLL_RESULT_EXPIRED, errMsg: "timeout for retry, cannot retry fetching the result anymore" }, f.API_NAME))] : (O = !0, o.timeoutErrorRetry > 0 ? r(n.__assign({}, o, { scene: f.SlowCallScene.TIMEOUT_RETRY, tryCount: E - 1, timeoutErrorRetry: y - 1 })) : v(s.returnAsFinalCloudSDKError({ errCode: i.ERR_CODE.SDK_FUNCTIONS_EXCEED_MAX_TIMEOUT_POLL_RETRY, errMsg: i.ERR_CODE[i.ERR_CODE.SDK_FUNCTIONS_EXCEED_MAX_TIMEOUT_POLL_RETRY] }, f.API_NAME)), [2]) } }) }) }, e.appConfig.clientPollTimeout || g), w = function (e) { var r = e.data; r && r.baseresponse && r.baseresponse.stat && (r.baseresponse.stat.qbase_cost_time && (t.context.tunnelTimeNoCSNetCost += r.baseresponse.stat.qbase_cost_time), r.baseresponse.stat.func_exec_cost_time && (t.context.funcExecTime = r.baseresponse.stat.func_exec_cost_time)) }, e.request({ apiName: "tcbapi_slowcallfunction_v2", serviceName: e.name, serializedReqData: A, env: t.config && t.config.env || e.env }).then(a).catch(function (e) { O || (I(), e && e.operateWXDataFail && b > 0 ? r(n.__assign({}, o, { scene: f.SlowCallScene.SYSTEM_ERROR_RETRY, tryCount: E - 1, systemErrorRetry: b - 1 })) : v(s.returnAsFinalCloudSDKError(e, f.API_NAME))) }), [2] }) }) } var E, m, b, y, S, v, T, A, O, N, I, C; return n.__generator(this, function (i) { switch (i.label) { case 0: if (E = n.__assign({}, t.data), (m = c.extractCloudID(E).map(function (e) { return { key_name: e.key, cloud_id: e.cloudID } })).length) try { for (b = n.__values(m), y = b.next(); !y.done; y = b.next())S = y.value, delete E[S.key_name] } catch (e) { I = { error: e } } finally { try { y && !y.done && (C = b.return) && C.call(b) } finally { if (I) throw I.error } } return v = u.serialize(E), o.assertStringLength({ input: v, max: e.appConfig.maxReqDataSize, name: "callFunction data", maxWording: e.appConfig.maxReqDataSize / 1024 + " KB" }), T = +new Date + "-" + Math.random(), t.context.tunnelStartTime = +new Date, [4, function (t, i, o, s) { return n.__awaiter(this, void 0, void 0, function () { return n.__generator(this, function (n) { return [2, new Promise(function (n, a) { r({ param: t, functionName: t.name, data: i, cloudIDList: o, callID: s, scene: f.SlowCallScene.INITIATE_CALL, tryCount: e.appConfig.maxPollRetry || _, systemErrorRetry: p, timeoutErrorRetry: h, resolve: n, reject: a }) })] }) }) }(t, v, m, T)]; case 1: return A = i.sent(), O = A.result, N = A.requestID, t.context.tunnelEndTime = +new Date, [2, { errMsg: a.apiSuccessMsg(f.API_NAME), result: O, requestID: N }] } }) }) } } }, "./src/services/functions/api/callFunction/sync.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"), i = r("./src/utils/msg.ts"), o = r("./src/utils/serializer.ts"), s = r("./src/services/functions/api/callFunction.ts"); t.default = function (e) { return function (t) { return n.__awaiter(this, void 0, void 0, function () { var r, a, u, c, l; return n.__generator(this, function (n) { switch (n.label) { case 0: return r = { function_name: t.name, data: o.serialize(t.data), cloudid_list: [] }, a = o.serialize(r), [4, e.request({ apiName: "tcbapi_callfunction", serviceName: e.name, serializedReqData: a, env: t.config && t.config.env || e.env })]; case 1: if (u = n.sent(), c = u.data, l = c && c.data) try { l = JSON.parse(l) } catch (e) { } return [2, { errMsg: i.apiSuccessMsg(s.API_NAME), result: l }] } }) }) } } }, "./src/services/functions/index.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/functions/api/api.ts"); t.FUNCTIONS_SERVICE_NAME = "functions", t.registerService = function (e) { e.registerService(function (e) { var r = { name: t.FUNCTIONS_SERVICE_NAME, identifiers: e.identifiers, request: e.request, get debug() { return e.debug }, get env() { return e.getEnvForService(t.FUNCTIONS_SERVICE_NAME) }, appConfig: { get maxReqDataSize() { return e.appConfig.call_function_max_req_data_size }, get maxPollRetry() { return e.appConfig.call_function_poll_max_retry }, get maxStartRetryGap() { return e.appConfig.call_function_valid_start_retry_gap }, get clientPollTimeout() { return e.appConfig.call_function_client_poll_timeout } } }; return { name: t.FUNCTIONS_SERVICE_NAME, context: r, getAPIs: n.getAPIs.bind(null, r) } }(e)) } }, "./src/services/functions/utils/extract.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/utils/symbol.ts"), i = r("./src/utils/type.ts"); t.extractCloudID = function (e) { var t = []; for (var r in e) i.isObject(e[r]) && e[r]._internalType === n.SYMBOL_CLOUD_ID && t.push({ key: r, cloudID: e[r].cloudID }); return t } }, "./src/services/index.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/functions/index.ts"), i = r("./src/services/storage/index.ts"), o = r("./src/services/database/index.ts"), s = r("./src/services/utils/index.ts"); t.registerServices = function (e) { n.registerService(e), i.registerService(e), o.registerService(e), s.registerService(e) } }, "./src/services/storage/api/api.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/storage/api/uploadFile.ts"), i = r("./src/services/storage/api/downloadFile.ts"), o = r("./src/services/storage/api/getTempFileURL.ts"), s = r("./src/services/storage/api/deleteFile.ts"); t.getAPIs = function (e) { return { uploadFile: n.default(e), downloadFile: i.default(e), getTempFileURL: o.default(e), deleteFile: s.default(e) } } }, "./src/services/storage/api/deleteFile.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"), i = r("./src/utils/assert.ts"), o = r("./src/utils/error.ts"), s = r("./src/utils/serializer.ts"), a = r("./src/hook/invoke.ts"), u = r("./src/utils/msg.ts"), c = r("./src/utils/fn/clone.ts"), l = r("./src/utils/report.ts"), d = r("./src/config/error.config.ts"), f = r("./src/externals/globals/devtools.ts"), _ = r("./src/externals/globals/wxconfig.ts"), p = "cloud.deleteFile"; t.default = function (e) { return function (e) { var n = c.shallowClone(e); if (n.timing = { apiStartTime: +new Date }, a.hasAPICallback(n)) return function (e) { var n = t(e); n.then(function (t) { a.invokeSuccessCompleteCallbacks(p, e, t) }).catch(function (t) { a.invokeFailCompleteCallbacks(p, e, t) }), r(n, e) }(n); var i = t(n); return r(i, n), i }; function t(t) { return n.__awaiter(this, void 0, void 0, function () { var r; return n.__generator(this, function (a) { switch (a.label) { case 0: return a.trys.push([0, 2, 3, 4]), function (t) { i.assertType(t, { fileList: "array" }), t.config && t.config.env && i.assertType(t.config.env, "string"); for (var r = 0, n = t.fileList.length; r < n; r++)i.assertType(t.fileList[r], "string", "parameter.fileList[" + r + "]"); if (e.appConfig.getTempFileURLMaxReq && t.fileList.length > e.appConfig.getTempFileURLMaxReq) throw new o.CloudSDKError({ errCode: d.ERR_CODE.SDK_API_PARAMETER_ERROR, errMsg: "parameter.fileList exceed max length " + e.appConfig.getTempFileURLMaxReq }) }(t), t.fileList.length ? [4, function (t) { return n.__awaiter(this, void 0, void 0, function () { var r, i, o, a; return n.__generator(this, function (n) { switch (n.label) { case 0: return r = { fileid_list: t.fileList }, i = s.serialize(r), t.timing.tunnelStartTime = +new Date, [4, e.request({ apiName: "tcbapi_deletefile", serviceName: e.name, serializedReqData: i, env: t.config && t.config.env || e.env })]; case 1: return o = n.sent(), t.timing.tunnelEndTime = +new Date, a = o.data, t.timing.tunnelTimeNoCSNetCost = a.baseresponse.stat.qbase_cost_time, [2, { errMsg: u.apiSuccessMsg(p), fileList: a.delete_list.map(function (e) { return { fileID: e.fileid, status: e.status, errMsg: e.errmsg } }) }] } }) }) }(t)] : [2, { errMsg: u.apiSuccessMsg(p), fileList: [] }]; case 1: return [2, a.sent()]; case 2: throw r = a.sent(), o.returnAsFinalCloudSDKError(r, p); case 3: return l.reportAPISpeed(n.__assign({}, t.timing, { apiEndTime: +new Date, apiName: p })), [7]; case 4: return [2] } }) }) } function r(t, r) { _.isDevTools() && f.autoDevtoolsNetworkLog(t, function () { return { url: "wx.cloud.deleteFile", headers: { Env: r.config && r.config.env || e.env }, reqBody: s.serialize(r.fileList), console: e.debug } }) } } }, "./src/services/storage/api/downloadFile.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"), i = r("./src/utils/assert.ts"), o = r("./src/utils/type.ts"), s = r("./src/utils/fn/clone.ts"), a = r("./src/utils/error.ts"), u = r("./src/hook/invoke.ts"), c = r("./src/externals/public-lib/appserviceSdk.ts"), l = r("./src/utils/report.ts"), d = r("./src/config/error.config.ts"), f = "cloud.downloadFile"; t.default = function (e) { return function (e) { if (e = s.shallowClone(e), u.hasAPICallback(e)) return function (e) { var r = { aborted: !1 }, i = function (e) { return { onProgressUpdate: function (t) { e.onProgressUpdateUserHandler = t }, abort: function () { e.abort && e.abort(), e.aborted = !0 } } }(r), o = { apiStartTime: +new Date }; return t(n.__assign({}, e, { context: r, timing: o, downloadTaskAgent: i })).then(function (t) { u.invokeSuccessCompleteCallbacks(f, e, t) }).catch(function (t) { u.invokeFailCompleteCallbacks(f, e, t) }), i }(e); var r = { apiStartTime: +new Date }; return t(n.__assign({}, e, { timing: r })) }; function t(t) { return n.__awaiter(this, void 0, void 0, function () { var r = this; return n.__generator(this, function (s) { return [2, new Promise(function (s, u) { return n.__awaiter(r, void 0, void 0, function () { var r, _; return n.__generator(this, function (p) { switch (p.label) { case 0: return p.trys.push([0, 2, 3, 4]), function (e) { i.assertType(e, { fileID: "string" }), e.config && e.config.env && i.assertType(e.config.env, "string") }(t), t.context && (t.context.abort = function () { u(a.returnAsFinalCloudSDKError({ errMsg: "abort" }, f)) }, t.context.aborted) ? [2, u(a.returnAsFinalCloudSDKError({ errMsg: "abort" }, f))] : [4, function (t) { return n.__awaiter(this, void 0, void 0, function () { var r, i; return n.__generator(this, function (s) { switch (s.label) { case 0: return r = c.getSDK(e.identifiers), [4, function (t) { return n.__awaiter(this, void 0, void 0, function () { var r, i, o, s; return n.__generator(this, function (n) { switch (n.label) { case 0: return r = JSON.stringify({ fileid: t.fileID }), i = +new Date, [4, e.request({ apiName: "tcbapi_downloadfile", serviceName: e.name, serializedReqData: r, env: t.config && t.config.env || e.env })]; case 1: if (o = n.sent(), s = o.data, t.timing && (t.timing.tunnelStartTime = i, t.timing.tunnelEndTime = +new Date, t.timing.tunnelTimeNoCSNetCost = s.baseresponse.stat.qbase_cost_time), !s.download_url) throw new a.CloudSDKError({ errCode: d.ERR_CODE.SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_DOWNLOAD_URL, errMsg: d.ERR_CODE[d.ERR_CODE.SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_DOWNLOAD_URL] }); return s.download_url.indexOf("?") > -1 ? s.download_url += "&skip_domain_check=true" : s.download_url += "?skip_domain_check=true", [2, s.download_url] } }) }) }(t)]; case 1: return i = s.sent(), [2, new Promise(function (e, n) { if (t.context && t.context.aborted) return n(a.returnAsFinalCloudSDKError({ errMsg: "abort" }, f)); var s = r.downloadFile({ url: i, success: function (t) { e(t) }, fail: function (e) { n(e) } }); s.onProgressUpdate(function () { t.downloadTaskAgent && t.context && t.context.onProgressUpdateUserHandler && o.isFunction(t.context.onProgressUpdateUserHandler) && t.context.onProgressUpdateUserHandler.apply(r.downloadFile, arguments) }), t.context && (t.context.abort = s.abort.bind(s)) })] } }) }) }(t)]; case 1: return r = p.sent(), s(r), [3, 4]; case 2: return _ = p.sent(), u(a.returnAsFinalCloudSDKError(_, f)), [3, 4]; case 3: return l.reportAPISpeed(n.__assign({}, t.timing, { apiEndTime: +new Date, apiName: f })), [7]; case 4: return [2] } }) }) })] }) }) } } }, "./src/services/storage/api/getTempFileURL.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"), i = r("./src/utils/assert.ts"), o = r("./src/utils/error.ts"), s = r("./src/utils/serializer.ts"), a = r("./src/hook/invoke.ts"), u = r("./src/utils/msg.ts"), c = r("./src/utils/fn/clone.ts"), l = r("./src/utils/type.ts"), d = r("./src/utils/report.ts"), f = r("./src/config/error.config.ts"), _ = r("./src/externals/globals/devtools.ts"), p = r("./src/externals/globals/wxconfig.ts"), h = "cloud.getTempFileURL"; t.default = function (e) { return function (e) { var n = c.shallowClone(e); if (n.timing = { apiStartTime: +new Date }, a.hasAPICallback(n)) return function (e) { var n = t(e); n.then(function (t) { a.invokeSuccessCompleteCallbacks(h, e, t) }).catch(function (t) { a.invokeFailCompleteCallbacks(h, e, t) }), r(n, e) }(n); var i = t(n); return r(i, n), i }; function t(t) { return n.__awaiter(this, void 0, void 0, function () { var r; return n.__generator(this, function (a) { switch (a.label) { case 0: return a.trys.push([0, 2, 3, 4]), function (t) { if (i.assertType(t, { fileList: "array" }), t.config && t.config.env && i.assertType(t.config.env, "string"), e.appConfig.getTempFileURLMaxReq && t.fileList.length > e.appConfig.getTempFileURLMaxReq) throw new o.CloudSDKError({ errCode: f.ERR_CODE.SDK_API_PARAMETER_ERROR, errMsg: "parameter.fileList exceed max length " + e.appConfig.getTempFileURLMaxReq }) }(t), t.fileList.length ? [4, function (t) { return n.__awaiter(this, void 0, void 0, function () { var r, i, o, a; return n.__generator(this, function (n) { switch (n.label) { case 0: return r = { file_list: t.fileList.map(function (e) { return l.isString(e) ? { fileid: e } : { fileid: e.fileID, max_age: e.maxAge } }) }, i = s.serialize(r), t.timing.tunnelStartTime = +new Date, [4, e.request({ apiName: "tcbapi_gettempfileurl", serviceName: e.name, serializedReqData: i, env: t.config && t.config.env || e.env })]; case 1: return o = n.sent(), t.timing.tunnelEndTime = +new Date, a = o.data, t.timing.tunnelTimeNoCSNetCost = a.baseresponse.stat.qbase_cost_time, [2, { errMsg: u.apiSuccessMsg(h), fileList: a.download_list.map(function (e) { return { fileID: e.fileid, tempFileURL: e.download_url, maxAge: e.max_age, status: e.status, errMsg: e.errmsg } }) }] } }) }) }(t)] : [2, { errMsg: u.apiSuccessMsg(h), fileList: [] }]; case 1: return [2, a.sent()]; case 2: throw r = a.sent(), o.returnAsFinalCloudSDKError(r, h); case 3: return d.reportAPISpeed(n.__assign({}, t.timing, { apiEndTime: +new Date, apiName: h })), [7]; case 4: return [2] } }) }) } function r(t, r) { p.isDevTools() && _.autoDevtoolsNetworkLog(t, function () { return { url: "wx.cloud.getTempFileURL", headers: { Env: r.config && r.config.env || e.env }, reqBody: s.serialize(r.fileList), console: e.debug } }) } } }, "./src/services/storage/api/uploadFile.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"), i = r("./src/utils/assert.ts"), o = r("./src/utils/error.ts"), s = r("./src/utils/type.ts"), a = r("./src/utils/fn/clone.ts"), u = r("./src/hook/invoke.ts"), c = r("./src/utils/msg.ts"), l = r("./src/externals/public-lib/appserviceSdk.ts"), d = r("./src/utils/report.ts"), f = r("./src/config/error.config.ts"), _ = "cloud.uploadFile"; t.default = function (e) { return function (e) { if (e = a.shallowClone(e), u.hasAPICallback(e)) return function (e) { var r = { aborted: !1 }, i = function (e) { return { onProgressUpdate: function (t) { e.onProgressUpdateUserHandler = t }, abort: function () { e.abort && e.abort(), e.aborted = !0 } } }(r), o = { apiStartTime: +new Date }; return t(n.__assign({}, e, { context: r, timing: o, uploadTaskAgent: i })).then(function (t) { u.invokeSuccessCompleteCallbacks(_, e, t) }).catch(function (t) { u.invokeFailCompleteCallbacks(_, e, t) }), i }(e); var r = { apiStartTime: +new Date }; return t(n.__assign({}, e, { timing: r })) }; function t(t) { var r = this; return new Promise(function (a, u) { return n.__awaiter(r, void 0, void 0, function () { var r, p; return n.__generator(this, function (h) { switch (h.label) { case 0: return h.trys.push([0, 2, 3, 4]), function (e) { i.assertType(e, { cloudPath: "string", filePath: "string" }), e.config && e.config.env && i.assertType(e.config.env, "string") }(t), function (t) { n.__awaiter(this, void 0, void 0, function () { return n.__generator(this, function (r) { return [2, new Promise(function (r, n) { wx.getFileInfo ? wx.getFileInfo({ filePath: t, success: function (t) { t.size > e.appConfig.uploadMaxFileSize ? n(new o.CloudSDKError({ errCode: f.ERR_CODE.SDK_STORAGE_EXCEED_MAX_UPLOAD_SIZE, errMsg: "exceed max upload file size: " + e.appConfig.uploadMaxFileSize / 1024 / 1024 + " MB" })) : r() }, fail: function () { r() } }) : r() })] }) }) }(t.filePath), t.context && (t.context.abort = function () { u(o.returnAsFinalCloudSDKError({ errMsg: "abort" }, _)) }, t.context.aborted) ? [2, u(o.returnAsFinalCloudSDKError({ errMsg: "abort" }, _))] : [4, function (t) { return n.__awaiter(this, void 0, void 0, function () { var r, i; return n.__generator(this, function (a) { switch (a.label) { case 0: return r = l.getSDK(e.identifiers), [4, function (t) { return n.__awaiter(this, void 0, void 0, function () { var r, i, s, a; return n.__generator(this, function (n) { switch (n.label) { case 0: return r = JSON.stringify({ path: t.cloudPath }), i = +new Date, [4, e.request({ apiName: "tcbapi_uploadfile", serviceName: e.name, serializedReqData: r, env: t.config && t.config.env || e.env })]; case 1: if (s = n.sent(), a = s.data, t.timing && (t.timing.tunnelStartTime = i, t.timing.tunnelEndTime = +new Date, t.timing.tunnelTimeNoCSNetCost = a.baseresponse.stat.qbase_cost_time), !a.upload_url) throw new o.CloudSDKError({ errCode: f.ERR_CODE.SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_UPLOAD_URL, errMsg: f.ERR_CODE[f.ERR_CODE.SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_UPLOAD_URL] }); return a.upload_url.indexOf("?") > -1 ? a.upload_url += "&skip_domain_check=true" : a.upload_url += "?skip_domain_check=true", [2, a.upload_url] } }) }) }(t)]; case 1: return i = a.sent(), [2, new Promise(function (e, n) { if (t.context && t.context.aborted) return n(o.returnAsFinalCloudSDKError({ errMsg: "abort" }, _)); var a = r.uploadFile({ url: i, filePath: t.filePath, header: t.header, name: "file", success: function (t) { try { var r = JSON.parse(t.data); if (r.data && (r = r.data), r.fileid) e({ errMsg: c.apiSuccessMsg(_), fileID: r.fileid, statusCode: t.statusCode }); else { var i = new o.CloudSDKError({ errMsg: "empty fileid; " + r.message + ";" }); n(i) } } catch (i) { var s = new o.CloudSDKError({ errMsg: "Error parsing response data " + t.data + ";" }); n(s) } }, fail: function (e) { n(e) } }); a.onProgressUpdate(function () { t.uploadTaskAgent && t.context && t.context.onProgressUpdateUserHandler && s.isFunction(t.context.onProgressUpdateUserHandler) && t.context.onProgressUpdateUserHandler.apply(r.uploadFile, arguments) }), t.context && (t.context.abort = a.abort.bind(a)) })] } }) }) }(t)]; case 1: return r = h.sent(), a(r), [3, 4]; case 2: return p = h.sent(), u(o.returnAsFinalCloudSDKError(p, _)), [3, 4]; case 3: return d.reportAPISpeed(n.__assign({}, t.timing, { apiEndTime: +new Date, apiName: _ })), [7]; case 4: return [2] } }) }) }) } } }, "./src/services/storage/index.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/storage/api/api.ts"); t.STORAGE_SERVICE_NAME = "storage", t.registerService = function (e) { e.registerService(function (e) { var r = { name: t.STORAGE_SERVICE_NAME, identifiers: e.identifiers, request: e.request, get env() { return e.getEnvForService(t.STORAGE_SERVICE_NAME) }, get debug() { return e.debug }, appConfig: { get uploadMaxFileSize() { return e.appConfig.upload_max_file_size }, get getTempFileURLMaxReq() { return e.appConfig.get_temp_file_url_max_requests } } }; return { name: t.STORAGE_SERVICE_NAME, context: r, getAPIs: n.getAPIs.bind(null, r) } }(e)) } }, "./src/services/utils/api/CloudID.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/utils/symbol.ts"); t.default = function (e) { var t = function () { function e(e) { this._internalType = n.SYMBOL_CLOUD_ID, this.cloudID = e, Object.defineProperties(this, { _internalType: { enumerable: !1, configurable: !1 } }) } return e.prototype.toJSON = function () { return this.cloudID }, e.prototype.toString = function () { return this.cloudID }, e }(); return function (e) { return new t(e) } } }, "./src/services/utils/api/api.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/utils/api/CloudID.ts"); t.getAPIs = function (e) { return { CloudID: n.default(e) } } }, "./src/services/utils/index.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/services/utils/api/api.ts"); t.UTILS_SERVICE_NAME = "utils", t.registerService = function (e) { e.registerService(function (e) { var r = { name: t.UTILS_SERVICE_NAME, identifiers: e.identifiers, request: e.request, get debug() { return e.debug } }; return { name: t.UTILS_SERVICE_NAME, context: r, getAPIs: n.getAPIs.bind(null, r) } }(e)) } }, "./src/utils/assert.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/utils/type.ts"), i = r("./src/utils/error.ts"), o = r("./src/config/error.config.ts"); function s(e, t, r) { void 0 === r && (r = "parameter"); var i = function e(t, r, i) { var o = n.getType(t), s = n.getType(r); if ("string" === s) return o !== r ? i + " should be " + r + " instead of " + o + ";" : ""; if (o !== s) return i + " should be " + s + " instead of " + o + "; "; var a = ""; switch (o) { case "object": for (var u in r) a += e(t[u], r[u], i + "." + u); break; case "array": for (var c = 0; c < r.length; c++)a += e(t[c], r[c], i + "[" + c + "]") }return a }(e, t, r); return { passed: !i, reason: i } } t.validType = s, t.assertType = function (e, t, r, n) { void 0 === r && (r = "parameter"), void 0 === n && (n = i.CloudSDKError); var a = s(e, t, r); if (!a.passed) throw new n({ errCode: o.ERR_CODE.SDK_API_PARAMETER_TYPE_ERROR, errMsg: a.reason }) }, t.assertRequiredParam = function (e, t, r, n) { if (void 0 === n && (n = i.CloudSDKError), void 0 === e || null === e) throw new n({ errCode: o.ERR_CODE.SDK_API_PARAMETER_ERROR, errMsg: "parameter " + t + " of function " + r + " must be provided" }) }, t.assertStringLength = function (e) { var t = e.name, r = e.input, n = e.max, s = e.maxWording, a = void 0 === s ? "" : s, u = e.ErrorClass, c = void 0 === u ? i.CloudSDKError : u; if (r.length > n) throw new c({ errCode: o.ERR_CODE.SDK_API_PARAMETER_ERROR, errMsg: t + " size must be less than " + (a || n) }) }, t.assertObjectNotEmpty = function (e) { var t = e.target, r = e.name, n = e.ErrorClass, s = void 0 === n ? i.CloudSDKError : n; if (0 === Object.keys(t).length) throw new s({ errCode: o.ERR_CODE.SDK_API_PARAMETER_ERROR, errMsg: r + " must not be empty" }) } }, "./src/utils/error.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"), i = r("./src/utils/type.ts"), o = r("./src/utils/msg.ts"), s = r("./src/config/error.config.ts"), a = function (e) { function t(t) { var r = e.call(this, t.errMsg) || this; return r.errCode = -1, Object.defineProperties(r, { message: { get: function () { return "errCode: " + this.errCode + " " + (s.ERR_CODE[this.errCode] || "") + " | errMsg: " + this.errMsg }, set: function (e) { this.errMsg = e } } }), r.errCode = t.errCode || -1, r.errMsg = t.errMsg, r } return n.__extends(t, e), Object.defineProperty(t.prototype, "message", { get: function () { return "errCode: " + this.errCode + " | errMsg: " + this.errMsg }, set: function (e) { this.errMsg = e }, enumerable: !0, configurable: !0 }), t }(Error); function u(e) { return e && e instanceof Error && i.isString(e.errMsg) } function c(e, t) { if (void 0 === t && (t = ""), e) { if (u(e)) return t && (e.errMsg += "; " + t), e; var r = e ? e.errCode : void 0, n = (e && e.errMsg || e.toString() || "unknown error") + "; " + t; return new a({ errCode: r, errMsg: n }) } return new a({ errMsg: t }) } t.CloudSDKError = a, t.isSDKError = u, t.returnAsCloudSDKError = c, t.returnAsFinalCloudSDKError = function (e, t) { if (e && u(e)) return e; var r = c(e, "at " + t + " api; "); return r.errMsg = o.apiFailMsg(t, r.errMsg), r }, t.isGenericError = function (e) { return e.generic }; var l = function (e) { function t(t, r) { var n = e.call(this, t) || this; return n.type = "timeout", n.payload = void 0, n.generic = !0, n.payload = r, n } return n.__extends(t, e), t }(Error); t.TimeoutError = l, t.isTimeoutError = function (e) { return "timeout" === e.type }; var d = function (e) { function t(t) { var r = e.call(this, t) || this; return r.type = "cancelled", r.payload = null, r.generic = !0, r } return n.__extends(t, e), t }(Error); t.CancelledError = d, t.isCancelledError = function (e) { return "cancelled" === e.type } }, "./src/utils/fail-safe.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./src/utils/error.ts"), i = r("./src/utils/type.ts"), o = r("./src/externals/public-lib/reporter.ts"); function s(e, t) { void 0 === t && (t = ""); try { return e() } catch (e) { if (n.isSDKError(e)) return e.errMsg += t, e; var r = (e ? e.toString() : "") + t; return new n.CloudSDKError({ errMsg: r }) } } t.tryCatch = s, t.wrapWithTryCatch = function (e, t) { return void 0 === t && (t = ""), function () { for (var r = [], n = 0; n < arguments.length; n++)r[n] = arguments[n]; return s(function () { return e.apply(e, r) }, t) } }, t.wrapParamCallbacksWithTryCatch = function (e) { var t = e.param; t && (t.success && i.isFunction(t.success) && (t.success = o.default.surroundThirdByTryCatch(t.success, "at api " + e.apiName + " success callback function")), t.fail && i.isFunction(t.fail) && (t.fail = o.default.surroundThirdByTryCatch(t.fail, "at api " + e.apiName + " fail callback function")), t.complete && i.isFunction(t.complete) && (t.complete = o.default.surroundThirdByTryCatch(t.complete, "at api " + e.apiName + " complete callback function"))) } }, "./src/utils/fn/clone.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"), i = r("./src/utils/type.ts"); t.shallowClone = function (e, t) { if (void 0 === t && (t = !1), t) return function (e) { switch (i.getType(e)) { case "object": return n.__assign({}, e); case "array": return e.slice(); case "number": return e instanceof Number ? new Number(e) : e; case "string": return e instanceof String ? new String(e) : e; case "boolean": return e instanceof Boolean ? new Boolean(e) : e; case "date": return new e.constructor(+e); case "map": return new Map(e); case "set": return new Set(e); default: return e } }(e); if (i.isPlainObject(e)) return n.__assign({}, e); switch (i.getType(e)) { case "object": return e; case "array": return e.slice(); default: return e } } }, "./src/utils/msg.ts": function (e, t) { Object.defineProperty(t, "__esModule", { value: !0 }), t.apiSuccessMsg = function (e) { return e + ":ok" }, t.apiCancelMsg = function (e, t) { return e + ":cancel " + t }, t.apiFailMsg = function (e, t) { return e + ":fail " + t } }, "./src/utils/report.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"), i = r("./src/externals/public-lib/reporter.ts"), o = r("./src/externals/public-lib/appserviceSdk.ts"), s = r("./src/utils/type.ts"), a = !1, u = [], c = "unknown"; t.init = function () { if (!a) try { var e = o.getSDK(); e.wx.getNetworkType({ success: function (e) { c = e.networkType }, complete: function () { a = !0, l() } }), e.wx.onNetworkStatusChange(function (e) { a || (a = !0, l()), c = e.networkType }) } catch (e) { 0 } }; var l = function () { var e, t; try { for (var r = n.__values(u), i = r.next(); !i.done; i = r.next()) { var o = i.value; try { o() } catch (e) { 0 } } } catch (t) { e = { error: t } } finally { try { i && !i.done && (t = r.return) && t.call(r) } finally { if (e) throw e.error } } u = [] }; t.reportAPISpeed = function (e) { setTimeout(function () { try { if (!function (e) { return !(e.tunnelStartTime && e.tunnelEndTime && e.tunnelEndTime < e.tunnelStartTime || !(e.apiStartTime && e.apiEndTime && e.apiEndTime > e.apiStartTime)) }(e)) return; if (!a && u.length < 100) return void u.push(t.reportAPISpeed.bind(null, e)); var r = e.apiEndTime - e.apiStartTime, n = e.tunnelEndTime ? e.tunnelEndTime - e.tunnelStartTime : 0, o = [0, e.apiName, r, n, (e.pollStartTime && e.pollEndTime && e.pollEndTime > e.pollStartTime ? e.pollEndTime - e.pollStartTime : 0) || 0, c, e.tunnelTimeNoCSNetCost ? r - e.tunnelTimeNoCSNetCost : 0, e.tunnelTimeNoCSNetCost ? n - e.tunnelTimeNoCSNetCost : 0, e.funcExecTime ? e.funcExecTime : 0]; i.default.reportKeyValue({ key: "CloudReport", value: o.join(","), force: !0 }) } catch (e) { } }) }, t.reportIDKey = function (e, t, r, n) { i.default.reportIDKeyDirectly({ id: e, key: t, force: r, immediately: n }) }, t.wrapTiming = function (e, r) { var i = s.isFunction(e); function o() { for (var t = [], n = 0; n < arguments.length; n++)t[n] = arguments[n]; if (r.samplePicker && !r.samplePicker.next()) return i ? e.apply(this, t) : e; var o = Date.now(), u = !0; try { if (r.condition && r.condition.emptyKey && r.timing[r.startKey]) return i ? e.apply(this, t) : e; var c = void 0; if (i) { var l = e.apply(this, t); if (!s.isPromise(l)) return u = !1, l; c = l } else c = e; return c.then(function () { return a(o) }).catch(function () { return a(o) }), c } catch (e) { throw u = !1, e } finally { u || a(o) } } function a(e) { r.timing[r.startKey] = e, r.timing[r.endKey] = Date.now(), r.autoReport && t.reportAPISpeed(n.__assign({}, r.timing, { apiName: r.autoReport })) } return i ? o : o() }; t.socketOnMessageSamplePicker = function (e, t) { return function () { var r, i; return n.__generator(this, function (n) { switch (n.label) { case 0: r = function () { return parseInt(Math.round(2 * Math.random() * e), 10) }, i = t ? 0 : r(), n.label = 1; case 1: return i > 0 ? (i-- , [4, !1]) : [3, 3]; case 2: return n.sent(), [3, 5]; case 3: return i = r(), [4, !0]; case 4: n.sent(), n.label = 5; case 5: return [3, 1]; case 6: return [2] } }) } }(10, !0)() }, "./src/utils/serializer.ts": function (e, t, r) { Object.defineProperty(t, "__esModule", { value: !0 }); var n = r("./node_modules/tslib/tslib.es6.js"), i = r("./src/utils/error.ts"), o = r("./src/config/error.config.ts"), s = r("./src/utils/type.ts"); function a(e, t) { switch (s.getType(t)) { case "arraybuffer": var r = new Uint8Array(t); return { type: "Buffer", data: n.__spread(r) } }return t } function u(e) { switch (s.getType(e)) { case "object": return function e(t) { var r = t; var n = c(r); if (r !== n) return n; for (var i in r) { var o = r[i], a = s.getType(o); switch (a) { case "object": var l = c(o); r[i] = l !== o ? l : e(r[i]); break; case "array": var l = u(o); l !== o && (r[i] = l); break; default: continue } } return r }(e); case "array": return e.map(u); default: return e } } function c(e) { for (var t in e) switch (t) { case "type": switch (e.type) { case "Buffer": if (s.isArray(e.data) && s.isNumber(e.data[0])) try { return new Uint8Array(e.data).buffer } catch (t) { return e } } }return e } t.serialize = function (e) { return JSON.stringify(e, a) }, t.stringifyReplacer = a, t.toJSONSerializable = function e(t, r) { if (void 0 === r && (r = "data"), null !== t && void 0 !== t) { if (!0 === t || !1 === t) return t; switch (s.getType(t)) { case "number": if (isFinite(t)) return t; break; case "string": return t; case "array": return t.map(function (t, n) { return e(t, r + "[" + n + "]") }); case "object": var a = {}; for (var u in t) t.hasOwnProperty(u) && (a[u] = e(t[u], r + "." + u)); return a; case "arraybuffer": var c = new Uint8Array(t); return { type: "Buffer", data: n.__spread(c) } }if ("function" == typeof t) return t; !function (e) { throw new i.CloudSDKError({ errCode: o.ERR_CODE.SDK_API_PARAMETER_TYPE_ERROR, errMsg: e + " is not JSON-serializable" }) }(r) } }, t.deserialize = function (e) { return u(JSON.parse(e)) } }, "./src/utils/symbol.ts": function (e, t) { Object.defineProperty(t, "__esModule", { value: !0 }), t.SYMBOL_CLOUD_ID = Symbol.for("CLOUD_ID") }, "./src/utils/type.ts": function (e, t) { Object.defineProperty(t, "__esModule", { value: !0 }), t.getType = function (e) { return Object.prototype.toString.call(e).slice(8, -1).toLowerCase() }, t.isObject = function (e) { return "object" === t.getType(e) }, t.isString = function (e) { return "string" === t.getType(e) }, t.isNumber = function (e) { return "number" === t.getType(e) }, t.isPromise = function (e) { return "promise" === t.getType(e) }, t.isFunction = function (e) { return "function" == typeof e }, t.isArray = function (e) { return Array.isArray(e) }, t.isDate = function (e) { return "date" === t.getType(e) }, t.isRegExp = function (e) { return "regexp" === t.getType(e) }, t.isInternalObject = function (e) { return e && "symbol" === t.getType(e._internalType) }, t.isPlainObject = function (e) { if ("object" != typeof e || null === e) return !1; for (var t = e; null !== Object.getPrototypeOf(t);)t = Object.getPrototypeOf(t); return Object.getPrototypeOf(e) === t } }, "./src/utils/utils.ts": function (e, t, r) { (function (e) { var n = this; Object.defineProperty(t, "__esModule", { value: !0 }); var i = r("./node_modules/tslib/tslib.es6.js"), o = r("./src/externals/public-lib/appserviceSdk.ts"); t.sleep = function (e) { return void 0 === e && (e = 0), new Promise(function (t) { return setTimeout(t, e) }) }, t.nextLoop = function () { return new Promise(function (t) { return e(t) }) }; var s, a = {}; t.autoCount = function (e) { return void 0 === e && (e = "any"), a[e] || (a[e] = 0), a[e]++ }, t.getWXVersion = function () { var e, t, r = o.getSDK().wx; if (r && r.version) { e = r.version.version, t = r.version.updateTime; var n = r.version.updateTime.match(/^(\d+)\.(\d+)\.(\d+)/); return { version: e, updateTime: t, updateDateInDashes: n ? n[1] + "-" + n[2] + "-" + n[3] : "unknown" } } return { version: "unknown", updateTime: "unknown", updateDateInDashes: "unknown" } }; var u = !1, c = []; t.getNetworkStatus = function () { return new Promise(function (e, t) { if (s) e(s); else { 0; try { o.getSDK().wx.getNetworkType({ success: function (t) { s = { networkType: t.networkType, isConnected: "none" !== t.networkType }, e(s), u || (o.getSDK().wx.onNetworkStatusChange(function (e) { if (s.networkType = e.networkType, s.isConnected = e.isConnected, e.isConnected && c.length) for (; c.length;)try { c.shift()() } catch (e) { } }), u = !0) }, fail: t }) } catch (e) { t(e) } } }) }, t.throwErrorIfNetworkOffline = function () { return new Promise(function (e, r) { return i.__awaiter(n, void 0, void 0, function () { return i.__generator(this, function (n) { switch (n.label) { case 0: return n.trys.push([0, 2, , 3]), [4, t.getNetworkStatus()]; case 1: return n.sent().isConnected ? e() : r("network offline"), [3, 3]; case 2: return n.sent(), e(), [3, 3]; case 3: return [2] } }) }) }) }, t.onceNetworkOnline = function () { return new Promise(function (e) { s && s.isConnected ? e() : c.push(e) }) } }).call(this, r("./node_modules/timers-browserify/main.js").setImmediate) } });
; try {
  var apis = __cloudSDK__.getCloudAPI()
  if (!wx.cloud) {
    wx.cloud = apis
  } else {
    for (var api in apis) {
      wx.cloud[api] = apis[api]
    }
  }
} catch (err) {
  console.warn('cloud sdk injection failed with error', err)
}
wx.wx = wx